{"version":3,"file":"index-BSTIYNG1.js","sources":["../../src/scripts/util/vector2d.ts","../../src/scripts/util/util.ts","../../src/scripts/const/const.ts","../../src/scripts/interaction/ui.ts","../../src/scripts/simulation/gravity.ts","../../src/scripts/util/transformations.ts","../../src/scripts/animation/view-controller.ts","../../src/scripts/animation/animation-controller.ts","../../src/scripts/types/types.ts","../../src/scripts/interaction/interaction-manager.ts","../../src/scripts/animation/canvas.ts","../../src/scripts/simulation/body2d.ts","../../src/scripts/app/app.ts","../../src/scripts/app/main.ts"],"sourcesContent":["export interface Coordinate {\r\n    x: number,\r\n    y: number,\r\n}\r\nexport class Vector2D {\r\n    public x: number;\r\n    public y: number;\r\n    constructor()\r\n    constructor(pos: Coordinate)\r\n    constructor(x: number, y: number)\r\n    constructor(a?: number | Coordinate, b?: number) {\r\n        if (typeof a === \"object\") {\r\n            this.x = a.x;\r\n            this.y = a.y;\r\n        } else {\r\n            this.x = a ?? 0;\r\n            this.y = b ?? 0;\r\n        }\r\n    }\r\n    public toString() {\r\n        return `x: ${this.x}, y: ${this.y}`;\r\n    }\r\n    public add(...vectors: Coordinate[]): Vector2D {\r\n        const result = vectors.reduce((previous, current) => {\r\n            return { x: (previous.x + current.x), y: (previous.y + current.y) };\r\n        }, {x: this.x, y: this.y});\r\n        return new Vector2D(result.x, result.y);\r\n    }\r\n    /**\r\n     * @returns this - v\r\n     */\r\n    public subtract(v: Coordinate): Vector2D {\r\n        return new Vector2D(this.x - v.x, this.y - v.y);\r\n    }\r\n    public scale(scalar: number): Vector2D {\r\n        return new Vector2D(this.x * scalar, this.y * scalar);\r\n    }\r\n    public dotProduct(v: Coordinate): number {\r\n        return this.x * v.x + this.y * v.y;\r\n    }\r\n    public magnitude(): number {\r\n        return Math.hypot(this.x, this.y);\r\n    }\r\n    public normalize(): Vector2D {\r\n        const magnitude = this.magnitude();\r\n        if (magnitude === 0) {\r\n            return new Vector2D(0, 0);\r\n        } else {\r\n            return this.scale(1 / magnitude);\r\n        }\r\n    }\r\n    /**\r\n     * @param v Vector2D\r\n     * @returns Distance to v\r\n     */\r\n    public distance(v: Coordinate): number {\r\n        return Math.hypot(v.x - this.x, v.y - this.y);\r\n    }\r\n    /**\r\n     * returns a vector pointing from this to v\r\n     */\r\n    public displacementVector(v: Coordinate) {\r\n        const vector = new Vector2D(v.x, v.y);\r\n        return vector.subtract(this);\r\n    }\r\n    public hadamardProduct(v: Coordinate) {\r\n        return new Vector2D(this.x * v.x, this.y * v.y);\r\n    }\r\n    /**\r\n     * @returns an array of two normalized vectors, both normal to this, both pointing in opposite directions\r\n     */\r\n    public normalVectors(): Vector2D[] {\r\n        const array: Vector2D[] = [];\r\n        const v = this.normalize();\r\n        array.push(new Vector2D(-v.y, v.x));\r\n        array.push(new Vector2D(v.y, -v.x));\r\n        return array;\r\n    }\r\n    public midpoint(p2: Vector2D): Vector2D {\r\n        return new Vector2D((this.x + p2.x) / 2, (this.y + p2.y) / 2);\r\n    }\r\n    /**\r\n     * Reflects this vector on reflectionSurface.\r\n     * @param reflectionSurface acts as a mirror\r\n     * @returns The reflected vector\r\n     */\r\n    public reflect(reflectionSurface: Vector2D): Vector2D {\r\n        reflectionSurface = reflectionSurface.normalize();\r\n        const axis = reflectionSurface.normalVectors()[0];\r\n        const dotAxis = this.dotProduct(axis);\r\n        const projection = axis.scale(dotAxis).scale(2);\r\n        const reflected = this.subtract(projection);\r\n        return reflected;\r\n    }\r\n    /**\r\n     * @param line1 defined by two points\r\n     * @param line2 defined by two points\r\n     * @param strict false by default. If true, the intersection must be within the line segments defined by the coordinates, not just the infinite lines.\r\n     * @returns The intersection of the two lines: a point, null if they don't intersect, or a line (defined by two points) if they are identical, or collinear and overlapping.\r\n     * https://stackoverflow.com/a/565282/97076991 - authored by ai.\r\n     */\r\n    public static linesIntersecting(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D], strict = false): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        if (rCrossS === 0) {\r\n            if (qmpCrossR === 0) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (tMin === tMax) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < 0 || t > 1 || u < 0 || u > 1) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n    public static midpoint(v1: Coordinate, v2: Coordinate): Vector2D {\r\n        return new Vector2D((v1.x + v2.x) / 2, (v1.y + v2.y) / 2);\r\n    }\r\n    public static simpleLineIntersection(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D]): Vector2D | null {\r\n        // make sure lines are strictly defined (p1 != p2, same for line2)\r\n        \r\n        // check for general intersection\r\n\r\n        // if parallel or identical, -> null\r\n        // otherwise intersection: {x, y}\r\n\r\n        // order points so that p1.x <= p2.x and q1.x <= q2.x\r\n\r\n        // p1.x <= intersection.x <= p2.x\r\n        // q1.x <= intersection.x <= q2.x\r\n        // and same for y\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    /**\r\n     * Written by ChatGPT-4\r\n     * @param line1 \r\n     * @param line2 \r\n     * @param strict \r\n     * @param epsilon \r\n     * @returns \r\n     */\r\n    public static linesIntersectingButBetter(\r\n        line1: [p1: Vector2D, p2: Vector2D],\r\n        line2: [q1: Vector2D, q2: Vector2D],\r\n        strict = false,\r\n        epsilon = 1e-9 // Default epsilon value\r\n    ): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        // Using epsilon for floating-point precision comparison\r\n        const isZero = (value: number) => Math.abs(value) < epsilon;\r\n\r\n        if (isZero(rCrossS)) {\r\n            if (isZero(qmpCrossR)) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (isZero(tMin - tMax)) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < -epsilon || t > 1 + epsilon || u < -epsilon || u > 1 + epsilon) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n\r\n}","\r\n/*\r\nJust Some functions\r\n(hopefully moderately helpful)\r\n*/\r\n\r\nimport { Vector2D } from \"./vector2d\";\r\n\r\n//#region generic stuff\r\nexport function log(message: string) {\r\n    const timestamp = new Date();\r\n    const hours = timestamp.getHours().toString().padStart(2, '0');\r\n    const minutes = timestamp.getMinutes().toString().padStart(2, '0');\r\n    const seconds = timestamp.getSeconds().toString().padStart(2, '0');\r\n    const milliseconds = timestamp.getMilliseconds().toString().padStart(3, '0');\r\n\r\n    const formattedTimestamp = `${hours}:${minutes}:${seconds}.${milliseconds}`;\r\n    console.log(`[${formattedTimestamp}] ${message}`);\r\n}\r\n/**\r\n * min and max included\r\n * @returns random number\r\n */\r\nexport function rng(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\n//#endregion\r\n\r\n//#region math stuff\r\n/**\r\n * empty string is NOT considered numeric\r\n * @param s the string to be examined\r\n * @returns true if s is a valid number, returns false otherwise\r\n */\r\nexport function isNumeric(s: string): boolean {\r\n    s = s.trim();\r\n    return (!isNaN(+s)) && s.length !== 0;\r\n}\r\n/**\r\n * @returns \"\", if d is a non-numeric string\r\n */\r\nexport function decimalToHex(d: string | number): string {\r\n    if (typeof(d) === \"string\")  {\r\n        if (isNumeric(d)) {\r\n            d = parseFloat(d);\r\n        } else {\r\n            return \"\";\r\n        }\r\n    }\r\n    return d.toString(16);\r\n}\r\n/**\r\n * converts a hexadecimal-number-string to a decimal number and returns it\r\n * @returns 0 if hex is not a valid hexadecimal number\r\n */\r\nexport function hexToDecimal(hex: string): number {\r\n    const prefix = \"0x\"\r\n    if (!(hex.startsWith(prefix))) {\r\n        hex = prefix + hex;\r\n    }\r\n    const num: number = Number(hex);\r\n    const valid = !isNaN(num);\r\n    return valid ? num : 0;\r\n}\r\n/**\r\n * \r\n * @returns n if n satisfies min <= n <= max, otherwise min or max are returned\r\n * @param n number to test against upper and lower bounds\r\n * @param min the lowest allowed value for n\r\n * @param max the highest allowed value for n\r\n */\r\nexport function clamp(n: number, min: number, max: number): number {\r\n    if (min > max) {\r\n        throw new Error(\"In function clamp: min cannot be greater than max\");\r\n    }\r\n    return Math.max(min, Math.min(n, max))\r\n}\r\nexport function isInRange(n: number, min: number, max: number): boolean {\r\n    return n >= min && n <= max;\r\n}\r\n//#endregion\r\n\r\n//#region string stuff\r\n/**\r\n * Removes all occurrences of charToRemove from the beginning of str\r\n * @param str the string to be modified\r\n * @param charToRemove ***optional*** If no value is provided the first character of str is used. Can be more than one character.\r\n * @returns the modified string\r\n */\r\nexport function removeLeadingChar(str: string, charToRemove?: string): string {\r\n    if (str.length < 1) { return \"\"; }\r\n    if (charToRemove === undefined) {\r\n        charToRemove = str[0];\r\n    }\r\n\r\n    while (str.startsWith(charToRemove)) {\r\n        str = str.slice(charToRemove.length);\r\n    }\r\n    return str;\r\n}\r\n//#endregion\r\n\r\n//#region input stuff\r\nexport function getInputValue(input: string | HTMLInputElement): string {\r\n    let inputElement: HTMLInputElement;\r\n    if (typeof input === \"string\") {\r\n        inputElement = document.getElementById(input) as HTMLInputElement;\r\n    } else {\r\n        inputElement = input;\r\n    }\r\n    return inputElement.value.trim();\r\n}\r\n/**\r\n * @param input an HTMLInputElement, or the id for the Element\r\n * @returns element's value attribute; 0 if value is not numeric\r\n */\r\nexport function getInputNumber(input: string | HTMLInputElement): number {\r\n    const inputValue = getInputValue(input);\r\n    return isNumeric(inputValue) ? +inputValue : 0;\r\n}\r\nexport function getAbsolutePointerPosition(ev: PointerEvent | WheelEvent | MouseEvent): { x: number, y: number } {\r\n    return { x: ev.clientX, y: ev.clientY };\r\n}\r\n\r\n/**\r\n * Calculates and returns the velocity vector needed to get from *fromCoordinate* to *toCoordinate* in *timeFrameInSeconds* seconds\r\n * @param toCoordinate value in simulation space\r\n * @param fromCoordinate value in simulation space\r\n * @param timeFrameInSeconds *optional* defaults to 1\r\n */\r\nexport function calculateVelocityBetweenPoints(toCoordinate: Vector2D | {x: number, y: number}, fromCoordinate: Vector2D, timeFrameInSeconds: number = 1): Vector2D {\r\n    if (timeFrameInSeconds <= 0) { timeFrameInSeconds = 1; }\r\n    const toVector = toCoordinate instanceof Vector2D ? toCoordinate : new Vector2D(toCoordinate)\r\n    const distance: Vector2D = toVector.subtract(fromCoordinate);\r\n    return distance.scale(1 / timeFrameInSeconds);\r\n}\r\n/**\r\n * returns n in hex formatted string, with length >= 2. \r\n * @param n number to convert\r\n */\r\nexport function twoDigitHex(n: number) {\r\n    return n.toString(16).padStart(2, \"0\");\r\n}\r\n//#endregion","\r\n//#region physics\r\nexport const DEFAULT_G = 50;\r\nexport const MIN_G = -10;\r\nexport const MAX_G = 100;\r\n//#endregion\r\n\r\n//#region animation\r\nexport const MIN_ZOOM = 0.05;\r\nexport const MAX_ZOOM = 100;\r\nexport const DEFAULT_ZOOM_FACTOR = 0.075;\r\nexport const DEFAULT_SCROLL_RATE = 0.1;\r\nexport const VECTOR_THICKNESS = 1;\r\nexport const MIN_DISPLAYED_RADIUS = 0.75;\r\nexport const BACKGROUND_COLOR = \"#222222ff\";\r\nexport const VECTOR_COLORS: Map<string, {hex: string, name: string}> = new Map()\r\n    .set(\"acceleration\",    { hex: \"#20ff20ff\", name: \"Green\" })\r\n    .set(\"velocity\",        { hex: \"#ffd700ff\", name: \"Yellow\" });\r\n//#endregion\r\n","import * as util from \"../util/util\";\r\nimport { RadioButtonGroup, StatusBar, UIAnimationSettings, SimulationSettings } from \"../types/types\";\r\nimport { App } from \"../app/app\";\r\nimport { VECTOR_COLORS } from \"../const/const\";\r\n\r\nexport class UI {\r\n//#region properties\r\n    // All UI Elements\r\n    private statusBar: StatusBar;\r\n    private resetButton: HTMLInputElement;\r\n    private playPauseButton: HTMLInputElement;\r\n    private stepButton: HTMLInputElement;\r\n    private repositoryLink: HTMLElement;\r\n    private zoomInButton: HTMLInputElement;\r\n    private zoomOutButton: HTMLInputElement;\r\n    private scrollUpButton: HTMLInputElement;\r\n    private scrollDownButton: HTMLInputElement;\r\n    private scrollLeftButton: HTMLInputElement;\r\n    private scrollRightButton: HTMLInputElement;\r\n    private displayVectorsCheckbox: HTMLInputElement;\r\n    private collisionDetectionCheckbox: HTMLInputElement;\r\n    private elasticCollisionsCheckbox: HTMLInputElement;\r\n    private gravitationalConstantInput: HTMLInputElement;\r\n    private gravitationalConstantRangeInput: HTMLInputElement;\r\n    private clickAction: RadioButtonGroup;\r\n    private massInput: HTMLInputElement;\r\n    private movableCheckbox: HTMLInputElement;\r\n//#endregion\r\n//#region get, set\r\n    // get all the values\r\n    private get collisionDetection() {\r\n        return this.collisionDetectionCheckbox.checked;\r\n    }\r\n    private get elasticCollisions() {\r\n        return this.elasticCollisionsCheckbox.checked;\r\n    }\r\n    private get gravitationalConstant() {\r\n        return util.getInputNumber(this.gravitationalConstantInput);\r\n    }\r\n    private get displayVectors() {\r\n        return this.displayVectorsCheckbox.checked;\r\n    }\r\n    private get mass() {\r\n        return util.getInputNumber(this.massInput);\r\n    }\r\n    private get movable() {\r\n        return this.movableCheckbox.checked;\r\n    }\r\n    get selectedClickAction() {\r\n        return this.getSelectedValue(this.clickAction) ?? this.clickAction.buttons[0].value;\r\n    }\r\n    get animationSettings(): UIAnimationSettings {\r\n        return {\r\n            displayVectors: this.displayVectors,\r\n        };\r\n    }\r\n    get simulationSettings(): SimulationSettings {\r\n        return {\r\n            collisionDetection: this.collisionDetection,\r\n            elasticCollisions: this.elasticCollisions,\r\n            gravitationalConstant: this.gravitationalConstant,\r\n        };\r\n    }\r\n    get bodyInformation() {\r\n        return {\r\n            mass: this.mass,\r\n            movable: this.movable,\r\n        }\r\n    }\r\n//#endregion\r\n//#region initialize\r\n    constructor(private app: App) {\r\n        this.resetButton                        = document.getElementById(\"btnResetSim\")! as HTMLInputElement;\r\n        this.playPauseButton                    = document.getElementById(\"btnToggleSim\")! as HTMLInputElement;\r\n        this.stepButton                         = document.getElementById(\"btnNextStep\")! as HTMLInputElement;\r\n        this.repositoryLink                     = document.getElementById(\"repoLink\")!;\r\n        this.zoomInButton                       = document.getElementById(\"btnZoomIn\")! as HTMLInputElement;\r\n        this.zoomOutButton                      = document.getElementById(\"btnZoomOut\")! as HTMLInputElement;\r\n        this.scrollUpButton                     = document.getElementById(\"btnScrollUp\")! as HTMLInputElement;\r\n        this.scrollDownButton                   = document.getElementById(\"btnScrollDown\")! as HTMLInputElement;\r\n        this.scrollLeftButton                   = document.getElementById(\"btnScrollLeft\")! as HTMLInputElement;\r\n        this.scrollRightButton                  = document.getElementById(\"btnScrollRight\")! as HTMLInputElement;\r\n        this.displayVectorsCheckbox             = document.getElementById(\"cbxDisplayVectors\")! as HTMLInputElement;\r\n        this.collisionDetectionCheckbox         = document.getElementById(\"cbxCollisions\")! as HTMLInputElement;\r\n        this.elasticCollisionsCheckbox          = document.getElementById(\"cbxElasticCollisions\")! as HTMLInputElement;\r\n        this.gravitationalConstantInput         = document.getElementById(\"numberG\")! as HTMLInputElement;\r\n        this.gravitationalConstantRangeInput    = document.getElementById(\"rangeG\")! as HTMLInputElement;\r\n        this.massInput                          = document.getElementById(\"massInput\")! as HTMLInputElement;\r\n        this.movableCheckbox                    = document.getElementById(\"cbxBodyMovable\")! as HTMLInputElement;\r\n        this.clickAction = {\r\n            name: \"radioBtnMouseAction\",\r\n            buttons: Array.from(document.querySelectorAll('input[name=\"radioBtnMouseAction\"]')) as HTMLInputElement[]\r\n        };\r\n        this.statusBar = (() => {\r\n            const bar = document.getElementById(\"statusBar\") as HTMLDivElement;\r\n            return {\r\n                bar: bar,\r\n                fields: Array.from((bar.querySelectorAll(\".statusBarItem\")) as NodeListOf<HTMLSpanElement>)\r\n            };\r\n        })();\r\n\r\n        this.registerEvents();\r\n    }\r\n    private registerEvents() {\r\n        this.resetButton.addEventListener(\"click\", () => this.resetButtonClicked());\r\n        this.playPauseButton.addEventListener(\"click\", () => this.playPauseClicked());\r\n        this.stepButton.addEventListener(\"click\", () => this.stepButtonClicked());\r\n        this.zoomInButton.addEventListener(\"click\", () => this.zoomInClicked());\r\n        this.zoomOutButton.addEventListener(\"click\", () => this.zoomOutClicked());\r\n        this.scrollUpButton.addEventListener(\"click\", () => this.scrollUpClicked());\r\n        this.scrollDownButton.addEventListener(\"click\", () => this.scrollDownClicked());\r\n        this.scrollLeftButton.addEventListener(\"click\", () => this.scrollLeftClicked());\r\n        this.scrollRightButton.addEventListener(\"click\", () => this.scrollRightClicked());\r\n        this.displayVectorsCheckbox.addEventListener(\"change\", () => this.cbxDisplayVectorsChanged());\r\n        this.collisionDetectionCheckbox.addEventListener(\"change\", () => this.cbxCollisionsChanged());\r\n        this.elasticCollisionsCheckbox.addEventListener(\"change\", () => this.cbxCollisionsChanged());\r\n        this.gravitationalConstantInput.addEventListener(\"change\", () => this.numberInputGChanged());\r\n        this.gravitationalConstantRangeInput.addEventListener(\"input\", () => this.rangeInputGChanged());\r\n        this.massInput.addEventListener(\"change\", () => this.updateSelectedMass());\r\n    }\r\n    public initialize(width: number, height: number) {\r\n        this.elasticCollisionsCheckbox.disabled = !this.collisionDetectionCheckbox.checked;\r\n        this.massInput.step = this.calculateMassInputStep();\r\n        \r\n        this.setStatusBarVectors()\r\n        \r\n        this.updateStatusBarCanvasDimensions(width, height);\r\n\r\n        this.app.applySimulationSettings({gravitationalConstant: Number(this.gravitationalConstantRangeInput.value)})\r\n    }\r\n//#endregion\r\n    public resetButtonClicked() {\r\n        this.app.resetSimulation()\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public playPauseClicked() {\r\n        if (this.app.simulationRunning) {\r\n            this.app.stop();\r\n        } else {\r\n            this.app.run();\r\n        }\r\n    }\r\n    public stepButtonClicked() {\r\n        this.app.advanceOneTick();\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public zoomInClicked() {\r\n        this.app.zoomIn();\r\n        this.updateStatusBarAnimationInfo();\r\n    }\r\n    public zoomOutClicked() {\r\n        this.app.zoomOut();\r\n        this.updateStatusBarAnimationInfo();\r\n    }\r\n    public scrollUpClicked() {\r\n        this.app.scrollUp();\r\n    }\r\n    public scrollDownClicked() {\r\n        this.app.scrollDown();\r\n    }\r\n    public scrollLeftClicked() {\r\n        this.app.scrollLeft();\r\n    }\r\n    public scrollRightClicked() {\r\n        this.app.scrollRight();\r\n    }\r\n    public cbxDisplayVectorsChanged() {\r\n        this.app.setDisplayVectors(this.displayVectors)\r\n        this.setStatusBarVectors();\r\n    }\r\n    public cbxCollisionsChanged() {\r\n        const checked = this.collisionDetectionCheckbox.checked;\r\n        const elasticChecked = this.elasticCollisionsCheckbox.checked;\r\n        \r\n        this.elasticCollisionsCheckbox.disabled = !checked;\r\n        \r\n        const simulationSettings: SimulationSettings = {\r\n            collisionDetection: checked,\r\n            elasticCollisions: elasticChecked,\r\n        }\r\n\r\n        this.app.applySimulationSettings(simulationSettings);\r\n    }\r\n    public numberInputGChanged() {\r\n        const newG: string = this.gravitationalConstantInput.value;\r\n        this.gravitationalConstantRangeInput.value = newG;\r\n        this.app.applySimulationSettings({gravitationalConstant: Number(newG) });\r\n    }\r\n    public rangeInputGChanged() {\r\n        const newG: string = this.gravitationalConstantRangeInput.value;\r\n        if (this.gravitationalConstantInput.value !== newG) {\r\n            this.gravitationalConstantInput.value = newG;\r\n            this.app.applySimulationSettings({gravitationalConstant: Number(newG) });\r\n        }\r\n    }\r\n    public simulationStopped() {\r\n        this.playPauseButton.innerHTML = \"&#9654;\"; // play symbol\r\n        this.stepButton.disabled = false;\r\n    }\r\n    public simulationResumed() {\r\n        this.playPauseButton.innerHTML = \"&#10074;&#10074;\"; // pause symbol\r\n        \r\n        this.stepButton.disabled = true;\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public getSelectedValue(group: RadioButtonGroup): string | null {\r\n        const selected = group.buttons.find(btn => btn.checked);\r\n        return selected?.value ?? null;\r\n    }\r\n    public updateSelectedMass() {\r\n        this.massInput.step = this.calculateMassInputStep();\r\n    }\r\n    /**\r\n     * The step is equal to 10% of the input value, rounded down to the nearest power of 10.\r\n     * @returns Step as a string. Step is always at least 1 or larger.\r\n     */\r\n    private calculateMassInputStep(): string {\r\n        let step = 10 ** (Math.floor(Math.log10(this.mass)) - 1);\r\n        return step < 1 ? \"1\" : step.toString();\r\n    }\r\n    private setStatusBarVectors() {\r\n        if (this.displayVectors) {\r\n            this.setStatusMessage(this.statusBarVectorMessage(), 3);\r\n        } else {\r\n            this.setStatusMessage(\"\", 3);\r\n        }\r\n    }\r\n    public updateStatusBarSimulationInfo() {\r\n        this.updateStatusBarTickCount(this.app.tick);\r\n        this.updateStatusBarBodyCount(this.app.currentSimulationState.length);\r\n    }\r\n    public updateStatusBarAnimationInfo() {\r\n        this.updateStatusBarZoom(this.app.currentZoom);\r\n    }\r\n    public updateStatusBarBodyCount(bodyCount: number, statusBarFieldIndex: number = 1) {\r\n        this.setStatusMessage(`Number of Bodies: ${bodyCount}`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarTickCount(tickCount: number, statusBarFieldIndex: number = 2) {\r\n        this.setStatusMessage(`Simulation Tick: ${tickCount}`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarZoom(currentZoom: number, statusBarFieldIndex: number = 4) {\r\n        this.setStatusMessage(`Zoom: ${currentZoom.toFixed(2)} (m per pixel)`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarCanvasDimensions(width: number, height: number, statusBarFieldIndex: number = 5) {\r\n        this.setStatusMessage(`Canvas dimension: ${width} * ${height}`, statusBarFieldIndex);\r\n    }\r\n    private statusBarVectorMessage() {\r\n        return `Acceleration: ${VECTOR_COLORS.get(\"acceleration\")?.name} - Velocity: ${VECTOR_COLORS.get(\"velocity\")?.name}`;\r\n    }\r\n    /**\r\n     * @param fieldIndexOrId number of field (starting at one) OR id of the field\r\n     */\r\n    private setStatusMessage(message: string, fieldIndexOrId?: number | string, append: boolean = false) {\r\n        let element: HTMLElement;\r\n        if (typeof fieldIndexOrId === \"number\") {\r\n            element = this.statusBar.fields[fieldIndexOrId - 1];\r\n        } else if (typeof fieldIndexOrId === \"string\") {\r\n            element = document.getElementById(fieldIndexOrId)!;\r\n        } else {\r\n            element = this.statusBar.fields[0];\r\n        }\r\n        \r\n        if (append) {\r\n            element!.innerHTML += message;\r\n        } else {\r\n            element!.innerHTML = message;\r\n        }\r\n    }\r\n\r\n}","import { ObjectState, SimulationSettings } from \"../types/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport * as c from \"../const/const\";\r\nimport { SimulationAPI } from \"../types/apis\";\r\nimport { clamp } from \"../util/util\";\r\nimport { Body2d } from \"./body2d\";\r\n\r\n\r\nexport class Gravity implements SimulationAPI {\r\n    private _simulationState: ObjectState[]; // Insertion Order is not preserved (bc we delete bodies using swap & pop). Switch to map at some point\r\n    private _running: boolean;\r\n    private _tickCount: number;\r\n    private _tickLength: number;\r\n    private _collisionDetection: boolean;\r\n    private _elasticCollisions: boolean;\r\n    private _g: number; // gravitational constant\r\n    private readonly gravityLowerBounds: number = 1; // force calculations for distances lower than this number are skipped\r\n//#region get, set\r\n    get simulationState() {\r\n        return this._simulationState;\r\n    }\r\n    get tick() {\r\n        return this._tickCount;\r\n    }\r\n    get running() {\r\n        return this._running;\r\n    }\r\n    get collisionSettings(): { collisionDetection: boolean, elastic: boolean } {\r\n        return { collisionDetection: this._collisionDetection, elastic: this._elasticCollisions };\r\n    }\r\n    get g(): number {\r\n        return this._g;\r\n    }\r\n\r\n    private set g(newG: number) {\r\n        this._g = clamp(newG, c.MIN_G, c.MAX_G);\r\n    }\r\n    private set collisionDetection(collisionDetection: boolean) {\r\n        this._collisionDetection = collisionDetection;\r\n    }\r\n    private set elasticCollisions(elastic: boolean) {\r\n        this._elasticCollisions = elastic;\r\n    }\r\n// #endregion\r\n    constructor() { \r\n        this._simulationState = [];\r\n        this._running = false;\r\n        this._tickCount = 0;\r\n        this._tickLength = 10; // ms\r\n        this._collisionDetection = false;\r\n        this._elasticCollisions = false;\r\n        this._g = c.DEFAULT_G;\r\n    }\r\n    public applySettings(settings: SimulationSettings): void {\r\n        if (settings.collisionDetection != undefined)       this.collisionDetection = settings.collisionDetection;\r\n        if (settings.elasticCollisions != undefined)        this.elasticCollisions = settings.elasticCollisions;\r\n        if (settings.gravitationalConstant != undefined)    this.g = settings.gravitationalConstant;\r\n    }\r\n    public addBody(body: Body2d, position: Vector2D, velocity: Vector2D): number {\r\n\r\n        const objectState = { body, position, velocity,  acceleration: new Vector2D(0, 0)};\r\n        if (!body.movable) {\r\n            objectState.velocity = new Vector2D(0, 0);\r\n        }\r\n        return this.addObject(objectState);\r\n    }\r\n    public stop() {\r\n        this._running = false;\r\n    }\r\n    public run() {\r\n        if (this._running) {\r\n            return;\r\n        }\r\n        this._running = true;\r\n\r\n        const runSimulationStep = () => {\r\n            if (this._running) {\r\n                setTimeout(runSimulationStep, this._tickLength);\r\n                this.advanceTick();\r\n            }\r\n        };\r\n        runSimulationStep();\r\n    }\r\n    public reset() {\r\n        this.clearObjects();\r\n        this._tickCount = 0;\r\n    }\r\n    public advanceTick() {\r\n        this.updateAccelerationVectors();\r\n        this.updateVelocitiesAndPositions();\r\n        if (this._collisionDetection) {\r\n            this.handleCollisions();\r\n        }\r\n        this._tickCount++;\r\n    }    \r\n    private addObject(objectState: ObjectState): number  {\r\n        if (!objectState.body.movable) {\r\n            objectState.velocity = new Vector2D(0, 0);\r\n        }\r\n        return this.simulationState.push(objectState);\r\n    }\r\n    private clearObjects() {\r\n        this._simulationState = [];\r\n    }\r\n    private removeFromObjectStates(index: number) {\r\n        this.simulationState[index] = this.simulationState[this.simulationState.length - 1];\r\n        this.simulationState.pop();\r\n    }\r\n    private updateAccelerationVectors() {\r\n        const forces: Map<number, Vector2D> = this.calculateForces();\r\n\r\n        this.simulationState.forEach((objectState, index) => {\r\n            const totalForceOnBody = forces.get(index) || (new Vector2D(0, 0));\r\n            const newAcceleration = totalForceOnBody.scale(1 / objectState.body.mass);\r\n            objectState.acceleration = newAcceleration;\r\n        });\r\n    }\r\n    private calculateForces() {\r\n        const forces: Map<number, Vector2D> = new Map();\r\n        \r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const forceOnI = this.calculateForceBetweenBodies(i, j);\r\n                const forceOnJ = forceOnI.scale(-1);\r\n\r\n                forces.set(i, (forces.get(i) || new Vector2D(0, 0)).add(forceOnI));\r\n                forces.set(j, (forces.get(j) || new Vector2D(0, 0)).add(forceOnJ));\r\n            }\r\n        }\r\n        return forces;\r\n    }\r\n    /**\r\n     * Calculates the next **position** and **velocity** of the object in state, and updates objectState accordingly.\r\n     * @param objectState *ObjectState* containing the body\r\n     */\r\n    private updateVelocityAndPosition(objectState: ObjectState) {\r\n        const dt = this._tickLength / 1000;\r\n        if (!objectState.body.movable) { return; }\r\n        objectState.velocity = objectState.velocity.add(objectState.acceleration.scale(dt));\r\n        objectState.position = objectState.position.add(objectState.velocity.scale(dt));\r\n    }\r\n    private updateVelocitiesAndPositions() {\r\n        this.simulationState.forEach(objectState => {\r\n            this.updateVelocityAndPosition(objectState)\r\n        });\r\n    }\r\n    /**\r\n     * Calculates the force-vector between the bodies in objectStates at index [i] and [j]\r\n     * @returns a vector representing the force applied ***to*** body at ***objectStates[i]***\r\n     */\r\n    private calculateForceBetweenBodies(i: number, j: number): Vector2D {\r\n        const objectStateI = this.simulationState[i];\r\n        const objectStateJ = this.simulationState[j];\r\n\r\n        const distance = objectStateI.position.distance(objectStateJ.position);\r\n        if (distance < this.gravityLowerBounds || distance === 0) // if the bodies are too close, skip the calculation\r\n            { return new Vector2D(0, 0); } \r\n        const netForceBetweenBodies: number = this._g * ((objectStateI.body.mass * objectStateJ.body.mass)/(distance * distance));\r\n        const unitVectorIToJ = objectStateJ.position.subtract(objectStateI.position).normalize();\r\n        return unitVectorIToJ.scale(netForceBetweenBodies);\r\n    }\r\n    private handleCollisions() {\r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            const objectStateI = this.simulationState[i];\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const objectStateJ = this.simulationState[j];\r\n                const distanceIJ = objectStateI.position.distance(objectStateJ.position);\r\n                const collision = distanceIJ <= objectStateI.body.radius + objectStateJ.body.radius;\r\n                if (collision) {\r\n                    if (distanceIJ <= objectStateI.body.radius || distanceIJ <= objectStateJ.body.radius) { \r\n                        this.mergeBodies(i, j);\r\n                    } else if (this._elasticCollisions) {\r\n                        this.elasticCollision(objectStateI, objectStateJ);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Merges the two bodies at indices in objectStates into one. The lighter body is merged into the heavier one. Momentum is preserved.\r\n     */\r\n    private mergeBodies(index1: number, index2: number) {\r\n        const state1: ObjectState = this.simulationState[index1];\r\n        const state2: ObjectState = this.simulationState[index2];\r\n        const totalMomentum = state1.velocity.scale(state1.body.mass).add(state2.velocity.scale(state2.body.mass));\r\n        const totalMass = state1.body.mass + state2.body.mass;\r\n        const resultingVelocity = totalMomentum.scale(1 / totalMass);\r\n        let changeObject: ObjectState;\r\n        let removeIndex: number;\r\n\r\n        if (state2.body.mass > state1.body.mass) {\r\n            changeObject = state2;\r\n            removeIndex = index1;\r\n        } else {\r\n            changeObject = state1;\r\n            removeIndex = index2;\r\n        }\r\n        changeObject.velocity = resultingVelocity;\r\n        changeObject.body.setProperties(totalMass);\r\n        \r\n        changeObject.body.movable = (state1.body.movable && state2.body.movable);\r\n        if (!changeObject.body.movable) {\r\n            changeObject.velocity = new Vector2D(0, 0);\r\n        }\r\n        this.removeFromObjectStates(removeIndex);\r\n    }\r\n    /**\r\n    * @param restitution number between 0 (perfectly inelastic) and 1 (perfectly elastic)\r\n    */\r\n    private elasticCollision(body1: ObjectState, body2: ObjectState, restitution: number = 1) {\r\n        const lowerBounds = 1;\r\n\r\n        // normal vector between the bodies\r\n        const displacement = body1.position.displacementVector(body2.position);\r\n        const distance = displacement.magnitude(); \r\n        if (distance <= lowerBounds || distance === 0) {\r\n            return; \r\n        }\r\n        const normalizedDisplacement = displacement.scale(1 / distance);\r\n\r\n        // relative velocity along the normalDisplacement?\r\n        const relativeVelocity = body2.velocity.subtract(body1.velocity);\r\n        const velocityAlongDisplacement = relativeVelocity.dotProduct(normalizedDisplacement);\r\n\r\n        // if the bodies are moving apart, do nothing\r\n        if (velocityAlongDisplacement > 0) { return; }\r\n\r\n        // impulseScalar = change in momentum as scalar\r\n        const impulseScalar = -(1 + restitution) * velocityAlongDisplacement / (body1.body.mass + body2.body.mass);\r\n\r\n        // update velocities based on the impulse scalar\r\n        const deltaV1 = normalizedDisplacement.scale(impulseScalar * body2.body.mass);\r\n        const deltaV2 = normalizedDisplacement.scale(impulseScalar * body1.body.mass);\r\n        body1.velocity = body1.velocity.subtract(deltaV1);\r\n        body2.velocity = body2.velocity.add(deltaV2);\r\n        \r\n        // REFACTOR ME: at the top, check for movable, if not just reflect velocity\r\n        // if a body is immovable, reset its velocity and transfer it back\r\n        if (!body1.body.movable) {\r\n            body1.velocity = new Vector2D(0, 0);\r\n            body2.velocity = body2.velocity.add(deltaV1);\r\n        }\r\n        if (!body2.body.movable) {\r\n            body2.velocity = new Vector2D(0, 0);\r\n            body1.velocity = body1.velocity.add(deltaV2);\r\n        }\r\n    }\r\n    private placeBodiesTangentially(objectState1: ObjectState, objectState2: ObjectState) {\r\n        const displacement = objectState1.position.displacementVector(objectState2.position);\r\n        const normalDisplacement = displacement.normalize();        \r\n        const targetDistance = objectState1.body.radius + objectState2.body.radius;\r\n        const totalMoveDistance = targetDistance - displacement.magnitude();\r\n        if (targetDistance === 0) {\r\n            return;\r\n        }\r\n        const moveBody1 = normalDisplacement.scale(totalMoveDistance * (objectState1.body.radius / targetDistance));\r\n        const moveBody2 = normalDisplacement.scale(totalMoveDistance * (objectState2.body.radius / targetDistance));\r\n    \r\n        objectState1.position = objectState1.position.subtract(moveBody1);\r\n        objectState2.position = objectState2.position.add(moveBody2);\r\n    }\r\n}\r\n","import { CanvasSpace } from \"../types/types\";\r\nimport { Coordinate, Vector2D } from \"./vector2d\";\r\nexport function relativePosition(absolutePosition: Coordinate, element: HTMLElement): Vector2D {\r\n    const elementRect = element.getBoundingClientRect();\r\n    const x = absolutePosition.x - elementRect.left;\r\n    const y = absolutePosition.y - elementRect.top;\r\n    return new Vector2D(x, y);\r\n}\r\n/**\r\n * Transforms a point from a canvas which is defined by canvasSpace (zoom, origin).\r\n * @param direction *Vector2d* representing a coordinate.\r\n * @param canvasSpace \r\n * @returns the transformed Vector2D\r\n */\r\nexport function pointFromCanvasToSimulation(point: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. scale (canvasVector * zoom in simulationUnits/canvasUnit)\r\n    // 2. flip (y axis are in opposite directions)\r\n    // 3. shift (scaledAndFlippedPoint + Origin of C in SimSpace)\r\n    const scaled = point.scale(canvasSpace.currentZoom);\r\n    const flipped = scaled.hadamardProduct(new Vector2D(1, canvasSpace.orientationY));\r\n    const shifted = flipped.add(canvasSpace.origin);\r\n    return shifted;\r\n}\r\n\r\n/**\r\n * Transforms a point from cartesian space to its position on a canvas, defined by canvasSpace.\r\n * @param direction *Vector2d* representing a coordinate.\r\n * @param canvasSpace \r\n * @returns the transformed Vector2D\r\n */\r\nexport function pointFromSimulationToCanvas(point: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. shift (point in SimSpace - Origin of C in SimSpace)\r\n    // 2. flip (y axis point in opposite directions)\r\n    // 3. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const shifted: Vector2D = point.subtract(canvasSpace.origin);\r\n    const flipped: Vector2D = new Vector2D(shifted.x, shifted.y * -1);\r\n    const scaled: Vector2D = flipped.scale(1 / canvasSpace.currentZoom);\r\n    return scaled;\r\n}\r\n/**\r\n * Transforms a direction/distance from cartesian space to its position on a canvas, defined by canvasSpace.\r\n * @param direction *Vector2d* representing a direction (a vector from the origin to this coordinate)\r\n * @param canvasSpace \r\n * @returns the transformed Vector2D\r\n */\r\nexport function directionFromSimulationToCanvas(direction: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. flip (y axis are in opposite directions)\r\n    // 2. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const flipped: Vector2D = new Vector2D(direction.x, direction.y * -1);\r\n    const scaled: Vector2D = flipped.scale(1 / canvasSpace.currentZoom);\r\n    return scaled;\r\n}\r\n","import { MAX_ZOOM, MIN_ZOOM } from \"../const/const\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport { AnimationController } from \"./animation-controller\";\r\n\r\n/**\r\n * This class is responsible for the view into the simulation, which is defined by the CanvasSpace-Interface.\r\n * That includes: scrolling/panning, and zoom.\r\n */\r\n\r\nexport class ViewController {\r\n    constructor(\r\n        private animation: AnimationController,\r\n    ) {}\r\n\r\n    private get canvasSpace() {\r\n        return this.animation.canvasSpace;\r\n    }\r\n    private get currentZoom() {\r\n        return this.canvasSpace.currentZoom;\r\n    }\r\n\r\n    public scroll(displacement: { x: number; y: number }) {\r\n        this.moveOrigin(displacement);\r\n    }\r\n\r\n    public zoomToFactor(factor: number, zoomCenter: Vector2D): number {\r\n        if (factor <= 0) return this.currentZoom;\r\n        \r\n        const oldZoom = this.currentZoom;\r\n        const newZoom = oldZoom * factor;\r\n        const zoomDelta = oldZoom - newZoom;\r\n\r\n        return this.zoomByStep(zoomCenter, zoomDelta)\r\n    }\r\n\r\n    /**\r\n     * Zoom is measured in simulationUnits (meter) per canvasUnit (pixel)\r\n     * @param zoomCenter this point stays fixed while zooming\r\n     * @param zoomStep the change in meter per pixel. positive = zoom in, negative = zoom out\r\n     * @returns the new zoom level\r\n     */\r\n    public zoomByStep(zoomCenter: Vector2D, zoomStep: number): number {\r\n        let newZoom = this.canvasSpace.currentZoom - zoomStep;\r\n        if (newZoom < MIN_ZOOM) {\r\n            newZoom = MIN_ZOOM;\r\n            zoomStep = this.canvasSpace.currentZoom - MIN_ZOOM;\r\n        } else if (newZoom > MAX_ZOOM) {\r\n            newZoom = MAX_ZOOM;\r\n            zoomStep = MAX_ZOOM - this.canvasSpace.currentZoom;\r\n        }\r\n        \r\n        const shiftOrigin: Vector2D = zoomCenter.scale(zoomStep);\r\n        this.moveOrigin(shiftOrigin.hadamardProduct({x: 1, y: -1}));\r\n        this.canvasSpace.currentZoom = newZoom;\r\n\r\n        return newZoom;\r\n    }\r\n    private moveOrigin(displacement: { x: number, y: number}) {\r\n        const originPosition = this.canvasSpace.origin;\r\n        const newOrigin = originPosition.add(displacement);\r\n        this.setOrigin(newOrigin);\r\n    }\r\n    /**\r\n     * Origin {x:0,y:0} is at the top-left\r\n     */\r\n    private setOrigin(newOrigin: Vector2D) {\r\n        this.canvasSpace.origin = newOrigin;\r\n    }\r\n\r\n}","import { BACKGROUND_COLOR, DEFAULT_SCROLL_RATE, DEFAULT_ZOOM_FACTOR, MAX_ZOOM, MIN_DISPLAYED_RADIUS, MIN_ZOOM, VECTOR_COLORS } from \"../const/const\";\r\nimport { Canvas } from \"./canvas\";\r\nimport { Body2d } from \"../simulation/body2d\";\r\nimport { AnimationSettings, CanvasSpace, ObjectState, UIAnimationSettings } from \"../types/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport * as tfm from \"../util/transformations\";\r\nimport * as util from \"../util/util\";\r\nimport { ViewController } from \"./view-controller\";\r\nimport { App } from \"../app/app\";\r\n\r\n/**\r\n * This class deals with everything animation related.\r\n */\r\nexport class AnimationController {\r\n//#region properties\r\n    private _canvasSpace: CanvasSpace;\r\n    private _animationSettings: AnimationSettings;\r\n    private _viewController: ViewController;\r\n    private _running: boolean;\r\n//#endregion\r\n//#region get, set\r\n    private get canvas(): Canvas {\r\n        return this._canvas;\r\n    }\r\n    private set canvas(canvas: Canvas) {\r\n        this._canvas = canvas;\r\n    }\r\n\r\n    private get viewController() {\r\n        return this._viewController;\r\n    }\r\n\r\n    get animationSettings(): AnimationSettings {\r\n        return this._animationSettings;\r\n    }\r\n    set animationSettings(animationSettings: AnimationSettings) {\r\n        this._animationSettings = animationSettings;\r\n    }\r\n\r\n    get canvasSpace() {\r\n        return this._canvasSpace;\r\n    }\r\n    private set canvasSpace(canvasSpace: CanvasSpace) {\r\n        this._canvasSpace = canvasSpace;\r\n    }\r\n\r\n    private get app() {\r\n        return this._app;\r\n    }\r\n\r\n    get running() {\r\n        return this._running;\r\n    }\r\n    private set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    // additional getters\r\n    get currentZoom(): number {\r\n        return this.canvasSpace.currentZoom;\r\n    }\r\n    get width(): number {\r\n        return this.canvas.width;\r\n    }\r\n    get height(): number {\r\n        return this.canvas.height;\r\n    }\r\n//#endregion\r\n    constructor(\r\n        private _canvas: Canvas, \r\n        private _app: App\r\n    ) {\r\n        this._animationSettings = { frameLength: 25, displayVectors: true, tracePaths: true };\r\n        this._canvasSpace = {origin: new Vector2D(0, 0), currentZoom: 1, orientationY: -1};\r\n        this._viewController = new ViewController(this);\r\n        this._running = false;\r\n    }\r\n    public initialize(width: number, height: number, animationSettings: UIAnimationSettings) {\r\n        this.canvas.visibleCanvas.width = width;\r\n        this.canvas.visibleCanvas.height = height;\r\n\r\n        // REFACTOR ME: apply settings after initialization\r\n        this.animationSettings.displayVectors = animationSettings.displayVectors;\r\n        \r\n        // offscreenCanvas = new OffscreenCanvas(visibleCanvas.clientWidth, visibleCanvas.clientHeight);\r\n        // offscreenCanvasCtx = offscreenCanvas.getContext(\"2d\")!;\r\n    }\r\n    public run() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n        const loop = () => {\r\n            if (this.running) {\r\n                setTimeout(loop, this.animationSettings.frameLength);\r\n                this.redrawSimulationState(this.app.currentSimulationState, this.animationSettings);\r\n                this._app.updateStatusBarSimulationInfo();\r\n            }\r\n        };\r\n        loop();\r\n    }\r\n    public stop() {\r\n        this.running = false;\r\n    }\r\n    private drawBodies(objectStates: ObjectState[]) {\r\n        objectStates.forEach(object => {\r\n            this.drawBody(object.body, tfm.pointFromSimulationToCanvas(object.position, this.canvasSpace));\r\n        });\r\n    }\r\n    private drawBody(body: Body2d, position: Vector2D) {\r\n        let visibleRadius = Math.max(body.radius / this.currentZoom, MIN_DISPLAYED_RADIUS);\r\n        this.canvas.drawCircle(position, visibleRadius, body.color);\r\n    }\r\n    public redrawSimulationState(objectStates: ObjectState[], animationSettings: AnimationSettings) {\r\n        this.canvas.clear();\r\n        this.canvas.fillCanvas(BACKGROUND_COLOR);\r\n        this.drawBodies(objectStates);\r\n        if (animationSettings.displayVectors) {\r\n            this.drawVectors(objectStates);\r\n        }\r\n    }\r\n    private drawVectors(objectStates: ObjectState[]) {\r\n        objectStates.forEach(objectState => {\r\n            const positionOnCanvas = tfm.pointFromSimulationToCanvas(objectState.position, this.canvasSpace);\r\n            const accelerationOnCanvas = tfm.directionFromSimulationToCanvas(objectState.acceleration, this.canvasSpace);\r\n            const velocityOnCanvas = tfm.directionFromSimulationToCanvas(objectState.velocity, this.canvasSpace);\r\n            \r\n            this.canvas.drawVector(positionOnCanvas, accelerationOnCanvas, VECTOR_COLORS.get(\"acceleration\")?.hex);\r\n            this.canvas.drawVector(positionOnCanvas, velocityOnCanvas, VECTOR_COLORS.get(\"velocity\")?.hex);\r\n        });\r\n    }\r\n    public setDisplayVectors(display: boolean) {\r\n        this.animationSettings.displayVectors = display;\r\n    }\r\n    public resizeCanvas(width: number, height: number) {\r\n        this.canvas.resize(width, height);\r\n    }\r\n\r\n    public scrollRight(distance?: number) {\r\n    if (!distance) {\r\n        distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n    }\r\n    this.viewController.scroll({x: distance, y: 0});\r\n    }\r\n    public scrollLeft(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n        }\r\n        this.viewController.scroll({x: -distance, y: 0});\r\n    }\r\n    public scrollUp(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.viewController.scroll({x: 0, y: distance});\r\n    }\r\n    public scrollDown(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.viewController.scroll({x: 0, y: -distance});\r\n    }\r\n    private scrollDistance(orientation: \"horizontal\" | \"vertical\", rate: number = DEFAULT_SCROLL_RATE): number {\r\n        switch (orientation) {\r\n            case \"horizontal\":\r\n                return this.width * rate * this.canvasSpace.currentZoom;\r\n            case \"vertical\":\r\n                return this.height * rate * this.canvasSpace.currentZoom;\r\n        }\r\n    }\r\n    public zoomIn(\r\n        zoomCenter: Vector2D = new Vector2D(this.width / 2, this.height / 2),\r\n        factor: number = DEFAULT_ZOOM_FACTOR, \r\n    ): number {\r\n\r\n        return this.zoomToFactor(1 - factor, zoomCenter);\r\n    }\r\n    public zoomOut(\r\n        zoomCenter: Vector2D = new Vector2D(this.width / 2, this.height / 2),\r\n        factor: number = DEFAULT_ZOOM_FACTOR, \r\n    ): number {\r\n\r\n        return this.zoomToFactor(1 + factor, zoomCenter);\r\n\r\n    }\r\n    /**\r\n     * \r\n     * @param factor if this is 0 or less, nothing happens\r\n     * @param zoomCenter \r\n     * @returns the new zoom level (in meter/pixel).\r\n     */\r\n    public zoomToFactor(factor: number, zoomCenter?: Vector2D): number {\r\n        if (!zoomCenter) zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        \r\n        this.app.updateStatusBarAnimationInfo();\r\n        \r\n        return this.viewController.zoomToFactor(factor, zoomCenter);\r\n    }\r\n    public scrollInCanvasUnits(movementOnCanvas: Vector2D){\r\n        const movementInSimulationUnits = movementOnCanvas.scale(this.currentZoom);\r\n        this.viewController.scroll({ x: -(movementInSimulationUnits.x), y: movementInSimulationUnits.y });\r\n    }\r\n}","import { Body2d } from \"../simulation/body2d\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\n\r\n//++++++++++++++++++++\r\n//+ pointer (touch, mouse)\r\n//++++++++++++++++++++\r\nexport interface Pointer {\r\n    main: {\r\n        state: ButtonState;\r\n        downCoordinatesInSimSpace: Vector2D | undefined;\r\n    };\r\n    secondary: {\r\n        state: ButtonState;\r\n    };\r\n    wheel: {\r\n        state: ButtonState;\r\n    };\r\n}\r\nexport enum TouchAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    ManipulateView = 2\r\n}\r\nexport enum MouseAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    Scroll = 2,\r\n    Zoom = 3\r\n}\r\nexport interface MultiTouchGesture {\r\n    first: Vector2D;\r\n    second: Vector2D;\r\n    midpoint: Vector2D; \r\n    distance: number;\r\n}\r\nexport interface Mouse {\r\n   main: MouseButton;\r\n   secondary: MouseButton;\r\n   wheel: MouseButton;\r\n}\r\nexport interface MouseButton {\r\n    state: ButtonState;\r\n    downCoordinatesInSimSpace?: { x: number, y: number } | Vector2D;\r\n}\r\nexport enum ButtonState {\r\n    Up = 0,\r\n    Down = 1,\r\n}\r\nexport enum MouseButtons {\r\n    Main = 0,\r\n    Wheel = 1,\r\n    Secondary = 2,\r\n}\r\n\r\n//++++++++++++++++++++\r\n//+ view and animation\r\n//++++++++++++++++++++\r\nexport interface CanvasSpace {\r\n    // use this to transform simulationSpace to canvasSpace and back\r\n    origin: Vector2D, // the canvas' origin in simulation space\r\n    currentZoom: number, // simulationUnits (meter) per canvasUnit\r\n    orientationY: number; // in practice this is -1, as the y-axis of the canvas points in the opposite direction of the simulation\r\n}\r\nexport interface AnimationSettings {\r\n    frameLength: number; // ms\r\n    displayVectors: boolean;\r\n    tracePaths: boolean;\r\n}\r\nexport interface UIAnimationSettings {\r\n    displayVectors: boolean;\r\n    //tracePaths: boolean;\r\n}\r\n\r\n//++++++++++++++++++++\r\n//+ user-input-related\r\n//++++++++++++++++++++\r\nexport interface SimulationSettings {\r\n    collisionDetection?: boolean;\r\n    elasticCollisions?: boolean;\r\n    gravitationalConstant?: number;\r\n}\r\n\r\nexport interface ObjectState {\r\n    body: Body2d, \r\n    position: Vector2D,\r\n    velocity: Vector2D, // simulationUnits (meter) per second\r\n    acceleration: Vector2D\r\n}\r\n\r\n//++++++++++++++++++++\r\n//+ UI\r\n//++++++++++++++++++++\r\nexport interface StatusBar {\r\n    bar: HTMLDivElement\r\n    fields: HTMLSpanElement[];\r\n}\r\nexport interface RadioButtonGroup {\r\n    name: string;\r\n    buttons: HTMLInputElement[];\r\n}\r\nexport interface UIElements {\r\n    statusBar: StatusBar;\r\n    // top menu\r\n    resetButton: HTMLElement;\r\n    playPauseButton: HTMLElement;\r\n    stepButton: HTMLElement;\r\n    repositoryLink: HTMLElement;\r\n\r\n    // main menu\r\n    zoomInButton: HTMLElement;\r\n    zoomOutButton: HTMLElement;\r\n    scrollUpButton: HTMLElement;\r\n    scrollDownButton: HTMLElement;\r\n    scrollLeftButton: HTMLElement;\r\n    scrollRightButton: HTMLElement;\r\n\r\n    displayVectorsCheckbox: HTMLInputElement;\r\n\r\n    collisionDetectionCheckbox: HTMLInputElement;\r\n    elasticCollisionsCheckbox: HTMLInputElement;\r\n    gravitationalConstantInput: HTMLInputElement;\r\n\r\n    clickAction: HTMLSelectElement | RadioButtonGroup;\r\n    massInput: HTMLInputElement;\r\n    movableCheckbox: HTMLInputElement;\r\n}","import { Vector2D } from \"../util/vector2d\";\r\nimport { TouchAction, ButtonState, MouseButtons, Pointer, MouseAction, MultiTouchGesture as MultiTouch } from \"../types/types\";\r\nimport * as util from \"../util/util\";\r\nimport { App } from \"../app/app\";\r\nimport * as tfm from \"../util/transformations\";\r\nimport { Body2d } from \"../simulation/body2d\";\r\n\r\nexport class InteractionManager {\r\n//#region properties\r\n    private _touchAction: TouchAction = TouchAction.None;\r\n    private _activeTouches = new Map<number, Vector2D>();\r\n    private _previousTouchesMid: Vector2D | null = null;\r\n    private _previousTouchesDist: number | null = null;\r\n    private _lastSingleTouchPos: Vector2D | null = null;\r\n    private pointer: Pointer = {\r\n        main: { state: ButtonState.Up, downCoordinatesInSimSpace: undefined },\r\n        secondary: { state: ButtonState.Up },\r\n        wheel: { state: ButtonState.Up }\r\n    };\r\n//#endregion\r\n//#region get, set\r\n    get touchAction(): TouchAction {\r\n        return this._touchAction;\r\n    }\r\n    set touchAction(action: TouchAction) {\r\n        this._touchAction = action;\r\n    }\r\n\r\n    get activeTouches(): Map<number, Vector2D> {\r\n        return this._activeTouches;\r\n    }\r\n    set activeTouches(touches: Map<number, Vector2D>) {\r\n        this._activeTouches = touches;\r\n    }\r\n\r\n    get lastSingleTouchPos(): Vector2D | null {\r\n        return this._lastSingleTouchPos;\r\n    }\r\n\r\n    set lastSingleTouchPos(pos: Vector2D | null) {\r\n        this._lastSingleTouchPos = pos;\r\n    }\r\n    \r\n    get previousTouchesMid(): Vector2D | null {\r\n        return this._previousTouchesMid;\r\n    }\r\n    set previousTouchesMid(mid: Vector2D | null) {\r\n        this._previousTouchesMid = mid;\r\n    }\r\n\r\n    get previousTouchesDist(): number | null {\r\n        return this._previousTouchesDist;\r\n    }\r\n    set previousTouchesDist(dist: number | null) {\r\n        this._previousTouchesDist = dist;\r\n    }\r\n\r\n//#endregion\r\n    constructor(private canvas: HTMLCanvasElement, private app: App) {\r\n        canvas.addEventListener(\"pointerdown\",   (ev) => this.canvasPointerDown(ev as PointerEvent));\r\n        canvas.addEventListener(\"pointerup\",     (ev) => this.canvasPointerUp(ev as PointerEvent));\r\n        canvas.addEventListener(\"pointermove\",   (ev) => this.canvasPointerMoving(ev as PointerEvent));\r\n        canvas.addEventListener(\"pointercancel\", (ev) => this.reset());\r\n        canvas.addEventListener(\"mousedown\",     (ev) => this.canvasMouseDown(ev as MouseEvent));    // pointerEvents only fire when the first button is pressed, and the last button is released\r\n        canvas.addEventListener(\"mouseup\",       (ev) => this.canvasMouseUp(ev as MouseEvent));      // so we need mouse events to catch all button interactions\r\n        canvas.addEventListener(\"wheel\",         (ev) => this.canvasScrollMouseWheel(ev as WheelEvent));\r\n        canvas.addEventListener(\"contextmenu\",   (ev) => { ev.preventDefault() });\r\n        canvas.addEventListener(\"touchend\",      (ev) => { ev.preventDefault() }, { passive: false });   // prevent touch-triggered MouseUp\r\n    }\r\n//#region primary interaction\r\n    private canvasPointerDown(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerDown only fires for presses while no other button is down.\r\n            return;\r\n        }\r\n        this.canvas.setPointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchStart(ev);\r\n                break;\r\n\r\n            case \"pen\":\r\n                \r\n                break;\r\n\r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n    }\r\n    private canvasPointerUp(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerUp only fires when the last button is released.\r\n            return;\r\n        }\r\n        this.canvas.releasePointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchEnd(ev);\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n        \r\n    }\r\n    private canvasPointerMoving(ev: PointerEvent) {\r\n        const currentMovement = new Vector2D(ev.movementX, ev.movementY);\r\n        \r\n        switch (ev.pointerType) {\r\n            case \"mouse\":\r\n                if (this.pointer.wheel.state === ButtonState.Down) {\r\n                    ev.preventDefault(); // prevent scroll-symbol\r\n                    this.app.scrollInCanvasUnits(currentMovement);\r\n                }\r\n                break;\r\n        \r\n            case \"touch\":\r\n                const currentTouchPosition = this.activeTouches.get(ev.pointerId)!;\r\n                if (!currentTouchPosition) return;\r\n\r\n                currentTouchPosition.x = ev.clientX;\r\n                currentTouchPosition.y = ev.clientY;\r\n\r\n                switch (this.touchAction) {\r\n\r\n                    case TouchAction.AddBody:\r\n                        // TODO: draw (half transparent) body and vector while dragging\r\n                        break;\r\n\r\n                    case TouchAction.ManipulateView:\r\n                        if (this.activeTouches.size === 1) {\r\n                            // --------------------\r\n                            //      SINGLE TOUCH\r\n                            // --------------------\r\n\r\n                            if (this.lastSingleTouchPos) {\r\n                                const dx = currentTouchPosition.x - this.lastSingleTouchPos.x;\r\n                                const dy = currentTouchPosition.y - this.lastSingleTouchPos.y;\r\n\r\n                                this.app.scrollInCanvasUnits(new Vector2D(dx, dy));\r\n                            }\r\n\r\n                            this.lastSingleTouchPos = new Vector2D(currentTouchPosition.x, currentTouchPosition.y);\r\n\r\n                            return;\r\n                        } else {\r\n\r\n                            // --------------------\r\n                            //      MULTI TOUCH IS WHAT'S LEFT\r\n                            // --------------------\r\n                            const gesture = this.multiTouch();\r\n                            if (!gesture) { return; }\r\n\r\n                            const touchesMidpoint = gesture.midpoint;\r\n                            const touchesDistance = gesture.distance;\r\n\r\n                            // no previous gesture -> initialize\r\n                            if (this.previousTouchesMid === null || this.previousTouchesDist === null) {\r\n                                this.previousTouchesMid = touchesMidpoint;\r\n                                this.previousTouchesDist = touchesDistance;\r\n                                return;\r\n                            }\r\n\r\n                            const zoomFactor = touchesDistance / this.previousTouchesDist;\r\n                            const zoomCenterCanvas = tfm.relativePosition(touchesMidpoint, this.canvas);\r\n                            const scroll = touchesMidpoint.subtract(this.previousTouchesMid);\r\n                            this.app.zoomToFactor(1 / zoomFactor, zoomCenterCanvas);\r\n                            this.app.scrollInCanvasUnits(scroll);\r\n\r\n                            this.previousTouchesMid = touchesMidpoint;\r\n                            this.previousTouchesDist = touchesDistance;\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType\");\r\n                break;\r\n        }\r\n    }\r\n    private deletePointer(ev: PointerEvent) {\r\n        this.activeTouches.delete(ev.pointerId);\r\n    }\r\n    private canvasScrollMouseWheel(ev: WheelEvent) {\r\n        // don't scroll the entire page\r\n        ev.preventDefault();\r\n        \r\n        const cursorPos = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        const posOnCanvas = tfm.relativePosition(cursorPos, this.canvas);\r\n\r\n        if (ev.deltaY < 0) {\r\n            this.app.zoomIn(posOnCanvas);\r\n        } else if (ev.deltaY > 0) {\r\n            this.app.zoomOut(posOnCanvas);\r\n        }\r\n        this.app.updateStatusBarAnimationInfo();\r\n    }\r\n    private canvasTouchStart(ev: PointerEvent) {\r\n        const touch = new Vector2D(ev.clientX, ev.clientY);\r\n        this.activeTouches.set(ev.pointerId, touch);\r\n\r\n        if (this.activeTouches.size === 1) {\r\n            this.touchAction = TouchAction.AddBody;\r\n            this.lastSingleTouchPos = touch;\r\n            \r\n            \r\n            const positionVector = new Vector2D(ev.clientX, ev.clientY);\r\n            const positionInSimSpace: Vector2D = tfm.pointFromCanvasToSimulation(positionVector, this.app.canvasSpace);\r\n            this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n\r\n        } else if (this.activeTouches.size === 2) {\r\n            this.touchAction = TouchAction.ManipulateView;\r\n\r\n            // reset pinch-gesture\r\n            this.previousTouchesMid = null;\r\n            this.previousTouchesDist = null;\r\n            \r\n            // stop scrolling\r\n            this.lastSingleTouchPos = null;\r\n        }\r\n    }\r\n    private canvasTouchEnd(ev: PointerEvent) {\r\n        if (!this.activeTouches.has(ev.pointerId)) return;\r\n\r\n        this.activeTouches.delete(ev.pointerId);\r\n\r\n        switch (this.touchAction) {\r\n            case TouchAction.AddBody:\r\n                const absPos = util.getAbsolutePointerPosition(ev);\r\n                this.addBodyAtPointer(tfm.relativePosition(absPos, this.canvas));\r\n                this.touchAction = TouchAction.None;\r\n                break;\r\n\r\n            case TouchAction.ManipulateView:\r\n                // reset pinch-gesture\r\n                this.previousTouchesMid = null;\r\n                this.previousTouchesDist = null;\r\n\r\n                if (this.activeTouches.size === 1) {\r\n                    // one touch remaining -> use it to scroll\r\n                    const remaining = this.activeTouches.values().next().value!;\r\n                    this.lastSingleTouchPos = new Vector2D(remaining.x, remaining.y);\r\n                } else if (this.activeTouches.size === 0) {\r\n                    this.touchAction = TouchAction.None;\r\n                    this.lastSingleTouchPos = null;\r\n                    this.previousTouchesMid = null;\r\n                    this.previousTouchesDist = null;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    private canvasMouseUp(ev: MouseEvent) {\r\n        const absolutePointerPosition = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Up;\r\n                this.canvasMainMouseUp(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Up;\r\n                \r\n                // prevent scroll-symbol\r\n                ev.preventDefault();\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Up;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n                \r\n    }\r\n    private canvasMouseDown(ev: MouseEvent) {\r\n        const absolutePointerPosition: Vector2D = new Vector2D(ev.clientX, ev.clientY);\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Down;\r\n                this.canvasMainMouseDown(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Down;\r\n                ev.preventDefault(); // prevent scroll-symbol\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Down;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseDown(absoluteMousePosition: Vector2D) {\r\n        switch (MouseAction[this.app.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                const positionVector = new Vector2D(absoluteMousePosition.x, absoluteMousePosition.y);\r\n                const positionInSimSpace: Vector2D = tfm.pointFromCanvasToSimulation(positionVector, this.app.canvasSpace);\r\n                this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseUp(absoluteMousePosition: Vector2D) {\r\n        switch (MouseAction[this.app.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                this.addBodyAtPointer(tfm.relativePosition(absoluteMousePosition, this.canvas));\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n//#endregion\r\n//#region manage interactions\r\n    private updateTouchPosition(pointerId: number, x: number, y: number): void {\r\n        const touch = this.activeTouches.get(pointerId);\r\n        if (touch) {\r\n            touch.x = x;\r\n            touch.y = y;\r\n        }\r\n    }\r\n    private multiTouch(): MultiTouch | null {\r\n        if (this.activeTouches.size < 2) return null;\r\n\r\n        const touches = this.activeTouches.values();\r\n        const first = new Vector2D (touches.next().value!);\r\n        const second = new Vector2D (touches.next().value!);\r\n\r\n        const midpoint = Vector2D.midpoint(first, second);\r\n        const distance = (new Vector2D(first)).distance(second);\r\n        Math.hypot(second.x - first.x, second.y - first.y);\r\n\r\n        return { first, second, midpoint, distance };\r\n    }\r\n    public reset(): void {\r\n        this.touchAction = TouchAction.None;\r\n        this.activeTouches.clear();\r\n        this.previousTouchesMid = null;\r\n        this.previousTouchesDist = null;\r\n        this.lastSingleTouchPos = null;\r\n    }\r\n//#endregion\r\n//#region do stuff\r\n    private addBodyAtPointer(pointerPositionOnCanvas: Vector2D) {\r\n        const bodyBeingAdded: Body2d = this.app.body2dFromUi();\r\n        const mousePositionInSimSpace: Vector2D = tfm.pointFromCanvasToSimulation(pointerPositionOnCanvas, this.app.canvasSpace);\r\n        const vel: Vector2D = util.calculateVelocityBetweenPoints(this.pointer.main.downCoordinatesInSimSpace!, mousePositionInSimSpace);\r\n        this.app.addBody(bodyBeingAdded, mousePositionInSimSpace, vel);\r\n        this.app.updateStatusBarSimulationInfo();\r\n    }\r\n\r\n//#endregion\r\n}","import { Vector2D } from \"../util/vector2d\";\r\nimport * as essentials from \"../util/util\";\r\nimport { VECTOR_THICKNESS } from \"../const/const\";\r\n\r\nexport class Canvas {\r\n//#region properties\r\n    // let offscreenCanvas: OffscreenCanvas; // use this in a worker thread to render or draw on, then transfer content to the visible html-canvas\r\n    // let offscreenCanvasCtx: OffscreenCanvasRenderingContext2D;\r\n    private _visibleCanvasContext: CanvasRenderingContext2D;\r\n    constructor(private _visibleCanvas: HTMLCanvasElement) {\r\n        this._visibleCanvasContext = _visibleCanvas.getContext(\"2d\", { alpha: false })!;\r\n    }\r\n//#endregion\r\n//#region get, set\r\n    get visibleCanvas() {\r\n        return this._visibleCanvas;\r\n    }\r\n    private get visibleCanvasContext() {\r\n        return this._visibleCanvasContext;\r\n    }\r\n    // additional getters\r\n    get width(): number {\r\n        return this.visibleCanvas.width;\r\n    }\r\n    get height(): number {\r\n        return this.visibleCanvas.height;\r\n    }\r\n//#endregion\r\n    public resize(width: number, height: number) {\r\n        this.visibleCanvas.width = width;\r\n        this.visibleCanvas.height = height;\r\n    }   \r\n//#region drawing stuff\r\n    public clear() {\r\n        this.visibleCanvasContext.clearRect(0, 0, this.width, this.height);\r\n    }\r\n    public fillCanvas(color: string = \"#000000\") {\r\n        this.visibleCanvasContext.fillStyle = color;\r\n        this.visibleCanvasContext.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    /**\r\n     * @param position in canvas space\r\n     * @param direction in canvas space\r\n     */\r\n    public drawVector(position: Vector2D, direction: Vector2D, color: string = \"white\") {\r\n        // optionally normalize the direction and scale later\r\n        let endPosition: Vector2D = position.add(direction);\r\n        if (!this.isLineVisible(position, endPosition)) {\r\n            return;\r\n        }\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.lineWidth = VECTOR_THICKNESS;\r\n        this.visibleCanvasContext.strokeStyle = color;\r\n        this.visibleCanvasContext.moveTo(position.x, position.y);\r\n        this.visibleCanvasContext.lineTo(endPosition.x, endPosition.y);\r\n        this.visibleCanvasContext.stroke();\r\n    }\r\n    /**\r\n     * draws a circular body at specified position, in specified color\r\n     * @param position on canvas\r\n     * @param radius in canvas units\r\n     * @param color default white\r\n     */\r\n    public drawCircle(position: Vector2D, radius: number, color: string = \"white\") {\r\n        if (!this.isCircleVisible(position, radius)) return;\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.arc(position.x, position.y, radius, 0, Math.PI * 2);\r\n        this.visibleCanvasContext.closePath();\r\n        this.visibleCanvasContext.fillStyle = color;\r\n        this.visibleCanvasContext.fill();\r\n\r\n    }\r\n    private isCircleVisible(position: Vector2D, radius: number): boolean {\r\n        const inBoundsLeft = position.x + radius >= 0;\r\n        const inBoundsRight = position.x - radius <= this.visibleCanvas.width;\r\n        const inBoundsTop = position.y + radius >= 0;\r\n        const inBoundsBottom = position.y - radius <= this.visibleCanvas.height;\r\n        return inBoundsLeft && inBoundsRight && inBoundsTop && inBoundsBottom;\r\n    }\r\n    private isLineVisible(startPoint: Vector2D, endPoint: Vector2D): boolean {\r\n        // if the startPoint or endPoint is in the canvas, return true\r\n        if ((essentials.isInRange(startPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(startPoint.y, 0, this.visibleCanvas.height)) ||\r\n            (essentials.isInRange(endPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(endPoint.y, 0, this.visibleCanvas.height))) \r\n            {\r\n            return true;\r\n        }\r\n        // if both points are outside the canvas, check if the line intersects with any of the canvas edges\r\n        if (Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, 0), new Vector2D(this.visibleCanvas.width, 0)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, 0), new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height), new Vector2D(0, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, this.visibleCanvas.height), new Vector2D(0, 0)], true)) \r\n            {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n//#endregion\r\n}","import { twoDigitHex } from \"../util/util\";\r\n\r\nexport class Body2d {\r\n//#region properties\r\n    private _radius!: number;\r\n    private _color!: string;\r\n    private _movable!: boolean;\r\n    static defaultDensity = 1;\r\n//#endregion\r\n// #region get, set\r\n    public get mass() {\r\n        return this._mass;\r\n    }\r\n    public set mass(newMass: number) {\r\n        this._mass = Math.max(newMass, 1);\r\n    }\r\n    public get radius() {\r\n        return this._radius;\r\n    }\r\n    private set radius(newRadius: number) {\r\n        this._radius = Math.max(newRadius, 1);\r\n    }\r\n    public get movable() {\r\n        return this._movable;\r\n    }\r\n    public set movable(movable: boolean) {\r\n        this._movable = movable\r\n    }   \r\n    public get color() : string {\r\n        return this._color\r\n    }\r\n    private set color(c: string) {\r\n        if (!(CSS.supports(\"color\", c))) {\r\n            c = \"#818181ff\";\r\n        }\r\n        this._color = c;\r\n    } \r\n// #endregion\r\n    constructor(private _mass: number, movable?: boolean, color?: string, radius?: number)  {\r\n        if (radius === undefined) { radius = this.defaultRadius(_mass); }\r\n        this.radius = radius;\r\n        if (color === undefined) { color = this.massDependentColor(_mass); }\r\n        this.color = color;\r\n        if (movable === undefined) { movable = true; }\r\n        this.movable = movable;     \r\n    }\r\n\r\n    /**\r\n     * returns the radius of a sphere based on mass and density\r\n     */\r\n    public defaultRadius(mass?: number) {\r\n        if (!mass) {\r\n            mass = this.mass;\r\n        }\r\n        return ((3 * mass)/(4 * Math.PI * Body2d.defaultDensity)) ** (1/3); \r\n    }\r\n    /**\r\n     * Sets the bodies' properties' values. If radius or color are omitted, their mass-dependent defaults are used.\r\n     * @param mass number\r\n     * @param radius number\r\n     * @param mass\r\n     */\r\n    public setProperties(mass: number): void\r\n    setProperties(mass: number, radius: number): void\r\n    setProperties(mass: number, color: string): void\r\n    setProperties(mass: number, radius: number, color: string): void\r\n    setProperties(mass: number, maybeRadiusOrColor?: number | string, maybeColor?: string): void {\r\n        if (!!maybeColor) {\r\n            this.color = maybeColor;\r\n            this.radius = +maybeRadiusOrColor!;\r\n        } else {\r\n            if (!maybeRadiusOrColor) {\r\n                this.color = this.massDependentColor(mass);\r\n                this.radius = this.defaultRadius(mass);\r\n            } else if (typeof maybeRadiusOrColor === \"string\") {\r\n                this.color = maybeRadiusOrColor;\r\n                this.radius = this.defaultRadius(mass);\r\n            } else if (typeof maybeRadiusOrColor === \"number\") {\r\n                this.color = this.massDependentColor(mass);\r\n                this.radius = maybeRadiusOrColor;\r\n            }\r\n        }\r\n        \r\n        this._mass = mass;\r\n    }\r\n    public massDependentColor(mass: number): string {\r\n        const lowestColorMass = 50;\r\n        const biggestColorMass = 100000000;\r\n        const alpha = \"ff\";\r\n\r\n        if (mass <= lowestColorMass) {\r\n            return \"#ff0000ff\";\r\n        }\r\n        if (mass >= biggestColorMass) {\r\n            return \"#0000ffff\";\r\n        }\r\n        const mid = Math.sqrt(lowestColorMass * biggestColorMass)\r\n        let r,g,b;\r\n\r\n        if (mass < mid) {\r\n            // Red -> White\r\n            const t = (Math.log(mass) - Math.log(lowestColorMass)) / (Math.log(mid) - Math.log(lowestColorMass));\r\n            r = 255;\r\n            g = Math.round(255 * t);\r\n            b = Math.round(255 * t);\r\n        } else {\r\n            // White -> Blue\r\n            const t = (Math.log(mass) - Math.log(mid)) / (Math.log(biggestColorMass) - Math.log(mid));\r\n            r = Math.round(255 * (1 - t));\r\n            g = Math.round(255 * (1 - t));\r\n            b = 255;\r\n        }\r\n\r\n        return `#${twoDigitHex(r)}${twoDigitHex(g)}${twoDigitHex(b)}${alpha}`;\r\n    }\r\n}","import { UI } from \"../interaction/ui\";\r\nimport { Gravity } from \"../simulation/gravity\";\r\nimport { AnimationController } from \"../animation/animation-controller\";\r\nimport { InteractionManager } from \"../interaction/interaction-manager\";\r\nimport { Canvas } from \"../animation/canvas\";\r\nimport { CanvasSpace, SimulationSettings } from \"../types/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport { Body2d } from \"../simulation/body2d\";\r\n\r\nexport class App {\r\n\r\n\r\n//#region properties\r\n    private _gravity: Gravity;\r\n    private _animation: AnimationController;\r\n    private _interaction: InteractionManager;\r\n    private _ui: UI;\r\n//#endregion\r\n//#region get\r\n    private get gravity() {\r\n        return this._gravity;\r\n    }\r\n    private get animation() {\r\n        return this._animation;\r\n    }\r\n    private get interaction() {\r\n        return this._interaction;\r\n    }\r\n    private get ui() {\r\n        return this._ui;\r\n    }\r\n\r\n    get simulationRunning() {\r\n        return this.gravity.running;\r\n    }\r\n    get currentSimulationState() {\r\n        return this.gravity.simulationState;\r\n    }\r\n    get canvasSpace(): CanvasSpace {\r\n        return this.animation.canvasSpace;\r\n    }\r\n    get selectedClickAction(): string {\r\n        return this.ui.selectedClickAction;\r\n    }\r\n    get tick(): number {\r\n        return this.gravity.tick;\r\n    }\r\n    get currentZoom(): number {\r\n        return this.animation.currentZoom;\r\n    }\r\n//#endregion\r\n//#region initialize\r\n    constructor() {\r\n        const canvasElement = document.getElementById(\"theCanvas\") as HTMLCanvasElement;\r\n        if (!canvasElement) throw new Error(\"canvasElement not found\");\r\n        const canvas = new Canvas(canvasElement);\r\n\r\n        this._gravity = new Gravity();        \r\n        this._animation = new AnimationController(canvas, this);        \r\n        this._ui = new UI(this);\r\n        this._interaction = new InteractionManager(canvas.visibleCanvas, this);\r\n        this.initialize();\r\n    }\r\n    private initialize() {\r\n        const width = window.innerWidth;\r\n        const height = window.innerHeight;\r\n        \r\n        this.animation.initialize(width, height, this.ui.animationSettings);\r\n        this.applySimulationSettings(this.ui.simulationSettings);\r\n        this.ui.initialize(width, height);\r\n        \r\n        this.animation.run();\r\n    }\r\n//#endregion\r\n// sim controls\r\n    public run() {\r\n        this.gravity.run();\r\n        this.ui.simulationResumed();\r\n    }\r\n    public stop() {\r\n        this.gravity.stop();\r\n        this.ui.simulationStopped();\r\n    }\r\n    public advanceOneTick() {\r\n        this.gravity.advanceTick();\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public resetSimulation() {\r\n        this.gravity.reset();\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public applySimulationSettings(simulationSettings: SimulationSettings) {\r\n        this.gravity.applySettings(simulationSettings);\r\n    }    \r\n    public addBody(bodyBeingAdded: Body2d, mousePositionInSimSpace: Vector2D, vel: Vector2D) {\r\n        return this.gravity.addBody(bodyBeingAdded, mousePositionInSimSpace, vel);\r\n    }\r\n// animation controls    \r\n    public zoomToFactor(zoomFactor: number, zoomCenterCanvas?: Vector2D) {\r\n        this.animation.zoomToFactor(zoomFactor, zoomCenterCanvas);\r\n    }\r\n    public zoomIn(zoomCenter?: Vector2D, factor?: number) {\r\n        this.animation.zoomIn(zoomCenter, factor);\r\n    }\r\n    public zoomOut(zoomCenter?: Vector2D, factor?: number) {\r\n        this.animation.zoomOut(zoomCenter, factor);\r\n    }\r\n    public scrollInCanvasUnits(scroll: Vector2D) {\r\n        this.animation.scrollInCanvasUnits(scroll);\r\n    }\r\n    public scrollUp() {\r\n        this.animation.scrollUp();\r\n    }\r\n    public scrollDown() {\r\n        this.animation.scrollDown();\r\n    }\r\n    public scrollLeft() {\r\n        this.animation.scrollLeft();\r\n    }\r\n    public scrollRight() {\r\n        this.animation.scrollRight();\r\n    }\r\n    public resizeCanvas(windowWidth: number, windowHeight: number) {\r\n        this.animation.resizeCanvas(windowWidth, windowHeight);\r\n        this.ui.updateStatusBarCanvasDimensions(windowWidth, windowHeight);\r\n    }\r\n    public setDisplayVectors(display: boolean) {\r\n        this.animation.setDisplayVectors(display);\r\n    }\r\n// UI related\r\n    public updateStatusBarAnimationInfo() {\r\n        this.ui.updateStatusBarAnimationInfo();\r\n    }\r\n    public updateStatusBarSimulationInfo() {\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public body2dFromUi(): Body2d {\r\n        const bodyInfo = this.ui.bodyInformation;\r\n        return new Body2d(bodyInfo.mass, bodyInfo.movable);\r\n    }\r\n}\r\n","import { App } from \"../app/app\";\r\n\r\nlet app: App;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", initialize);\r\nfunction initialize() {\r\n    app = new App();\r\n    registerEvents();\r\n\r\n    app.run();\r\n}\r\n\r\nfunction registerEvents() {\r\n    document.removeEventListener(\"DOMContentLoaded\", initialize);\r\n    window.addEventListener(\"resize\", windowResized);\r\n}\r\n\r\nfunction windowResized(this: Window, ev: UIEvent) {\r\n    let windowWidth = this.innerWidth;\r\n    let windowHeight = this.innerHeight;\r\n    app.resizeCanvas(windowWidth, windowHeight);\r\n}\r\n"],"names":["Vector2D","a","b","__publicField","vectors","result","previous","current","v","scalar","magnitude","array","p2","reflectionSurface","axis","dotAxis","projection","line1","line2","strict","p1","q1","q2","r","s","rCrossS","qMinusP","qmpCrossR","t0","t1","tMin","tMax","pointA","pointB","t","u","v1","v2","epsilon","isZero","value","isNumeric","clamp","min","max","isInRange","getInputValue","input","inputElement","getInputNumber","inputValue","getAbsolutePointerPosition","ev","calculateVelocityBetweenPoints","toCoordinate","fromCoordinate","timeFrameInSeconds","twoDigitHex","DEFAULT_G","MIN_G","MAX_G","MIN_ZOOM","MAX_ZOOM","DEFAULT_ZOOM_FACTOR","DEFAULT_SCROLL_RATE","VECTOR_THICKNESS","MIN_DISPLAYED_RADIUS","BACKGROUND_COLOR","VECTOR_COLORS","UI","app","bar","util.getInputNumber","width","height","checked","elasticChecked","simulationSettings","newG","group","selected","btn","step","bodyCount","statusBarFieldIndex","tickCount","currentZoom","_a","_b","message","fieldIndexOrId","append","element","Gravity","c.DEFAULT_G","c.MIN_G","c.MAX_G","collisionDetection","elastic","settings","body","position","velocity","objectState","runSimulationStep","index","forces","newAcceleration","j","forceOnI","forceOnJ","dt","i","objectStateI","objectStateJ","distance","netForceBetweenBodies","distanceIJ","index1","index2","state1","state2","totalMomentum","totalMass","resultingVelocity","changeObject","removeIndex","body1","body2","restitution","displacement","normalizedDisplacement","velocityAlongDisplacement","impulseScalar","deltaV1","deltaV2","objectState1","objectState2","normalDisplacement","targetDistance","totalMoveDistance","moveBody1","moveBody2","relativePosition","absolutePosition","elementRect","x","y","pointFromCanvasToSimulation","point","canvasSpace","pointFromSimulationToCanvas","shifted","directionFromSimulationToCanvas","direction","ViewController","animation","factor","zoomCenter","oldZoom","newZoom","zoomDelta","zoomStep","shiftOrigin","newOrigin","AnimationController","_canvas","_app","canvas","animationSettings","running","loop","objectStates","object","tfm.pointFromSimulationToCanvas","visibleRadius","positionOnCanvas","accelerationOnCanvas","tfm.directionFromSimulationToCanvas","velocityOnCanvas","display","orientation","rate","movementOnCanvas","movementInSimulationUnits","TouchAction","MouseAction","ButtonState","MouseButtons","InteractionManager","action","touches","pos","mid","dist","currentMovement","currentTouchPosition","dx","dy","gesture","touchesMidpoint","touchesDistance","zoomFactor","zoomCenterCanvas","tfm.relativePosition","scroll","cursorPos","util.getAbsolutePointerPosition","posOnCanvas","touch","positionVector","positionInSimSpace","tfm.pointFromCanvasToSimulation","absPos","remaining","absolutePointerPosition","absoluteMousePosition","pointerId","first","second","midpoint","pointerPositionOnCanvas","bodyBeingAdded","mousePositionInSimSpace","vel","util.calculateVelocityBetweenPoints","Canvas","_visibleCanvas","color","endPosition","radius","inBoundsLeft","inBoundsRight","inBoundsTop","inBoundsBottom","startPoint","endPoint","essentials.isInRange","_Body2d","_mass","movable","newMass","newRadius","c","mass","maybeRadiusOrColor","maybeColor","g","Body2d","App","canvasElement","windowWidth","windowHeight","bodyInfo","initialize","registerEvents","windowResized"],"mappings":"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"}