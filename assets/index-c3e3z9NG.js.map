{"version":3,"file":"index-c3e3z9NG.js","sources":["../../src/scripts/vector2d.ts","../../src/const.ts","../../src/scripts/gravity.ts","../../src/scripts/essentials.ts","../../src/scripts/ui.ts","../../src/scripts/canvas.ts","../../src/scripts/types.ts","../../src/scripts/gravity-animation-controller.ts","../../src/scripts/app.ts","../../src/scripts/main.ts"],"sourcesContent":["export interface Coordinate {\r\n    x: number,\r\n    y: number,\r\n}\r\nexport class Vector2D {\r\n    public x: number;\r\n    public y: number;\r\n    constructor()\r\n    constructor(pos: Coordinate)\r\n    constructor(x: number, y: number)\r\n    constructor(a?: number | Coordinate, b?: number) {\r\n        if (typeof a === \"object\") {\r\n            this.x = a.x;\r\n            this.y = a.y;\r\n        } else {\r\n            this.x = a ?? 0;\r\n            this.y = b ?? 0;\r\n        }\r\n    }\r\n    public toString() {\r\n        return `x: ${this.x}, y: ${this.y}`;\r\n    }\r\n    public add(...vectors: Coordinate[]): Vector2D {\r\n        const result = vectors.reduce((previous, current) => {\r\n            return { x: (previous.x + current.x), y: (previous.y + current.y) };\r\n        }, {x: this.x, y: this.y});\r\n        return new Vector2D(result.x, result.y);\r\n    }\r\n    /**\r\n     * @returns this - v\r\n     */\r\n    public subtract(v: Coordinate): Vector2D {\r\n        return new Vector2D(this.x - v.x, this.y - v.y);\r\n    }\r\n    public scale(scalar: number): Vector2D {\r\n        return new Vector2D(this.x * scalar, this.y * scalar);\r\n    }\r\n    public dotProduct(v: Coordinate): number {\r\n        return this.x * v.x + this.y * v.y;\r\n    }\r\n    public magnitude(): number {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    }\r\n    public normalize(): Vector2D {\r\n        const magnitude = this.magnitude();\r\n        if (magnitude === 0) {\r\n            return new Vector2D(0, 0);\r\n        } else {\r\n            return this.scale(1 / magnitude);\r\n        }\r\n    }\r\n    /**\r\n     * @param v Vector2D\r\n     * @returns Distance to v\r\n     */\r\n    public distance(v: Coordinate): number {\r\n        return Math.sqrt((v.x - this.x)**2 + (v.y - this.y)**2);\r\n    }\r\n    /**\r\n     * returns a vector pointing from this to v\r\n     */\r\n    public displacementVector(v: Coordinate) {\r\n        const vector = new Vector2D(v.x, v.y);\r\n        return vector.subtract(this);\r\n    }\r\n    public hadamardProduct(v: Coordinate) {\r\n        return new Vector2D(this.x * v.x, this.y * v.y);\r\n    }\r\n    /**\r\n     * @returns an array of two normalized vectors, both normal to this, both pointing in opposite directions\r\n     */\r\n    public normalVectors(): Vector2D[] {\r\n        const array: Vector2D[] = [];\r\n        const v = this.normalize();\r\n        array.push(new Vector2D(-v.y, v.x));\r\n        array.push(new Vector2D(v.y, -v.x));\r\n        return array;\r\n    }\r\n    /**\r\n     * Reflects this vector on reflectionSurface.\r\n     * @param reflectionSurface acts as a mirror\r\n     * @returns The reflected vector\r\n     */\r\n    public reflect(reflectionSurface: Vector2D): Vector2D {\r\n        reflectionSurface = reflectionSurface.normalize();\r\n        const axis = reflectionSurface.normalVectors()[0];\r\n        const dotAxis = this.dotProduct(axis);\r\n        const projection = axis.scale(dotAxis).scale(2);\r\n        const reflected = this.subtract(projection);\r\n        return reflected;\r\n    }\r\n    /**\r\n     * @param line1 defined by two points\r\n     * @param line2 defined by two points\r\n     * @param strict false by default. If true, the intersection must be within the line segments defined by the coordinates, not just the infinite lines.\r\n     * @returns The intersection of the two lines: a point, null if they don't intersect, or a line (defined by two points) if they are identical, or collinear and overlapping.\r\n     * https://stackoverflow.com/a/565282/97076991 - authored by ai.\r\n     */\r\n    public static linesIntersecting(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D], strict = false): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        if (rCrossS === 0) {\r\n            if (qmpCrossR === 0) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (tMin === tMax) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < 0 || t > 1 || u < 0 || u > 1) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n    public static midpoint(v1: Vector2D, v2: Vector2D): Vector2D {\r\n        return new Vector2D((v1.x + v2.x) / 2, (v1.y + v2.y) / 2);\r\n    }\r\n    public static simpleLineIntersection(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D]): Vector2D | null {\r\n        // make sure lines are strictly defined (p1 != p2, same for line2)\r\n        \r\n        // check for general intersection\r\n\r\n        // if parallel or identical, -> null\r\n        // otherwise intersection: {x, y}\r\n\r\n        // order points so that p1.x <= p2.x and q1.x <= q2.x\r\n\r\n        // p1.x <= intersection.x <= p2.x\r\n        // q1.x <= intersection.x <= q2.x\r\n        // and same for y\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    /**\r\n     * Written by ChatGPT-4\r\n     * @param line1 \r\n     * @param line2 \r\n     * @param strict \r\n     * @param epsilon \r\n     * @returns \r\n     */\r\n    public static linesIntersectingButBetter(\r\n        line1: [p1: Vector2D, p2: Vector2D],\r\n        line2: [q1: Vector2D, q2: Vector2D],\r\n        strict = false,\r\n        epsilon = 1e-9 // Default epsilon value\r\n    ): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        // Using epsilon for floating-point precision comparison\r\n        const isZero = (value: number) => Math.abs(value) < epsilon;\r\n\r\n        if (isZero(rCrossS)) {\r\n            if (isZero(qmpCrossR)) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (isZero(tMin - tMax)) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < -epsilon || t > 1 + epsilon || u < -epsilon || u > 1 + epsilon) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n\r\n}","import { ButtonState, Mouse } from \"./scripts/types\";\r\n\r\n//#region physics\r\nexport const DEFAULT_G = 50;\r\nexport const MIN_G = -10;\r\nexport const MAX_G = 100;\r\n//#endregion\r\n\r\n//#region animation\r\nexport const MIN_ZOOM = 0.01;\r\nexport const MAX_ZOOM = 10000;\r\nexport const VECTOR_THICKNESS = 1.5;\r\nexport const MIN_DISPLAYED_RADIUS = 0.5;\r\n//#endregion\r\n","import { ObjectState } from \"./types\";\r\nimport { Vector2D } from \"./vector2d\";\r\nimport * as c from \"../const\";\r\n\r\nexport class Body2d {\r\n    private _mass: number;\r\n    private _radius: number;\r\n    private _color: string;\r\n    private _movable: boolean;\r\n    static defaultDensity = 1;\r\n\r\n    // #region constructor, get, set\r\n    constructor(mass: number, movable?: boolean, color?: string, radius?: number)  {\r\n        this._mass = mass;\r\n        if (radius === undefined) { radius = this.defaultRadius(mass); }\r\n        this._radius = radius;\r\n        if (color === undefined) { color = \"white\"; }\r\n        this._color = color;\r\n        if (movable === undefined) { movable = true; }\r\n        this._movable = movable;     \r\n    }\r\n    public get mass() {\r\n        return this._mass;\r\n    }\r\n    public set mass(newMass: number) {\r\n        this._mass = newMass;\r\n    }\r\n    public get radius() {\r\n        return this._radius;\r\n    }\r\n    public set radius(newRadius: number) {\r\n        this._radius = newRadius;\r\n    }\r\n    public get movable() {\r\n        return this._movable;\r\n    }\r\n    public set movable(affected: boolean) {\r\n        this._movable = affected\r\n    }   \r\n    public get color() : string {\r\n        return this._color\r\n    }\r\n    public set color(c: string) {\r\n        if (!(CSS.supports(\"color\", c))) {\r\n            c = \"white\";\r\n        }\r\n        this._color = c;\r\n    } \r\n    // #endregion\r\n    /**\r\n     * returns the radius of a sphere based on mass and density\r\n     */\r\n    public defaultRadius(mass?: number) {\r\n        if (mass === undefined) {\r\n            mass = this.mass;\r\n        }\r\n        return ((3 * mass)/(4 * Math.PI * Body2d.defaultDensity)) ** (1/3); \r\n    }\r\n}\r\nexport class Simulation {\r\n    private _simulationState: ObjectState[];\r\n    private _running: boolean;\r\n    private _tickCount: number;\r\n    private _tickLength: number;\r\n    private _collisionDetection: boolean;\r\n    private _elasticCollisions: boolean;\r\n    private _g: number; // gravitational constant\r\n    private readonly gravityLowerBounds: number = 1; // force calculations for distances lower than this number are skipped\r\n    constructor() { \r\n        this._simulationState = [];\r\n        this._running = false;\r\n        this._tickCount = 0;\r\n        this._tickLength = 10; // ms\r\n        this._collisionDetection = false;\r\n        this._elasticCollisions = false;\r\n        this._g = c.DEFAULT_G;\r\n    }\r\n    // #region get, set\r\n    public get simulationState() {\r\n        return this._simulationState;\r\n    }\r\n    public set simulationState(objectState: ObjectState[]) {\r\n        this._simulationState = objectState;\r\n    }\r\n    public get running() {\r\n        return this._running;\r\n    }\r\n    public set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    public get tickCount() {\r\n        return this._tickCount;\r\n    }\r\n    public set tickCount(tickCount: number) {\r\n        this._tickCount = tickCount;\r\n    }\r\n    public get tickLength() {\r\n        return this._tickLength;\r\n    }\r\n    //public set tickLength(t: number) {\r\n    //    this._tickLength = t;\r\n    //}\r\n    public get collisionDetection() {\r\n        return this._collisionDetection;\r\n    }\r\n    public set collisionDetection(collisionDetection: boolean) {\r\n        this._collisionDetection = collisionDetection;\r\n    }\r\n    public get elasticCollisions() {\r\n        return this._elasticCollisions;\r\n    }\r\n    public set elasticCollisions(elasticCollisions: boolean) {\r\n        this._elasticCollisions = elasticCollisions;\r\n    }\r\n    public get g() {\r\n        return this._g;\r\n    }\r\n    public set g(g: number) {\r\n        if (isNaN(g) || g < c.MIN_G || g > c.MAX_G) {\r\n            g = c.DEFAULT_G;\r\n        }\r\n        this._g = g;\r\n    }\r\n// #endregion\r\n    public addObject(body: Body2d, position: Vector2D, velocity: Vector2D): number \r\n    public addObject(objectState: ObjectState): number \r\n    public addObject(bodyOrObject: ObjectState | Body2d, position?: Vector2D, velocity?: Vector2D): number {\r\n        if (bodyOrObject instanceof Body2d) {\r\n            bodyOrObject = {body: bodyOrObject, position: position!, velocity: velocity!, acceleration: new Vector2D(0, 0)};\r\n        }\r\n        if (!bodyOrObject.body.movable) {\r\n            bodyOrObject.velocity = new Vector2D(0, 0);\r\n        }\r\n        return this.simulationState.push(bodyOrObject);\r\n    }\r\n    private clearObjects() {\r\n        this.simulationState = [];\r\n    }\r\n    private removeFromObjectStates(index: number) {\r\n        this.simulationState.splice(index, 1);\r\n    }\r\n    public pause() {\r\n        this.running = false;\r\n    }\r\n    public run() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n\r\n        const runSimulationStep = () => {\r\n            if (this.running) {\r\n                setTimeout(runSimulationStep, this.tickLength);\r\n                this.advanceTick();\r\n            }\r\n        };\r\n        runSimulationStep();\r\n    }\r\n    public reset() {\r\n        this.clearObjects();\r\n        this.tickCount = 0;\r\n    }\r\n    /**\r\n     * Calculates and returns the velocity vector needed to get from *fromCoordinate* to *toCoordinate* in *timeFrameInSeconds* seconds\r\n     * @param toCoordinate value in simulation space\r\n     * @param fromCoordinate value in simulation space\r\n     * @param timeFrameInSeconds *optional* defaults to 1\r\n     */\r\n    public calculateVelocityBetweenPoints(toCoordinate: Vector2D | {x: number, y: number}, fromCoordinate: Vector2D, timeFrameInSeconds: number = 1): Vector2D {\r\n        if (timeFrameInSeconds <= 0) { timeFrameInSeconds = 1; }\r\n        const toVector = toCoordinate instanceof Vector2D ? toCoordinate : new Vector2D(toCoordinate)\r\n        const distance: Vector2D = toVector.subtract(fromCoordinate);\r\n        return distance.scale(1 / timeFrameInSeconds);\r\n    }\r\n    public advanceTick() {\r\n        this.updateAccelerationVectors();\r\n        this.updateVelocitiesAndPositions();\r\n        if (this.collisionDetection) {\r\n            this.handleCollisions();\r\n        }\r\n        this.tickCount++;\r\n    }\r\n    private updateAccelerationVectors() {\r\n        const forces: Map<number, Vector2D> = this.calculateForces();\r\n\r\n        this.simulationState.forEach((objectState, index) => {\r\n            const totalForceOnBody = forces.get(index) || (new Vector2D(0, 0));\r\n            const newAcceleration = totalForceOnBody.scale(1 / objectState.body.mass);\r\n            objectState.acceleration = newAcceleration;\r\n        });\r\n    }\r\n    private calculateForces() {\r\n        const forces: Map<number, Vector2D> = new Map();\r\n        \r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const forceOnI = this.calculateForceBetweenBodies(i, j);\r\n                const forceOnJ = forceOnI.scale(-1);\r\n\r\n                forces.set(i, (forces.get(i) || new Vector2D(0, 0)).add(forceOnI));\r\n                forces.set(j, (forces.get(j) || new Vector2D(0, 0)).add(forceOnJ));\r\n            }\r\n        }\r\n        return forces;\r\n    }\r\n    /**\r\n     * Calculates the next **position** and **velocity** of the object in state, and updates objectState accordingly.\r\n     * @param objectState *ObjectState* containing the body\r\n     */\r\n    private updateVelocityAndPosition(objectState: ObjectState) {\r\n        const dt = this.tickLength / 1000;\r\n        if (!objectState.body.movable) { return; }\r\n        objectState.velocity = objectState.velocity.add(objectState.acceleration.scale(dt));\r\n        objectState.position = objectState.position.add(objectState.velocity.scale(dt));\r\n    }\r\n    private updateVelocitiesAndPositions() {\r\n        this.simulationState.forEach(objectState => {\r\n            this.updateVelocityAndPosition(objectState)\r\n        });\r\n    }\r\n    /**\r\n     * Calculates the force-vector between the bodies in objectStates at index [i] and [j]\r\n     * @returns a vector representing the force applied ***to*** body at ***objectStates[i]***\r\n     */\r\n    private calculateForceBetweenBodies(i: number, j: number): Vector2D {\r\n        const objectStateI = this.simulationState[i];\r\n        const objectStateJ = this.simulationState[j];\r\n\r\n        const distance = objectStateI.position.distance(objectStateJ.position);\r\n        if (distance < this.gravityLowerBounds || distance === 0) // if the bodies are too close, skip the calculation\r\n            { return new Vector2D(0, 0); } \r\n        const netForceBetweenBodies: number = this.g * ((objectStateI.body.mass * objectStateJ.body.mass)/(distance * distance));\r\n        const unitVectorIToJ = objectStateJ.position.subtract(objectStateI.position).normalize();\r\n        return unitVectorIToJ.scale(netForceBetweenBodies);\r\n    }\r\n    private handleCollisions() {\r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            const objectStateI = this.simulationState[i];\r\n            if (objectStateI === undefined) {\r\n                // undefined, if objectStateI has been merged in a previous collision\r\n                continue;\r\n            }\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const objectStateJ = this.simulationState[j];\r\n                const distanceIJ = objectStateI.position.distance(objectStateJ.position);\r\n                const collision = distanceIJ <= objectStateI.body.radius + objectStateJ.body.radius;\r\n                if (collision) {\r\n                    if (distanceIJ <= objectStateI.body.radius || distanceIJ <= objectStateJ.body.radius) { \r\n                        this.mergeBodies(i, j);\r\n                    } else if (this.elasticCollisions) {\r\n                        this.elasticCollision(objectStateI, objectStateJ);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Merges the two bodies at indices in objectStates into one. The lighter body is merged into the heavier one. Momentum is preserved.\r\n     */\r\n    private mergeBodies(index1: number, index2: number) {\r\n        const state1: ObjectState = this.simulationState[index1];\r\n        const state2: ObjectState = this.simulationState[index2];\r\n        const totalMomentum = state1.velocity.scale(state1.body.mass).add(state2.velocity.scale(state2.body.mass));\r\n        const totalMass = state1.body.mass + state2.body.mass;\r\n        const resultingVelocity = totalMomentum.scale(1 / totalMass);\r\n        let changeObject: ObjectState;\r\n        let removeIndex: number;\r\n\r\n        if (state2.body.mass > state1.body.mass) {\r\n            changeObject = state2;\r\n            removeIndex = index1;\r\n        } else {\r\n            changeObject = state1;\r\n            removeIndex = index2;\r\n        }\r\n        changeObject.velocity = resultingVelocity;\r\n        changeObject.body.mass = totalMass;\r\n        changeObject.body.radius = changeObject.body.defaultRadius();\r\n        changeObject.body.movable = (state1.body.movable && state2.body.movable);\r\n        if (!changeObject.body.movable) {\r\n            changeObject.velocity = new Vector2D(0, 0);\r\n        }\r\n        this.removeFromObjectStates(removeIndex);\r\n    }\r\n    /**\r\n    * @param restitution number between 0 (perfectly inelastic) and 1 (perfectly elastic)\r\n    */\r\n    private elasticCollision(body1: ObjectState, body2: ObjectState, restitution: number = 1) {\r\n        const lowerBounds = 1;\r\n\r\n        // normal vector between the bodies\r\n        const displacement = body1.position.displacementVector(body2.position);\r\n        const distance = displacement.magnitude(); \r\n        if (distance <= lowerBounds || distance === 0) {\r\n            return; \r\n        }\r\n        const normalizedDisplacement = displacement.scale(1 / distance);\r\n\r\n        // relative velocity along the normalDisplacement?\r\n        const relativeVelocity = body2.velocity.subtract(body1.velocity);\r\n        const velocityAlongDisplacement = relativeVelocity.dotProduct(normalizedDisplacement);\r\n\r\n        // if the bodies are moving apart, do nothing\r\n        if (velocityAlongDisplacement > 0) { return; }\r\n\r\n        // impulseScalar = change in momentum as scalar\r\n        const impulseScalar = -(1 + restitution) * velocityAlongDisplacement / (body1.body.mass + body2.body.mass);\r\n\r\n        // update velocities based on the impulse scalar\r\n        const deltaV1 = normalizedDisplacement.scale(impulseScalar * body2.body.mass);\r\n        const deltaV2 = normalizedDisplacement.scale(impulseScalar * body1.body.mass);\r\n        body1.velocity = body1.velocity.subtract(deltaV1);\r\n        body2.velocity = body2.velocity.add(deltaV2);\r\n        \r\n        // REFACTOR ME: at the top, check for movable, if not just reflect velocity\r\n        // if a body is immovable, reset its velocity and transfer it back\r\n        if (!body1.body.movable) {\r\n            body1.velocity = new Vector2D(0, 0);\r\n            body2.velocity = body2.velocity.add(deltaV1);\r\n        }\r\n        if (!body2.body.movable) {\r\n            body2.velocity = new Vector2D(0, 0);\r\n            body1.velocity = body1.velocity.add(deltaV2);\r\n        }\r\n    }\r\n    private placeBodiesTangentially(objectState1: ObjectState, objectState2: ObjectState) {\r\n        const displacement = objectState1.position.displacementVector(objectState2.position);\r\n        const normalDisplacement = displacement.normalize();        \r\n        const targetDistance = objectState1.body.radius + objectState2.body.radius;\r\n        const totalMoveDistance = targetDistance - displacement.magnitude();\r\n        if (targetDistance === 0) {\r\n            return;\r\n        }\r\n        const moveBody1 = normalDisplacement.scale(totalMoveDistance * (objectState1.body.radius / targetDistance));\r\n        const moveBody2 = normalDisplacement.scale(totalMoveDistance * (objectState2.body.radius / targetDistance));\r\n    \r\n        objectState1.position = objectState1.position.subtract(moveBody1);\r\n        objectState2.position = objectState2.position.add(moveBody2);\r\n    }\r\n}\r\n","\r\n/*\r\nJust Some functions\r\n(hopefully moderately helpful)\r\n*/\r\n//#region generic stuff\r\nexport function log(message: string) {\r\n    const timestamp = new Date();\r\n    const hours = timestamp.getHours().toString().padStart(2, '0');\r\n    const minutes = timestamp.getMinutes().toString().padStart(2, '0');\r\n    const seconds = timestamp.getSeconds().toString().padStart(2, '0');\r\n    const milliseconds = timestamp.getMilliseconds().toString().padStart(3, '0');\r\n\r\n    const formattedTimestamp = `${hours}:${minutes}:${seconds}.${milliseconds}`;\r\n    console.log(`[${formattedTimestamp}] ${message}`);\r\n}\r\n/**\r\n * min and max included\r\n * @returns random number\r\n */\r\nexport function rng(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\n//#endregion\r\n\r\n//#region math stuff\r\n/**\r\n * empty string is NOT considered numeric\r\n * @param s the string to be examined\r\n * @returns true if s is a valid number, returns false otherwise\r\n */\r\nexport function isNumeric(s: string): boolean {\r\n    s = s.trim();\r\n    return (!isNaN(+s)) && s.length !== 0;\r\n}\r\n/**\r\n * @returns \"\", if d is a non-numeric string\r\n */\r\nexport function decimalToHex(d: string | number): string {\r\n    if (typeof(d) === \"string\")  {\r\n        if (isNumeric(d)) {\r\n            d = parseFloat(d);\r\n        } else {\r\n            return \"\";\r\n        }\r\n    }\r\n    return d.toString(16);\r\n}\r\n/**\r\n * converts a hexadecimal-number-string to a decimal number and returns it\r\n * @returns 0 if hex is not a valid hexadecimal number\r\n */\r\nexport function hexToDecimal(hex: string): number {\r\n    const prefix = \"0x\"\r\n    if (!(hex.startsWith(prefix))) {\r\n        hex = prefix + hex;\r\n    }\r\n    const num: number = Number(hex);\r\n    const valid = !isNaN(num);\r\n    return valid ? num : 0;\r\n}\r\n/**\r\n * \r\n * @returns n if n satisfies min <= n <= max, otherwise min or max are returned\r\n * @param n number to test against upper and lower bounds\r\n * @param min the lowest allowed value for n\r\n * @param max the highest allowed value for n\r\n */\r\nexport function numberInRange(n: number, min: number, max: number): number {\r\n    if (min > max) {\r\n        throw new Error(\"In ensureNumberInRange: min cannot be greater than max\");\r\n    }\r\n    return Math.max(min, Math.min(n, max))\r\n}\r\nexport function isInRange(n: number, min: number, max: number): boolean {\r\n    return n >= min && n <= max;\r\n}\r\n//#endregion\r\n\r\n//#region string stuff\r\n/**\r\n * Removes all occurrences of charToRemove from the beginning of str\r\n * @param str the string to be modified\r\n * @param charToRemove ***optional*** If no value is provided the first character of str is used. Can be more than one character.\r\n * @returns the modified string\r\n */\r\nexport function removeLeadingChar(str: string, charToRemove?: string): string {\r\n    if (str.length < 1) { return \"\"; }\r\n    if (charToRemove === undefined) {\r\n        charToRemove = str[0];\r\n    }\r\n\r\n    while (str.startsWith(charToRemove)) {\r\n        str = str.slice(charToRemove.length);\r\n    }\r\n    return str;\r\n}\r\n//#endregion\r\n\r\n//#region input stuff\r\nexport function getInputValue(input: string | HTMLInputElement): string {\r\n    let inputElement: HTMLInputElement;\r\n    if (typeof input === \"string\") {\r\n        inputElement = document.getElementById(input) as HTMLInputElement;\r\n    } else {\r\n        inputElement = input;\r\n    }\r\n    return inputElement.value.trim();\r\n}\r\n/**\r\n * @param input an HTMLInputElement, or the id for the Element\r\n * @returns element's value attribute; 0 if value is not numeric\r\n */\r\nexport function getInputNumber(input: string | HTMLInputElement): number {\r\n    const inputValue = getInputValue(input);\r\n    return isNumeric(inputValue) ? +inputValue : 0;\r\n}\r\nexport function getAbsolutePointerPosition(ev: PointerEvent | WheelEvent | MouseEvent): { x: number, y: number } {\r\n    return { x: ev.clientX, y: ev.clientY };\r\n}\r\n\r\n//#endregion","import { Body2d } from \"./gravity\";\r\nimport * as util from \"./essentials\";\r\nimport { IUI, RadioButtonGroup, StatusBar } from \"./types\";\r\nimport { App } from \"./app\";\r\n\r\nexport class UI implements IUI {\r\n// All UI Elements\r\n    statusBar: StatusBar;\r\n    resetButton: HTMLInputElement;\r\n    playPauseButton: HTMLInputElement;\r\n    stepButton: HTMLInputElement;\r\n    repositoryLink: HTMLElement;\r\n    zoomInButton: HTMLInputElement;\r\n    zoomOutButton: HTMLInputElement;\r\n    scrollUpButton: HTMLInputElement;\r\n    scrollDownButton: HTMLInputElement;\r\n    scrollLeftButton: HTMLInputElement;\r\n    scrollRightButton: HTMLInputElement;\r\n    displayVectorsCheckbox: HTMLInputElement;\r\n    collisionDetectionCheckbox: HTMLInputElement;\r\n    elasticCollisionsCheckbox: HTMLInputElement;\r\n    gravitationalConstantInput: HTMLInputElement;\r\n    gravitationalConstantRangeInput: HTMLInputElement;\r\n    clickAction: RadioButtonGroup;\r\n    massInput: HTMLInputElement;\r\n    addBodyMovable: HTMLInputElement;\r\n\r\n    \r\n    //#region get, set\r\n\r\n\r\n    //#endregion\r\n    constructor(private app: App) {\r\n        this.resetButton                        = document.getElementById(\"btnResetSim\")! as HTMLInputElement;\r\n        this.playPauseButton                    = document.getElementById(\"btnToggleSim\")! as HTMLInputElement;\r\n        this.stepButton                         = document.getElementById(\"btnNextStep\")! as HTMLInputElement;\r\n        this.repositoryLink                     = document.getElementById(\"repoLink\")!;\r\n        this.zoomInButton                       = document.getElementById(\"btnZoomIn\")! as HTMLInputElement;\r\n        this.zoomOutButton                      = document.getElementById(\"btnZoomOut\")! as HTMLInputElement;\r\n        this.scrollUpButton                     = document.getElementById(\"btnScrollUp\")! as HTMLInputElement;\r\n        this.scrollDownButton                   = document.getElementById(\"btnScrollDown\")! as HTMLInputElement;\r\n        this.scrollLeftButton                   = document.getElementById(\"btnScrollLeft\")! as HTMLInputElement;\r\n        this.scrollRightButton                  = document.getElementById(\"btnScrollRight\")! as HTMLInputElement;\r\n        this.displayVectorsCheckbox             = document.getElementById(\"cbxDisplayVectors\")! as HTMLInputElement;\r\n        this.collisionDetectionCheckbox         = document.getElementById(\"cbxCollisions\")! as HTMLInputElement;\r\n        this.elasticCollisionsCheckbox          = document.getElementById(\"cbxElasticCollisions\")! as HTMLInputElement;\r\n        this.gravitationalConstantInput         = document.getElementById(\"numberG\")! as HTMLInputElement;\r\n        this.gravitationalConstantRangeInput    = document.getElementById(\"rangeG\")! as HTMLInputElement;\r\n        this.massInput                          = document.getElementById(\"massInput\")! as HTMLInputElement;\r\n        this.addBodyMovable                     = document.getElementById(\"cbxBodyMovable\")! as HTMLInputElement;\r\n        this.clickAction = {\r\n            name: \"radioBtnMouseAction\",\r\n            buttons: Array.from(document.querySelectorAll('input[name=\"radioBtnMouseAction\"]')) as HTMLInputElement[]\r\n        };\r\n        this.statusBar = (() => {\r\n            const bar = document.getElementById(\"statusBar\") as HTMLDivElement;\r\n            return {\r\n                bar: bar,\r\n                fields: Array.from((bar.querySelectorAll(\".statusBarItem\")) as NodeListOf<HTMLSpanElement>)\r\n            };\r\n        })();\r\n\r\n        this.registerEvents();\r\n    }\r\n    public initialize() {\r\n        this.elasticCollisionsCheckbox.disabled = !this.collisionDetectionCheckbox.checked;\r\n        this.massInput.step = this.calculateMassInputStep();\r\n        \r\n        if (this.displayVectorsCheckbox.checked) {\r\n            this.setStatusMessage(\"Green: acceleration - Red: velocity\", 3);\r\n        } else {\r\n            this.setStatusMessage(\"\", 3);\r\n        }\r\n        \r\n        this.setStatusMessage(`Canvas dimension: ${this.app.gravityAnimationController.width} * ${this.app.gravityAnimationController.height}`, 5);\r\n\r\n        this.app.setG(Number(this.gravitationalConstantRangeInput.value));\r\n    }\r\n    private registerEvents() {\r\n        this.resetButton.addEventListener(\"click\", () => this.app.reset());\r\n        this.playPauseButton.addEventListener(\"click\", () => this.app.toggleSimulation());\r\n        this.stepButton.addEventListener(\"click\", () => this.app.advanceOneTick());\r\n        this.zoomInButton.addEventListener(\"click\", () => this.app.zoomIn());\r\n        this.zoomOutButton.addEventListener(\"click\", () => this.app.zoomOut());\r\n        this.scrollUpButton.addEventListener(\"click\", () => this.app.scrollViewUp());\r\n        this.scrollDownButton.addEventListener(\"click\", () => this.app.scrollViewDown());\r\n        this.scrollLeftButton.addEventListener(\"click\", () => this.app.scrollViewLeft());\r\n        this.scrollRightButton.addEventListener(\"click\", () => this.app.scrollViewRight());\r\n        this.displayVectorsCheckbox.addEventListener(\"change\", () => this.cbxDisplayVectorsChanged());\r\n        this.collisionDetectionCheckbox.addEventListener(\"change\", () => this.cbxCollisionsChanged());\r\n        this.elasticCollisionsCheckbox.addEventListener(\"change\", () => this.cbxElasticCollisionsChanged());\r\n        this.gravitationalConstantInput.addEventListener(\"change\", () => this.numberInputGChanged());\r\n        this.gravitationalConstantRangeInput.addEventListener(\"input\", () => this.rangeInputGChanged());\r\n        this.massInput.addEventListener(\"change\", () => this.updateSelectedMass());\r\n    }\r\n    public cbxDisplayVectorsChanged() {\r\n        const displayVectors = this.displayVectorsCheckbox.checked;\r\n        this.app.setDisplayVectors(displayVectors)\r\n        if (displayVectors) {\r\n            this.setStatusMessage(\"Green: acceleration - Red: velocity\", 3);\r\n        } else {\r\n            this.setStatusMessage(\"\", 3);\r\n        }\r\n    }\r\n    public cbxCollisionsChanged() {\r\n        const checked = this.collisionDetectionCheckbox.checked;\r\n        const elasticChecked = this.elasticCollisionsCheckbox.checked;\r\n        \r\n        this.elasticCollisionsCheckbox.disabled = !checked;\r\n        \r\n        this.app.setCollisionDetection(checked, elasticChecked);\r\n    }\r\n    public cbxElasticCollisionsChanged() {\r\n        this.app.setElasticCollisions(this.elasticCollisionsCheckbox.checked);\r\n    }\r\n    public numberInputGChanged() {\r\n        const newG: string = this.gravitationalConstantInput.value;\r\n        this.gravitationalConstantRangeInput.value = newG;\r\n        this.app.setG(Number(newG));\r\n    }\r\n    public rangeInputGChanged() {\r\n        const newG: string = this.gravitationalConstantRangeInput.value;\r\n        if (this.gravitationalConstantInput.value !== newG) {\r\n            this.gravitationalConstantInput.value = newG;\r\n            this.app.setG(Number(newG));\r\n        }\r\n    }\r\n    public simulationStopped() {\r\n        this.playPauseButton.innerHTML = \"&#9654;\"; // play symbol\r\n        this.stepButton.disabled = false;\r\n    }\r\n    public simulationResumed() {\r\n        this.playPauseButton.innerHTML = \"&#10074;&#10074;\"; // pause symbol\r\n        \r\n        (this.stepButton as HTMLInputElement)!.disabled = true;\r\n        this.app.updateStatusBarSimulationMessages();\r\n    }\r\n    public updateStatusBarZoom() {\r\n        const currentZoom = this.app.gravityAnimationController.currentZoom;\r\n        this.setStatusMessage(`Zoom: ${currentZoom.toFixed(2)} (m per pixel)`, 4);\r\n    }\r\n    public getSelectedClickAction() {\r\n        return this.getSelectedValue(this.clickAction) ?? this.clickAction.buttons[0].value;\r\n    }\r\n\r\n    public getSelectedValue(group: RadioButtonGroup): string | null {\r\n        const selected = group.buttons.find(btn => btn.checked);\r\n        return selected?.value ?? null;\r\n    }\r\n    public body2dFromInputs(): Body2d {\r\n        const movable = this.addBodyMovable.checked;\r\n        const mass = util.getInputNumber(this.massInput);\r\n\r\n        return new Body2d(util.numberInRange(mass, 1, Number.MAX_SAFE_INTEGER), movable);\r\n    }\r\n    public updateSelectedMass() {\r\n        this.massInput.step = this.calculateMassInputStep();\r\n    }\r\n    /**\r\n     * The step is equal to 10% of the input value, rounded down to the nearest power of 10.\r\n     * @returns Step as a string. Step is always at least 1 or larger.\r\n     */\r\n    private calculateMassInputStep(): string {\r\n        let step = (10 ** (Math.floor(Math.log10(util.getInputNumber(this.massInput))) - 1));\r\n        return step < 1 ? \"1\" : step.toString();\r\n    }\r\n    /**\r\n     * @param fieldIndexOrId number of field (starting at one) OR id of the field\r\n     */\r\n    public setStatusMessage(message: string, fieldIndexOrId?: number | string, append: boolean = false) {\r\n        let element: HTMLElement;\r\n        if (typeof fieldIndexOrId === \"number\") {\r\n            element = this.statusBar.fields[fieldIndexOrId - 1];\r\n        } else if (typeof fieldIndexOrId === \"string\") {\r\n            element = document.getElementById(fieldIndexOrId)!;\r\n        } else {\r\n            element = this.statusBar.fields[0];\r\n        }\r\n        \r\n        if (append) {\r\n            element!.innerHTML += message;\r\n        } else {\r\n            element!.innerHTML = message;\r\n        }\r\n    }\r\n\r\n}","import { Body2d } from \"./gravity\";\r\nimport { AnimationSettings, CanvasSpace, ObjectState } from \"./types\";\r\nimport { Vector2D } from \"./vector2d\";\r\nimport * as essentials from \"./essentials\";\r\nimport { MAX_ZOOM, MIN_ZOOM, VECTOR_THICKNESS, MIN_DISPLAYED_RADIUS } from \"../const\";\r\n\r\nexport class Canvas {\r\n    // let offscreenCanvas: OffscreenCanvas; // use this in a worker thread to render or draw on, then transfer content to the visible html-canvas\r\n    // let offscreenCanvasCtx: OffscreenCanvasRenderingContext2D;\r\n    private _visibleCanvas: HTMLCanvasElement;\r\n    private _visibleCanvasContext: CanvasRenderingContext2D;\r\n    private _canvasSpace: CanvasSpace;\r\n    private _running: boolean = false;\r\n    constructor(visibleCanvas: HTMLCanvasElement) {\r\n        this._visibleCanvas = visibleCanvas;\r\n        this._visibleCanvasContext = visibleCanvas.getContext(\"2d\")!;\r\n        this._canvasSpace = {origin: new Vector2D(0, 0), currentZoom: 1, orientationY: -1};\r\n    }\r\n    //#region get, set\r\n    get visibleCanvas() {\r\n        return this._visibleCanvas;\r\n    }\r\n    set visibleCanvas(canvas: HTMLCanvasElement) {\r\n        this._visibleCanvas = canvas;\r\n    }\r\n    get visibleCanvasContext() {\r\n        return this._visibleCanvasContext;\r\n    }\r\n    set visibleCanvasContext(context: CanvasRenderingContext2D) {\r\n        this._visibleCanvasContext = context;\r\n    }\r\n    get canvasSpace() {\r\n        return this._canvasSpace;\r\n    }\r\n    set canvasSpace(canvasSpace: CanvasSpace) {\r\n        this._canvasSpace = canvasSpace;\r\n    }\r\n    get running() {\r\n        return this._running;\r\n    }\r\n    set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    // additional getters\r\n    get currentZoom(): number {\r\n        return this.canvasSpace.currentZoom;\r\n    }\r\n    //#endregion\r\n\r\n    public resize(width: number, height: number) {\r\n        this.visibleCanvas.width = width;\r\n        this.visibleCanvas.height = height;\r\n    }   \r\n\r\n    //#region drawing stuff\r\n    /**\r\n     * @param position in canvas space\r\n     * @param direction in canvas space\r\n     */\r\n    private drawVector(position: Vector2D, direction: Vector2D, color: string = \"white\") {\r\n        // optionally normalize the direction and scale later\r\n        let endPosition: Vector2D = position.add(direction);\r\n        if (!this.isLineVisible(position, endPosition)) {\r\n            return;\r\n        }\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.lineWidth = VECTOR_THICKNESS;\r\n        this.visibleCanvasContext.strokeStyle = color;\r\n        this.visibleCanvasContext.moveTo(position.x, position.y);\r\n        this.visibleCanvasContext.lineTo(endPosition.x, endPosition.y);\r\n        this.visibleCanvasContext.stroke();\r\n    }\r\n    public drawVectors(objectStates: ObjectState[]) {\r\n        objectStates.forEach(objectState => {\r\n            this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(objectState.position), this.directionFromSimulationSpaceToCanvasSpace(objectState.acceleration), \"green\");\r\n            this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(objectState.position), this.directionFromSimulationSpaceToCanvasSpace(objectState.velocity), \"red\");\r\n        });\r\n    }\r\n    /**\r\n     * draws a circular body at specified position, in specified color\r\n     * @param body \r\n     * @param position on canvas\r\n     * @param color default white\r\n     */\r\n    private drawBody(body: Body2d, position: Vector2D) {\r\n        let visibleRadius = Math.max(body.radius / this.currentZoom, MIN_DISPLAYED_RADIUS);\r\n        if (!this.isCircleVisible(position, visibleRadius)) {\r\n            return;\r\n        }\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.arc(position.x, position.y, visibleRadius, 0, Math.PI * 2);\r\n        this.visibleCanvasContext.closePath();\r\n        this.visibleCanvasContext.fillStyle = body.color;\r\n        this.visibleCanvasContext.fill();\r\n    }\r\n    public drawBodies(objectStates: ObjectState[]) {\r\n        objectStates.forEach(object => {\r\n            this.drawBody(object.body, this.pointFromSimulationSpaceToCanvasSpace(object.position));\r\n        });\r\n    }\r\n    public redrawSimulationState(objectStates: ObjectState[], animationSettings: AnimationSettings) {\r\n        this.visibleCanvasContext.clearRect(0, 0, this.visibleCanvas.width, this.visibleCanvas.height);\r\n        this.drawBodies(objectStates);\r\n        if (animationSettings.displayVectors) {\r\n            this.drawVectors(objectStates);\r\n        }\r\n    }\r\n    private isCircleVisible(position: Vector2D, radius: number): boolean {\r\n        const inBoundsLeft = position.x + radius >= 0;\r\n        const inBoundsRight = position.x - radius <= this.visibleCanvas.width;\r\n        const inBoundsTop = position.y + radius >= 0;\r\n        const inBoundsBottom = position.y - radius <= this.visibleCanvas.height;\r\n        return inBoundsLeft && inBoundsRight && inBoundsTop && inBoundsBottom;\r\n    }\r\n    private isLineVisible(startPoint: Vector2D, endPoint: Vector2D): boolean {\r\n        // if the startPoint or endPoint is in the canvas, return true\r\n        if ((essentials.isInRange(startPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(startPoint.y, 0, this.visibleCanvas.height)) ||\r\n            (essentials.isInRange(endPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(endPoint.y, 0, this.visibleCanvas.height))) \r\n            {\r\n            return true;\r\n        }\r\n        // if both points are outside the canvas, check if the line intersects with any of the canvas edges\r\n        if (Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, 0), new Vector2D(this.visibleCanvas.width, 0)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, 0), new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height), new Vector2D(0, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, this.visibleCanvas.height), new Vector2D(0, 0)], true)) \r\n            {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    //#endregion\r\n    \r\n    /**\r\n     * Origin {x:0,y:0} is at the top-left\r\n     */\r\n    public setOrigin(newOrigin: Vector2D) {\r\n        this.canvasSpace.origin = newOrigin;\r\n    }\r\n    public moveOrigin(displacement: { x: number, y: number}) {\r\n        const originPosition = this.canvasSpace.origin;\r\n        const newOrigin = originPosition.add(displacement);\r\n        this.setOrigin(newOrigin);\r\n    }\r\n    public scrollRight(distance: number) {\r\n        this.moveOrigin(new Vector2D(distance, 0));\r\n    }\r\n    public scrollLeft(distance: number) {\r\n        this.moveOrigin(new Vector2D(-distance, 0));\r\n    }\r\n    public scrollUp(distance: number) {\r\n        this.moveOrigin(new Vector2D(0, distance));\r\n    }\r\n    public scrollDown(distance: number) {\r\n        this.moveOrigin(new Vector2D(0, -distance));\r\n    }\r\n    public zoomOut(zoomCenter: Vector2D, zoomStep: number): number {\r\n        if (this.currentZoom >= MAX_ZOOM) { \r\n            return this.currentZoom; \r\n        }\r\n\r\n        let newZoom = this.currentZoom + zoomStep;\r\n        if(newZoom > MAX_ZOOM) {\r\n            newZoom = MAX_ZOOM;\r\n            zoomStep = MAX_ZOOM - this.canvasSpace.currentZoom;\r\n        }\r\n        \r\n        const shiftOrigin: Vector2D = zoomCenter.scale(zoomStep);\r\n        this.moveOrigin(shiftOrigin.hadamardProduct({x: -1, y: 1}));\r\n        this.canvasSpace.currentZoom = newZoom;\r\n\r\n        return newZoom;\r\n    }\r\n    public zoomIn(zoomCenter: Vector2D, zoomStep: number): number {\r\n        if (this.currentZoom <= MIN_ZOOM) { \r\n            return this.currentZoom; \r\n        }\r\n\r\n        let newZoom = this.canvasSpace.currentZoom - zoomStep;\r\n        if (newZoom < MIN_ZOOM) {\r\n            newZoom = MIN_ZOOM;\r\n            zoomStep = this.canvasSpace.currentZoom - MIN_ZOOM;\r\n        }\r\n        \r\n        const shiftOrigin: Vector2D = zoomCenter.scale(zoomStep);\r\n        this.moveOrigin(shiftOrigin.hadamardProduct({x: 1, y: -1}));\r\n        this.canvasSpace.currentZoom = newZoom;\r\n        \r\n        return newZoom;\r\n    }\r\n    public setZoom(newZoom: number) {\r\n        newZoom = essentials.numberInRange(newZoom, MIN_ZOOM, MAX_ZOOM);\r\n        this.canvasSpace.currentZoom = newZoom;\r\n    }\r\n    public pointFromSimulationSpaceToCanvasSpace(simVector: Vector2D): Vector2D {\r\n    // transformation:\r\n    // 1. shift (point in SimSpace - Origin of C in SimSpace)\r\n    // 2. flip (y axis point in opposite directions)\r\n    // 3. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const shifted: Vector2D = simVector.subtract(this.canvasSpace.origin);\r\n    const flipped: Vector2D = new Vector2D(shifted.x, shifted.y * -1);\r\n    const scaled: Vector2D = flipped.scale(1 / this.currentZoom);\r\n    return scaled;\r\n    }\r\n    public directionFromSimulationSpaceToCanvasSpace(simVector: Vector2D): Vector2D {\r\n        // transformation:\r\n        // 1. flip (y axis are in opposite directions)\r\n        // 2. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n        const flipped: Vector2D = new Vector2D(simVector.x, simVector.y * -1);\r\n        const scaled: Vector2D = flipped.scale(1 / this.currentZoom);\r\n        return scaled;\r\n    }\r\n\r\n    \r\n}","import { Body2d } from \"./gravity\";\r\nimport { Vector2D } from \"./vector2d\";\r\nexport interface AnimationSettings {\r\n    defaultScrollRate: number;\r\n    defaultZoomStep: number;\r\n    defaultZoomFactor: number;\r\n    frameLength: number; // ms\r\n    displayVectors: boolean;\r\n    tracePaths: boolean;\r\n}\r\nexport enum TouchAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    ManipulateView = 2\r\n}\r\nexport enum MouseAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    Scroll = 2,\r\n    Zoom = 3\r\n}\r\nexport interface Mouse {\r\n   main: MouseButton;\r\n   secondary: MouseButton;\r\n   wheel: MouseButton;\r\n}\r\nexport interface MouseButton {\r\n    state: ButtonState;\r\n    downCoordinatesInSimSpace?: { x: number, y: number } | Vector2D;\r\n}\r\nexport enum ButtonState {\r\n    Up = 0,\r\n    Down = 1,\r\n}\r\nexport enum MouseButtons {\r\n    Main = 0,\r\n    Wheel = 1,\r\n    Secondary = 2,\r\n}\r\nexport interface CanvasSpace {\r\n    // use this to transform simulationSpace to canvasSpace and back\r\n    origin: Vector2D, // the canvas' origin in simulation space\r\n    currentZoom: number, // simulationUnits (meter) per canvasUnit\r\n    orientationY: number; // in practice this is -1, as the y-axis of the canvas is in the opposite direction of the simulation\r\n}\r\nexport interface ObjectState {\r\n    body: Body2d, \r\n    position: Vector2D,\r\n    /**\r\n     * simulationUnits (meter?) per second\r\n     */\r\n    velocity: Vector2D,\r\n    acceleration: Vector2D\r\n}\r\n/*\r\n    UI stuff\r\n*/\r\nexport interface StatusBar {\r\n    bar: HTMLDivElement\r\n    fields: HTMLSpanElement[];\r\n}\r\nexport interface RadioButtonGroup {\r\n    name: string;\r\n    buttons: HTMLInputElement[];\r\n}\r\nexport interface IUI {\r\n    statusBar: StatusBar;\r\n    // top menu\r\n    resetButton: HTMLElement;\r\n    playPauseButton: HTMLElement;\r\n    stepButton: HTMLElement;\r\n    repositoryLink: HTMLElement;\r\n\r\n    // main menu\r\n    zoomInButton: HTMLElement;\r\n    zoomOutButton: HTMLElement;\r\n    scrollUpButton: HTMLElement;\r\n    scrollDownButton: HTMLElement;\r\n    scrollLeftButton: HTMLElement;\r\n    scrollRightButton: HTMLElement;\r\n\r\n    displayVectorsCheckbox: HTMLInputElement;\r\n\r\n    collisionDetectionCheckbox: HTMLInputElement;\r\n    elasticCollisionsCheckbox: HTMLInputElement;\r\n    gravitationalConstantInput: HTMLInputElement;\r\n\r\n    clickAction: HTMLSelectElement | RadioButtonGroup;\r\n    massInput: HTMLInputElement;\r\n    addBodyMovable: HTMLInputElement;\r\n}","import { Canvas } from \"./canvas\";\r\nimport { Body2d, Simulation } from \"./gravity\";\r\nimport * as util from \"./essentials\";\r\nimport { AnimationSettings, ButtonState, MouseButtons, MouseAction, TouchAction, Mouse as Pointer } from \"./types\";\r\nimport { Coordinate, Vector2D } from \"./vector2d\";\r\nimport { App } from \"./app\";\r\n\r\n\r\nexport class GravityAnimationController {\r\n    private _canvas: Canvas;\r\n    private _simulation: Simulation;\r\n    private _animationSettings: AnimationSettings;\r\n    private _running: boolean;\r\n    // ---\r\n    private pointer: Pointer = { main: { state: ButtonState.Up, downCoordinatesInSimSpace: undefined }, \r\n                     secondary: { state: ButtonState.Up }, \r\n                     wheel: { state: ButtonState.Up} };\r\n    private touchAction: TouchAction = TouchAction.None;\r\n    private activeTouches = new Map<number, Coordinate>();\r\n    private previousTouchesMid: Vector2D | null = null;\r\n    private previousTouchesDist: number | null = null;\r\n    private lastSingleTouchPos: Coordinate | null = null;\r\n//#region get, set\r\n    get canvas(): Canvas {\r\n        return this._canvas;\r\n    }\r\n    set canvas(canvas: Canvas) {\r\n        this._canvas = canvas;\r\n    }\r\n    get simulation(): Simulation {\r\n        return this._simulation;\r\n    }\r\n    set simulation(simulation: Simulation) {\r\n        this._simulation = simulation;\r\n    }\r\n    get animationSettings(): AnimationSettings {\r\n        return this._animationSettings;\r\n    }\r\n    private set animationSettings(animationSettings: AnimationSettings) {\r\n        this._animationSettings = animationSettings;\r\n    }\r\n    get running(): boolean {\r\n        return this._running;\r\n    }\r\n    private set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    // additional getters\r\n    get tickCount(): number {\r\n        return this.simulation.tickCount;\r\n    }\r\n    get bodyCount(): number {\r\n        return this.simulation.simulationState.length;\r\n    }\r\n    get width(): number {\r\n        return this.canvas.visibleCanvas.width;\r\n    }\r\n    get height(): number {\r\n        return this.canvas.visibleCanvas.height;\r\n    }\r\n    get currentZoom(): number {\r\n        return this.canvas.currentZoom;\r\n    }\r\n//#endregion\r\n//#region initialization\r\n    constructor(private app: App, elementId: string = \"theCanvas\") {\r\n        this._canvas = new Canvas(document.getElementById(elementId) as HTMLCanvasElement);\r\n        this._simulation = new Simulation;\r\n        this._animationSettings = { defaultScrollRate: 0.1, defaultZoomStep: 1, defaultZoomFactor: 0.1, frameLength: 25, displayVectors: true, tracePaths: true };\r\n        this._running = false;\r\n        \r\n        this.canvas.visibleCanvas.addEventListener(\"pointerdown\",   (ev) => this.canvasPointerDown(ev as PointerEvent));\r\n        this.canvas.visibleCanvas.addEventListener(\"pointerup\",     (ev) => this.canvasPointerUp(ev as PointerEvent));\r\n        this.canvas.visibleCanvas.addEventListener(\"pointermove\",   (ev) => this.canvasPointerMoving(ev as PointerEvent));\r\n        this.canvas.visibleCanvas.addEventListener(\"pointercancel\", (ev) => this.cancelPointer(ev as PointerEvent));\r\n        this.canvas.visibleCanvas.addEventListener(\"mousedown\",     (ev) => this.canvasMouseDown(ev as MouseEvent));    // pointerEvents only fire when the first button is pressed, and the last button is released\r\n        this.canvas.visibleCanvas.addEventListener(\"mouseup\",       (ev) => this.canvasMouseUp(ev as MouseEvent));      // so we need mouse events to catch all button presses\r\n        this.canvas.visibleCanvas.addEventListener(\"wheel\",         (ev) => this.canvasScrollMouseWheel(ev as WheelEvent));\r\n        this.canvas.visibleCanvas.addEventListener(\"contextmenu\",   (ev) => {ev.preventDefault()});\r\n    }\r\n\r\n    public initialize(width: number, height: number) {\r\n        this.initCanvas(width, height);\r\n        this.initSimulation();\r\n    }\r\n    private initCanvas(width: number, height: number) {\r\n        this.canvas.visibleCanvas.width = width;\r\n        this.canvas.visibleCanvas.height = height;\r\n\r\n        // REFACTOR ME: apply settings after initialization\r\n        this.animationSettings.displayVectors = this.app.ui.displayVectorsCheckbox.checked;\r\n        \r\n        // offscreenCanvas = new OffscreenCanvas(visibleCanvas.clientWidth, visibleCanvas.clientHeight);\r\n        // offscreenCanvasCtx = offscreenCanvas.getContext(\"2d\")!;\r\n    }\r\n    private initSimulation() {\r\n        this.simulation.collisionDetection = this.app.ui.collisionDetectionCheckbox.checked;\r\n        this.simulation.elasticCollisions = this.app.ui.elasticCollisionsCheckbox.checked;\r\n    }\r\n//#endregion\r\n//#region interaction\r\n    private canvasPointerDown(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerDown only fires for presses while no other button is down.\r\n            return;\r\n        }\r\n        this.canvas.visibleCanvas.setPointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchStart(ev);\r\n                break;\r\n\r\n            case \"pen\":\r\n                \r\n                break;\r\n\r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n        \r\n       \r\n    }\r\n    private canvasPointerUp(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerUp only fires when the last button is released.\r\n            return;\r\n        }\r\n        this.canvas.visibleCanvas.releasePointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchEnd(ev);\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n        \r\n    }\r\n    private canvasPointerMoving(ev: PointerEvent) {\r\n        const currentMovement = new Vector2D(ev.movementX, ev.movementY);\r\n        \r\n        switch (ev.pointerType) {\r\n            case \"mouse\":\r\n                // check .buttons (bitmask) to detect wheel press\r\n                // buttons bit 2 (value 4) = wheel button\r\n                const wheelButtonPressed = (ev.buttons & 4) !== 0;\r\n                if (wheelButtonPressed) {\r\n                    ev.preventDefault(); // prevent scroll-symbol\r\n                    this.scrollInCanvasUnits(currentMovement);\r\n                }\r\n                break;\r\n        \r\n            case \"touch\":\r\n                const currentTouchPosition = this.activeTouches.get(ev.pointerId)!;\r\n                if (!currentTouchPosition) return;\r\n\r\n                currentTouchPosition.x = ev.clientX;\r\n                currentTouchPosition.y = ev.clientY;\r\n\r\n                switch (this.touchAction) {\r\n\r\n                    case TouchAction.AddBody:\r\n                        // TODO: draw (half transparent) body and vector while dragging\r\n                        break;\r\n\r\n                    case TouchAction.ManipulateView:\r\n                        if (this.activeTouches.size === 1) {\r\n                            // --------------------\r\n                            //      SINGLE TOUCH\r\n                            // --------------------\r\n\r\n                            if (this.lastSingleTouchPos) {\r\n                                const dx = currentTouchPosition.x - this.lastSingleTouchPos.x;\r\n                                const dy = currentTouchPosition.y - this.lastSingleTouchPos.y;\r\n\r\n                                // RefactorMe(maybe?) use movement.x / y, mostly works but not technically part of PointerEvents\r\n                                this.scrollInCanvasUnits(new Vector2D(dx, dy));\r\n                            }\r\n\r\n                            this.lastSingleTouchPos = currentTouchPosition;\r\n                            return;\r\n                        }\r\n\r\n                        // --------------------\r\n                        //      MULTI TOUCH IS WHAT'S LEFT\r\n                        // --------------------\r\n                        const touches = [...this.activeTouches.values()];\r\n                        const p1 = touches[0];\r\n                        const p2 = touches[1];\r\n\r\n                        const touchesMidpoint = new Vector2D(\r\n                            (p1.x + p2.x) / 2,\r\n                            (p1.y + p2.y) / 2\r\n                        );\r\n\r\n                        const touchesDistance = Math.hypot(p2.x - p1.x, p2.y - p1.y);\r\n\r\n                        // no previous gesture -> initialize\r\n                        // RefactorMe: this should be determined at pointerdown\r\n                        if (this.previousTouchesMid === null || this.previousTouchesDist === null) {\r\n                            this.previousTouchesMid = touchesMidpoint;\r\n                            this.previousTouchesDist = touchesDistance;\r\n                            return;\r\n                        }\r\n\r\n                        const zoomFactor = touchesDistance / this.previousTouchesDist;\r\n                        const zoomCenterCanvas = this.absoluteToCanvasPosition(touchesMidpoint);\r\n                        const scroll = touchesMidpoint.subtract(this.previousTouchesMid);\r\n                        this.zoomToFactor(zoomFactor, zoomCenterCanvas);\r\n                        this.scrollInCanvasUnits(scroll);\r\n\r\n                        this.previousTouchesMid = touchesMidpoint;\r\n                        this.previousTouchesDist = touchesDistance;\r\n\r\n                        break;\r\n                    }\r\n\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType\");\r\n                break;\r\n        }\r\n    }\r\n    private cancelPointer(ev: PointerEvent) {\r\n        this.activeTouches.delete(ev.pointerId);\r\n    }\r\n    private canvasScrollMouseWheel(ev: WheelEvent) {\r\n        // don't scroll the entire page\r\n        ev.preventDefault();\r\n        \r\n        const cursorPos = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        const posInCanvasSpace = this.absoluteToCanvasPosition(cursorPos);\r\n\r\n        if (ev.deltaY < 0) {\r\n            this.zoomIn(posInCanvasSpace);\r\n        } else if (ev.deltaY > 0) {\r\n            this.zoomOut(posInCanvasSpace);\r\n        }\r\n    }    \r\n    private canvasTouchStart(ev: PointerEvent) {\r\n        this.activeTouches.set(ev.pointerId, { x: ev.clientX, y: ev.clientY });\r\n\r\n        if (this.activeTouches.size === 1) {\r\n            this.touchAction = TouchAction.AddBody;\r\n            this.lastSingleTouchPos = { x: ev.clientX, y: ev.clientY };\r\n            \r\n            \r\n            const positionVector = new Vector2D(ev.clientX, ev.clientY);\r\n            const positionInSimSpace: Vector2D = this.pointFromCanvasSpaceToSimulationSpace(positionVector);\r\n            this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n\r\n        } else if (this.activeTouches.size === 2) {\r\n            this.touchAction = TouchAction.ManipulateView;\r\n\r\n            // reset pinch-gesture\r\n            this.previousTouchesMid = null;\r\n            this.previousTouchesDist = null;\r\n            \r\n            // stop scrolling\r\n            this.lastSingleTouchPos = null;\r\n        }\r\n    }\r\n    private canvasTouchEnd(ev: PointerEvent) {\r\n        if (!this.activeTouches.has(ev.pointerId)) return;\r\n\r\n        this.activeTouches.delete(ev.pointerId);\r\n\r\n        switch (this.touchAction) {\r\n            case TouchAction.AddBody:\r\n                const absPos = util.getAbsolutePointerPosition(ev);\r\n                this.addBodyAtPointer(this.absoluteToCanvasPosition(absPos));\r\n                this.touchAction = TouchAction.None;\r\n                break;\r\n\r\n            case TouchAction.ManipulateView:\r\n                // reset pinch-gesture\r\n                this.previousTouchesMid = null;\r\n                this.previousTouchesDist = null;\r\n\r\n                if (this.activeTouches.size === 1) {\r\n                    // one touch remaining -> use it to scroll\r\n                    const remaining = this.activeTouches.values().next().value!;\r\n                    this.lastSingleTouchPos = { x: remaining.x, y: remaining.y }\r\n                } else if (this.activeTouches.size === 0) {\r\n                    this.touchAction = TouchAction.None;\r\n                    this.lastSingleTouchPos = null;\r\n                    this.previousTouchesMid = null;\r\n                    this.previousTouchesDist = null;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    private canvasMouseUp(ev: MouseEvent) {\r\n        const absolutePointerPosition = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Up;\r\n                this.canvasMainMouseUp(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Up;\r\n                \r\n                // prevent scroll-symbol\r\n                ev.preventDefault();\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Up;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n                \r\n    }\r\n    private canvasMouseDown(ev: MouseEvent) {\r\n        const absolutePointerPosition: Vector2D = new Vector2D(ev.clientX, ev.clientY);\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Down;\r\n                this.canvasMainMouseDown(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Down;\r\n                ev.preventDefault(); // prevent scroll-symbol\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Down;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseDown(absoluteMousePosition: Coordinate) {\r\n        switch (MouseAction[this.app.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                const positionVector = new Vector2D(absoluteMousePosition.x, absoluteMousePosition.y);\r\n                const positionInSimSpace: Vector2D = this.pointFromCanvasSpaceToSimulationSpace(positionVector);\r\n                this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseUp(absoluteMousePosition: Vector2D) {\r\n        switch (MouseAction[this.app.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                this.addBodyAtPointer(this.absoluteToCanvasPosition(absoluteMousePosition));\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.redrawIfPaused();\r\n    }\r\n//#endregion\r\n//#region control methods\r\n    public run() {\r\n        this.runSimulation();\r\n        this.runAnimation();\r\n    }\r\n    public stop() {\r\n        this.running = false;\r\n        this.simulation.pause();\r\n    }\r\n    public toggle() {\r\n        if (this.running) {\r\n            this.stop();\r\n        } else {\r\n            this.run();\r\n        }\r\n    }\r\n    public reset() {\r\n        this.simulation.reset();\r\n        this.redrawIfPaused();\r\n    }\r\n    private runSimulation() {\r\n        if (!this.running) {\r\n            this.simulation.run();\r\n        }\r\n    }\r\n    private runAnimation() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n        const loop = () => {\r\n            if (this.running) {\r\n                setTimeout(loop, this.animationSettings.frameLength);\r\n                this.canvas.redrawSimulationState(this.simulation.simulationState, this.animationSettings);\r\n                this.app.updateStatusBarSimulationMessages();\r\n            }\r\n        };   \r\n        loop();\r\n    }\r\n    public advanceOneTick() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.simulation.advanceTick();\r\n        this.redrawIfPaused();\r\n    }\r\n    public redrawIfPaused() {\r\n        if (!this.running) {\r\n            this.canvas.redrawSimulationState(this.simulation.simulationState, this.animationSettings);\r\n        }\r\n    }\r\n//#endregion\r\n\r\n//#region interaction 2\r\n    public addBodyAtPointer(pointerPositionOnCanvas: Coordinate | Vector2D) {\r\n        const pointerPositionVector = pointerPositionOnCanvas instanceof Vector2D ? pointerPositionOnCanvas : new Vector2D(pointerPositionOnCanvas.x, pointerPositionOnCanvas.y);\r\n        const bodyBeingAdded: Body2d = this.app.ui.body2dFromInputs();\r\n        const mousePositionInSimSpace: Vector2D = this.pointFromCanvasSpaceToSimulationSpace(pointerPositionVector);\r\n        const vel: Vector2D = this.simulation.calculateVelocityBetweenPoints(this.pointer.main.downCoordinatesInSimSpace!, mousePositionInSimSpace);\r\n        this.addBody(bodyBeingAdded, mousePositionInSimSpace, vel);\r\n        this.app.updateStatusBarBodyCount();\r\n    }\r\n    public addBody(body: Body2d, position: Vector2D, velocity: Vector2D = new Vector2D(0, 0)) {\r\n        this.simulation.addObject(body, position, velocity);        \r\n        this.redrawIfPaused();\r\n    }\r\n    public setG(g: number) {\r\n        this.simulation.g = g;\r\n    }\r\n    public setDisplayVectors(display: boolean) {\r\n        this.animationSettings.displayVectors = display;\r\n        this.redrawIfPaused();\r\n    }\r\n    public resizeCanvas(width: number, height: number) {\r\n        this.canvas.resize(width, height);\r\n        this.redrawIfPaused();\r\n    }\r\n    public zoomOut(zoomCenter?: Vector2D, zoomStep?: number): number {\r\n        if (!zoomCenter) {\r\n            zoomCenter = new Vector2D(this.canvas.visibleCanvas.width / 2, this.canvas.visibleCanvas.height / 2);\r\n        }\r\n        if (!zoomStep) {\r\n            zoomStep = this.animationSettings.defaultZoomStep;\r\n        }\r\n        const newZoom = this.canvas.zoomOut(zoomCenter, zoomStep);\r\n        this.redrawIfPaused();\r\n        this.app.updateStatusBarZoom();\r\n\r\n        return newZoom;\r\n    }\r\n    public zoomIn(zoomCenter?: Vector2D, zoomStep?: number): number {\r\n        if (!zoomCenter) {\r\n            zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        }\r\n        if (!zoomStep) {\r\n            zoomStep = this.animationSettings.defaultZoomStep;\r\n        }\r\n        const newZoom = this.canvas.zoomIn(zoomCenter, zoomStep);\r\n        this.redrawIfPaused();\r\n        this.app.updateStatusBarZoom();\r\n\r\n        return newZoom;\r\n    }\r\n    public zoomToFactor(factor: number, zoomCenter?: Vector2D): number {\r\n        if (factor <= 0) return this.currentZoom;\r\n        if (!zoomCenter) {\r\n            zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        }\r\n\r\n        const oldZoom = this.currentZoom;\r\n        const newZoom = oldZoom * factor;\r\n        const zoomDelta = newZoom - oldZoom;\r\n\r\n        this.app.updateStatusBarZoom();\r\n\r\n        if (zoomDelta > 0) {\r\n            return this.canvas.zoomIn(zoomCenter, zoomDelta);\r\n        } else if (zoomDelta < 0) {\r\n            return this.canvas.zoomOut(zoomCenter, -zoomDelta);\r\n        } else {\r\n            return oldZoom;\r\n        }\r\n\r\n    }\r\n    public zoomInByFactor(factor: number = this.animationSettings.defaultZoomFactor, zoomCenter?: Vector2D): number {\r\n        if (zoomCenter === undefined) {\r\n            zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        }\r\n        const zoomStep = this.currentZoom * factor;\r\n        const newZoom = this.canvas.zoomIn(zoomCenter, zoomStep);\r\n        this.redrawIfPaused();\r\n        this.app.updateStatusBarZoom();\r\n\r\n        return newZoom;\r\n    }\r\n    public zoomOutByFactor(factor: number = this.animationSettings.defaultZoomFactor, zoomCenter?: Vector2D): number {\r\n        if (zoomCenter === undefined) {\r\n            zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        }\r\n        const zoomStep = this.currentZoom * factor;\r\n        const newZoom = this.canvas.zoomOut(zoomCenter, zoomStep);\r\n        this.redrawIfPaused();\r\n        this.app.updateStatusBarZoom();\r\n\r\n        return newZoom;\r\n    }\r\n    public setCanvasView(origin: Vector2D, zoom: number) { \r\n        this.canvas.setOrigin(origin);\r\n        this.canvas.setZoom(zoom);\r\n        this.app.updateStatusBarZoom();\r\n        this.redrawIfPaused();\r\n    }\r\n    private moveCanvas(displacement: { x: number; y: number }) {\r\n        this.canvas.moveOrigin(displacement);\r\n        this.redrawIfPaused();\r\n    }\r\n    public scrollInCanvasUnits(movementOnCanvas: Vector2D){\r\n        const movementInSimulationUnits = movementOnCanvas.scale(this.currentZoom);\r\n        this.moveCanvas({ x: -(movementInSimulationUnits.x), y: movementInSimulationUnits.y });\r\n    }\r\n    public canvasScrollRight(distance?: number) {\r\n        if (distance === undefined) {\r\n            distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n        }\r\n        this.canvas.scrollRight(distance);\r\n        this.redrawIfPaused();\r\n    }\r\n    public canvasScrollLeft(distance?: number) {\r\n        if (distance === undefined) {\r\n            distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n        }\r\n        this.canvas.scrollLeft(distance);\r\n        this.redrawIfPaused();\r\n    }\r\n    public canvasScrollUp(distance?: number) {\r\n        if (distance === undefined) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.canvas.scrollUp(distance);\r\n        this.redrawIfPaused();\r\n    }\r\n    public canvasScrollDown(distance?: number) {\r\n        if (distance === undefined) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.canvas.scrollDown(distance);\r\n        this.redrawIfPaused();\r\n    } \r\n//#endregion\r\n\r\n//#region transformations and various calculations\r\n    private absoluteToCanvasPosition(absolutePosition: Coordinate): Vector2D {\r\n        const canvasRect = this.canvas.visibleCanvas.getBoundingClientRect();\r\n        const x = absolutePosition.x - canvasRect.left;\r\n        const y = absolutePosition.y - canvasRect.top;\r\n        return new Vector2D(x, y);\r\n    }\r\n    /**\r\n     * Calculates the distance of the screen dimension (h/v) that one scroll step will move (ie. 0.1 will scroll 10% of the width/height in a horizontal/vertical direction)\r\n     * @param orientation \"horizontal\" | \"vertical\"\r\n     * @param rate a number *0 < rate < 1* - defaults to animationSettings.defaultScrollRate \r\n     * @returns the distance in simulationUnits\r\n     */\r\n    private scrollDistance(orientation: \"horizontal\" | \"vertical\", rate?: number): number {\r\n        if (rate === undefined) { rate = this.animationSettings.defaultScrollRate; }\r\n        switch (orientation) {\r\n            case \"horizontal\":\r\n                return this.width * rate * this.currentZoom;\r\n            case \"vertical\":\r\n                return this.height * rate * this.currentZoom;\r\n        }\r\n    }\r\n    private pointFromCanvasSpaceToSimulationSpace(canvasVector: Vector2D): Vector2D {\r\n        // transformation:\r\n        // 1. scale (canvasVector * zoom in simulationUnits/canvasUnit)\r\n        // 2. flip (y axis are in opposite directions)\r\n        // 3. shift (scaledAndFlippedPoint + Origin of C in SimSpace)\r\n        const scaled = canvasVector.scale(this.canvas.currentZoom);\r\n        const flipped = scaled.hadamardProduct(new Vector2D(1, this.canvas.canvasSpace.orientationY));\r\n        const shifted = flipped.add(this.canvas.canvasSpace.origin);\r\n        return shifted;\r\n    }\r\n\r\n//#endregion\r\n}","import { Vector2D } from \"./vector2d\";\r\nimport { UI } from \"./ui\";\r\nimport { GravityAnimationController } from \"./gravity-animation-controller\";\r\n\r\nexport class App {\r\n    private _ui: UI;\r\n    private _gravityAnimationController: GravityAnimationController;\r\n    //#region get, set\r\n    get gravityAnimationController() {\r\n        return this._gravityAnimationController;\r\n    }\r\n    set gravityAnimationController(controller: GravityAnimationController) {\r\n        this._gravityAnimationController = controller;\r\n    }\r\n    get ui() {\r\n        return this._ui;\r\n    }\r\n    get running() {\r\n        return this.gravityAnimationController.running;\r\n    }\r\n    // additional getters\r\n    get selectedClickAction() {\r\n        return this.ui.getSelectedValue(this.ui.clickAction) ?? this.ui.clickAction.buttons[0].value;\r\n    }\r\n    //#endregion\r\n    constructor() {\r\n        this._gravityAnimationController = new GravityAnimationController(this);        \r\n        this._ui = new UI(this);\r\n\r\n        this.initialize();\r\n    }\r\n    private initialize() {\r\n        this.gravityAnimationController.initialize(window.innerWidth, window.innerHeight);\r\n        this.ui.initialize();\r\n    }\r\n    //#region control\r\n    public run() {\r\n        this.gravityAnimationController.run();\r\n        this.ui.simulationResumed();\r\n    }\r\n    public stop() {\r\n        this.gravityAnimationController.stop();\r\n        this.ui.simulationStopped();\r\n    }\r\n    public toggleSimulation() {\r\n        if (this.running) {\r\n            this.stop();\r\n        } else {\r\n            this.run();\r\n        }\r\n    }\r\n    public advanceOneTick() {\r\n        this.gravityAnimationController.advanceOneTick();\r\n        this.updateStatusBarSimulationMessages();\r\n    }\r\n    public reset() {\r\n        this.gravityAnimationController.reset();\r\n        this.updateStatusBarSimulationMessages();\r\n    }\r\n    public updateStatusBarBodyCount() {\r\n        this.ui.setStatusMessage(`Number of Bodies: ${this.gravityAnimationController.bodyCount}`, 1);\r\n    }\r\n    public updateStatusBarTickCount() {\r\n        this.ui.setStatusMessage(`Simulation Tick: ${this.gravityAnimationController.tickCount}`, 2);\r\n    }\r\n    /**\r\n     * Updates the status fields for tick count and number of bodies\r\n     */\r\n    public updateStatusBarSimulationMessages() {\r\n        this.updateStatusBarTickCount();\r\n        this.updateStatusBarBodyCount();\r\n    }\r\n    public updateStatusBarZoom() {\r\n        this.ui.updateStatusBarZoom();\r\n    }\r\n    //#endregion\r\n    \r\n\r\n    //#region interaction\r\n    public scrollViewRight(distance?: number) {\r\n        this.gravityAnimationController.canvasScrollRight(distance);\r\n    }\r\n    public scrollViewLeft(distance?: number) {\r\n        this.gravityAnimationController.canvasScrollLeft(distance);\r\n    }\r\n    public scrollViewUp(distance?: number) {\r\n        this.gravityAnimationController.canvasScrollUp(distance);\r\n    }\r\n    public scrollViewDown(distance?: number) {\r\n        this.gravityAnimationController.canvasScrollDown(distance);\r\n    }\r\n    public setG(g: number) {\r\n        this.gravityAnimationController.setG(g);\r\n    }\r\n    public zoomOut(zoomCenter?: Vector2D, zoomStep?: number): number {\r\n        const newZoom = this.gravityAnimationController.zoomOut(zoomCenter, zoomStep);\r\n        return newZoom;\r\n    }\r\n    public zoomIn(zoomCenter?: Vector2D, zoomStep?: number) {\r\n        const newZoom = this.gravityAnimationController.zoomIn(zoomCenter, zoomStep);\r\n        return newZoom;\r\n    }\r\n    public resizeCanvas(width: number, height: number) {\r\n        this.gravityAnimationController.resizeCanvas(width, height);\r\n        this.ui.setStatusMessage(`Canvas dimension: ${width} * ${height}`, 5);\r\n    }\r\n    public setCollisionDetection(collisionDetection: boolean, elasticCollisions = false) {\r\n        this.gravityAnimationController.simulation.collisionDetection = collisionDetection;\r\n        this.gravityAnimationController.simulation.elasticCollisions = elasticCollisions;\r\n    }\r\n    public setElasticCollisions(elasticCollisions: boolean) {\r\n        this.gravityAnimationController.simulation.elasticCollisions = elasticCollisions;\r\n    }\r\n    public setDisplayVectors(displayVectors: boolean) {\r\n        this.gravityAnimationController.setDisplayVectors(displayVectors)\r\n    }\r\n}\r\n    //#endregion\r\n","import { App } from \"./app\";\r\n\r\nlet app: App;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", initialize);\r\nfunction initialize() {\r\n    app = new App();\r\n    registerEvents();\r\n\r\n    app.run();\r\n}\r\n\r\nfunction registerEvents() {\r\n    document.removeEventListener(\"DOMContentLoaded\", initialize);\r\n    window.addEventListener(\"resize\", windowResized);\r\n}\r\n\r\nfunction windowResized(this: Window, ev: UIEvent) {\r\n    let windowWidth = this.innerWidth;\r\n    let windowHeight = this.innerHeight;\r\n    app.resizeCanvas(windowWidth, windowHeight);\r\n}\r\n"],"names":["Vector2D","a","b","__publicField","vectors","result","previous","current","v","scalar","magnitude","array","reflectionSurface","axis","dotAxis","projection","line1","line2","strict","p1","p2","q1","q2","r","s","rCrossS","qMinusP","qmpCrossR","t0","t1","tMin","tMax","pointA","pointB","t","u","v1","v2","epsilon","isZero","value","DEFAULT_G","MIN_G","MAX_G","MIN_ZOOM","MAX_ZOOM","VECTOR_THICKNESS","MIN_DISPLAYED_RADIUS","_Body2d","mass","movable","color","radius","newMass","newRadius","affected","c","Body2d","Simulation","c.DEFAULT_G","objectState","running","tickCount","collisionDetection","elasticCollisions","g","c.MIN_G","c.MAX_G","bodyOrObject","position","velocity","index","runSimulationStep","toCoordinate","fromCoordinate","timeFrameInSeconds","forces","newAcceleration","j","forceOnI","forceOnJ","dt","i","objectStateI","objectStateJ","distance","netForceBetweenBodies","distanceIJ","index1","index2","state1","state2","totalMomentum","totalMass","resultingVelocity","changeObject","removeIndex","body1","body2","restitution","displacement","normalizedDisplacement","velocityAlongDisplacement","impulseScalar","deltaV1","deltaV2","objectState1","objectState2","normalDisplacement","targetDistance","totalMoveDistance","moveBody1","moveBody2","isNumeric","numberInRange","min","max","isInRange","getInputValue","input","inputElement","getInputNumber","inputValue","getAbsolutePointerPosition","ev","UI","app","bar","displayVectors","checked","elasticChecked","newG","currentZoom","group","selected","btn","util.getInputNumber","util.numberInRange","step","message","fieldIndexOrId","append","element","Canvas","visibleCanvas","canvas","context","canvasSpace","width","height","direction","endPosition","objectStates","body","visibleRadius","object","animationSettings","inBoundsLeft","inBoundsRight","inBoundsTop","inBoundsBottom","startPoint","endPoint","essentials.isInRange","newOrigin","zoomCenter","zoomStep","newZoom","shiftOrigin","essentials.numberInRange","simVector","shifted","TouchAction","MouseAction","ButtonState","MouseButtons","GravityAnimationController","elementId","simulation","currentMovement","currentTouchPosition","dx","dy","touches","touchesMidpoint","touchesDistance","zoomFactor","zoomCenterCanvas","scroll","cursorPos","util.getAbsolutePointerPosition","posInCanvasSpace","positionVector","positionInSimSpace","absPos","remaining","absolutePointerPosition","absoluteMousePosition","loop","pointerPositionOnCanvas","pointerPositionVector","bodyBeingAdded","mousePositionInSimSpace","vel","display","factor","oldZoom","zoomDelta","origin","zoom","movementOnCanvas","movementInSimulationUnits","absolutePosition","canvasRect","x","y","orientation","rate","canvasVector","App","controller","initialize","registerEvents","windowResized","windowWidth","windowHeight"],"mappings":"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"}