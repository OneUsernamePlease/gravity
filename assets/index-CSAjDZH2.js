var X=Object.defineProperty;var H=(n,t,i)=>t in n?X(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var r=(n,t,i)=>H(n,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();class a{constructor(t,i){r(this,"x");r(this,"y");typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t??0,this.y=i??0)}toString(){return`x: ${this.x}, y: ${this.y}`}add(...t){const i=t.reduce((e,s)=>({x:e.x+s.x,y:e.y+s.y}),{x:this.x,y:this.y});return new a(i.x,i.y)}subtract(t){return new a(this.x-t.x,this.y-t.y)}scale(t){return new a(this.x*t,this.y*t)}dotProduct(t){return this.x*t.x+this.y*t.y}magnitude(){return Math.hypot(this.x,this.y)}normalize(){const t=this.magnitude();return t===0?new a(0,0):this.scale(1/t)}distance(t){return Math.hypot(t.x-this.x,t.y-this.y)}displacementVector(t){return new a(t.x,t.y).subtract(this)}hadamardProduct(t){return new a(this.x*t.x,this.y*t.y)}normalVectors(){const t=[],i=this.normalize();return t.push(new a(-i.y,i.x)),t.push(new a(i.y,-i.x)),t}midpoint(t){return new a((this.x+t.x)/2,(this.y+t.y)/2)}reflect(t){t=t.normalize();const i=t.normalVectors()[0],e=this.dotProduct(i),s=i.scale(e).scale(2);return this.subtract(s)}static linesIntersecting(t,i,e=!1){const[s,o]=t,[l,h]=i,c=o.subtract(s),u=h.subtract(l),m=c.x*u.y-c.y*u.x,d=l.subtract(s),v=d.x*c.y-d.y*c.x;if(m===0){if(v===0){if(e){const B=l.subtract(s).dotProduct(c)/c.dotProduct(c),E=h.subtract(s).dotProduct(c)/c.dotProduct(c),C=Math.max(0,Math.min(B,E)),S=Math.min(1,Math.max(B,E));if(C<=S){const x=s.add(c.scale(C)),I=s.add(c.scale(S));return C===S?x:[x,I]}else return null}return[s,o]}return null}const y=(d.x*u.y-d.y*u.x)/m,w=(d.x*c.y-d.y*c.x)/m;return e&&(y<0||y>1||w<0||w>1)?null:s.add(c.scale(y))}static midpoint(t,i){return new a((t.x+i.x)/2,(t.y+i.y)/2)}static simpleLineIntersection(t,i){throw new Error("Method not implemented.")}static linesIntersectingButBetter(t,i,e=!1,s=1e-9){const[o,l]=t,[h,c]=i,u=l.subtract(o),m=c.subtract(h),d=u.x*m.y-u.y*m.x,v=h.subtract(o),y=v.x*u.y-v.y*u.x,w=C=>Math.abs(C)<s;if(w(d)){if(w(y)){if(e){const C=h.subtract(o).dotProduct(u)/u.dotProduct(u),S=c.subtract(o).dotProduct(u)/u.dotProduct(u),x=Math.max(0,Math.min(C,S)),I=Math.min(1,Math.max(C,S));if(x<=I){const Z=o.add(u.scale(x)),W=o.add(u.scale(I));return w(x-I)?Z:[Z,W]}else return null}return[o,l]}return null}const A=(v.x*m.y-v.y*m.x)/d,B=(v.x*u.y-v.y*u.x)/d;return e&&(A<-s||A>1+s||B<-s||B>1+s)?null:o.add(u.scale(A))}}const N=50,J=-10,K=100,k=.01,M=1e4,U=.1,Q=.1,j=1,tt="#20ff20ff",it="Green",et="#ffd700ff",st="Yellow",nt=.75,ot="#222222ff";function at(n){return n=n.trim(),!isNaN(+n)&&n.length!==0}function $(n,t,i){if(t>i)throw new Error("In ensureNumberInRange: min cannot be greater than max");return Math.max(t,Math.min(n,i))}function T(n,t,i){return n>=t&&n<=i}function rt(n){let t;return typeof n=="string"?t=document.getElementById(n):t=n,t.value.trim()}function P(n){const t=rt(n);return at(t)?+t:0}function L(n){return{x:n.clientX,y:n.clientY}}function ct(n,t,i=1){return i<=0&&(i=1),(n instanceof a?n:new a(n)).subtract(t).scale(1/i)}function V(n){return n.toString(16).padStart(2,"0")}function q(n){if(n<=1e3)return"#ff0000ff";if(n>=1e8)return"#0000ffff";const s=Math.sqrt(1e3*1e8);let o,l,h;if(n<s){const c=(Math.log(n)-Math.log(1e3))/(Math.log(s)-Math.log(1e3));o=255,l=Math.round(255*c),h=Math.round(255*c)}else{const c=(Math.log(n)-Math.log(s))/(Math.log(1e8)-Math.log(s));o=Math.round(255*(1-c)),l=Math.round(255*(1-c)),h=255}return`#${V(o)}${V(l)}${V(h)}ff`}const D=class D{constructor(t,i,e,s){r(this,"_mass");r(this,"_radius");r(this,"_color");r(this,"_movable");this._mass=t,s===void 0&&(s=this.defaultRadius(t)),this._radius=s,e===void 0&&(e=q(t)),this._color=e,i===void 0&&(i=!0),this._movable=i}get mass(){return this._mass}set mass(t){this._mass=t}get radius(){return this._radius}set radius(t){this._radius=t}get movable(){return this._movable}set movable(t){this._movable=t}get color(){return this._color}set color(t){CSS.supports("color",t)||(t="#818181ff"),this._color=t}defaultRadius(t){return t===void 0&&(t=this.mass),(3*t/(4*Math.PI*D.defaultDensity))**(1/3)}};r(D,"defaultDensity",1);let _=D;class lt{constructor(){r(this,"_simulationState");r(this,"_running");r(this,"_tickCount");r(this,"_tickLength");r(this,"_collisionDetection");r(this,"_elasticCollisions");r(this,"_g");r(this,"gravityLowerBounds",1);this._simulationState=[],this._running=!1,this._tickCount=0,this._tickLength=10,this._collisionDetection=!1,this._elasticCollisions=!1,this._g=N}get simulationState(){return this._simulationState}set simulationState(t){this._simulationState=t}get running(){return this._running}set running(t){this._running=t}get tickCount(){return this._tickCount}set tickCount(t){this._tickCount=t}get tickLength(){return this._tickLength}set tickLength(t){this._tickLength=t}get collisionDetection(){return this._collisionDetection}set collisionDetection(t){this._collisionDetection=t}get elasticCollisions(){return this._elasticCollisions}set elasticCollisions(t){this._elasticCollisions=t}get g(){return this._g}set g(t){(isNaN(t)||t<J||t>K)&&(t=N),this._g=t}addObject(t,i,e){return t instanceof _&&(t={body:t,position:i,velocity:e,acceleration:new a(0,0)}),t.body.movable||(t.velocity=new a(0,0)),this.simulationState.push(t)}clearObjects(){this.simulationState=[]}removeFromObjectStates(t){this.simulationState.splice(t,1)}pause(){this.running=!1}run(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.tickLength),this.advanceTick())};t()}reset(){this.clearObjects(),this.tickCount=0}advanceTick(){this.updateAccelerationVectors(),this.updateVelocitiesAndPositions(),this.collisionDetection&&this.handleCollisions(),this.tickCount++}updateAccelerationVectors(){const t=this.calculateForces();this.simulationState.forEach((i,e)=>{const o=(t.get(e)||new a(0,0)).scale(1/i.body.mass);i.acceleration=o})}calculateForces(){const t=new Map;for(let i=0;i<this.simulationState.length;i++)for(let e=i+1;e<this.simulationState.length;e++){const s=this.calculateForceBetweenBodies(i,e),o=s.scale(-1);t.set(i,(t.get(i)||new a(0,0)).add(s)),t.set(e,(t.get(e)||new a(0,0)).add(o))}return t}updateVelocityAndPosition(t){const i=this.tickLength/1e3;t.body.movable&&(t.velocity=t.velocity.add(t.acceleration.scale(i)),t.position=t.position.add(t.velocity.scale(i)))}updateVelocitiesAndPositions(){this.simulationState.forEach(t=>{this.updateVelocityAndPosition(t)})}calculateForceBetweenBodies(t,i){const e=this.simulationState[t],s=this.simulationState[i],o=e.position.distance(s.position);if(o<this.gravityLowerBounds||o===0)return new a(0,0);const l=this.g*(e.body.mass*s.body.mass/(o*o));return s.position.subtract(e.position).normalize().scale(l)}handleCollisions(){for(let t=0;t<this.simulationState.length;t++){const i=this.simulationState[t];if(i!==void 0)for(let e=t+1;e<this.simulationState.length;e++){const s=this.simulationState[e],o=i.position.distance(s.position);o<=i.body.radius+s.body.radius&&(o<=i.body.radius||o<=s.body.radius?this.mergeBodies(t,e):this.elasticCollisions&&this.elasticCollision(i,s))}}}mergeBodies(t,i){const e=this.simulationState[t],s=this.simulationState[i],o=e.velocity.scale(e.body.mass).add(s.velocity.scale(s.body.mass)),l=e.body.mass+s.body.mass,h=o.scale(1/l);let c,u;s.body.mass>e.body.mass?(c=s,u=t):(c=e,u=i),c.velocity=h,c.body.mass=l,c.body.radius=c.body.defaultRadius(),c.body.color=q(c.body.mass),c.body.movable=e.body.movable&&s.body.movable,c.body.movable||(c.velocity=new a(0,0)),this.removeFromObjectStates(u)}elasticCollision(t,i,e=1){const o=t.position.displacementVector(i.position),l=o.magnitude();if(l<=1||l===0)return;const h=o.scale(1/l),u=i.velocity.subtract(t.velocity).dotProduct(h);if(u>0)return;const m=-(1+e)*u/(t.body.mass+i.body.mass),d=h.scale(m*i.body.mass),v=h.scale(m*t.body.mass);t.velocity=t.velocity.subtract(d),i.velocity=i.velocity.add(v),t.body.movable||(t.velocity=new a(0,0),i.velocity=i.velocity.add(d)),i.body.movable||(i.velocity=new a(0,0),t.velocity=t.velocity.add(v))}placeBodiesTangentially(t,i){const e=t.position.displacementVector(i.position),s=e.normalize(),o=t.body.radius+i.body.radius,l=o-e.magnitude();if(o===0)return;const h=s.scale(l*(t.body.radius/o)),c=s.scale(l*(i.body.radius/o));t.position=t.position.subtract(h),i.position=i.position.add(c)}}class ut{constructor(t){r(this,"statusBar");r(this,"resetButton");r(this,"playPauseButton");r(this,"stepButton");r(this,"repositoryLink");r(this,"zoomInButton");r(this,"zoomOutButton");r(this,"scrollUpButton");r(this,"scrollDownButton");r(this,"scrollLeftButton");r(this,"scrollRightButton");r(this,"displayVectorsCheckbox");r(this,"collisionDetectionCheckbox");r(this,"elasticCollisionsCheckbox");r(this,"gravitationalConstantInput");r(this,"gravitationalConstantRangeInput");r(this,"clickAction");r(this,"massInput");r(this,"movableCheckbox");this.app=t,this.resetButton=document.getElementById("btnResetSim"),this.playPauseButton=document.getElementById("btnToggleSim"),this.stepButton=document.getElementById("btnNextStep"),this.repositoryLink=document.getElementById("repoLink"),this.zoomInButton=document.getElementById("btnZoomIn"),this.zoomOutButton=document.getElementById("btnZoomOut"),this.scrollUpButton=document.getElementById("btnScrollUp"),this.scrollDownButton=document.getElementById("btnScrollDown"),this.scrollLeftButton=document.getElementById("btnScrollLeft"),this.scrollRightButton=document.getElementById("btnScrollRight"),this.displayVectorsCheckbox=document.getElementById("cbxDisplayVectors"),this.collisionDetectionCheckbox=document.getElementById("cbxCollisions"),this.elasticCollisionsCheckbox=document.getElementById("cbxElasticCollisions"),this.gravitationalConstantInput=document.getElementById("numberG"),this.gravitationalConstantRangeInput=document.getElementById("rangeG"),this.massInput=document.getElementById("massInput"),this.movableCheckbox=document.getElementById("cbxBodyMovable"),this.clickAction={name:"radioBtnMouseAction",buttons:Array.from(document.querySelectorAll('input[name="radioBtnMouseAction"]'))},this.statusBar=(()=>{const i=document.getElementById("statusBar");return{bar:i,fields:Array.from(i.querySelectorAll(".statusBarItem"))}})(),this.registerEvents()}get selectedClickAction(){return this.getSelectedValue(this.clickAction)??this.clickAction.buttons[0].value}get collisionDetection(){return this.collisionDetectionCheckbox.checked}get elasticCollisions(){return this.elasticCollisionsCheckbox.checked}get gravitationalConstant(){return P(this.gravitationalConstantInput)}get displayVectors(){return this.displayVectorsCheckbox.checked}get mass(){return P(this.massInput)}get movable(){return this.movableCheckbox}get animationSettings(){return{displayVectors:this.displayVectorsCheckbox.checked}}get simulationSettings(){return{collisionDetection:this.collisionDetection,elasticCollisions:this.elasticCollisions,gravitationalConstant:this.gravitationalConstant}}get gravityAnimationController(){return this.app.gravityAnimationController}registerEvents(){this.resetButton.addEventListener("click",()=>this.resetButtonClicked()),this.playPauseButton.addEventListener("click",()=>this.playPauseClicked()),this.stepButton.addEventListener("click",()=>this.stepButtonClicked()),this.zoomInButton.addEventListener("click",()=>this.zoomInClicked()),this.zoomOutButton.addEventListener("click",()=>this.zoomOutClicked()),this.scrollUpButton.addEventListener("click",()=>this.scrollUpClicked()),this.scrollDownButton.addEventListener("click",()=>this.scrollDownClicked()),this.scrollLeftButton.addEventListener("click",()=>this.scrollLeftClicked()),this.scrollRightButton.addEventListener("click",()=>this.scrollRightClicked()),this.displayVectorsCheckbox.addEventListener("change",()=>this.cbxDisplayVectorsChanged()),this.collisionDetectionCheckbox.addEventListener("change",()=>this.cbxCollisionsChanged()),this.elasticCollisionsCheckbox.addEventListener("change",()=>this.cbxElasticCollisionsChanged()),this.gravitationalConstantInput.addEventListener("change",()=>this.numberInputGChanged()),this.gravitationalConstantRangeInput.addEventListener("input",()=>this.rangeInputGChanged()),this.massInput.addEventListener("change",()=>this.updateSelectedMass())}initialize(t,i){this.elasticCollisionsCheckbox.disabled=!this.collisionDetectionCheckbox.checked,this.massInput.step=this.calculateMassInputStep(),this.setStatusBarVectors(),this.updateStatusBarCanvasDimensions(t,i),this.gravityAnimationController.setG(Number(this.gravitationalConstantRangeInput.value))}resetButtonClicked(){this.gravityAnimationController.reset(),this.updateStatusBarSimulationInfo()}playPauseClicked(){this.gravityAnimationController.running?(this.gravityAnimationController.stop(),this.simulationStopped()):(this.gravityAnimationController.run(),this.simulationResumed())}stepButtonClicked(){this.gravityAnimationController.advanceOneTick(),this.updateStatusBarSimulationInfo()}zoomInClicked(){this.gravityAnimationController.zoomIn(),this.updateStatusBarAnimationInfo()}zoomOutClicked(){this.gravityAnimationController.zoomOut(),this.updateStatusBarAnimationInfo()}scrollUpClicked(){this.gravityAnimationController.scrollUp()}scrollDownClicked(){this.gravityAnimationController.scrollDown()}scrollLeftClicked(){this.gravityAnimationController.scrollLeft()}scrollRightClicked(){this.gravityAnimationController.scrollRight()}cbxDisplayVectorsChanged(){const t=this.displayVectorsCheckbox.checked;this.gravityAnimationController.setDisplayVectors(t),this.setStatusBarVectors()}cbxCollisionsChanged(){const t=this.collisionDetectionCheckbox.checked,i=this.elasticCollisionsCheckbox.checked;this.elasticCollisionsCheckbox.disabled=!t,this.gravityAnimationController.setCollisionDetection(t,i)}cbxElasticCollisionsChanged(){this.gravityAnimationController.setElasticCollisions(this.elasticCollisionsCheckbox.checked)}numberInputGChanged(){const t=this.gravitationalConstantInput.value;this.gravitationalConstantRangeInput.value=t,this.gravityAnimationController.setG(Number(t))}rangeInputGChanged(){const t=this.gravitationalConstantRangeInput.value;this.gravitationalConstantInput.value!==t&&(this.gravitationalConstantInput.value=t,this.gravityAnimationController.setG(Number(t)))}simulationStopped(){this.playPauseButton.innerHTML="&#9654;",this.stepButton.disabled=!1}simulationResumed(){this.playPauseButton.innerHTML="&#10074;&#10074;",this.stepButton.disabled=!0,this.updateStatusBarSimulationInfo()}getSelectedValue(t){const i=t.buttons.find(e=>e.checked);return(i==null?void 0:i.value)??null}body2dFromInputs(){const t=this.movableCheckbox.checked,i=P(this.massInput);return new _($(i,1,Number.MAX_SAFE_INTEGER),t)}updateSelectedMass(){this.massInput.step=this.calculateMassInputStep()}calculateMassInputStep(){let t=10**(Math.floor(Math.log10(this.mass))-1);return t<1?"1":t.toString()}setStatusBarVectors(){this.displayVectorsCheckbox.checked?this.setStatusMessage(this.statusBarVectorMessage(),3):this.setStatusMessage("",3)}updateStatusBarSimulationInfo(){this.updateStatusBarTickCount(this.gravityAnimationController.tickCount),this.updateStatusBarBodyCount(this.gravityAnimationController.bodyCount)}updateStatusBarAnimationInfo(){this.updateStatusBarZoom(this.gravityAnimationController.currentZoom)}updateStatusBarBodyCount(t,i=1){this.setStatusMessage(`Number of Bodies: ${t}`,i)}updateStatusBarTickCount(t,i=2){this.setStatusMessage(`Simulation Tick: ${t}`,i)}updateStatusBarZoom(t,i=4){this.setStatusMessage(`Zoom: ${t.toFixed(2)} (m per pixel)`,i)}updateStatusBarCanvasDimensions(t,i,e=5){this.setStatusMessage(`Canvas dimension: ${t} * ${i}`,e)}statusBarVectorMessage(){return`Acceleration: ${it} - Velocity: ${st}`}setStatusMessage(t,i,e=!1){let s;typeof i=="number"?s=this.statusBar.fields[i-1]:typeof i=="string"?s=document.getElementById(i):s=this.statusBar.fields[0],e?s.innerHTML+=t:s.innerHTML=t}}class ht{constructor(t){r(this,"_visibleCanvas");r(this,"_visibleCanvasContext");this._visibleCanvas=t,this._visibleCanvasContext=t.getContext("2d",{alpha:!1})}get visibleCanvas(){return this._visibleCanvas}set visibleCanvas(t){this._visibleCanvas=t}get visibleCanvasContext(){return this._visibleCanvasContext}set visibleCanvasContext(t){this._visibleCanvasContext=t}get width(){return this.visibleCanvas.width}get height(){return this.visibleCanvas.height}resize(t,i){this.visibleCanvas.width=t,this.visibleCanvas.height=i}clear(){this.visibleCanvasContext.clearRect(0,0,this.width,this.height)}fillCanvas(t="#000000"){this.visibleCanvasContext.fillStyle=t,this.visibleCanvasContext.fillRect(0,0,this.width,this.height)}drawVector(t,i,e="white"){let s=t.add(i);this.isLineVisible(t,s)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.lineWidth=j,this.visibleCanvasContext.strokeStyle=e,this.visibleCanvasContext.moveTo(t.x,t.y),this.visibleCanvasContext.lineTo(s.x,s.y),this.visibleCanvasContext.stroke())}drawCircle(t,i,e="white"){this.isCircleVisible(t,i)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.arc(t.x,t.y,i,0,Math.PI*2),this.visibleCanvasContext.closePath(),this.visibleCanvasContext.fillStyle=e,this.visibleCanvasContext.fill())}isCircleVisible(t,i){const e=t.x+i>=0,s=t.x-i<=this.visibleCanvas.width,o=t.y+i>=0,l=t.y-i<=this.visibleCanvas.height;return e&&s&&o&&l}isLineVisible(t,i){return!!(T(t.x,0,this.visibleCanvas.width)&&T(t.y,0,this.visibleCanvas.height)||T(i.x,0,this.visibleCanvas.width)&&T(i.y,0,this.visibleCanvas.height)||a.linesIntersecting([t,i],[new a(0,0),new a(this.visibleCanvas.width,0)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,0),new a(this.visibleCanvas.width,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,this.visibleCanvas.height),new a(0,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(0,this.visibleCanvas.height),new a(0,0)],!0))}}var g=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.ManipulateView=2]="ManipulateView",n))(g||{}),f=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.Scroll=2]="Scroll",n[n.Zoom=3]="Zoom",n))(f||{}),p=(n=>(n[n.Up=0]="Up",n[n.Down=1]="Down",n))(p||{}),b=(n=>(n[n.Main=0]="Main",n[n.Wheel=1]="Wheel",n[n.Secondary=2]="Secondary",n))(b||{});function O(n,t){const i=t.getBoundingClientRect(),e=n.x-i.left,s=n.y-i.top;return new a(e,s)}function dt(n,t){const i=t.getBoundingClientRect(),e=n.x-i.left,s=n.y-i.top;return new a(e,s)}function z(n,t){return n.scale(t.currentZoom).hadamardProduct(new a(1,t.orientationY)).add(t.origin)}function F(n,t){const i=n.subtract(t.origin);return new a(i.x,i.y*-1).scale(1/t.currentZoom)}function G(n,t){return new a(n.x,n.y*-1).scale(1/t.currentZoom)}class mt{constructor(t,i){r(this,"_touchAction",g.None);r(this,"_activeTouches",new Map);r(this,"_previousTouchesMid",null);r(this,"_previousTouchesDist",null);r(this,"_lastSingleTouchPos",null);r(this,"pointer",{main:{state:p.Up,downCoordinatesInSimSpace:void 0},secondary:{state:p.Up},wheel:{state:p.Up}});this.canvas=t,this.app=i;const e=t.visibleCanvas;e.addEventListener("pointerdown",s=>this.canvasPointerDown(s)),e.addEventListener("pointerup",s=>this.canvasPointerUp(s)),e.addEventListener("pointermove",s=>this.canvasPointerMoving(s)),e.addEventListener("pointercancel",s=>this.deletePointer(s)),e.addEventListener("mousedown",s=>this.canvasMouseDown(s)),e.addEventListener("mouseup",s=>this.canvasMouseUp(s)),e.addEventListener("wheel",s=>this.canvasScrollMouseWheel(s)),e.addEventListener("contextmenu",s=>{s.preventDefault()}),e.addEventListener("touchend",s=>{s.preventDefault()},{passive:!1})}get touchAction(){return this._touchAction}set touchAction(t){this._touchAction=t}get activeTouches(){return this._activeTouches}set activeTouches(t){this._activeTouches=t}get lastSingleTouchPos(){return this._lastSingleTouchPos}set lastSingleTouchPos(t){this._lastSingleTouchPos=t}get previousTouchesMid(){return this._previousTouchesMid}set previousTouchesMid(t){this._previousTouchesMid=t}get previousTouchesDist(){return this._previousTouchesDist}set previousTouchesDist(t){this._previousTouchesDist=t}get gravityAnimationController(){return this.app.gravityAnimationController}get ui(){return this.app.ui}canvasPointerDown(t){if(t.pointerType!=="mouse")switch(this.canvas.visibleCanvas.setPointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchStart(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerUp(t){if(t.pointerType!=="mouse")switch(this.canvas.visibleCanvas.releasePointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchEnd(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerMoving(t){const i=new a(t.movementX,t.movementY);switch(t.pointerType){case"mouse":this.pointer.wheel.state===p.Down&&(t.preventDefault(),this.gravityAnimationController.scrollInCanvasUnits(i));break;case"touch":const e=this.activeTouches.get(t.pointerId);if(!e)return;switch(e.x=t.clientX,e.y=t.clientY,this.touchAction){case g.AddBody:break;case g.ManipulateView:if(this.activeTouches.size===1){if(this.lastSingleTouchPos){const v=e.x-this.lastSingleTouchPos.x,y=e.y-this.lastSingleTouchPos.y;this.gravityAnimationController.scrollInCanvasUnits(new a(v,y))}this.lastSingleTouchPos=new a(e.x,e.y);return}const s=[...this.activeTouches.values()],o=s[0],l=s[1],h=new a((o.x+l.x)/2,(o.y+l.y)/2),c=Math.hypot(l.x-o.x,l.y-o.y);if(this.previousTouchesMid===null||this.previousTouchesDist===null){this.previousTouchesMid=h,this.previousTouchesDist=c;return}const u=c/this.previousTouchesDist,m=dt(h,this.canvas.visibleCanvas),d=h.subtract(this.previousTouchesMid);this.gravityAnimationController.zoomToFactor(u,m),this.gravityAnimationController.scrollInCanvasUnits(d),this.previousTouchesMid=h,this.previousTouchesDist=c;break}break;case"pen":break;default:console.log("unknown pointerType");break}}deletePointer(t){this.activeTouches.delete(t.pointerId)}canvasScrollMouseWheel(t){t.preventDefault();const i=new a(L(t)),e=O(i,this.canvas.visibleCanvas);t.deltaY<0?this.gravityAnimationController.zoomIn(e):t.deltaY>0&&this.gravityAnimationController.zoomOut(e),this.ui.updateStatusBarAnimationInfo()}canvasTouchStart(t){const i=new a(t.clientX,t.clientY);if(this.activeTouches.set(t.pointerId,i),this.activeTouches.size===1){this.touchAction=g.AddBody,this.lastSingleTouchPos=i;const e=new a(t.clientX,t.clientY),s=z(e,this.gravityAnimationController.canvasSpace);this.pointer.main.downCoordinatesInSimSpace=s}else this.activeTouches.size===2&&(this.touchAction=g.ManipulateView,this.previousTouchesMid=null,this.previousTouchesDist=null,this.lastSingleTouchPos=null)}canvasTouchEnd(t){if(this.activeTouches.has(t.pointerId))switch(this.activeTouches.delete(t.pointerId),this.touchAction){case g.AddBody:const i=L(t);this.addBodyAtPointer(O(i,this.canvas.visibleCanvas)),this.touchAction=g.None;break;case g.ManipulateView:if(this.previousTouchesMid=null,this.previousTouchesDist=null,this.activeTouches.size===1){const e=this.activeTouches.values().next().value;this.lastSingleTouchPos=new a(e.x,e.y)}else this.activeTouches.size===0&&(this.touchAction=g.None,this.lastSingleTouchPos=null,this.previousTouchesMid=null,this.previousTouchesDist=null);break}}canvasMouseUp(t){const i=new a(L(t));switch(t.button){case b.Main:this.pointer.main.state=p.Up,this.canvasMainMouseUp(i);break;case b.Wheel:this.pointer.wheel.state=p.Up,t.preventDefault();break;case b.Secondary:this.pointer.secondary.state=p.Up;break}}canvasMouseDown(t){const i=new a(t.clientX,t.clientY);switch(t.button){case b.Main:this.pointer.main.state=p.Down,this.canvasMainMouseDown(i);break;case b.Wheel:this.pointer.wheel.state=p.Down,t.preventDefault();break;case b.Secondary:this.pointer.secondary.state=p.Down;break}}canvasMainMouseDown(t){switch(f[this.ui.selectedClickAction]){case f.None:break;case f.AddBody:const i=new a(t.x,t.y),e=z(i,this.gravityAnimationController.canvasSpace);this.pointer.main.downCoordinatesInSimSpace=e;break}}canvasMainMouseUp(t){switch(f[this.ui.selectedClickAction]){case f.None:break;case f.AddBody:this.addBodyAtPointer(O(t,this.canvas.visibleCanvas));break}}updateTouchPosition(t,i,e){const s=this.activeTouches.get(t);s&&(s.x=i,s.y=e)}multiTouchGesture(){if(this.activeTouches.size<2)return null;const t=this.activeTouches.values(),i=new a(t.next().value),e=new a(t.next().value),s=a.midpoint(i,e),o=new a(i).distance(e);return Math.hypot(e.x-i.x,e.y-i.y),{first:i,second:e,midpoint:s,distance:o}}reset(){this.touchAction=g.None,this.activeTouches.clear(),this.previousTouchesMid=null,this.previousTouchesDist=null,this.lastSingleTouchPos=null}addBodyAtPointer(t){const i=this.ui.body2dFromInputs(),e=z(t,this.gravityAnimationController.canvasSpace),s=ct(this.pointer.main.downCoordinatesInSimSpace,e);this.gravityAnimationController.addBody(i,e,s),this.ui.updateStatusBarSimulationInfo()}}class vt{constructor(t,i){r(this,"_canvas");r(this,"_canvasSpace");r(this,"_animationSettings");r(this,"_running");this.gravityAnimationController=i,this._animationSettings={frameLength:25,displayVectors:!0,tracePaths:!0},this._canvas=t,this._canvasSpace={origin:new a(0,0),currentZoom:1,orientationY:-1},this._running=!1}get canvas(){return this._canvas}set canvas(t){this._canvas=t}get animationSettings(){return this._animationSettings}set animationSettings(t){this._animationSettings=t}get canvasSpace(){return this._canvasSpace}set canvasSpace(t){this._canvasSpace=t}get running(){return this._running}set running(t){this._running=t}get simulationState(){return this.gravityAnimationController.currentSimulationState}get currentZoom(){return this.canvasSpace.currentZoom}get width(){return this.canvas.visibleCanvas.width}get height(){return this.canvas.visibleCanvas.height}initialize(t,i,e){this.canvas.visibleCanvas.width=t,this.canvas.visibleCanvas.height=i,this.animationSettings.displayVectors=e.displayVectors}run(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.animationSettings.frameLength),this.redrawSimulationState(this.simulationState,this.animationSettings),this.gravityAnimationController.updateStatusBarSimulationMessages())};t()}stop(){this.running=!1}redrawIfPaused(){this.running||this.redrawSimulationState(this.simulationState,this.animationSettings)}drawBodies(t){t.forEach(i=>{this.drawBody(i.body,F(i.position,this.canvasSpace))})}drawBody(t,i){let e=Math.max(t.radius/this.currentZoom,nt);this.canvas.drawCircle(i,e,t.color)}redrawSimulationState(t,i){this.canvas.clear(),this.canvas.fillCanvas(ot),this.drawBodies(t),i.displayVectors&&this.drawVectors(t)}drawVectors(t){t.forEach(i=>{const e=F(i.position,this.canvasSpace),s=G(i.acceleration,this.canvasSpace),o=G(i.velocity,this.canvasSpace);this.canvas.drawVector(e,s,tt),this.canvas.drawVector(e,o,et)})}setDisplayVectors(t){this.animationSettings.displayVectors=t,this.redrawIfPaused()}resizeCanvas(t,i){this.canvas.resize(t,i),this.redrawIfPaused()}setCanvasView(t,i){this.setOrigin(t),this.setZoom(i),this.gravityAnimationController.updateStatusBarAnimationInfo(),this.redrawIfPaused()}moveCanvas(t){this.moveOrigin(t),this.redrawIfPaused()}scroll(t){this.moveCanvas(t)}setOrigin(t){this.canvasSpace.origin=t}moveOrigin(t){const e=this.canvasSpace.origin.add(t);this.setOrigin(e)}zoomOut(t,i){if(this.currentZoom>=M)return this.currentZoom;let e=this.currentZoom+i;e>M&&(e=M,i=M-this.canvasSpace.currentZoom);const s=t.scale(i);return this.moveOrigin(s.hadamardProduct({x:-1,y:1})),this.canvasSpace.currentZoom=e,this.redrawIfPaused(),e}zoomIn(t,i){if(this.currentZoom<=k)return this.currentZoom;let e=this.canvasSpace.currentZoom-i;e<k&&(e=k,i=this.canvasSpace.currentZoom-k);const s=t.scale(i);return this.moveOrigin(s.hadamardProduct({x:1,y:-1})),this.canvasSpace.currentZoom=e,this.redrawIfPaused(),e}setZoom(t){t=$(t,k,M),this.canvasSpace.currentZoom=t,this.redrawIfPaused()}zoomToFactor(t,i){if(t<=0)return this.currentZoom;i||(i=new a(this.width/2,this.height/2));const e=this.currentZoom,o=e*t-e;return this.gravityAnimationController.updateStatusBarAnimationInfo(),o>0?this.zoomIn(i,o):o<0?this.zoomOut(i,-o):e}}class gt{constructor(t,i="theCanvas"){r(this,"_simulation");r(this,"_interaction");r(this,"_animation");r(this,"_running");this.app=t;const e=document.getElementById(i);if(!e)throw new Error(`Canvas element with id '${i}' not found.`);const s=new ht(e);this._simulation=new lt,this._animation=new vt(s,this),this._interaction=new mt(s,this.app),this._running=!1}get simulation(){return this._simulation}get animation(){return this._animation}get running(){return this._running}set running(t){this._running=t}get tickCount(){return this.simulation.tickCount}get bodyCount(){return this.simulation.simulationState.length}get width(){return this.animation.width}get height(){return this.animation.height}get currentZoom(){return this.animation.currentZoom}get currentSimulationState(){return this.simulation.simulationState}get canvasSpace(){return this.animation.canvasSpace}get ui(){return this.app.ui}initialize(t,i){this.animation.initialize(t,i,this.ui.animationSettings),this.initSimulation()}initSimulation(){this.simulation.collisionDetection=this.ui.collisionDetection,this.simulation.elasticCollisions=this.ui.elasticCollisions}run(){this.running||(this.running=!0,this.simulation.run(),this.animation.run())}stop(){this.running=!1,this.simulation.pause(),this.animation.stop()}toggle(){this.running?this.stop():this.run()}reset(){this.simulation.reset(),this.animation.redrawIfPaused()}advanceOneTick(){this.running||(this.simulation.advanceTick(),this.animation.redrawIfPaused())}setDisplayVectors(t){this.animation.setDisplayVectors(t)}setCollisionDetection(t,i=!1){this.simulation.collisionDetection=t,this.simulation.elasticCollisions=i}setElasticCollisions(t){this.simulation.elasticCollisions=t}updateStatusBarSimulationMessages(){this.ui.updateStatusBarSimulationInfo()}updateStatusBarAnimationInfo(){this.ui.updateStatusBarAnimationInfo()}addBody(t,i,e=new a(0,0)){this.simulation.addObject(t,i,e),this.animation.redrawIfPaused()}setG(t){this.simulation.g=t}scrollInCanvasUnits(t){const i=t.scale(this.currentZoom);this.animation.scroll({x:-i.x,y:i.y})}scrollRight(t){t||(t=this.scrollDistance("horizontal")),this.animation.scroll({x:t,y:0})}scrollLeft(t){t||(t=this.scrollDistance("horizontal")),this.animation.scroll({x:-t,y:0})}scrollUp(t){t||(t=this.scrollDistance("vertical")),this.animation.scroll({x:0,y:t})}scrollDown(t){t||(t=this.scrollDistance("vertical")),this.animation.scroll({x:0,y:-t})}scrollDistance(t,i=Q){switch(t){case"horizontal":return this.width*i*this.currentZoom;case"vertical":return this.height*i*this.currentZoom}}zoomToFactor(t,i){return this.animation.zoomToFactor(t,i)}zoomIn(t=new a(this.width/2,this.height/2),i=U){const e=this.currentZoom*i;return this.animation.zoomIn(t,e)}zoomOut(t=new a(this.width/2,this.height/2),i=U){const e=this.currentZoom*i;return this.animation.zoomOut(t,e)}resizeCanvas(t,i){this.animation.resizeCanvas(t,i)}}class pt{constructor(){r(this,"_ui");r(this,"_gravityAnimationController");this._gravityAnimationController=new gt(this),this._ui=new ut(this),this.initialize()}get gravityAnimationController(){return this._gravityAnimationController}set gravityAnimationController(t){this._gravityAnimationController=t}get ui(){return this._ui}initialize(){const t=window.innerWidth,i=window.innerHeight;this.gravityAnimationController.initialize(t,i),this.ui.initialize(t,i)}run(){this.gravityAnimationController.run(),this.ui.simulationResumed()}stop(){this.gravityAnimationController.stop(),this.ui.simulationStopped()}advanceOneTick(){this.gravityAnimationController.advanceOneTick(),this.ui.updateStatusBarSimulationInfo()}reset(){this.gravityAnimationController.reset(),this.ui.updateStatusBarSimulationInfo()}resizeCanvas(t,i){this.gravityAnimationController.resizeCanvas(t,i),this.ui.updateStatusBarCanvasDimensions(t,i)}}let R;document.addEventListener("DOMContentLoaded",Y);function Y(){R=new pt,Ct(),R.run()}function Ct(){document.removeEventListener("DOMContentLoaded",Y),window.addEventListener("resize",yt)}function yt(n){let t=this.innerWidth,i=this.innerHeight;R.resizeCanvas(t,i)}
//# sourceMappingURL=index-CSAjDZH2.js.map
