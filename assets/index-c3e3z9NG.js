var U=Object.defineProperty;var N=(n,t,i)=>t in n?U(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var r=(n,t,i)=>N(n,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();class a{constructor(t,i){r(this,"x");r(this,"y");typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t??0,this.y=i??0)}toString(){return`x: ${this.x}, y: ${this.y}`}add(...t){const i=t.reduce((s,e)=>({x:s.x+e.x,y:s.y+e.y}),{x:this.x,y:this.y});return new a(i.x,i.y)}subtract(t){return new a(this.x-t.x,this.y-t.y)}scale(t){return new a(this.x*t,this.y*t)}dotProduct(t){return this.x*t.x+this.y*t.y}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return t===0?new a(0,0):this.scale(1/t)}distance(t){return Math.sqrt((t.x-this.x)**2+(t.y-this.y)**2)}displacementVector(t){return new a(t.x,t.y).subtract(this)}hadamardProduct(t){return new a(this.x*t.x,this.y*t.y)}normalVectors(){const t=[],i=this.normalize();return t.push(new a(-i.y,i.x)),t.push(new a(i.y,-i.x)),t}reflect(t){t=t.normalize();const i=t.normalVectors()[0],s=this.dotProduct(i),e=i.scale(s).scale(2);return this.subtract(e)}static linesIntersecting(t,i,s=!1){const[e,o]=t,[u,h]=i,c=o.subtract(e),l=h.subtract(u),m=c.x*l.y-c.y*l.x,d=u.subtract(e),v=d.x*c.y-d.y*c.x;if(m===0){if(v===0){if(s){const B=u.subtract(e).dotProduct(c)/c.dotProduct(c),E=h.subtract(e).dotProduct(c)/c.dotProduct(c),C=Math.max(0,Math.min(B,E)),S=Math.min(1,Math.max(B,E));if(C<=S){const x=e.add(c.scale(C)),I=e.add(c.scale(S));return C===S?x:[x,I]}else return null}return[e,o]}return null}const f=(d.x*l.y-d.y*l.x)/m,y=(d.x*c.y-d.y*c.x)/m;return s&&(f<0||f>1||y<0||y>1)?null:e.add(c.scale(f))}static midpoint(t,i){return new a((t.x+i.x)/2,(t.y+i.y)/2)}static simpleLineIntersection(t,i){throw new Error("Method not implemented.")}static linesIntersectingButBetter(t,i,s=!1,e=1e-9){const[o,u]=t,[h,c]=i,l=u.subtract(o),m=c.subtract(h),d=l.x*m.y-l.y*m.x,v=h.subtract(o),f=v.x*l.y-v.y*l.x,y=C=>Math.abs(C)<e;if(y(d)){if(y(f)){if(s){const C=h.subtract(o).dotProduct(l)/l.dotProduct(l),S=c.subtract(o).dotProduct(l)/l.dotProduct(l),x=Math.max(0,Math.min(C,S)),I=Math.min(1,Math.max(C,S));if(x<=I){const Z=o.add(l.scale(x)),F=o.add(l.scale(I));return y(x-I)?Z:[Z,F]}else return null}return[o,u]}return null}const T=(v.x*m.y-v.y*m.x)/d,B=(v.x*l.y-v.y*l.x)/d;return s&&(T<-e||T>1+e||B<-e||B>1+e)?null:o.add(l.scale(T))}}const V=50,G=-10,q=100,k=.01,M=1e4,Y=1.5,W=.5,A=class A{constructor(t,i,s,e){r(this,"_mass");r(this,"_radius");r(this,"_color");r(this,"_movable");this._mass=t,e===void 0&&(e=this.defaultRadius(t)),this._radius=e,s===void 0&&(s="white"),this._color=s,i===void 0&&(i=!0),this._movable=i}get mass(){return this._mass}set mass(t){this._mass=t}get radius(){return this._radius}set radius(t){this._radius=t}get movable(){return this._movable}set movable(t){this._movable=t}get color(){return this._color}set color(t){CSS.supports("color",t)||(t="white"),this._color=t}defaultRadius(t){return t===void 0&&(t=this.mass),(3*t/(4*Math.PI*A.defaultDensity))**(1/3)}};r(A,"defaultDensity",1);let _=A;class X{constructor(){r(this,"_simulationState");r(this,"_running");r(this,"_tickCount");r(this,"_tickLength");r(this,"_collisionDetection");r(this,"_elasticCollisions");r(this,"_g");r(this,"gravityLowerBounds",1);this._simulationState=[],this._running=!1,this._tickCount=0,this._tickLength=10,this._collisionDetection=!1,this._elasticCollisions=!1,this._g=V}get simulationState(){return this._simulationState}set simulationState(t){this._simulationState=t}get running(){return this._running}set running(t){this._running=t}get tickCount(){return this._tickCount}set tickCount(t){this._tickCount=t}get tickLength(){return this._tickLength}get collisionDetection(){return this._collisionDetection}set collisionDetection(t){this._collisionDetection=t}get elasticCollisions(){return this._elasticCollisions}set elasticCollisions(t){this._elasticCollisions=t}get g(){return this._g}set g(t){(isNaN(t)||t<G||t>q)&&(t=V),this._g=t}addObject(t,i,s){return t instanceof _&&(t={body:t,position:i,velocity:s,acceleration:new a(0,0)}),t.body.movable||(t.velocity=new a(0,0)),this.simulationState.push(t)}clearObjects(){this.simulationState=[]}removeFromObjectStates(t){this.simulationState.splice(t,1)}pause(){this.running=!1}run(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.tickLength),this.advanceTick())};t()}reset(){this.clearObjects(),this.tickCount=0}calculateVelocityBetweenPoints(t,i,s=1){return s<=0&&(s=1),(t instanceof a?t:new a(t)).subtract(i).scale(1/s)}advanceTick(){this.updateAccelerationVectors(),this.updateVelocitiesAndPositions(),this.collisionDetection&&this.handleCollisions(),this.tickCount++}updateAccelerationVectors(){const t=this.calculateForces();this.simulationState.forEach((i,s)=>{const o=(t.get(s)||new a(0,0)).scale(1/i.body.mass);i.acceleration=o})}calculateForces(){const t=new Map;for(let i=0;i<this.simulationState.length;i++)for(let s=i+1;s<this.simulationState.length;s++){const e=this.calculateForceBetweenBodies(i,s),o=e.scale(-1);t.set(i,(t.get(i)||new a(0,0)).add(e)),t.set(s,(t.get(s)||new a(0,0)).add(o))}return t}updateVelocityAndPosition(t){const i=this.tickLength/1e3;t.body.movable&&(t.velocity=t.velocity.add(t.acceleration.scale(i)),t.position=t.position.add(t.velocity.scale(i)))}updateVelocitiesAndPositions(){this.simulationState.forEach(t=>{this.updateVelocityAndPosition(t)})}calculateForceBetweenBodies(t,i){const s=this.simulationState[t],e=this.simulationState[i],o=s.position.distance(e.position);if(o<this.gravityLowerBounds||o===0)return new a(0,0);const u=this.g*(s.body.mass*e.body.mass/(o*o));return e.position.subtract(s.position).normalize().scale(u)}handleCollisions(){for(let t=0;t<this.simulationState.length;t++){const i=this.simulationState[t];if(i!==void 0)for(let s=t+1;s<this.simulationState.length;s++){const e=this.simulationState[s],o=i.position.distance(e.position);o<=i.body.radius+e.body.radius&&(o<=i.body.radius||o<=e.body.radius?this.mergeBodies(t,s):this.elasticCollisions&&this.elasticCollision(i,e))}}}mergeBodies(t,i){const s=this.simulationState[t],e=this.simulationState[i],o=s.velocity.scale(s.body.mass).add(e.velocity.scale(e.body.mass)),u=s.body.mass+e.body.mass,h=o.scale(1/u);let c,l;e.body.mass>s.body.mass?(c=e,l=t):(c=s,l=i),c.velocity=h,c.body.mass=u,c.body.radius=c.body.defaultRadius(),c.body.movable=s.body.movable&&e.body.movable,c.body.movable||(c.velocity=new a(0,0)),this.removeFromObjectStates(l)}elasticCollision(t,i,s=1){const o=t.position.displacementVector(i.position),u=o.magnitude();if(u<=1||u===0)return;const h=o.scale(1/u),l=i.velocity.subtract(t.velocity).dotProduct(h);if(l>0)return;const m=-(1+s)*l/(t.body.mass+i.body.mass),d=h.scale(m*i.body.mass),v=h.scale(m*t.body.mass);t.velocity=t.velocity.subtract(d),i.velocity=i.velocity.add(v),t.body.movable||(t.velocity=new a(0,0),i.velocity=i.velocity.add(d)),i.body.movable||(i.velocity=new a(0,0),t.velocity=t.velocity.add(v))}placeBodiesTangentially(t,i){const s=t.position.displacementVector(i.position),e=s.normalize(),o=t.body.radius+i.body.radius,u=o-s.magnitude();if(o===0)return;const h=e.scale(u*(t.body.radius/o)),c=e.scale(u*(i.body.radius/o));t.position=t.position.subtract(h),i.position=i.position.add(c)}}function $(n){return n=n.trim(),!isNaN(+n)&&n.length!==0}function O(n,t,i){if(t>i)throw new Error("In ensureNumberInRange: min cannot be greater than max");return Math.max(t,Math.min(n,i))}function P(n,t,i){return n>=t&&n<=i}function H(n){let t;return typeof n=="string"?t=document.getElementById(n):t=n,t.value.trim()}function z(n){const t=H(n);return $(t)?+t:0}function D(n){return{x:n.clientX,y:n.clientY}}class J{constructor(t){r(this,"statusBar");r(this,"resetButton");r(this,"playPauseButton");r(this,"stepButton");r(this,"repositoryLink");r(this,"zoomInButton");r(this,"zoomOutButton");r(this,"scrollUpButton");r(this,"scrollDownButton");r(this,"scrollLeftButton");r(this,"scrollRightButton");r(this,"displayVectorsCheckbox");r(this,"collisionDetectionCheckbox");r(this,"elasticCollisionsCheckbox");r(this,"gravitationalConstantInput");r(this,"gravitationalConstantRangeInput");r(this,"clickAction");r(this,"massInput");r(this,"addBodyMovable");this.app=t,this.resetButton=document.getElementById("btnResetSim"),this.playPauseButton=document.getElementById("btnToggleSim"),this.stepButton=document.getElementById("btnNextStep"),this.repositoryLink=document.getElementById("repoLink"),this.zoomInButton=document.getElementById("btnZoomIn"),this.zoomOutButton=document.getElementById("btnZoomOut"),this.scrollUpButton=document.getElementById("btnScrollUp"),this.scrollDownButton=document.getElementById("btnScrollDown"),this.scrollLeftButton=document.getElementById("btnScrollLeft"),this.scrollRightButton=document.getElementById("btnScrollRight"),this.displayVectorsCheckbox=document.getElementById("cbxDisplayVectors"),this.collisionDetectionCheckbox=document.getElementById("cbxCollisions"),this.elasticCollisionsCheckbox=document.getElementById("cbxElasticCollisions"),this.gravitationalConstantInput=document.getElementById("numberG"),this.gravitationalConstantRangeInput=document.getElementById("rangeG"),this.massInput=document.getElementById("massInput"),this.addBodyMovable=document.getElementById("cbxBodyMovable"),this.clickAction={name:"radioBtnMouseAction",buttons:Array.from(document.querySelectorAll('input[name="radioBtnMouseAction"]'))},this.statusBar=(()=>{const i=document.getElementById("statusBar");return{bar:i,fields:Array.from(i.querySelectorAll(".statusBarItem"))}})(),this.registerEvents()}initialize(){this.elasticCollisionsCheckbox.disabled=!this.collisionDetectionCheckbox.checked,this.massInput.step=this.calculateMassInputStep(),this.displayVectorsCheckbox.checked?this.setStatusMessage("Green: acceleration - Red: velocity",3):this.setStatusMessage("",3),this.setStatusMessage(`Canvas dimension: ${this.app.gravityAnimationController.width} * ${this.app.gravityAnimationController.height}`,5),this.app.setG(Number(this.gravitationalConstantRangeInput.value))}registerEvents(){this.resetButton.addEventListener("click",()=>this.app.reset()),this.playPauseButton.addEventListener("click",()=>this.app.toggleSimulation()),this.stepButton.addEventListener("click",()=>this.app.advanceOneTick()),this.zoomInButton.addEventListener("click",()=>this.app.zoomIn()),this.zoomOutButton.addEventListener("click",()=>this.app.zoomOut()),this.scrollUpButton.addEventListener("click",()=>this.app.scrollViewUp()),this.scrollDownButton.addEventListener("click",()=>this.app.scrollViewDown()),this.scrollLeftButton.addEventListener("click",()=>this.app.scrollViewLeft()),this.scrollRightButton.addEventListener("click",()=>this.app.scrollViewRight()),this.displayVectorsCheckbox.addEventListener("change",()=>this.cbxDisplayVectorsChanged()),this.collisionDetectionCheckbox.addEventListener("change",()=>this.cbxCollisionsChanged()),this.elasticCollisionsCheckbox.addEventListener("change",()=>this.cbxElasticCollisionsChanged()),this.gravitationalConstantInput.addEventListener("change",()=>this.numberInputGChanged()),this.gravitationalConstantRangeInput.addEventListener("input",()=>this.rangeInputGChanged()),this.massInput.addEventListener("change",()=>this.updateSelectedMass())}cbxDisplayVectorsChanged(){const t=this.displayVectorsCheckbox.checked;this.app.setDisplayVectors(t),t?this.setStatusMessage("Green: acceleration - Red: velocity",3):this.setStatusMessage("",3)}cbxCollisionsChanged(){const t=this.collisionDetectionCheckbox.checked,i=this.elasticCollisionsCheckbox.checked;this.elasticCollisionsCheckbox.disabled=!t,this.app.setCollisionDetection(t,i)}cbxElasticCollisionsChanged(){this.app.setElasticCollisions(this.elasticCollisionsCheckbox.checked)}numberInputGChanged(){const t=this.gravitationalConstantInput.value;this.gravitationalConstantRangeInput.value=t,this.app.setG(Number(t))}rangeInputGChanged(){const t=this.gravitationalConstantRangeInput.value;this.gravitationalConstantInput.value!==t&&(this.gravitationalConstantInput.value=t,this.app.setG(Number(t)))}simulationStopped(){this.playPauseButton.innerHTML="&#9654;",this.stepButton.disabled=!1}simulationResumed(){this.playPauseButton.innerHTML="&#10074;&#10074;",this.stepButton.disabled=!0,this.app.updateStatusBarSimulationMessages()}updateStatusBarZoom(){const t=this.app.gravityAnimationController.currentZoom;this.setStatusMessage(`Zoom: ${t.toFixed(2)} (m per pixel)`,4)}getSelectedClickAction(){return this.getSelectedValue(this.clickAction)??this.clickAction.buttons[0].value}getSelectedValue(t){const i=t.buttons.find(s=>s.checked);return(i==null?void 0:i.value)??null}body2dFromInputs(){const t=this.addBodyMovable.checked,i=z(this.massInput);return new _(O(i,1,Number.MAX_SAFE_INTEGER),t)}updateSelectedMass(){this.massInput.step=this.calculateMassInputStep()}calculateMassInputStep(){let t=10**(Math.floor(Math.log10(z(this.massInput)))-1);return t<1?"1":t.toString()}setStatusMessage(t,i,s=!1){let e;typeof i=="number"?e=this.statusBar.fields[i-1]:typeof i=="string"?e=document.getElementById(i):e=this.statusBar.fields[0],s?e.innerHTML+=t:e.innerHTML=t}}class K{constructor(t){r(this,"_visibleCanvas");r(this,"_visibleCanvasContext");r(this,"_canvasSpace");r(this,"_running",!1);this._visibleCanvas=t,this._visibleCanvasContext=t.getContext("2d"),this._canvasSpace={origin:new a(0,0),currentZoom:1,orientationY:-1}}get visibleCanvas(){return this._visibleCanvas}set visibleCanvas(t){this._visibleCanvas=t}get visibleCanvasContext(){return this._visibleCanvasContext}set visibleCanvasContext(t){this._visibleCanvasContext=t}get canvasSpace(){return this._canvasSpace}set canvasSpace(t){this._canvasSpace=t}get running(){return this._running}set running(t){this._running=t}get currentZoom(){return this.canvasSpace.currentZoom}resize(t,i){this.visibleCanvas.width=t,this.visibleCanvas.height=i}drawVector(t,i,s="white"){let e=t.add(i);this.isLineVisible(t,e)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.lineWidth=Y,this.visibleCanvasContext.strokeStyle=s,this.visibleCanvasContext.moveTo(t.x,t.y),this.visibleCanvasContext.lineTo(e.x,e.y),this.visibleCanvasContext.stroke())}drawVectors(t){t.forEach(i=>{this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(i.position),this.directionFromSimulationSpaceToCanvasSpace(i.acceleration),"green"),this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(i.position),this.directionFromSimulationSpaceToCanvasSpace(i.velocity),"red")})}drawBody(t,i){let s=Math.max(t.radius/this.currentZoom,W);this.isCircleVisible(i,s)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.arc(i.x,i.y,s,0,Math.PI*2),this.visibleCanvasContext.closePath(),this.visibleCanvasContext.fillStyle=t.color,this.visibleCanvasContext.fill())}drawBodies(t){t.forEach(i=>{this.drawBody(i.body,this.pointFromSimulationSpaceToCanvasSpace(i.position))})}redrawSimulationState(t,i){this.visibleCanvasContext.clearRect(0,0,this.visibleCanvas.width,this.visibleCanvas.height),this.drawBodies(t),i.displayVectors&&this.drawVectors(t)}isCircleVisible(t,i){const s=t.x+i>=0,e=t.x-i<=this.visibleCanvas.width,o=t.y+i>=0,u=t.y-i<=this.visibleCanvas.height;return s&&e&&o&&u}isLineVisible(t,i){return!!(P(t.x,0,this.visibleCanvas.width)&&P(t.y,0,this.visibleCanvas.height)||P(i.x,0,this.visibleCanvas.width)&&P(i.y,0,this.visibleCanvas.height)||a.linesIntersecting([t,i],[new a(0,0),new a(this.visibleCanvas.width,0)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,0),new a(this.visibleCanvas.width,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,this.visibleCanvas.height),new a(0,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(0,this.visibleCanvas.height),new a(0,0)],!0))}setOrigin(t){this.canvasSpace.origin=t}moveOrigin(t){const s=this.canvasSpace.origin.add(t);this.setOrigin(s)}scrollRight(t){this.moveOrigin(new a(t,0))}scrollLeft(t){this.moveOrigin(new a(-t,0))}scrollUp(t){this.moveOrigin(new a(0,t))}scrollDown(t){this.moveOrigin(new a(0,-t))}zoomOut(t,i){if(this.currentZoom>=M)return this.currentZoom;let s=this.currentZoom+i;s>M&&(s=M,i=M-this.canvasSpace.currentZoom);const e=t.scale(i);return this.moveOrigin(e.hadamardProduct({x:-1,y:1})),this.canvasSpace.currentZoom=s,s}zoomIn(t,i){if(this.currentZoom<=k)return this.currentZoom;let s=this.canvasSpace.currentZoom-i;s<k&&(s=k,i=this.canvasSpace.currentZoom-k);const e=t.scale(i);return this.moveOrigin(e.hadamardProduct({x:1,y:-1})),this.canvasSpace.currentZoom=s,s}setZoom(t){t=O(t,k,M),this.canvasSpace.currentZoom=t}pointFromSimulationSpaceToCanvasSpace(t){const i=t.subtract(this.canvasSpace.origin);return new a(i.x,i.y*-1).scale(1/this.currentZoom)}directionFromSimulationSpaceToCanvasSpace(t){return new a(t.x,t.y*-1).scale(1/this.currentZoom)}}var p=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.ManipulateView=2]="ManipulateView",n))(p||{}),w=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.Scroll=2]="Scroll",n[n.Zoom=3]="Zoom",n))(w||{}),g=(n=>(n[n.Up=0]="Up",n[n.Down=1]="Down",n))(g||{}),b=(n=>(n[n.Main=0]="Main",n[n.Wheel=1]="Wheel",n[n.Secondary=2]="Secondary",n))(b||{});class Q{constructor(t,i="theCanvas"){r(this,"_canvas");r(this,"_simulation");r(this,"_animationSettings");r(this,"_running");r(this,"pointer",{main:{state:g.Up,downCoordinatesInSimSpace:void 0},secondary:{state:g.Up},wheel:{state:g.Up}});r(this,"touchAction",p.None);r(this,"activeTouches",new Map);r(this,"previousTouchesMid",null);r(this,"previousTouchesDist",null);r(this,"lastSingleTouchPos",null);this.app=t,this._canvas=new K(document.getElementById(i)),this._simulation=new X,this._animationSettings={defaultScrollRate:.1,defaultZoomStep:1,defaultZoomFactor:.1,frameLength:25,displayVectors:!0,tracePaths:!0},this._running=!1,this.canvas.visibleCanvas.addEventListener("pointerdown",s=>this.canvasPointerDown(s)),this.canvas.visibleCanvas.addEventListener("pointerup",s=>this.canvasPointerUp(s)),this.canvas.visibleCanvas.addEventListener("pointermove",s=>this.canvasPointerMoving(s)),this.canvas.visibleCanvas.addEventListener("pointercancel",s=>this.cancelPointer(s)),this.canvas.visibleCanvas.addEventListener("mousedown",s=>this.canvasMouseDown(s)),this.canvas.visibleCanvas.addEventListener("mouseup",s=>this.canvasMouseUp(s)),this.canvas.visibleCanvas.addEventListener("wheel",s=>this.canvasScrollMouseWheel(s)),this.canvas.visibleCanvas.addEventListener("contextmenu",s=>{s.preventDefault()})}get canvas(){return this._canvas}set canvas(t){this._canvas=t}get simulation(){return this._simulation}set simulation(t){this._simulation=t}get animationSettings(){return this._animationSettings}set animationSettings(t){this._animationSettings=t}get running(){return this._running}set running(t){this._running=t}get tickCount(){return this.simulation.tickCount}get bodyCount(){return this.simulation.simulationState.length}get width(){return this.canvas.visibleCanvas.width}get height(){return this.canvas.visibleCanvas.height}get currentZoom(){return this.canvas.currentZoom}initialize(t,i){this.initCanvas(t,i),this.initSimulation()}initCanvas(t,i){this.canvas.visibleCanvas.width=t,this.canvas.visibleCanvas.height=i,this.animationSettings.displayVectors=this.app.ui.displayVectorsCheckbox.checked}initSimulation(){this.simulation.collisionDetection=this.app.ui.collisionDetectionCheckbox.checked,this.simulation.elasticCollisions=this.app.ui.elasticCollisionsCheckbox.checked}canvasPointerDown(t){if(t.pointerType!=="mouse")switch(this.canvas.visibleCanvas.setPointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchStart(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerUp(t){if(t.pointerType!=="mouse")switch(this.canvas.visibleCanvas.releasePointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchEnd(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerMoving(t){const i=new a(t.movementX,t.movementY);switch(t.pointerType){case"mouse":(t.buttons&4)!==0&&(t.preventDefault(),this.scrollInCanvasUnits(i));break;case"touch":const e=this.activeTouches.get(t.pointerId);if(!e)return;switch(e.x=t.clientX,e.y=t.clientY,this.touchAction){case p.AddBody:break;case p.ManipulateView:if(this.activeTouches.size===1){if(this.lastSingleTouchPos){const f=e.x-this.lastSingleTouchPos.x,y=e.y-this.lastSingleTouchPos.y;this.scrollInCanvasUnits(new a(f,y))}this.lastSingleTouchPos=e;return}const o=[...this.activeTouches.values()],u=o[0],h=o[1],c=new a((u.x+h.x)/2,(u.y+h.y)/2),l=Math.hypot(h.x-u.x,h.y-u.y);if(this.previousTouchesMid===null||this.previousTouchesDist===null){this.previousTouchesMid=c,this.previousTouchesDist=l;return}const m=l/this.previousTouchesDist,d=this.absoluteToCanvasPosition(c),v=c.subtract(this.previousTouchesMid);this.zoomToFactor(m,d),this.scrollInCanvasUnits(v),this.previousTouchesMid=c,this.previousTouchesDist=l;break}break;case"pen":break;default:console.log("unknown pointerType");break}}cancelPointer(t){this.activeTouches.delete(t.pointerId)}canvasScrollMouseWheel(t){t.preventDefault();const i=new a(D(t)),s=this.absoluteToCanvasPosition(i);t.deltaY<0?this.zoomIn(s):t.deltaY>0&&this.zoomOut(s)}canvasTouchStart(t){if(this.activeTouches.set(t.pointerId,{x:t.clientX,y:t.clientY}),this.activeTouches.size===1){this.touchAction=p.AddBody,this.lastSingleTouchPos={x:t.clientX,y:t.clientY};const i=new a(t.clientX,t.clientY),s=this.pointFromCanvasSpaceToSimulationSpace(i);this.pointer.main.downCoordinatesInSimSpace=s}else this.activeTouches.size===2&&(this.touchAction=p.ManipulateView,this.previousTouchesMid=null,this.previousTouchesDist=null,this.lastSingleTouchPos=null)}canvasTouchEnd(t){if(this.activeTouches.has(t.pointerId))switch(this.activeTouches.delete(t.pointerId),this.touchAction){case p.AddBody:const i=D(t);this.addBodyAtPointer(this.absoluteToCanvasPosition(i)),this.touchAction=p.None;break;case p.ManipulateView:if(this.previousTouchesMid=null,this.previousTouchesDist=null,this.activeTouches.size===1){const s=this.activeTouches.values().next().value;this.lastSingleTouchPos={x:s.x,y:s.y}}else this.activeTouches.size===0&&(this.touchAction=p.None,this.lastSingleTouchPos=null,this.previousTouchesMid=null,this.previousTouchesDist=null);break}}canvasMouseUp(t){const i=new a(D(t));switch(t.button){case b.Main:this.pointer.main.state=g.Up,this.canvasMainMouseUp(i);break;case b.Wheel:this.pointer.wheel.state=g.Up,t.preventDefault();break;case b.Secondary:this.pointer.secondary.state=g.Up;break}}canvasMouseDown(t){const i=new a(t.clientX,t.clientY);switch(t.button){case b.Main:this.pointer.main.state=g.Down,this.canvasMainMouseDown(i);break;case b.Wheel:this.pointer.wheel.state=g.Down,t.preventDefault();break;case b.Secondary:this.pointer.secondary.state=g.Down;break}}canvasMainMouseDown(t){switch(w[this.app.selectedClickAction]){case w.None:break;case w.AddBody:const i=new a(t.x,t.y),s=this.pointFromCanvasSpaceToSimulationSpace(i);this.pointer.main.downCoordinatesInSimSpace=s;break}}canvasMainMouseUp(t){switch(w[this.app.selectedClickAction]){case w.None:break;case w.AddBody:this.addBodyAtPointer(this.absoluteToCanvasPosition(t));break}this.redrawIfPaused()}run(){this.runSimulation(),this.runAnimation()}stop(){this.running=!1,this.simulation.pause()}toggle(){this.running?this.stop():this.run()}reset(){this.simulation.reset(),this.redrawIfPaused()}runSimulation(){this.running||this.simulation.run()}runAnimation(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.animationSettings.frameLength),this.canvas.redrawSimulationState(this.simulation.simulationState,this.animationSettings),this.app.updateStatusBarSimulationMessages())};t()}advanceOneTick(){this.running||(this.simulation.advanceTick(),this.redrawIfPaused())}redrawIfPaused(){this.running||this.canvas.redrawSimulationState(this.simulation.simulationState,this.animationSettings)}addBodyAtPointer(t){const i=t instanceof a?t:new a(t.x,t.y),s=this.app.ui.body2dFromInputs(),e=this.pointFromCanvasSpaceToSimulationSpace(i),o=this.simulation.calculateVelocityBetweenPoints(this.pointer.main.downCoordinatesInSimSpace,e);this.addBody(s,e,o),this.app.updateStatusBarBodyCount()}addBody(t,i,s=new a(0,0)){this.simulation.addObject(t,i,s),this.redrawIfPaused()}setG(t){this.simulation.g=t}setDisplayVectors(t){this.animationSettings.displayVectors=t,this.redrawIfPaused()}resizeCanvas(t,i){this.canvas.resize(t,i),this.redrawIfPaused()}zoomOut(t,i){t||(t=new a(this.canvas.visibleCanvas.width/2,this.canvas.visibleCanvas.height/2)),i||(i=this.animationSettings.defaultZoomStep);const s=this.canvas.zoomOut(t,i);return this.redrawIfPaused(),this.app.updateStatusBarZoom(),s}zoomIn(t,i){t||(t=new a(this.width/2,this.height/2)),i||(i=this.animationSettings.defaultZoomStep);const s=this.canvas.zoomIn(t,i);return this.redrawIfPaused(),this.app.updateStatusBarZoom(),s}zoomToFactor(t,i){if(t<=0)return this.currentZoom;i||(i=new a(this.width/2,this.height/2));const s=this.currentZoom,o=s*t-s;return this.app.updateStatusBarZoom(),o>0?this.canvas.zoomIn(i,o):o<0?this.canvas.zoomOut(i,-o):s}zoomInByFactor(t=this.animationSettings.defaultZoomFactor,i){i===void 0&&(i=new a(this.width/2,this.height/2));const s=this.currentZoom*t,e=this.canvas.zoomIn(i,s);return this.redrawIfPaused(),this.app.updateStatusBarZoom(),e}zoomOutByFactor(t=this.animationSettings.defaultZoomFactor,i){i===void 0&&(i=new a(this.width/2,this.height/2));const s=this.currentZoom*t,e=this.canvas.zoomOut(i,s);return this.redrawIfPaused(),this.app.updateStatusBarZoom(),e}setCanvasView(t,i){this.canvas.setOrigin(t),this.canvas.setZoom(i),this.app.updateStatusBarZoom(),this.redrawIfPaused()}moveCanvas(t){this.canvas.moveOrigin(t),this.redrawIfPaused()}scrollInCanvasUnits(t){const i=t.scale(this.currentZoom);this.moveCanvas({x:-i.x,y:i.y})}canvasScrollRight(t){t===void 0&&(t=this.scrollDistance("horizontal")),this.canvas.scrollRight(t),this.redrawIfPaused()}canvasScrollLeft(t){t===void 0&&(t=this.scrollDistance("horizontal")),this.canvas.scrollLeft(t),this.redrawIfPaused()}canvasScrollUp(t){t===void 0&&(t=this.scrollDistance("vertical")),this.canvas.scrollUp(t),this.redrawIfPaused()}canvasScrollDown(t){t===void 0&&(t=this.scrollDistance("vertical")),this.canvas.scrollDown(t),this.redrawIfPaused()}absoluteToCanvasPosition(t){const i=this.canvas.visibleCanvas.getBoundingClientRect(),s=t.x-i.left,e=t.y-i.top;return new a(s,e)}scrollDistance(t,i){switch(i===void 0&&(i=this.animationSettings.defaultScrollRate),t){case"horizontal":return this.width*i*this.currentZoom;case"vertical":return this.height*i*this.currentZoom}}pointFromCanvasSpaceToSimulationSpace(t){return t.scale(this.canvas.currentZoom).hadamardProduct(new a(1,this.canvas.canvasSpace.orientationY)).add(this.canvas.canvasSpace.origin)}}class j{constructor(){r(this,"_ui");r(this,"_gravityAnimationController");this._gravityAnimationController=new Q(this),this._ui=new J(this),this.initialize()}get gravityAnimationController(){return this._gravityAnimationController}set gravityAnimationController(t){this._gravityAnimationController=t}get ui(){return this._ui}get running(){return this.gravityAnimationController.running}get selectedClickAction(){return this.ui.getSelectedValue(this.ui.clickAction)??this.ui.clickAction.buttons[0].value}initialize(){this.gravityAnimationController.initialize(window.innerWidth,window.innerHeight),this.ui.initialize()}run(){this.gravityAnimationController.run(),this.ui.simulationResumed()}stop(){this.gravityAnimationController.stop(),this.ui.simulationStopped()}toggleSimulation(){this.running?this.stop():this.run()}advanceOneTick(){this.gravityAnimationController.advanceOneTick(),this.updateStatusBarSimulationMessages()}reset(){this.gravityAnimationController.reset(),this.updateStatusBarSimulationMessages()}updateStatusBarBodyCount(){this.ui.setStatusMessage(`Number of Bodies: ${this.gravityAnimationController.bodyCount}`,1)}updateStatusBarTickCount(){this.ui.setStatusMessage(`Simulation Tick: ${this.gravityAnimationController.tickCount}`,2)}updateStatusBarSimulationMessages(){this.updateStatusBarTickCount(),this.updateStatusBarBodyCount()}updateStatusBarZoom(){this.ui.updateStatusBarZoom()}scrollViewRight(t){this.gravityAnimationController.canvasScrollRight(t)}scrollViewLeft(t){this.gravityAnimationController.canvasScrollLeft(t)}scrollViewUp(t){this.gravityAnimationController.canvasScrollUp(t)}scrollViewDown(t){this.gravityAnimationController.canvasScrollDown(t)}setG(t){this.gravityAnimationController.setG(t)}zoomOut(t,i){return this.gravityAnimationController.zoomOut(t,i)}zoomIn(t,i){return this.gravityAnimationController.zoomIn(t,i)}resizeCanvas(t,i){this.gravityAnimationController.resizeCanvas(t,i),this.ui.setStatusMessage(`Canvas dimension: ${t} * ${i}`,5)}setCollisionDetection(t,i=!1){this.gravityAnimationController.simulation.collisionDetection=t,this.gravityAnimationController.simulation.elasticCollisions=i}setElasticCollisions(t){this.gravityAnimationController.simulation.elasticCollisions=t}setDisplayVectors(t){this.gravityAnimationController.setDisplayVectors(t)}}let L;document.addEventListener("DOMContentLoaded",R);function R(){L=new j,tt(),L.run()}function tt(){document.removeEventListener("DOMContentLoaded",R),window.addEventListener("resize",it)}function it(n){let t=this.innerWidth,i=this.innerHeight;L.resizeCanvas(t,i)}
//# sourceMappingURL=index-c3e3z9NG.js.map
