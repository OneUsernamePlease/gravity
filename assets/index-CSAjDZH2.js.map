{"version":3,"file":"index-CSAjDZH2.js","sources":["../../src/scripts/util/vector2d.ts","../../src/scripts/const/const.ts","../../src/scripts/util/util.ts","../../src/scripts/animation/animation-utils.ts","../../src/scripts/simulation/gravity.ts","../../src/scripts/interaction/ui.ts","../../src/scripts/animation/canvas.ts","../../src/scripts/const/types.ts","../../src/scripts/util/transformations.ts","../../src/scripts/interaction/interaction-manager.ts","../../src/scripts/animation/animation-controller.ts","../../src/scripts/simulation/gravity-animation-controller.ts","../../src/scripts/app/app.ts","../../src/scripts/app/main.ts"],"sourcesContent":["export interface Coordinate {\r\n    x: number,\r\n    y: number,\r\n}\r\nexport class Vector2D {\r\n    public x: number;\r\n    public y: number;\r\n    constructor()\r\n    constructor(pos: Coordinate)\r\n    constructor(x: number, y: number)\r\n    constructor(a?: number | Coordinate, b?: number) {\r\n        if (typeof a === \"object\") {\r\n            this.x = a.x;\r\n            this.y = a.y;\r\n        } else {\r\n            this.x = a ?? 0;\r\n            this.y = b ?? 0;\r\n        }\r\n    }\r\n    public toString() {\r\n        return `x: ${this.x}, y: ${this.y}`;\r\n    }\r\n    public add(...vectors: Coordinate[]): Vector2D {\r\n        const result = vectors.reduce((previous, current) => {\r\n            return { x: (previous.x + current.x), y: (previous.y + current.y) };\r\n        }, {x: this.x, y: this.y});\r\n        return new Vector2D(result.x, result.y);\r\n    }\r\n    /**\r\n     * @returns this - v\r\n     */\r\n    public subtract(v: Coordinate): Vector2D {\r\n        return new Vector2D(this.x - v.x, this.y - v.y);\r\n    }\r\n    public scale(scalar: number): Vector2D {\r\n        return new Vector2D(this.x * scalar, this.y * scalar);\r\n    }\r\n    public dotProduct(v: Coordinate): number {\r\n        return this.x * v.x + this.y * v.y;\r\n    }\r\n    public magnitude(): number {\r\n        return Math.hypot(this.x, this.y);\r\n    }\r\n    public normalize(): Vector2D {\r\n        const magnitude = this.magnitude();\r\n        if (magnitude === 0) {\r\n            return new Vector2D(0, 0);\r\n        } else {\r\n            return this.scale(1 / magnitude);\r\n        }\r\n    }\r\n    /**\r\n     * @param v Vector2D\r\n     * @returns Distance to v\r\n     */\r\n    public distance(v: Coordinate): number {\r\n        return Math.hypot(v.x - this.x, v.y - this.y);\r\n    }\r\n    /**\r\n     * returns a vector pointing from this to v\r\n     */\r\n    public displacementVector(v: Coordinate) {\r\n        const vector = new Vector2D(v.x, v.y);\r\n        return vector.subtract(this);\r\n    }\r\n    public hadamardProduct(v: Coordinate) {\r\n        return new Vector2D(this.x * v.x, this.y * v.y);\r\n    }\r\n    /**\r\n     * @returns an array of two normalized vectors, both normal to this, both pointing in opposite directions\r\n     */\r\n    public normalVectors(): Vector2D[] {\r\n        const array: Vector2D[] = [];\r\n        const v = this.normalize();\r\n        array.push(new Vector2D(-v.y, v.x));\r\n        array.push(new Vector2D(v.y, -v.x));\r\n        return array;\r\n    }\r\n    public midpoint(p2: Vector2D): Vector2D {\r\n        return new Vector2D((this.x + p2.x) / 2, (this.y + p2.y) / 2);\r\n    }\r\n    /**\r\n     * Reflects this vector on reflectionSurface.\r\n     * @param reflectionSurface acts as a mirror\r\n     * @returns The reflected vector\r\n     */\r\n    public reflect(reflectionSurface: Vector2D): Vector2D {\r\n        reflectionSurface = reflectionSurface.normalize();\r\n        const axis = reflectionSurface.normalVectors()[0];\r\n        const dotAxis = this.dotProduct(axis);\r\n        const projection = axis.scale(dotAxis).scale(2);\r\n        const reflected = this.subtract(projection);\r\n        return reflected;\r\n    }\r\n    /**\r\n     * @param line1 defined by two points\r\n     * @param line2 defined by two points\r\n     * @param strict false by default. If true, the intersection must be within the line segments defined by the coordinates, not just the infinite lines.\r\n     * @returns The intersection of the two lines: a point, null if they don't intersect, or a line (defined by two points) if they are identical, or collinear and overlapping.\r\n     * https://stackoverflow.com/a/565282/97076991 - authored by ai.\r\n     */\r\n    public static linesIntersecting(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D], strict = false): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        if (rCrossS === 0) {\r\n            if (qmpCrossR === 0) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (tMin === tMax) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < 0 || t > 1 || u < 0 || u > 1) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n    public static midpoint(v1: Coordinate, v2: Coordinate): Vector2D {\r\n        return new Vector2D((v1.x + v2.x) / 2, (v1.y + v2.y) / 2);\r\n    }\r\n    public static simpleLineIntersection(line1: [p1: Vector2D, p2: Vector2D], line2: [q1: Vector2D, q2: Vector2D]): Vector2D | null {\r\n        // make sure lines are strictly defined (p1 != p2, same for line2)\r\n        \r\n        // check for general intersection\r\n\r\n        // if parallel or identical, -> null\r\n        // otherwise intersection: {x, y}\r\n\r\n        // order points so that p1.x <= p2.x and q1.x <= q2.x\r\n\r\n        // p1.x <= intersection.x <= p2.x\r\n        // q1.x <= intersection.x <= q2.x\r\n        // and same for y\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    /**\r\n     * Written by ChatGPT-4\r\n     * @param line1 \r\n     * @param line2 \r\n     * @param strict \r\n     * @param epsilon \r\n     * @returns \r\n     */\r\n    public static linesIntersectingButBetter(\r\n        line1: [p1: Vector2D, p2: Vector2D],\r\n        line2: [q1: Vector2D, q2: Vector2D],\r\n        strict = false,\r\n        epsilon = 1e-9 // Default epsilon value\r\n    ): Vector2D | null | [Vector2D, Vector2D] {\r\n        const [p1, p2] = line1;\r\n        const [q1, q2] = line2;\r\n        \r\n        const r = p2.subtract(p1);\r\n        const s = q2.subtract(q1);\r\n        const rCrossS = r.x * s.y - r.y * s.x;\r\n\r\n        const qMinusP = q1.subtract(p1);\r\n        const qmpCrossR = qMinusP.x * r.y - qMinusP.y * r.x;\r\n\r\n        // Using epsilon for floating-point precision comparison\r\n        const isZero = (value: number) => Math.abs(value) < epsilon;\r\n\r\n        if (isZero(rCrossS)) {\r\n            if (isZero(qmpCrossR)) {\r\n                // collinear\r\n                if (strict) {\r\n                    const t0 = q1.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n                    const t1 = q2.subtract(p1).dotProduct(r) / r.dotProduct(r);\r\n\r\n                    const tMin = Math.max(0, Math.min(t0, t1));\r\n                    const tMax = Math.min(1, Math.max(t0, t1));\r\n\r\n                    if (tMin <= tMax) {\r\n                        const pointA = p1.add(r.scale(tMin));\r\n                        const pointB = p1.add(r.scale(tMax));\r\n                        if (isZero(tMin - tMax)) {\r\n                            // overlap at a point\r\n                            return pointA;\r\n                        } else {\r\n                            // overlap at a line\r\n                            return [pointA, pointB];\r\n                        }\r\n                    } else {\r\n                        // no overlap\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // identical\r\n                return [p1, p2];\r\n            }\r\n            // parallel\r\n            return null;\r\n        }\r\n\r\n        // point intersection\r\n        const t = (qMinusP.x * s.y - qMinusP.y * s.x) / rCrossS;\r\n        const u = (qMinusP.x * r.y - qMinusP.y * r.x) / rCrossS;\r\n\r\n        if (strict) {\r\n            if (t < -epsilon || t > 1 + epsilon || u < -epsilon || u > 1 + epsilon) {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        const intersection = p1.add(r.scale(t));\r\n        return intersection;\r\n    }\r\n\r\n}","\r\n//#region physics\r\nexport const DEFAULT_G = 50;\r\nexport const MIN_G = -10;\r\nexport const MAX_G = 100;\r\n//#endregion\r\n\r\n//#region animation\r\nexport const MIN_ZOOM = 0.01;\r\nexport const MAX_ZOOM = 10000;\r\nexport const DEFAULT_ZOOM_FACTOR = 0.1;\r\nexport const DEFAULT_SCROLL_RATE = 0.1;\r\nexport const VECTOR_THICKNESS = 1;\r\nexport const VECTOR_ACC_COLOR = \"#20ff20ff\"\r\nexport const VECTOR_ACC_COLOR_NAME = \"Green\"\r\nexport const VECTOR_VEL_COLOR = \"#ffd700ff\"\r\nexport const VECTOR_VEL_COLOR_NAME = \"Yellow\"\r\nexport const MIN_DISPLAYED_RADIUS = 0.75;\r\nexport const BACKGROUND_COLOR = \"#222222ff\";\r\n//#endregion\r\n","\r\n/*\r\nJust Some functions\r\n(hopefully moderately helpful)\r\n*/\r\n\r\nimport { Vector2D } from \"./vector2d\";\r\n\r\n//#region generic stuff\r\nexport function log(message: string) {\r\n    const timestamp = new Date();\r\n    const hours = timestamp.getHours().toString().padStart(2, '0');\r\n    const minutes = timestamp.getMinutes().toString().padStart(2, '0');\r\n    const seconds = timestamp.getSeconds().toString().padStart(2, '0');\r\n    const milliseconds = timestamp.getMilliseconds().toString().padStart(3, '0');\r\n\r\n    const formattedTimestamp = `${hours}:${minutes}:${seconds}.${milliseconds}`;\r\n    console.log(`[${formattedTimestamp}] ${message}`);\r\n}\r\n/**\r\n * min and max included\r\n * @returns random number\r\n */\r\nexport function rng(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\n//#endregion\r\n\r\n//#region math stuff\r\n/**\r\n * empty string is NOT considered numeric\r\n * @param s the string to be examined\r\n * @returns true if s is a valid number, returns false otherwise\r\n */\r\nexport function isNumeric(s: string): boolean {\r\n    s = s.trim();\r\n    return (!isNaN(+s)) && s.length !== 0;\r\n}\r\n/**\r\n * @returns \"\", if d is a non-numeric string\r\n */\r\nexport function decimalToHex(d: string | number): string {\r\n    if (typeof(d) === \"string\")  {\r\n        if (isNumeric(d)) {\r\n            d = parseFloat(d);\r\n        } else {\r\n            return \"\";\r\n        }\r\n    }\r\n    return d.toString(16);\r\n}\r\n/**\r\n * converts a hexadecimal-number-string to a decimal number and returns it\r\n * @returns 0 if hex is not a valid hexadecimal number\r\n */\r\nexport function hexToDecimal(hex: string): number {\r\n    const prefix = \"0x\"\r\n    if (!(hex.startsWith(prefix))) {\r\n        hex = prefix + hex;\r\n    }\r\n    const num: number = Number(hex);\r\n    const valid = !isNaN(num);\r\n    return valid ? num : 0;\r\n}\r\n/**\r\n * \r\n * @returns n if n satisfies min <= n <= max, otherwise min or max are returned\r\n * @param n number to test against upper and lower bounds\r\n * @param min the lowest allowed value for n\r\n * @param max the highest allowed value for n\r\n */\r\nexport function clamp(n: number, min: number, max: number): number {\r\n    if (min > max) {\r\n        throw new Error(\"In ensureNumberInRange: min cannot be greater than max\");\r\n    }\r\n    return Math.max(min, Math.min(n, max))\r\n}\r\nexport function isInRange(n: number, min: number, max: number): boolean {\r\n    return n >= min && n <= max;\r\n}\r\n//#endregion\r\n\r\n//#region string stuff\r\n/**\r\n * Removes all occurrences of charToRemove from the beginning of str\r\n * @param str the string to be modified\r\n * @param charToRemove ***optional*** If no value is provided the first character of str is used. Can be more than one character.\r\n * @returns the modified string\r\n */\r\nexport function removeLeadingChar(str: string, charToRemove?: string): string {\r\n    if (str.length < 1) { return \"\"; }\r\n    if (charToRemove === undefined) {\r\n        charToRemove = str[0];\r\n    }\r\n\r\n    while (str.startsWith(charToRemove)) {\r\n        str = str.slice(charToRemove.length);\r\n    }\r\n    return str;\r\n}\r\n//#endregion\r\n\r\n//#region input stuff\r\nexport function getInputValue(input: string | HTMLInputElement): string {\r\n    let inputElement: HTMLInputElement;\r\n    if (typeof input === \"string\") {\r\n        inputElement = document.getElementById(input) as HTMLInputElement;\r\n    } else {\r\n        inputElement = input;\r\n    }\r\n    return inputElement.value.trim();\r\n}\r\n/**\r\n * @param input an HTMLInputElement, or the id for the Element\r\n * @returns element's value attribute; 0 if value is not numeric\r\n */\r\nexport function getInputNumber(input: string | HTMLInputElement): number {\r\n    const inputValue = getInputValue(input);\r\n    return isNumeric(inputValue) ? +inputValue : 0;\r\n}\r\nexport function getAbsolutePointerPosition(ev: PointerEvent | WheelEvent | MouseEvent): { x: number, y: number } {\r\n    return { x: ev.clientX, y: ev.clientY };\r\n}\r\n\r\n/**\r\n * Calculates and returns the velocity vector needed to get from *fromCoordinate* to *toCoordinate* in *timeFrameInSeconds* seconds\r\n * @param toCoordinate value in simulation space\r\n * @param fromCoordinate value in simulation space\r\n * @param timeFrameInSeconds *optional* defaults to 1\r\n */\r\nexport function calculateVelocityBetweenPoints(toCoordinate: Vector2D | {x: number, y: number}, fromCoordinate: Vector2D, timeFrameInSeconds: number = 1): Vector2D {\r\n    if (timeFrameInSeconds <= 0) { timeFrameInSeconds = 1; }\r\n    const toVector = toCoordinate instanceof Vector2D ? toCoordinate : new Vector2D(toCoordinate)\r\n    const distance: Vector2D = toVector.subtract(fromCoordinate);\r\n    return distance.scale(1 / timeFrameInSeconds);\r\n}\r\n/**\r\n * returns n in hex formatted string, with length >= 2. \r\n * @param n number to convert\r\n */\r\nexport function twoDigitHex(n: number) {\r\n    return n.toString(16).padStart(2, \"0\");\r\n}\r\n//#endregion","import { rng, twoDigitHex } from \"../util/util\";\r\n/**\r\n * \r\n * @param alpha value between 0 and 1. Defaults to 1 (opaque).\r\n * @returns a random hex-color-string in the format #RRGGBBAA\r\n */ \r\nexport function randomHexColor(alpha: number = 1): string {\r\n    alpha = Math.min(1, Math.max(0, alpha));\r\n    const a = Math.round(alpha * 255);\r\n\r\n    const toHex = (n: number) => n.toString(16).padStart(2, \"0\");\r\n\r\n\r\n    const r = rng(0, 256);\r\n    const g = rng(0, 256);\r\n    const b = rng(0, 256);\r\n\r\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}${toHex(a)}`;\r\n}\r\n/**\r\n * !!! COLORS MUST BE IN THE FORMAT #RRGGBBAA !!!\r\n * @param color1 #RRGGBBAA\r\n * @param weight1 \r\n * @param color2 #RRGGBBAA\r\n * @param weight2 \r\n * @returns the weighted, combined color of the inputs\r\n */\r\nexport function mixColorsWeighted(color1: string, weight1: number, color2: string, weight2: number): string {\r\n    function parseHex(color: string): number[] {\r\n        const r = parseInt(color.slice(1, 3), 16);\r\n        const g = parseInt(color.slice(3, 5), 16);\r\n        const b = parseInt(color.slice(5, 7), 16);\r\n        const a = parseInt(color.slice(7, 9), 16);\r\n        return [r, g, b, a];\r\n    }\r\n\r\n    const [r1, g1, b1, a1] = parseHex(color1);\r\n    const [r2, g2, b2, a2] = parseHex(color2);\r\n\r\n    const r = Math.round((r1 * weight1 + r2 * weight2) / (weight1 + weight2));\r\n    const g = Math.round((g1 * weight1 + g2 * weight2) / (weight1 + weight2));\r\n    const b = Math.round((b1 * weight1 + b2 * weight2) / (weight1 + weight2));\r\n    const a = Math.round((a1 * weight1 + a2 * weight2) / (weight1 + weight2));\r\n\r\n    return `#${twoDigitHex(r)}${twoDigitHex(g)}${twoDigitHex(b)}${twoDigitHex(a)}`;\r\n}\r\nexport function massDependentColor(mass: number): string {\r\n    const lowestColorMass = 1000;\r\n    const biggestColorMass = 100000000;\r\n    const alpha = \"ff\";\r\n\r\n    if (mass <= lowestColorMass) {\r\n        return \"#ff0000ff\";\r\n    }\r\n    if (mass >= biggestColorMass) {\r\n        return \"#0000ffff\";\r\n    }\r\n    const mid = Math.sqrt(lowestColorMass * biggestColorMass)\r\n    let r,g,b;\r\n\r\n    if (mass < mid) {\r\n        // Red -> White\r\n        const t = (Math.log(mass) - Math.log(lowestColorMass)) / (Math.log(mid) - Math.log(lowestColorMass));\r\n        r = 255;\r\n        g = Math.round(255 * t);\r\n        b = Math.round(255 * t);\r\n    } else {\r\n        // White -> Blue\r\n        const t = (Math.log(mass) - Math.log(mid)) / (Math.log(biggestColorMass) - Math.log(mid));\r\n        r = Math.round(255 * (1 - t));\r\n        g = Math.round(255 * (1 - t));\r\n        b = 255;\r\n    }\r\n\r\n    return `#${twoDigitHex(r)}${twoDigitHex(g)}${twoDigitHex(b)}${alpha}`;\r\n}","import { ObjectState } from \"../const/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport * as c from \"../const/const\";\r\nimport { massDependentColor } from \"../animation/animation-utils\";\r\n\r\nexport class Body2d {\r\n//#region properties\r\n    private _mass: number;\r\n    private _radius: number;\r\n    private _color: string;\r\n    private _movable: boolean;\r\n    static defaultDensity = 1;\r\n//#endregion\r\n// #region get, set\r\n    public get mass() {\r\n        return this._mass;\r\n    }\r\n    public set mass(newMass: number) {\r\n        this._mass = newMass;\r\n    }\r\n    public get radius() {\r\n        return this._radius;\r\n    }\r\n    public set radius(newRadius: number) {\r\n        this._radius = newRadius;\r\n    }\r\n    public get movable() {\r\n        return this._movable;\r\n    }\r\n    public set movable(affected: boolean) {\r\n        this._movable = affected\r\n    }   \r\n    public get color() : string {\r\n        return this._color\r\n    }\r\n    public set color(c: string) {\r\n        if (!(CSS.supports(\"color\", c))) {\r\n            c = \"#818181ff\";\r\n        }\r\n        this._color = c;\r\n    } \r\n// #endregion\r\n    constructor(mass: number, movable?: boolean, color?: string, radius?: number)  {\r\n        this._mass = mass;\r\n        if (radius === undefined) { radius = this.defaultRadius(mass); }\r\n        this._radius = radius;\r\n        if (color === undefined) { color = massDependentColor(mass); }\r\n        this._color = color;\r\n        if (movable === undefined) { movable = true; }\r\n        this._movable = movable;     \r\n    }\r\n\r\n    /**\r\n     * returns the radius of a sphere based on mass and density\r\n     */\r\n    public defaultRadius(mass?: number) {\r\n        if (mass === undefined) {\r\n            mass = this.mass;\r\n        }\r\n        return ((3 * mass)/(4 * Math.PI * Body2d.defaultDensity)) ** (1/3); \r\n    }\r\n}\r\nexport class Simulation {\r\n    private _simulationState: ObjectState[];\r\n    private _running: boolean;\r\n    private _tickCount: number;\r\n    private _tickLength: number;\r\n    private _collisionDetection: boolean;\r\n    private _elasticCollisions: boolean;\r\n    private _g: number; // gravitational constant\r\n    private readonly gravityLowerBounds: number = 1; // force calculations for distances lower than this number are skipped\r\n    constructor() { \r\n        this._simulationState = [];\r\n        this._running = false;\r\n        this._tickCount = 0;\r\n        this._tickLength = 10; // ms\r\n        this._collisionDetection = false;\r\n        this._elasticCollisions = false;\r\n        this._g = c.DEFAULT_G;\r\n    }\r\n    // #region get, set\r\n    public get simulationState() {\r\n        return this._simulationState;\r\n    }\r\n    public set simulationState(objectState: ObjectState[]) {\r\n        this._simulationState = objectState;\r\n    }\r\n    public get running() {\r\n        return this._running;\r\n    }\r\n    public set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    public get tickCount() {\r\n        return this._tickCount;\r\n    }\r\n    public set tickCount(tickCount: number) {\r\n        this._tickCount = tickCount;\r\n    }\r\n    public get tickLength() {\r\n        return this._tickLength;\r\n    }\r\n    public set tickLength(t: number) {\r\n        this._tickLength = t;\r\n    }\r\n    public get collisionDetection() {\r\n        return this._collisionDetection;\r\n    }\r\n    public set collisionDetection(collisionDetection: boolean) {\r\n        this._collisionDetection = collisionDetection;\r\n    }\r\n    public get elasticCollisions() {\r\n        return this._elasticCollisions;\r\n    }\r\n    public set elasticCollisions(elasticCollisions: boolean) {\r\n        this._elasticCollisions = elasticCollisions;\r\n    }\r\n    public get g() {\r\n        return this._g;\r\n    }\r\n    public set g(g: number) {\r\n        if (isNaN(g) || g < c.MIN_G || g > c.MAX_G) {\r\n            g = c.DEFAULT_G;\r\n        }\r\n        this._g = g;\r\n    }\r\n// #endregion\r\n    public addObject(body: Body2d, position: Vector2D, velocity: Vector2D): number \r\n    public addObject(objectState: ObjectState): number \r\n    public addObject(bodyOrObject: ObjectState | Body2d, position?: Vector2D, velocity?: Vector2D): number {\r\n        if (bodyOrObject instanceof Body2d) {\r\n            bodyOrObject = {body: bodyOrObject, position: position!, velocity: velocity!, acceleration: new Vector2D(0, 0)};\r\n        }\r\n        if (!bodyOrObject.body.movable) {\r\n            bodyOrObject.velocity = new Vector2D(0, 0);\r\n        }\r\n        return this.simulationState.push(bodyOrObject);\r\n    }\r\n    private clearObjects() {\r\n        this.simulationState = [];\r\n    }\r\n    private removeFromObjectStates(index: number) {\r\n        this.simulationState.splice(index, 1);\r\n    }\r\n    public pause() {\r\n        this.running = false;\r\n    }\r\n    public run() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n\r\n        const runSimulationStep = () => {\r\n            if (this.running) {\r\n                setTimeout(runSimulationStep, this.tickLength);\r\n                this.advanceTick();\r\n            }\r\n        };\r\n        runSimulationStep();\r\n    }\r\n    public reset() {\r\n        this.clearObjects();\r\n        this.tickCount = 0;\r\n    }\r\n    public advanceTick() {\r\n        this.updateAccelerationVectors();\r\n        this.updateVelocitiesAndPositions();\r\n        if (this.collisionDetection) {\r\n            this.handleCollisions();\r\n        }\r\n        this.tickCount++;\r\n    }\r\n    private updateAccelerationVectors() {\r\n        const forces: Map<number, Vector2D> = this.calculateForces();\r\n\r\n        this.simulationState.forEach((objectState, index) => {\r\n            const totalForceOnBody = forces.get(index) || (new Vector2D(0, 0));\r\n            const newAcceleration = totalForceOnBody.scale(1 / objectState.body.mass);\r\n            objectState.acceleration = newAcceleration;\r\n        });\r\n    }\r\n    private calculateForces() {\r\n        const forces: Map<number, Vector2D> = new Map();\r\n        \r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const forceOnI = this.calculateForceBetweenBodies(i, j);\r\n                const forceOnJ = forceOnI.scale(-1);\r\n\r\n                forces.set(i, (forces.get(i) || new Vector2D(0, 0)).add(forceOnI));\r\n                forces.set(j, (forces.get(j) || new Vector2D(0, 0)).add(forceOnJ));\r\n            }\r\n        }\r\n        return forces;\r\n    }\r\n    /**\r\n     * Calculates the next **position** and **velocity** of the object in state, and updates objectState accordingly.\r\n     * @param objectState *ObjectState* containing the body\r\n     */\r\n    private updateVelocityAndPosition(objectState: ObjectState) {\r\n        const dt = this.tickLength / 1000;\r\n        if (!objectState.body.movable) { return; }\r\n        objectState.velocity = objectState.velocity.add(objectState.acceleration.scale(dt));\r\n        objectState.position = objectState.position.add(objectState.velocity.scale(dt));\r\n    }\r\n    private updateVelocitiesAndPositions() {\r\n        this.simulationState.forEach(objectState => {\r\n            this.updateVelocityAndPosition(objectState)\r\n        });\r\n    }\r\n    /**\r\n     * Calculates the force-vector between the bodies in objectStates at index [i] and [j]\r\n     * @returns a vector representing the force applied ***to*** body at ***objectStates[i]***\r\n     */\r\n    private calculateForceBetweenBodies(i: number, j: number): Vector2D {\r\n        const objectStateI = this.simulationState[i];\r\n        const objectStateJ = this.simulationState[j];\r\n\r\n        const distance = objectStateI.position.distance(objectStateJ.position);\r\n        if (distance < this.gravityLowerBounds || distance === 0) // if the bodies are too close, skip the calculation\r\n            { return new Vector2D(0, 0); } \r\n        const netForceBetweenBodies: number = this.g * ((objectStateI.body.mass * objectStateJ.body.mass)/(distance * distance));\r\n        const unitVectorIToJ = objectStateJ.position.subtract(objectStateI.position).normalize();\r\n        return unitVectorIToJ.scale(netForceBetweenBodies);\r\n    }\r\n    private handleCollisions() {\r\n        for (let i = 0; i < this.simulationState.length; i++) {\r\n            const objectStateI = this.simulationState[i];\r\n            if (objectStateI === undefined) {\r\n                // undefined, if objectStateI has been merged in a previous collision\r\n                continue;\r\n            }\r\n            for (let j = i+1; j < this.simulationState.length; j++) {\r\n                const objectStateJ = this.simulationState[j];\r\n                const distanceIJ = objectStateI.position.distance(objectStateJ.position);\r\n                const collision = distanceIJ <= objectStateI.body.radius + objectStateJ.body.radius;\r\n                if (collision) {\r\n                    if (distanceIJ <= objectStateI.body.radius || distanceIJ <= objectStateJ.body.radius) { \r\n                        this.mergeBodies(i, j);\r\n                    } else if (this.elasticCollisions) {\r\n                        this.elasticCollision(objectStateI, objectStateJ);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Merges the two bodies at indices in objectStates into one. The lighter body is merged into the heavier one. Momentum is preserved.\r\n     */\r\n    private mergeBodies(index1: number, index2: number) {\r\n        const state1: ObjectState = this.simulationState[index1];\r\n        const state2: ObjectState = this.simulationState[index2];\r\n        const totalMomentum = state1.velocity.scale(state1.body.mass).add(state2.velocity.scale(state2.body.mass));\r\n        const totalMass = state1.body.mass + state2.body.mass;\r\n        const resultingVelocity = totalMomentum.scale(1 / totalMass);\r\n        let changeObject: ObjectState;\r\n        let removeIndex: number;\r\n\r\n        if (state2.body.mass > state1.body.mass) {\r\n            changeObject = state2;\r\n            removeIndex = index1;\r\n        } else {\r\n            changeObject = state1;\r\n            removeIndex = index2;\r\n        }\r\n        changeObject.velocity = resultingVelocity;\r\n        changeObject.body.mass = totalMass;\r\n        changeObject.body.radius = changeObject.body.defaultRadius();\r\n        changeObject.body.color = massDependentColor(changeObject.body.mass);\r\n        changeObject.body.movable = (state1.body.movable && state2.body.movable);\r\n        if (!changeObject.body.movable) {\r\n            changeObject.velocity = new Vector2D(0, 0);\r\n        }\r\n        this.removeFromObjectStates(removeIndex);\r\n    }\r\n    /**\r\n    * @param restitution number between 0 (perfectly inelastic) and 1 (perfectly elastic)\r\n    */\r\n    private elasticCollision(body1: ObjectState, body2: ObjectState, restitution: number = 1) {\r\n        const lowerBounds = 1;\r\n\r\n        // normal vector between the bodies\r\n        const displacement = body1.position.displacementVector(body2.position);\r\n        const distance = displacement.magnitude(); \r\n        if (distance <= lowerBounds || distance === 0) {\r\n            return; \r\n        }\r\n        const normalizedDisplacement = displacement.scale(1 / distance);\r\n\r\n        // relative velocity along the normalDisplacement?\r\n        const relativeVelocity = body2.velocity.subtract(body1.velocity);\r\n        const velocityAlongDisplacement = relativeVelocity.dotProduct(normalizedDisplacement);\r\n\r\n        // if the bodies are moving apart, do nothing\r\n        if (velocityAlongDisplacement > 0) { return; }\r\n\r\n        // impulseScalar = change in momentum as scalar\r\n        const impulseScalar = -(1 + restitution) * velocityAlongDisplacement / (body1.body.mass + body2.body.mass);\r\n\r\n        // update velocities based on the impulse scalar\r\n        const deltaV1 = normalizedDisplacement.scale(impulseScalar * body2.body.mass);\r\n        const deltaV2 = normalizedDisplacement.scale(impulseScalar * body1.body.mass);\r\n        body1.velocity = body1.velocity.subtract(deltaV1);\r\n        body2.velocity = body2.velocity.add(deltaV2);\r\n        \r\n        // REFACTOR ME: at the top, check for movable, if not just reflect velocity\r\n        // if a body is immovable, reset its velocity and transfer it back\r\n        if (!body1.body.movable) {\r\n            body1.velocity = new Vector2D(0, 0);\r\n            body2.velocity = body2.velocity.add(deltaV1);\r\n        }\r\n        if (!body2.body.movable) {\r\n            body2.velocity = new Vector2D(0, 0);\r\n            body1.velocity = body1.velocity.add(deltaV2);\r\n        }\r\n    }\r\n    private placeBodiesTangentially(objectState1: ObjectState, objectState2: ObjectState) {\r\n        const displacement = objectState1.position.displacementVector(objectState2.position);\r\n        const normalDisplacement = displacement.normalize();        \r\n        const targetDistance = objectState1.body.radius + objectState2.body.radius;\r\n        const totalMoveDistance = targetDistance - displacement.magnitude();\r\n        if (targetDistance === 0) {\r\n            return;\r\n        }\r\n        const moveBody1 = normalDisplacement.scale(totalMoveDistance * (objectState1.body.radius / targetDistance));\r\n        const moveBody2 = normalDisplacement.scale(totalMoveDistance * (objectState2.body.radius / targetDistance));\r\n    \r\n        objectState1.position = objectState1.position.subtract(moveBody1);\r\n        objectState2.position = objectState2.position.add(moveBody2);\r\n    }\r\n}\r\n","import { Body2d } from \"../simulation/gravity\";\r\nimport * as util from \"../util/util\";\r\nimport { UIElements, RadioButtonGroup, StatusBar, UIAnimationSettings } from \"../const/types\";\r\nimport { App } from \"../app/app\";\r\nimport { VECTOR_ACC_COLOR_NAME, VECTOR_VEL_COLOR_NAME } from \"../const/const\";\r\n\r\nexport class UI implements UIElements {\r\n//#region properties\r\n    // All UI Elements\r\n    statusBar: StatusBar;\r\n    resetButton: HTMLInputElement;\r\n    playPauseButton: HTMLInputElement;\r\n    stepButton: HTMLInputElement;\r\n    repositoryLink: HTMLElement;\r\n    zoomInButton: HTMLInputElement;\r\n    zoomOutButton: HTMLInputElement;\r\n    scrollUpButton: HTMLInputElement;\r\n    scrollDownButton: HTMLInputElement;\r\n    scrollLeftButton: HTMLInputElement;\r\n    scrollRightButton: HTMLInputElement;\r\n    displayVectorsCheckbox: HTMLInputElement;\r\n    collisionDetectionCheckbox: HTMLInputElement;\r\n    elasticCollisionsCheckbox: HTMLInputElement;\r\n    gravitationalConstantInput: HTMLInputElement;\r\n    gravitationalConstantRangeInput: HTMLInputElement;\r\n    clickAction: RadioButtonGroup;\r\n    massInput: HTMLInputElement;\r\n    movableCheckbox: HTMLInputElement;\r\n//#endregion\r\n//#region get, set\r\n    // get all the values\r\n    public get selectedClickAction() {\r\n        return this.getSelectedValue(this.clickAction) ?? this.clickAction.buttons[0].value;\r\n    }\r\n    get collisionDetection() {\r\n        return this.collisionDetectionCheckbox.checked;\r\n    }\r\n    get elasticCollisions() {\r\n        return this.elasticCollisionsCheckbox.checked;\r\n    }\r\n    get gravitationalConstant() {\r\n        return util.getInputNumber(this.gravitationalConstantInput);\r\n    }\r\n    get displayVectors() {\r\n        return this.displayVectorsCheckbox.checked;\r\n    }\r\n    get mass() {\r\n        return util.getInputNumber(this.massInput);\r\n    }\r\n    get movable() {\r\n        return this.movableCheckbox;\r\n    }\r\n    get animationSettings(): UIAnimationSettings {\r\n        return {\r\n            displayVectors: this.displayVectorsCheckbox.checked,\r\n        };\r\n    }\r\n    get simulationSettings() {\r\n        return {\r\n            collisionDetection: this.collisionDetection,\r\n            elasticCollisions: this.elasticCollisions,\r\n            gravitationalConstant: this.gravitationalConstant,\r\n        };\r\n    }\r\n    get gravityAnimationController() {\r\n        return this.app.gravityAnimationController;\r\n    }\r\n//#endregion\r\n//#region initialize\r\n    constructor(private app: App) {\r\n        this.resetButton                        = document.getElementById(\"btnResetSim\")! as HTMLInputElement;\r\n        this.playPauseButton                    = document.getElementById(\"btnToggleSim\")! as HTMLInputElement;\r\n        this.stepButton                         = document.getElementById(\"btnNextStep\")! as HTMLInputElement;\r\n        this.repositoryLink                     = document.getElementById(\"repoLink\")!;\r\n        this.zoomInButton                       = document.getElementById(\"btnZoomIn\")! as HTMLInputElement;\r\n        this.zoomOutButton                      = document.getElementById(\"btnZoomOut\")! as HTMLInputElement;\r\n        this.scrollUpButton                     = document.getElementById(\"btnScrollUp\")! as HTMLInputElement;\r\n        this.scrollDownButton                   = document.getElementById(\"btnScrollDown\")! as HTMLInputElement;\r\n        this.scrollLeftButton                   = document.getElementById(\"btnScrollLeft\")! as HTMLInputElement;\r\n        this.scrollRightButton                  = document.getElementById(\"btnScrollRight\")! as HTMLInputElement;\r\n        this.displayVectorsCheckbox             = document.getElementById(\"cbxDisplayVectors\")! as HTMLInputElement;\r\n        this.collisionDetectionCheckbox         = document.getElementById(\"cbxCollisions\")! as HTMLInputElement;\r\n        this.elasticCollisionsCheckbox          = document.getElementById(\"cbxElasticCollisions\")! as HTMLInputElement;\r\n        this.gravitationalConstantInput         = document.getElementById(\"numberG\")! as HTMLInputElement;\r\n        this.gravitationalConstantRangeInput    = document.getElementById(\"rangeG\")! as HTMLInputElement;\r\n        this.massInput                          = document.getElementById(\"massInput\")! as HTMLInputElement;\r\n        this.movableCheckbox                    = document.getElementById(\"cbxBodyMovable\")! as HTMLInputElement;\r\n        this.clickAction = {\r\n            name: \"radioBtnMouseAction\",\r\n            buttons: Array.from(document.querySelectorAll('input[name=\"radioBtnMouseAction\"]')) as HTMLInputElement[]\r\n        };\r\n        this.statusBar = (() => {\r\n            const bar = document.getElementById(\"statusBar\") as HTMLDivElement;\r\n            return {\r\n                bar: bar,\r\n                fields: Array.from((bar.querySelectorAll(\".statusBarItem\")) as NodeListOf<HTMLSpanElement>)\r\n            };\r\n        })();\r\n\r\n        this.registerEvents();\r\n    }\r\n    private registerEvents() {\r\n        this.resetButton.addEventListener(\"click\", () => this.resetButtonClicked());\r\n        this.playPauseButton.addEventListener(\"click\", () => this.playPauseClicked());\r\n        this.stepButton.addEventListener(\"click\", () => this.stepButtonClicked());\r\n        this.zoomInButton.addEventListener(\"click\", () => this.zoomInClicked());\r\n        this.zoomOutButton.addEventListener(\"click\", () => this.zoomOutClicked());\r\n        this.scrollUpButton.addEventListener(\"click\", () => this.scrollUpClicked());\r\n        this.scrollDownButton.addEventListener(\"click\", () => this.scrollDownClicked());\r\n        this.scrollLeftButton.addEventListener(\"click\", () => this.scrollLeftClicked());\r\n        this.scrollRightButton.addEventListener(\"click\", () => this.scrollRightClicked());\r\n        this.displayVectorsCheckbox.addEventListener(\"change\", () => this.cbxDisplayVectorsChanged());\r\n        this.collisionDetectionCheckbox.addEventListener(\"change\", () => this.cbxCollisionsChanged());\r\n        this.elasticCollisionsCheckbox.addEventListener(\"change\", () => this.cbxElasticCollisionsChanged());\r\n        this.gravitationalConstantInput.addEventListener(\"change\", () => this.numberInputGChanged());\r\n        this.gravitationalConstantRangeInput.addEventListener(\"input\", () => this.rangeInputGChanged());\r\n        this.massInput.addEventListener(\"change\", () => this.updateSelectedMass());\r\n    }\r\n    public initialize(width: number, height: number) {\r\n        this.elasticCollisionsCheckbox.disabled = !this.collisionDetectionCheckbox.checked;\r\n        this.massInput.step = this.calculateMassInputStep();\r\n        \r\n        this.setStatusBarVectors()\r\n        \r\n        this.updateStatusBarCanvasDimensions(width, height);\r\n\r\n        this.gravityAnimationController.setG(Number(this.gravitationalConstantRangeInput.value));\r\n    }\r\n//#endregion\r\n    public resetButtonClicked() {\r\n        this.gravityAnimationController.reset()\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public playPauseClicked() {\r\n        if (this.gravityAnimationController.running) {\r\n            this.gravityAnimationController.stop();\r\n            this.simulationStopped();\r\n        } else {\r\n            this.gravityAnimationController.run();\r\n            this.simulationResumed();\r\n        }\r\n    }\r\n    public stepButtonClicked() {\r\n        this.gravityAnimationController.advanceOneTick();\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public zoomInClicked() {\r\n        this.gravityAnimationController.zoomIn();\r\n        this.updateStatusBarAnimationInfo();\r\n    }\r\n    public zoomOutClicked() {\r\n        this.gravityAnimationController.zoomOut();\r\n        this.updateStatusBarAnimationInfo();\r\n    }\r\n    public scrollUpClicked() {\r\n        this.gravityAnimationController.scrollUp();\r\n    }\r\n    public scrollDownClicked() {\r\n        this.gravityAnimationController.scrollDown();\r\n    }\r\n    public scrollLeftClicked() {\r\n        this.gravityAnimationController.scrollLeft();\r\n    }\r\n    public scrollRightClicked() {\r\n        this.gravityAnimationController.scrollRight();\r\n    }\r\n    public cbxDisplayVectorsChanged() {\r\n        const displayVectors = this.displayVectorsCheckbox.checked;\r\n        this.gravityAnimationController.setDisplayVectors(displayVectors)\r\n        this.setStatusBarVectors();\r\n    }\r\n    public cbxCollisionsChanged() {\r\n        const checked = this.collisionDetectionCheckbox.checked;\r\n        const elasticChecked = this.elasticCollisionsCheckbox.checked;\r\n        \r\n        this.elasticCollisionsCheckbox.disabled = !checked;\r\n        \r\n        this.gravityAnimationController.setCollisionDetection(checked, elasticChecked);\r\n    }\r\n    public cbxElasticCollisionsChanged() {\r\n        this.gravityAnimationController.setElasticCollisions(this.elasticCollisionsCheckbox.checked);\r\n    }\r\n    public numberInputGChanged() {\r\n        const newG: string = this.gravitationalConstantInput.value;\r\n        this.gravitationalConstantRangeInput.value = newG;\r\n        this.gravityAnimationController.setG(Number(newG));\r\n    }\r\n    public rangeInputGChanged() {\r\n        const newG: string = this.gravitationalConstantRangeInput.value;\r\n        if (this.gravitationalConstantInput.value !== newG) {\r\n            this.gravitationalConstantInput.value = newG;\r\n            this.gravityAnimationController.setG(Number(newG));\r\n        }\r\n    }\r\n    public simulationStopped() {\r\n        this.playPauseButton.innerHTML = \"&#9654;\"; // play symbol\r\n        this.stepButton.disabled = false;\r\n    }\r\n    public simulationResumed() {\r\n        this.playPauseButton.innerHTML = \"&#10074;&#10074;\"; // pause symbol\r\n        \r\n        this.stepButton.disabled = true;\r\n        this.updateStatusBarSimulationInfo();\r\n    }\r\n    public getSelectedValue(group: RadioButtonGroup): string | null {\r\n        const selected = group.buttons.find(btn => btn.checked);\r\n        return selected?.value ?? null;\r\n    }\r\n    public body2dFromInputs(): Body2d {\r\n        const movable = this.movableCheckbox.checked;\r\n        const mass = util.getInputNumber(this.massInput);\r\n\r\n        return new Body2d(util.clamp(mass, 1, Number.MAX_SAFE_INTEGER), movable);\r\n    }\r\n    public updateSelectedMass() {\r\n        this.massInput.step = this.calculateMassInputStep();\r\n    }\r\n    /**\r\n     * The step is equal to 10% of the input value, rounded down to the nearest power of 10.\r\n     * @returns Step as a string. Step is always at least 1 or larger.\r\n     */\r\n    private calculateMassInputStep(): string {\r\n        let step = 10 ** (Math.floor(Math.log10(this.mass)) - 1);\r\n        return step < 1 ? \"1\" : step.toString();\r\n    }\r\n    private setStatusBarVectors() {\r\n        const displayVectors = this.displayVectorsCheckbox.checked;\r\n        if (displayVectors) {\r\n            this.setStatusMessage(this.statusBarVectorMessage(), 3);\r\n        } else {\r\n            this.setStatusMessage(\"\", 3);\r\n        }\r\n    }\r\n    public updateStatusBarSimulationInfo() {\r\n        this.updateStatusBarTickCount(this.gravityAnimationController.tickCount);\r\n        this.updateStatusBarBodyCount(this.gravityAnimationController.bodyCount);\r\n    }\r\n    public updateStatusBarAnimationInfo() {\r\n        this.updateStatusBarZoom(this.gravityAnimationController.currentZoom);\r\n    }\r\n    public updateStatusBarBodyCount(bodyCount: number, statusBarFieldIndex: number = 1) {\r\n        this.setStatusMessage(`Number of Bodies: ${bodyCount}`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarTickCount(tickCount: number, statusBarFieldIndex: number = 2) {\r\n        this.setStatusMessage(`Simulation Tick: ${tickCount}`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarZoom(currentZoom: number, statusBarFieldIndex: number = 4) {\r\n        this.setStatusMessage(`Zoom: ${currentZoom.toFixed(2)} (m per pixel)`, statusBarFieldIndex);\r\n    }\r\n    public updateStatusBarCanvasDimensions(width: number, height: number, statusBarFieldIndex: number = 5) {\r\n        this.setStatusMessage(`Canvas dimension: ${width} * ${height}`, statusBarFieldIndex);\r\n    }\r\n    private statusBarVectorMessage() {\r\n        return `Acceleration: ${VECTOR_ACC_COLOR_NAME} - Velocity: ${VECTOR_VEL_COLOR_NAME}`;\r\n    }\r\n    /**\r\n     * @param fieldIndexOrId number of field (starting at one) OR id of the field\r\n     */\r\n    private setStatusMessage(message: string, fieldIndexOrId?: number | string, append: boolean = false) {\r\n        let element: HTMLElement;\r\n        if (typeof fieldIndexOrId === \"number\") {\r\n            element = this.statusBar.fields[fieldIndexOrId - 1];\r\n        } else if (typeof fieldIndexOrId === \"string\") {\r\n            element = document.getElementById(fieldIndexOrId)!;\r\n        } else {\r\n            element = this.statusBar.fields[0];\r\n        }\r\n        \r\n        if (append) {\r\n            element!.innerHTML += message;\r\n        } else {\r\n            element!.innerHTML = message;\r\n        }\r\n    }\r\n\r\n}","import { Vector2D } from \"../util/vector2d\";\r\nimport * as essentials from \"../util/util\";\r\nimport { VECTOR_THICKNESS } from \"../const/const\";\r\n\r\nexport class Canvas {\r\n//#region properties\r\n    // let offscreenCanvas: OffscreenCanvas; // use this in a worker thread to render or draw on, then transfer content to the visible html-canvas\r\n    // let offscreenCanvasCtx: OffscreenCanvasRenderingContext2D;\r\n    private _visibleCanvas: HTMLCanvasElement;\r\n    private _visibleCanvasContext: CanvasRenderingContext2D;\r\n    constructor(visibleCanvas: HTMLCanvasElement) {\r\n        this._visibleCanvas = visibleCanvas;\r\n        this._visibleCanvasContext = visibleCanvas.getContext(\"2d\", { alpha: false })!;\r\n    }\r\n//#endregion\r\n//#region get, set\r\n    get visibleCanvas() {\r\n        return this._visibleCanvas;\r\n    }\r\n    set visibleCanvas(canvas: HTMLCanvasElement) {\r\n        this._visibleCanvas = canvas;\r\n    }\r\n    get visibleCanvasContext() {\r\n        return this._visibleCanvasContext;\r\n    }\r\n    set visibleCanvasContext(context: CanvasRenderingContext2D) {\r\n        this._visibleCanvasContext = context;\r\n    }\r\n    // additional getters\r\n    get width(): number {\r\n        return this.visibleCanvas.width;\r\n    }\r\n    get height(): number {\r\n        return this.visibleCanvas.height;\r\n    }\r\n//#endregion\r\n    public resize(width: number, height: number) {\r\n        this.visibleCanvas.width = width;\r\n        this.visibleCanvas.height = height;\r\n    }   \r\n//#region drawing stuff\r\n    public clear() {\r\n        this.visibleCanvasContext.clearRect(0, 0, this.width, this.height);\r\n    }\r\n    public fillCanvas(color: string = \"#000000\") {\r\n        this.visibleCanvasContext.fillStyle = color;\r\n        this.visibleCanvasContext.fillRect(0, 0, this.width, this.height);\r\n    }\r\n    /**\r\n     * @param position in canvas space\r\n     * @param direction in canvas space\r\n     */\r\n    public drawVector(position: Vector2D, direction: Vector2D, color: string = \"white\") {\r\n        // optionally normalize the direction and scale later\r\n        let endPosition: Vector2D = position.add(direction);\r\n        if (!this.isLineVisible(position, endPosition)) {\r\n            return;\r\n        }\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.lineWidth = VECTOR_THICKNESS;\r\n        this.visibleCanvasContext.strokeStyle = color;\r\n        this.visibleCanvasContext.moveTo(position.x, position.y);\r\n        this.visibleCanvasContext.lineTo(endPosition.x, endPosition.y);\r\n        this.visibleCanvasContext.stroke();\r\n    }\r\n    /**\r\n     * draws a circular body at specified position, in specified color\r\n     * @param position on canvas\r\n     * @param radius in canvas units\r\n     * @param color default white\r\n     */\r\n    public drawCircle(position: Vector2D, radius: number, color: string = \"white\") {\r\n        if (!this.isCircleVisible(position, radius)) return;\r\n        this.visibleCanvasContext.beginPath();\r\n        this.visibleCanvasContext.arc(position.x, position.y, radius, 0, Math.PI * 2);\r\n        this.visibleCanvasContext.closePath();\r\n        this.visibleCanvasContext.fillStyle = color;\r\n        this.visibleCanvasContext.fill();\r\n\r\n    }\r\n    private isCircleVisible(position: Vector2D, radius: number): boolean {\r\n        const inBoundsLeft = position.x + radius >= 0;\r\n        const inBoundsRight = position.x - radius <= this.visibleCanvas.width;\r\n        const inBoundsTop = position.y + radius >= 0;\r\n        const inBoundsBottom = position.y - radius <= this.visibleCanvas.height;\r\n        return inBoundsLeft && inBoundsRight && inBoundsTop && inBoundsBottom;\r\n    }\r\n    private isLineVisible(startPoint: Vector2D, endPoint: Vector2D): boolean {\r\n        // if the startPoint or endPoint is in the canvas, return true\r\n        if ((essentials.isInRange(startPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(startPoint.y, 0, this.visibleCanvas.height)) ||\r\n            (essentials.isInRange(endPoint.x, 0, this.visibleCanvas.width) && essentials.isInRange(endPoint.y, 0, this.visibleCanvas.height))) \r\n            {\r\n            return true;\r\n        }\r\n        // if both points are outside the canvas, check if the line intersects with any of the canvas edges\r\n        if (Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, 0), new Vector2D(this.visibleCanvas.width, 0)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, 0), new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(this.visibleCanvas.width, this.visibleCanvas.height), new Vector2D(0, this.visibleCanvas.height)], true) ||\r\n            Vector2D.linesIntersecting([startPoint, endPoint], [new Vector2D(0, this.visibleCanvas.height), new Vector2D(0, 0)], true)) \r\n            {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n//#endregion\r\n}","import { Body2d } from \"../simulation/gravity\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nexport interface Pointer {\r\n    main: {\r\n        state: ButtonState;\r\n        downCoordinatesInSimSpace: Vector2D | undefined;\r\n    };\r\n    secondary: {\r\n        state: ButtonState;\r\n    };\r\n    wheel: {\r\n        state: ButtonState;\r\n    };\r\n}\r\nexport interface AnimationSettings {\r\n    frameLength: number; // ms\r\n    displayVectors: boolean;\r\n    tracePaths: boolean;\r\n}\r\nexport enum TouchAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    ManipulateView = 2\r\n}\r\nexport enum MouseAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    Scroll = 2,\r\n    Zoom = 3\r\n}\r\nexport interface MultiTouchGesture {\r\n    first: Vector2D;\r\n    second: Vector2D;\r\n    midpoint: Vector2D; \r\n    distance: number;\r\n}\r\nexport interface Mouse {\r\n   main: MouseButton;\r\n   secondary: MouseButton;\r\n   wheel: MouseButton;\r\n}\r\nexport interface MouseButton {\r\n    state: ButtonState;\r\n    downCoordinatesInSimSpace?: { x: number, y: number } | Vector2D;\r\n}\r\nexport enum ButtonState {\r\n    Up = 0,\r\n    Down = 1,\r\n}\r\nexport enum MouseButtons {\r\n    Main = 0,\r\n    Wheel = 1,\r\n    Secondary = 2,\r\n}\r\nexport interface CanvasSpace {\r\n    // use this to transform simulationSpace to canvasSpace and back\r\n    origin: Vector2D, // the canvas' origin in simulation space\r\n    currentZoom: number, // simulationUnits (meter) per canvasUnit\r\n    orientationY: number; // in practice this is -1, as the y-axis of the canvas is in the opposite direction of the simulation\r\n}\r\nexport interface ObjectState {\r\n    body: Body2d, \r\n    position: Vector2D,\r\n    /**\r\n     * simulationUnits (meter?) per second\r\n     */\r\n    velocity: Vector2D,\r\n    acceleration: Vector2D\r\n}\r\n/*\r\n    UI stuff\r\n*/\r\nexport interface StatusBar {\r\n    bar: HTMLDivElement\r\n    fields: HTMLSpanElement[];\r\n}\r\nexport interface RadioButtonGroup {\r\n    name: string;\r\n    buttons: HTMLInputElement[];\r\n}\r\nexport interface UIElements {\r\n    statusBar: StatusBar;\r\n    // top menu\r\n    resetButton: HTMLElement;\r\n    playPauseButton: HTMLElement;\r\n    stepButton: HTMLElement;\r\n    repositoryLink: HTMLElement;\r\n\r\n    // main menu\r\n    zoomInButton: HTMLElement;\r\n    zoomOutButton: HTMLElement;\r\n    scrollUpButton: HTMLElement;\r\n    scrollDownButton: HTMLElement;\r\n    scrollLeftButton: HTMLElement;\r\n    scrollRightButton: HTMLElement;\r\n\r\n    displayVectorsCheckbox: HTMLInputElement;\r\n\r\n    collisionDetectionCheckbox: HTMLInputElement;\r\n    elasticCollisionsCheckbox: HTMLInputElement;\r\n    gravitationalConstantInput: HTMLInputElement;\r\n\r\n    clickAction: HTMLSelectElement | RadioButtonGroup;\r\n    massInput: HTMLInputElement;\r\n    movableCheckbox: HTMLInputElement;\r\n}\r\nexport interface UIAnimationSettings {\r\n    displayVectors: boolean;\r\n    //tracePaths: boolean;\r\n}\r\nexport interface UISimulationSettings {\r\n    collisionDetection: boolean;\r\n    elasticCollisions: boolean;\r\n    gravitationalConstant: number;\r\n}","import { CanvasSpace } from \"../const/types\";\r\nimport { Coordinate, Vector2D } from \"./vector2d\";\r\n\r\nexport function absoluteToCanvasPosition(absolutePosition: Coordinate, canvas: HTMLCanvasElement): Vector2D {\r\n    const canvasRect = canvas.getBoundingClientRect();\r\n    const x = absolutePosition.x - canvasRect.left;\r\n    const y = absolutePosition.y - canvasRect.top;\r\n    return new Vector2D(x, y);\r\n}\r\nexport function relativePosition(absolutePosition: Coordinate, element: HTMLElement): Vector2D {\r\n    const elementRect = element.getBoundingClientRect();\r\n    const x = absolutePosition.x - elementRect.left;\r\n    const y = absolutePosition.y - elementRect.top;\r\n    return new Vector2D(x, y);\r\n}\r\nexport function pointFromCanvasSpaceToSimulationSpace(point: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. scale (canvasVector * zoom in simulationUnits/canvasUnit)\r\n    // 2. flip (y axis are in opposite directions)\r\n    // 3. shift (scaledAndFlippedPoint + Origin of C in SimSpace)\r\n    const scaled = point.scale(canvasSpace.currentZoom);\r\n    const flipped = scaled.hadamardProduct(new Vector2D(1, canvasSpace.orientationY));\r\n    const shifted = flipped.add(canvasSpace.origin);\r\n    return shifted;\r\n}\r\n\r\nexport function pointFromSimulationSpaceToCanvasSpace(point: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. shift (point in SimSpace - Origin of C in SimSpace)\r\n    // 2. flip (y axis point in opposite directions)\r\n    // 3. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const shifted: Vector2D = point.subtract(canvasSpace.origin);\r\n    const flipped: Vector2D = new Vector2D(shifted.x, shifted.y * -1);\r\n    const scaled: Vector2D = flipped.scale(1 / canvasSpace.currentZoom);\r\n    return scaled;\r\n}\r\nexport function directionFromSimulationSpaceToCanvasSpace(direction: Vector2D, canvasSpace: CanvasSpace): Vector2D {\r\n    // transformation:\r\n    // 1. flip (y axis are in opposite directions)\r\n    // 2. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const flipped: Vector2D = new Vector2D(direction.x, direction.y * -1);\r\n    const scaled: Vector2D = flipped.scale(1 / canvasSpace.currentZoom);\r\n    return scaled;\r\n}\r\n","import { Vector2D } from \"../util/vector2d\";\r\nimport { TouchAction, ButtonState, MouseButtons, Pointer, MouseAction, MultiTouchGesture } from \"../const/types\";\r\nimport * as util from \"../util/util\";\r\nimport { Canvas } from \"../animation/canvas\";\r\nimport { App } from \"../app/app\";\r\nimport * as tfm from \"../util/transformations\";\r\nimport { Body2d } from \"../simulation/gravity\";\r\n\r\nexport class InteractionManager {\r\n//#region properties\r\n    private _touchAction: TouchAction = TouchAction.None;\r\n    private _activeTouches = new Map<number, Vector2D>();\r\n    private _previousTouchesMid: Vector2D | null = null;\r\n    private _previousTouchesDist: number | null = null;\r\n    private _lastSingleTouchPos: Vector2D | null = null;\r\n    private pointer: Pointer = {\r\n        main: { state: ButtonState.Up, downCoordinatesInSimSpace: undefined },\r\n        secondary: { state: ButtonState.Up },\r\n        wheel: { state: ButtonState.Up }\r\n    };\r\n//#endregion\r\n//#region get, set\r\n    get touchAction(): TouchAction {\r\n        return this._touchAction;\r\n    }\r\n    set touchAction(action: TouchAction) {\r\n        this._touchAction = action;\r\n    }\r\n\r\n    get activeTouches(): Map<number, Vector2D> {\r\n        return this._activeTouches;\r\n    }\r\n    set activeTouches(touches: Map<number, Vector2D>) {\r\n        this._activeTouches = touches;\r\n    }\r\n\r\n    get lastSingleTouchPos(): Vector2D | null {\r\n        return this._lastSingleTouchPos;\r\n    }\r\n\r\n    set lastSingleTouchPos(pos: Vector2D | null) {\r\n        this._lastSingleTouchPos = pos;\r\n    }\r\n    \r\n    get previousTouchesMid(): Vector2D | null {\r\n        return this._previousTouchesMid;\r\n    }\r\n    set previousTouchesMid(mid: Vector2D | null) {\r\n        this._previousTouchesMid = mid;\r\n    }\r\n\r\n    get previousTouchesDist(): number | null {\r\n        return this._previousTouchesDist;\r\n    }\r\n    set previousTouchesDist(dist: number | null) {\r\n        this._previousTouchesDist = dist;\r\n    }\r\n    // additional getters\r\n    get gravityAnimationController() {\r\n        return this.app.gravityAnimationController;\r\n    }\r\n    get ui() {\r\n        return this.app.ui;\r\n    }\r\n//#endregion\r\n    constructor(private canvas: Canvas, private app: App) {\r\n        const visibleCanvas = canvas.visibleCanvas;\r\n        visibleCanvas.addEventListener(\"pointerdown\",   (ev) => this.canvasPointerDown(ev as PointerEvent));\r\n        visibleCanvas.addEventListener(\"pointerup\",     (ev) => this.canvasPointerUp(ev as PointerEvent));\r\n        visibleCanvas.addEventListener(\"pointermove\",   (ev) => this.canvasPointerMoving(ev as PointerEvent));\r\n        visibleCanvas.addEventListener(\"pointercancel\", (ev) => this.deletePointer(ev as PointerEvent));\r\n        visibleCanvas.addEventListener(\"mousedown\",     (ev) => this.canvasMouseDown(ev as MouseEvent));    // pointerEvents only fire when the first button is pressed, and the last button is released\r\n        visibleCanvas.addEventListener(\"mouseup\",       (ev) => this.canvasMouseUp(ev as MouseEvent));      // so we need mouse events to catch all button interactions\r\n        visibleCanvas.addEventListener(\"wheel\",         (ev) => this.canvasScrollMouseWheel(ev as WheelEvent));\r\n        visibleCanvas.addEventListener(\"contextmenu\",   (ev) => { ev.preventDefault() });\r\n        visibleCanvas.addEventListener(\"touchend\",      (ev) => { ev.preventDefault() }, { passive: false });   // prevent touch-triggered MouseUp\r\n    }\r\n//#region primary interaction\r\n    private canvasPointerDown(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerDown only fires for presses while no other button is down.\r\n            return;\r\n        }\r\n        this.canvas.visibleCanvas.setPointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchStart(ev);\r\n                break;\r\n\r\n            case \"pen\":\r\n                \r\n                break;\r\n\r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n    }\r\n    private canvasPointerUp(ev: PointerEvent) {\r\n        if (ev.pointerType === \"mouse\") {\r\n            // handled in its own eventListener. PointerUp only fires when the last button is released.\r\n            return;\r\n        }\r\n        this.canvas.visibleCanvas.releasePointerCapture(ev.pointerId);\r\n        switch (ev.pointerType) {\r\n            case \"touch\":\r\n                this.canvasTouchEnd(ev);\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType: \" + ev.pointerType);\r\n                break;\r\n        }\r\n        \r\n    }\r\n    private canvasPointerMoving(ev: PointerEvent) {\r\n        const currentMovement = new Vector2D(ev.movementX, ev.movementY);\r\n        \r\n        switch (ev.pointerType) {\r\n            case \"mouse\":\r\n                if (this.pointer.wheel.state === ButtonState.Down) {\r\n                    ev.preventDefault(); // prevent scroll-symbol\r\n                    this.gravityAnimationController.scrollInCanvasUnits(currentMovement);\r\n                }\r\n                break;\r\n        \r\n            case \"touch\":\r\n                const currentTouchPosition = this.activeTouches.get(ev.pointerId)!;\r\n                if (!currentTouchPosition) return;\r\n\r\n                currentTouchPosition.x = ev.clientX;\r\n                currentTouchPosition.y = ev.clientY;\r\n\r\n                switch (this.touchAction) {\r\n\r\n                    case TouchAction.AddBody:\r\n                        // TODO: draw (half transparent) body and vector while dragging\r\n                        break;\r\n\r\n                    case TouchAction.ManipulateView:\r\n                        if (this.activeTouches.size === 1) {\r\n                            // --------------------\r\n                            //      SINGLE TOUCH\r\n                            // --------------------\r\n\r\n                            if (this.lastSingleTouchPos) {\r\n                                const dx = currentTouchPosition.x - this.lastSingleTouchPos.x;\r\n                                const dy = currentTouchPosition.y - this.lastSingleTouchPos.y;\r\n\r\n                                // RefactorMe(maybe?) use movement.x / y, mostly works but not technically part of PointerEvents\r\n                                this.gravityAnimationController.scrollInCanvasUnits(new Vector2D(dx, dy));\r\n                            }\r\n\r\n                            this.lastSingleTouchPos = new Vector2D(currentTouchPosition.x, currentTouchPosition.y);\r\n                            return;\r\n                        }\r\n\r\n                        // --------------------\r\n                        //      MULTI TOUCH IS WHAT'S LEFT\r\n                        // --------------------\r\n                        const touches = [...this.activeTouches.values()];\r\n                        const p1 = touches[0];\r\n                        const p2 = touches[1];\r\n\r\n                        const touchesMidpoint = new Vector2D(\r\n                            (p1.x + p2.x) / 2,\r\n                            (p1.y + p2.y) / 2\r\n                        );\r\n\r\n                        const touchesDistance = Math.hypot(p2.x - p1.x, p2.y - p1.y);\r\n\r\n                        // no previous gesture -> initialize\r\n                        if (this.previousTouchesMid === null || this.previousTouchesDist === null) {\r\n                            this.previousTouchesMid = touchesMidpoint;\r\n                            this.previousTouchesDist = touchesDistance;\r\n                            return;\r\n                        }\r\n\r\n                        const zoomFactor = touchesDistance / this.previousTouchesDist;\r\n                        const zoomCenterCanvas = tfm.relativePosition(touchesMidpoint, this.canvas.visibleCanvas);\r\n                        const scroll = touchesMidpoint.subtract(this.previousTouchesMid);\r\n                        this.gravityAnimationController.zoomToFactor(zoomFactor, zoomCenterCanvas);\r\n                        this.gravityAnimationController.scrollInCanvasUnits(scroll);\r\n\r\n                        this.previousTouchesMid = touchesMidpoint;\r\n                        this.previousTouchesDist = touchesDistance;\r\n\r\n                        break;\r\n                    }\r\n\r\n                break;\r\n        \r\n            case \"pen\":\r\n                \r\n                break;\r\n        \r\n            default:\r\n                console.log(\"unknown pointerType\");\r\n                break;\r\n        }\r\n    }\r\n    private deletePointer(ev: PointerEvent) {\r\n        this.activeTouches.delete(ev.pointerId);\r\n    }\r\n    private canvasScrollMouseWheel(ev: WheelEvent) {\r\n        // don't scroll the entire page\r\n        ev.preventDefault();\r\n        \r\n        const cursorPos = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        const posInCanvasSpace = tfm.absoluteToCanvasPosition(cursorPos, this.canvas.visibleCanvas);\r\n\r\n        if (ev.deltaY < 0) {\r\n            this.gravityAnimationController.zoomIn(posInCanvasSpace);\r\n        } else if (ev.deltaY > 0) {\r\n            this.gravityAnimationController.zoomOut(posInCanvasSpace);\r\n        }\r\n        this.ui.updateStatusBarAnimationInfo();\r\n    }    \r\n    private canvasTouchStart(ev: PointerEvent) {\r\n        const touch = new Vector2D(ev.clientX, ev.clientY);\r\n        this.activeTouches.set(ev.pointerId, touch);\r\n\r\n        if (this.activeTouches.size === 1) {\r\n            this.touchAction = TouchAction.AddBody;\r\n            this.lastSingleTouchPos = touch;\r\n            \r\n            \r\n            const positionVector = new Vector2D(ev.clientX, ev.clientY);\r\n            const positionInSimSpace: Vector2D = tfm.pointFromCanvasSpaceToSimulationSpace(positionVector, this.gravityAnimationController.canvasSpace);\r\n            this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n\r\n        } else if (this.activeTouches.size === 2) {\r\n            this.touchAction = TouchAction.ManipulateView;\r\n\r\n            // reset pinch-gesture\r\n            this.previousTouchesMid = null;\r\n            this.previousTouchesDist = null;\r\n            \r\n            // stop scrolling\r\n            this.lastSingleTouchPos = null;\r\n        }\r\n    }\r\n    private canvasTouchEnd(ev: PointerEvent) {\r\n        if (!this.activeTouches.has(ev.pointerId)) return;\r\n\r\n        this.activeTouches.delete(ev.pointerId);\r\n\r\n        switch (this.touchAction) {\r\n            case TouchAction.AddBody:\r\n                const absPos = util.getAbsolutePointerPosition(ev);\r\n                this.addBodyAtPointer(tfm.absoluteToCanvasPosition(absPos, this.canvas.visibleCanvas));\r\n                this.touchAction = TouchAction.None;\r\n                break;\r\n\r\n            case TouchAction.ManipulateView:\r\n                // reset pinch-gesture\r\n                this.previousTouchesMid = null;\r\n                this.previousTouchesDist = null;\r\n\r\n                if (this.activeTouches.size === 1) {\r\n                    // one touch remaining -> use it to scroll\r\n                    const remaining = this.activeTouches.values().next().value!;\r\n                    this.lastSingleTouchPos = new Vector2D(remaining.x, remaining.y);\r\n                } else if (this.activeTouches.size === 0) {\r\n                    this.touchAction = TouchAction.None;\r\n                    this.lastSingleTouchPos = null;\r\n                    this.previousTouchesMid = null;\r\n                    this.previousTouchesDist = null;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n    private canvasMouseUp(ev: MouseEvent) {\r\n        const absolutePointerPosition = new Vector2D(util.getAbsolutePointerPosition(ev));\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Up;\r\n                this.canvasMainMouseUp(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Up;\r\n                \r\n                // prevent scroll-symbol\r\n                ev.preventDefault();\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Up;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n                \r\n    }\r\n    private canvasMouseDown(ev: MouseEvent) {\r\n        const absolutePointerPosition: Vector2D = new Vector2D(ev.clientX, ev.clientY);\r\n        switch (ev.button) {\r\n            case MouseButtons.Main:\r\n                this.pointer.main.state = ButtonState.Down;\r\n                this.canvasMainMouseDown(absolutePointerPosition);\r\n                break;\r\n            case MouseButtons.Wheel:\r\n                this.pointer.wheel.state = ButtonState.Down;\r\n                ev.preventDefault(); // prevent scroll-symbol\r\n                break;\r\n            case MouseButtons.Secondary:\r\n                this.pointer.secondary.state = ButtonState.Down;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseDown(absoluteMousePosition: Vector2D) {\r\n        switch (MouseAction[this.ui.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                const positionVector = new Vector2D(absoluteMousePosition.x, absoluteMousePosition.y);\r\n                const positionInSimSpace: Vector2D = tfm.pointFromCanvasSpaceToSimulationSpace(positionVector, this.gravityAnimationController.canvasSpace);\r\n                this.pointer.main.downCoordinatesInSimSpace = positionInSimSpace;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    private canvasMainMouseUp(absoluteMousePosition: Vector2D) {\r\n        switch (MouseAction[this.ui.selectedClickAction as keyof typeof MouseAction]) {\r\n            case MouseAction.None:\r\n                break;\r\n            case MouseAction.AddBody:\r\n                this.addBodyAtPointer(tfm.absoluteToCanvasPosition(absoluteMousePosition, this.canvas.visibleCanvas));\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n//#endregion\r\n//#region manage interactions\r\n    private updateTouchPosition(pointerId: number, x: number, y: number): void {\r\n        const touch = this.activeTouches.get(pointerId);\r\n        if (touch) {\r\n            touch.x = x;\r\n            touch.y = y;\r\n        }\r\n    }\r\n    private multiTouchGesture(): MultiTouchGesture | null {\r\n        if (this.activeTouches.size < 2) return null;\r\n\r\n        const touches = this.activeTouches.values();\r\n        const first = new Vector2D (touches.next().value!);\r\n        const second = new Vector2D (touches.next().value!);\r\n\r\n        const midpoint = Vector2D.midpoint(first, second);\r\n        const distance = (new Vector2D(first)).distance(second);\r\n        Math.hypot(second.x - first.x, second.y - first.y);\r\n\r\n        return { first, second, midpoint, distance };\r\n    }\r\n    public reset(): void {\r\n        this.touchAction = TouchAction.None;\r\n        this.activeTouches.clear();\r\n        this.previousTouchesMid = null;\r\n        this.previousTouchesDist = null;\r\n        this.lastSingleTouchPos = null;\r\n    }\r\n//#endregion\r\n//#region do stuff\r\n    private addBodyAtPointer(pointerPositionOnCanvas: Vector2D) {\r\n        const bodyBeingAdded: Body2d = this.ui.body2dFromInputs();\r\n        const mousePositionInSimSpace: Vector2D = tfm.pointFromCanvasSpaceToSimulationSpace(pointerPositionOnCanvas, this.gravityAnimationController.canvasSpace);\r\n        const vel: Vector2D = util.calculateVelocityBetweenPoints(this.pointer.main.downCoordinatesInSimSpace!, mousePositionInSimSpace);\r\n        this.gravityAnimationController.addBody(bodyBeingAdded, mousePositionInSimSpace, vel);\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n\r\n//#endregion\r\n}","import { BACKGROUND_COLOR, MAX_ZOOM, MIN_DISPLAYED_RADIUS, MIN_ZOOM, VECTOR_ACC_COLOR, VECTOR_VEL_COLOR } from \"../const/const\";\r\nimport { Canvas } from \"./canvas\";\r\nimport { Body2d } from \"../simulation/gravity\";\r\nimport { AnimationSettings, CanvasSpace, ObjectState, UIAnimationSettings } from \"../const/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport * as tfm from \"../util/transformations\";\r\nimport { GravityAnimationController } from \"../simulation/gravity-animation-controller\";\r\nimport * as util from \"../util/util\";\r\nexport class AnimationController {\r\n//#region properties\r\n    private _canvas: Canvas;\r\n    private _canvasSpace: CanvasSpace;\r\n    private _animationSettings: AnimationSettings;\r\n    private _running: boolean;\r\n//#endregion\r\n//#region get, set\r\n    get canvas(): Canvas {\r\n        return this._canvas;\r\n    }\r\n    set canvas(canvas: Canvas) {\r\n        this._canvas = canvas;\r\n    }\r\n\r\n    get animationSettings(): AnimationSettings {\r\n        return this._animationSettings;\r\n    }\r\n    private set animationSettings(animationSettings: AnimationSettings) {\r\n        this._animationSettings = animationSettings;\r\n    }\r\n\r\n    get canvasSpace() {\r\n        return this._canvasSpace;\r\n    }\r\n    set canvasSpace(canvasSpace: CanvasSpace) {\r\n        this._canvasSpace = canvasSpace;\r\n    }\r\n\r\n    get running() {\r\n        return this._running;\r\n    }\r\n    set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    // additional getters\r\n    get simulationState(): ObjectState[] {\r\n        return this.gravityAnimationController.currentSimulationState;\r\n    }\r\n    get currentZoom(): number {\r\n        return this.canvasSpace.currentZoom;\r\n    }\r\n    get width(): number {\r\n        return this.canvas.visibleCanvas.width;\r\n    }\r\n    get height(): number {\r\n        return this.canvas.visibleCanvas.height;\r\n    }\r\n        \r\n//#endregion\r\n    constructor(canvas: Canvas, private gravityAnimationController: GravityAnimationController) {\r\n        this._animationSettings = { frameLength: 25, displayVectors: true, tracePaths: true };\r\n        this._canvas = canvas;\r\n        this._canvasSpace = {origin: new Vector2D(0, 0), currentZoom: 1, orientationY: -1};\r\n        this._running = false;\r\n    }\r\n    public initialize(width: number, height: number, animationSettings: UIAnimationSettings) {\r\n        this.canvas.visibleCanvas.width = width;\r\n        this.canvas.visibleCanvas.height = height;\r\n\r\n        // REFACTOR ME: apply settings after initialization\r\n        this.animationSettings.displayVectors = animationSettings.displayVectors;\r\n        \r\n        // offscreenCanvas = new OffscreenCanvas(visibleCanvas.clientWidth, visibleCanvas.clientHeight);\r\n        // offscreenCanvasCtx = offscreenCanvas.getContext(\"2d\")!;\r\n    }\r\n    public run() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n        const loop = () => {\r\n            if (this.running) {\r\n                setTimeout(loop, this.animationSettings.frameLength);\r\n                this.redrawSimulationState(this.simulationState, this.animationSettings);\r\n                this.gravityAnimationController.updateStatusBarSimulationMessages();\r\n            }\r\n        };\r\n        loop();\r\n    }\r\n    public stop() {\r\n        this.running = false;\r\n    }\r\n    public redrawIfPaused() {\r\n        if (!this.running) {\r\n            this.redrawSimulationState(this.simulationState, this.animationSettings);\r\n        }\r\n    }\r\n    private drawBodies(objectStates: ObjectState[]) {\r\n        objectStates.forEach(object => {\r\n            this.drawBody(object.body, tfm.pointFromSimulationSpaceToCanvasSpace(object.position, this.canvasSpace));\r\n        });\r\n    }\r\n    private drawBody(body: Body2d, position: Vector2D) {\r\n        let visibleRadius = Math.max(body.radius / this.currentZoom, MIN_DISPLAYED_RADIUS);\r\n        this.canvas.drawCircle(position, visibleRadius, body.color);\r\n    }\r\n    private redrawSimulationState(objectStates: ObjectState[], animationSettings: AnimationSettings) {\r\n        this.canvas.clear();\r\n        this.canvas.fillCanvas(BACKGROUND_COLOR);\r\n        this.drawBodies(objectStates);\r\n        if (animationSettings.displayVectors) {\r\n            this.drawVectors(objectStates);\r\n        }\r\n    }\r\n    private drawVectors(objectStates: ObjectState[]) {\r\n        objectStates.forEach(objectState => {\r\n            const positionOnCanvas = tfm.pointFromSimulationSpaceToCanvasSpace(objectState.position, this.canvasSpace);\r\n            const accelerationOnCanvas = tfm.directionFromSimulationSpaceToCanvasSpace(objectState.acceleration, this.canvasSpace);\r\n            const velocityOnCanvas = tfm.directionFromSimulationSpaceToCanvasSpace(objectState.velocity, this.canvasSpace);\r\n            \r\n            this.canvas.drawVector(positionOnCanvas, accelerationOnCanvas, VECTOR_ACC_COLOR);\r\n            this.canvas.drawVector(positionOnCanvas, velocityOnCanvas, VECTOR_VEL_COLOR);\r\n        });\r\n    }\r\n    public setDisplayVectors(display: boolean) {\r\n        this.animationSettings.displayVectors = display;\r\n        this.redrawIfPaused();\r\n    }\r\n    public resizeCanvas(width: number, height: number) {\r\n        this.canvas.resize(width, height);\r\n        this.redrawIfPaused();\r\n    }\r\n    public setCanvasView(origin: Vector2D, zoom: number) { \r\n        this.setOrigin(origin);\r\n        this.setZoom(zoom);\r\n        this.gravityAnimationController.updateStatusBarAnimationInfo();\r\n        this.redrawIfPaused();\r\n    }\r\n    private moveCanvas(displacement: { x: number; y: number }) {\r\n        this.moveOrigin(displacement);\r\n        this.redrawIfPaused();\r\n    }\r\n    public scroll(displacement: { x: number; y: number }) {\r\n        this.moveCanvas(displacement);\r\n    }\r\n    /**\r\n     * Origin {x:0,y:0} is at the top-left\r\n     */\r\n    private setOrigin(newOrigin: Vector2D) {\r\n        this.canvasSpace.origin = newOrigin;\r\n    }\r\n    private moveOrigin(displacement: { x: number, y: number}) {\r\n        const originPosition = this.canvasSpace.origin;\r\n        const newOrigin = originPosition.add(displacement);\r\n        this.setOrigin(newOrigin);\r\n    }\r\n    /**\r\n     * Zoom is measured in simulationUnits (meter) per canvasUnit (pixel)\r\n     * @param zoomCenter this point stays fixed while zooming\r\n     * @param zoomStep the change of meter per pixel\r\n     * @returns the new zoom level\r\n     */\r\n    public zoomOut(zoomCenter: Vector2D, zoomStep: number): number {\r\n        if (this.currentZoom >= MAX_ZOOM) { \r\n            return this.currentZoom; \r\n        }\r\n\r\n        let newZoom = this.currentZoom + zoomStep;\r\n        if(newZoom > MAX_ZOOM) {\r\n            newZoom = MAX_ZOOM;\r\n            zoomStep = MAX_ZOOM - this.canvasSpace.currentZoom;\r\n        }\r\n        \r\n        const shiftOrigin: Vector2D = zoomCenter.scale(zoomStep);\r\n        this.moveOrigin(shiftOrigin.hadamardProduct({x: -1, y: 1}));\r\n        this.canvasSpace.currentZoom = newZoom;\r\n\r\n        this.redrawIfPaused();\r\n\r\n        return newZoom;\r\n    }\r\n    /**\r\n     * Zoom is measured in simulationUnits (meter) per canvasUnit (pixel)\r\n     * @param zoomCenter this point stays fixed while zooming\r\n     * @param zoomStep the change in meter per pixel\r\n     * @returns the new zoom level\r\n     */\r\n    public zoomIn(zoomCenter: Vector2D, zoomStep: number): number {\r\n        if (this.currentZoom <= MIN_ZOOM) { \r\n            return this.currentZoom; \r\n        }\r\n\r\n        let newZoom = this.canvasSpace.currentZoom - zoomStep;\r\n        if (newZoom < MIN_ZOOM) {\r\n            newZoom = MIN_ZOOM;\r\n            zoomStep = this.canvasSpace.currentZoom - MIN_ZOOM;\r\n        }\r\n        \r\n        const shiftOrigin: Vector2D = zoomCenter.scale(zoomStep);\r\n        this.moveOrigin(shiftOrigin.hadamardProduct({x: 1, y: -1}));\r\n        this.canvasSpace.currentZoom = newZoom;\r\n\r\n        this.redrawIfPaused();\r\n\r\n        return newZoom;\r\n    }\r\n    private setZoom(newZoom: number) {\r\n        newZoom = util.clamp(newZoom, MIN_ZOOM, MAX_ZOOM);\r\n        this.canvasSpace.currentZoom = newZoom;\r\n        \r\n        this.redrawIfPaused();\r\n    }\r\n    public zoomToFactor(factor: number, zoomCenter?: Vector2D): number {\r\n        if (factor <= 0) return this.currentZoom;\r\n        \r\n        if (!zoomCenter) {\r\n            zoomCenter = new Vector2D(this.width / 2, this.height / 2);\r\n        }\r\n\r\n        const oldZoom = this.currentZoom;\r\n        const newZoom = oldZoom * factor;\r\n        const zoomDelta = newZoom - oldZoom;\r\n\r\n        this.gravityAnimationController.updateStatusBarAnimationInfo();\r\n\r\n        if (zoomDelta > 0) {\r\n            return this.zoomIn(zoomCenter, zoomDelta);\r\n        } else if (zoomDelta < 0) {\r\n            return this.zoomOut(zoomCenter, -zoomDelta);\r\n        } else {\r\n            return oldZoom;\r\n        }\r\n\r\n    }\r\n\r\n\r\n}","import { Canvas } from \"../animation/canvas\";\r\nimport { Body2d, Simulation } from \"./gravity\";\r\nimport { ObjectState } from \"../const/types\";\r\nimport { Vector2D } from \"../util/vector2d\";\r\nimport { App } from \"../app/app\";\r\nimport { DEFAULT_SCROLL_RATE, DEFAULT_ZOOM_FACTOR } from \"../const/const\";\r\nimport { InteractionManager } from \"../interaction/interaction-manager\";\r\nimport { AnimationController } from \"../animation/animation-controller\";\r\n\r\nexport class GravityAnimationController {\r\n//#region properties\r\n    private _simulation: Simulation;\r\n    private _interaction: InteractionManager;\r\n    private _animation: AnimationController;\r\n    private _running: boolean;\r\n//#endregion\r\n//#region get, set\r\n    get simulation(): Simulation {\r\n        return this._simulation;\r\n    }\r\n    \r\n    get animation(): AnimationController {\r\n        return this._animation;\r\n    }\r\n    \r\n    get running(): boolean {\r\n        return this._running;\r\n    }\r\n    private set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n// additional getters\r\n    get tickCount(): number {\r\n        return this.simulation.tickCount;\r\n    }\r\n    get bodyCount(): number {\r\n        return this.simulation.simulationState.length;\r\n    }\r\n    get width(): number {\r\n        return this.animation.width;\r\n    }\r\n    get height(): number {\r\n        return this.animation.height;\r\n    }\r\n    get currentZoom(): number {\r\n        return this.animation.currentZoom;\r\n    }\r\n    get currentSimulationState(): ObjectState[] {\r\n        return this.simulation.simulationState;\r\n    }\r\n    get canvasSpace() {\r\n        return this.animation.canvasSpace;\r\n    }\r\n    get ui() {\r\n        return this.app.ui;\r\n    }\r\n//#endregion\r\n//#region initialization\r\n    constructor(private app: App, elementId: string = \"theCanvas\") {\r\n        const canvasElement: HTMLCanvasElement = document.getElementById(elementId) as HTMLCanvasElement;\r\n        if (!canvasElement) {\r\n            throw new Error(`Canvas element with id '${elementId}' not found.`);\r\n        }\r\n        const canvas = new Canvas(canvasElement);\r\n        this._simulation = new Simulation;\r\n        this._animation = new AnimationController(canvas, this);\r\n        this._interaction = new InteractionManager(canvas, this.app);\r\n        this._running = false;\r\n    }\r\n    public initialize(width: number, height: number) {\r\n        this.animation.initialize(width, height, this.ui.animationSettings);\r\n        this.initSimulation();\r\n    }\r\n    private initSimulation() {\r\n        this.simulation.collisionDetection = this.ui.collisionDetection;\r\n        this.simulation.elasticCollisions = this.ui.elasticCollisions;\r\n    }\r\n//#endregion\r\n\r\n//#region control methods\r\n    public run() {\r\n        if (!this.running) {\r\n            this.running = true;\r\n            this.simulation.run();\r\n            this.animation.run();\r\n        }\r\n    }\r\n    public stop() {\r\n        this.running = false;\r\n        this.simulation.pause();\r\n        this.animation.stop();\r\n    }\r\n    public toggle() {\r\n        if (this.running) {\r\n            this.stop();\r\n        } else {\r\n            this.run();\r\n        }\r\n    }\r\n    public reset() {\r\n        this.simulation.reset();\r\n        this.animation.redrawIfPaused();\r\n    }\r\n    public advanceOneTick() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.simulation.advanceTick();\r\n        this.animation.redrawIfPaused();\r\n    }\r\n//#endregion\r\n\r\n//#region interaction\r\n    public setDisplayVectors(displayVectors: boolean) {\r\n        this.animation.setDisplayVectors(displayVectors);\r\n    }\r\n    public setCollisionDetection(collisionDetection: boolean, elasticCollisions = false) {\r\n        this.simulation.collisionDetection = collisionDetection;\r\n        this.simulation.elasticCollisions = elasticCollisions;\r\n    }\r\n    public setElasticCollisions(elasticCollisions: boolean) {\r\n        this.simulation.elasticCollisions = elasticCollisions;\r\n    }\r\n    public updateStatusBarSimulationMessages() {\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public updateStatusBarAnimationInfo() {\r\n        this.ui.updateStatusBarAnimationInfo();\r\n    }\r\n    public addBody(body: Body2d, position: Vector2D, velocity: Vector2D = new Vector2D(0, 0)) {\r\n        this.simulation.addObject(body, position, velocity);        \r\n        this.animation.redrawIfPaused();\r\n    }\r\n    public setG(g: number) {\r\n        this.simulation.g = g;\r\n    }\r\n    public scrollInCanvasUnits(movementOnCanvas: Vector2D){\r\n        const movementInSimulationUnits = movementOnCanvas.scale(this.currentZoom);\r\n        this.animation.scroll({ x: -(movementInSimulationUnits.x), y: movementInSimulationUnits.y });\r\n    }\r\n    public scrollRight(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n        }\r\n        this.animation.scroll({x: distance, y: 0});\r\n    }\r\n    public scrollLeft(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"horizontal\"); // in simulationUnits\r\n        }\r\n        this.animation.scroll({x: -distance, y: 0});\r\n    }\r\n    public scrollUp(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.animation.scroll({x: 0, y: distance});\r\n    }\r\n    public scrollDown(distance?: number) {\r\n        if (!distance) {\r\n            distance = this.scrollDistance(\"vertical\"); // in simulationUnits\r\n        }\r\n        this.animation.scroll({x: 0, y: -distance});\r\n    }\r\n    private scrollDistance(orientation: \"horizontal\" | \"vertical\", rate: number = DEFAULT_SCROLL_RATE): number {\r\n        switch (orientation) {\r\n            case \"horizontal\":\r\n                return this.width * rate * this.currentZoom;\r\n            case \"vertical\":\r\n                return this.height * rate * this.currentZoom;\r\n        }\r\n    }\r\n    public zoomToFactor(factor: number, zoomCenter: Vector2D): number {\r\n        return this.animation.zoomToFactor(factor, zoomCenter);\r\n    }\r\n    public zoomIn(\r\n        zoomCenter: Vector2D = new Vector2D(this.width / 2, this.height / 2),\r\n        factor: number = DEFAULT_ZOOM_FACTOR, \r\n    ): number {\r\n        const zoomStep = this.currentZoom * factor;\r\n        const newZoom = this.animation.zoomIn(zoomCenter, zoomStep);\r\n\r\n        return newZoom;\r\n    }\r\n    public zoomOut(\r\n        zoomCenter: Vector2D = new Vector2D(this.width / 2, this.height / 2),\r\n        factor: number = DEFAULT_ZOOM_FACTOR, \r\n    ): number {\r\n        const zoomStep = this.currentZoom * factor;\r\n        const newZoom = this.animation.zoomOut(zoomCenter, zoomStep);\r\n\r\n        return newZoom;\r\n    }\r\n    public resizeCanvas(width: number, height: number) {\r\n        this.animation.resizeCanvas(width, height);\r\n    }\r\n//#endregion\r\n}","import { UI } from \"../interaction/ui\";\r\nimport { GravityAnimationController } from \"../simulation/gravity-animation-controller\";\r\n\r\nexport class App {\r\n//#region properties\r\n    private _ui: UI;\r\n    private _gravityAnimationController: GravityAnimationController;\r\n//#endregion\r\n//#region get, set\r\n    get gravityAnimationController() {\r\n        return this._gravityAnimationController;\r\n    }\r\n    set gravityAnimationController(controller: GravityAnimationController) {\r\n        this._gravityAnimationController = controller;\r\n    }\r\n    get ui() {\r\n        return this._ui;\r\n    }\r\n//#endregion\r\n//#region initialize\r\n    constructor() {\r\n        this._gravityAnimationController = new GravityAnimationController(this);        \r\n        this._ui = new UI(this);\r\n        this.initialize();\r\n    }\r\n    private initialize() {\r\n        const width = window.innerWidth;\r\n        const height = window.innerHeight;\r\n        this.gravityAnimationController.initialize(width, height);\r\n        this.ui.initialize(width, height);\r\n    }\r\n//#endregion\r\n//#region control\r\n    public run() {\r\n        this.gravityAnimationController.run();\r\n        this.ui.simulationResumed();\r\n    }\r\n    public stop() {\r\n        this.gravityAnimationController.stop();\r\n        this.ui.simulationStopped();\r\n    }\r\n    public advanceOneTick() {\r\n        this.gravityAnimationController.advanceOneTick();\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public reset() {\r\n        this.gravityAnimationController.reset();\r\n        this.ui.updateStatusBarSimulationInfo();\r\n    }\r\n    public resizeCanvas(windowWidth: number, windowHeight: number) {\r\n        this.gravityAnimationController.resizeCanvas(windowWidth, windowHeight);\r\n        this.ui.updateStatusBarCanvasDimensions(windowWidth, windowHeight);\r\n    }\r\n}\r\n//#endregion\r\n","import { App } from \"../app/app\";\r\n\r\nlet app: App;\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", initialize);\r\nfunction initialize() {\r\n    app = new App();\r\n    registerEvents();\r\n\r\n    app.run();\r\n}\r\n\r\nfunction registerEvents() {\r\n    document.removeEventListener(\"DOMContentLoaded\", initialize);\r\n    window.addEventListener(\"resize\", windowResized);\r\n}\r\n\r\nfunction windowResized(this: Window, ev: UIEvent) {\r\n    let windowWidth = this.innerWidth;\r\n    let windowHeight = this.innerHeight;\r\n    app.resizeCanvas(windowWidth, windowHeight);\r\n}\r\n"],"names":["Vector2D","a","b","__publicField","vectors","result","previous","current","v","scalar","magnitude","array","p2","reflectionSurface","axis","dotAxis","projection","line1","line2","strict","p1","q1","q2","r","s","rCrossS","qMinusP","qmpCrossR","t0","t1","tMin","tMax","pointA","pointB","t","u","v1","v2","epsilon","isZero","value","DEFAULT_G","MIN_G","MAX_G","MIN_ZOOM","MAX_ZOOM","DEFAULT_ZOOM_FACTOR","DEFAULT_SCROLL_RATE","VECTOR_THICKNESS","VECTOR_ACC_COLOR","VECTOR_ACC_COLOR_NAME","VECTOR_VEL_COLOR","VECTOR_VEL_COLOR_NAME","MIN_DISPLAYED_RADIUS","BACKGROUND_COLOR","isNumeric","clamp","min","max","isInRange","getInputValue","input","inputElement","getInputNumber","inputValue","getAbsolutePointerPosition","ev","calculateVelocityBetweenPoints","toCoordinate","fromCoordinate","timeFrameInSeconds","twoDigitHex","massDependentColor","mass","mid","g","_Body2d","movable","color","radius","newMass","newRadius","affected","c","Body2d","Simulation","c.DEFAULT_G","objectState","running","tickCount","collisionDetection","elasticCollisions","c.MIN_G","c.MAX_G","bodyOrObject","position","velocity","index","runSimulationStep","forces","newAcceleration","j","forceOnI","forceOnJ","dt","i","objectStateI","objectStateJ","distance","netForceBetweenBodies","distanceIJ","index1","index2","state1","state2","totalMomentum","totalMass","resultingVelocity","changeObject","removeIndex","body1","body2","restitution","displacement","normalizedDisplacement","velocityAlongDisplacement","impulseScalar","deltaV1","deltaV2","objectState1","objectState2","normalDisplacement","targetDistance","totalMoveDistance","moveBody1","moveBody2","UI","app","bar","util.getInputNumber","width","height","displayVectors","checked","elasticChecked","newG","group","selected","btn","util.clamp","step","bodyCount","statusBarFieldIndex","currentZoom","message","fieldIndexOrId","append","element","Canvas","visibleCanvas","canvas","context","direction","endPosition","inBoundsLeft","inBoundsRight","inBoundsTop","inBoundsBottom","startPoint","endPoint","essentials.isInRange","TouchAction","MouseAction","ButtonState","MouseButtons","absoluteToCanvasPosition","absolutePosition","canvasRect","x","y","relativePosition","elementRect","pointFromCanvasSpaceToSimulationSpace","point","canvasSpace","pointFromSimulationSpaceToCanvasSpace","shifted","directionFromSimulationSpaceToCanvasSpace","InteractionManager","action","touches","pos","dist","currentMovement","currentTouchPosition","dx","dy","touchesMidpoint","touchesDistance","zoomFactor","zoomCenterCanvas","tfm.relativePosition","scroll","cursorPos","util.getAbsolutePointerPosition","posInCanvasSpace","tfm.absoluteToCanvasPosition","touch","positionVector","positionInSimSpace","tfm.pointFromCanvasSpaceToSimulationSpace","absPos","remaining","absolutePointerPosition","absoluteMousePosition","pointerId","first","second","midpoint","pointerPositionOnCanvas","bodyBeingAdded","mousePositionInSimSpace","vel","util.calculateVelocityBetweenPoints","AnimationController","gravityAnimationController","animationSettings","loop","objectStates","object","tfm.pointFromSimulationSpaceToCanvasSpace","body","visibleRadius","positionOnCanvas","accelerationOnCanvas","tfm.directionFromSimulationSpaceToCanvasSpace","velocityOnCanvas","display","origin","zoom","newOrigin","zoomCenter","zoomStep","newZoom","shiftOrigin","factor","oldZoom","zoomDelta","GravityAnimationController","elementId","canvasElement","movementOnCanvas","movementInSimulationUnits","orientation","rate","App","controller","windowWidth","windowHeight","initialize","registerEvents","windowResized"],"mappings":"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"}