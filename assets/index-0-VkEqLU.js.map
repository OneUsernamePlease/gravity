{"version":3,"file":"index-0-VkEqLU.js","sources":["../../../MyPackages/tcellib-vectors/dist/Vector2D/vector2d.js","../../src/scripts/gravity.ts","../../src/scripts/essentials.ts","../../src/scripts/main.ts"],"sourcesContent":["export class Vector2D {\n    constructor(x, y) {\n        if (x === undefined) {\n            x = 0;\n        }\n        if (y === undefined) {\n            y = 0;\n        }\n        this.x = x;\n        this.y = y;\n    }\n    toString() {\n        return `x: ${this.x}, y: ${this.y}`;\n    }\n    static add(...vectors) {\n        return vectors.reduce((previous, current) => {\n            return { x: previous.x + current.x, y: previous.y + current.y };\n        }, { x: 0, y: 0 });\n    }\n    /**\n     * @returns v1 - v2\n     */\n    static subtract(v1, v2) {\n        return { x: v1.x - v2.x, y: v1.y - v2.y };\n    }\n    static scale(v, scalar) {\n        return { x: v.x * scalar, y: v.y * scalar };\n    }\n    static dotProduct(v1, v2) {\n        return v1.x * v2.x + v1.y * v2.y;\n    }\n    static magnitude(v) {\n        return Math.sqrt(v.x * v.x + v.y * v.y);\n    }\n    static normalize(v) {\n        const mag = this.magnitude(v);\n        return mag === 0 ? { x: 0, y: 0 } : this.scale(v, 1 / mag);\n    }\n    /**\n     * @param v1 Vector2D\n     * @param v2 Vector2D\n     * @returns Distance from v1 to v2\n     */\n    static distance(v1, v2) {\n        return Math.sqrt((v2.x - v1.x) ** 2 + (v2.y - v1.y) ** 2);\n    }\n    /**\n     * returns a vector pointing from v1 to v2\n     */\n    static displacementVector(v1, v2) {\n        return this.subtract(v2, v1);\n    }\n    static hadamardProduct(v1, v2) {\n        return { x: v1.x * v2.x, y: v1.y * v2.y };\n    }\n}\n","import { Vector2D } from \"tcellib-vectors\";\r\n\r\nexport class Body2d {\r\n    private _mass!: number;\r\n    private _radius!: number;\r\n    private _color!: string;\r\n    private _movable!: boolean;\r\n    static defaultDensity = 1;\r\n\r\n    // #region constructor, get, set\r\n    constructor(mass: number, movable?: boolean, color?: string, radius?: number)  {\r\n        this.mass = mass;\r\n        if (radius === undefined) { radius = this.defaultRadius(mass); }\r\n        this.radius = radius;\r\n        if (color === undefined) { color = \"white\"; }\r\n        this.color = color;\r\n        if (movable === undefined) { movable = true; }\r\n        this.movable = movable;     \r\n    }\r\n    public get mass() {\r\n        return this._mass;\r\n    }\r\n    public set mass(newMass: number) {\r\n        this._mass = newMass;\r\n    }\r\n    public get radius() {\r\n        return this._radius;\r\n    }\r\n    public set radius(newRadius: number) {\r\n        this._radius = newRadius;\r\n    }\r\n    public get movable() {\r\n        return this._movable;\r\n    }\r\n    public set movable(affected: boolean) {\r\n        this._movable = affected\r\n    }   \r\n    public get color() : string {\r\n        return this._color\r\n    }\r\n    public set color(c: string) {\r\n        if (!(CSS.supports(\"color\", c))) {\r\n            c = \"white\";\r\n        }\r\n        this._color = c;\r\n    } \r\n    // #endregion\r\n    /**\r\n     * sets the radius based on mass and density\r\n     */\r\n    public defaultRadius(mass?: number) {\r\n        if (mass === undefined) {\r\n            mass = this.mass;\r\n        }\r\n        return ((3 * mass)/(4 * Math.PI * Body2d.defaultDensity)) ** (1/3); \r\n    }\r\n}\r\nexport interface ObjectState {\r\n    body: Body2d, \r\n    position: Vector2D,\r\n    /**\r\n     * simulationUnits (meter?) per second\r\n     */\r\n    velocity: Vector2D,\r\n    acceleration: Vector2D\r\n}\r\nexport class Simulation {\r\n    private _objectStates: ObjectState[];\r\n    public _running: boolean;\r\n    public _tickCount: number;\r\n    private _tickLength: number;\r\n    private _collisionDetection: boolean;\r\n    private _elasticCollisions: boolean;\r\n    private _g: number; // gravitational constant\r\n    private readonly gravityLowerBounds: number = 1; // force calculations for distances lower than this number are skipped\r\n    constructor() { \r\n        this._objectStates = [];\r\n        this._running = false;\r\n        this._tickCount = 0;\r\n        this._tickLength = 10; // ms\r\n        this._collisionDetection = false;\r\n        this._elasticCollisions = false;\r\n        this._g = 50;\r\n    }\r\n    // #region get, set\r\n    public get objectStates() {\r\n        return this._objectStates;\r\n    }\r\n    public set objectStates(objectState: ObjectState[]) {\r\n        this._objectStates = objectState;\r\n    }\r\n    public get running() {\r\n        return this._running;\r\n    }\r\n    public set running(running: boolean) {\r\n        this._running = running;\r\n    }\r\n    public get tickCount() {\r\n        return this._tickCount;\r\n    }\r\n    public set tickCount(tickCount: number) {\r\n        this._tickCount = tickCount;\r\n    }\r\n    public get tickLength() {\r\n        return this._tickLength;\r\n    }\r\n    public set tickLength(t: number) {\r\n        this._tickLength = t;\r\n    }\r\n    public get collisionDetection() {\r\n        return this._collisionDetection;\r\n    }\r\n    public set collisionDetection(collisionDetection: boolean) {\r\n        this._collisionDetection = collisionDetection;\r\n    }\r\n    public get elasticCollisions() {\r\n        return this._elasticCollisions;\r\n    }\r\n    public set elasticCollisions(elasticCollisions: boolean) {\r\n        this._elasticCollisions = elasticCollisions;\r\n    }\r\n    public get g() {\r\n        return this._g;\r\n    }\r\n    public set g(g: number) {\r\n        this._g = g;\r\n    }\r\n// #endregion\r\n    public addObject(objectState: ObjectState): number {\r\n        if (!objectState.body.movable) {\r\n            objectState.velocity = new Vector2D(0, 0);\r\n        }\r\n        return this.objectStates.push(objectState);\r\n    }\r\n    public clearObjects() {\r\n        this.objectStates = [];\r\n    }\r\n    public removeFromObjectStates(i: number) {\r\n        this.objectStates.splice(i, 1);\r\n    }\r\n    public pause() {\r\n        this.running = false;\r\n    }\r\n    public nextState() {\r\n        // calculate new accelerations vectors and update objectStates accordingly\r\n        this.updateAccelerationVectors();\r\n        \r\n        // update position and velocity arising therefrom\r\n        this.objectStates.forEach(objectState => {\r\n            this.updateVelocityAndPosition(objectState)\r\n        });\r\n\r\n        if (this.collisionDetection) {\r\n            this.handleCollisions();\r\n        }\r\n        \r\n        this.tickCount++;\r\n    }\r\n    private updateAccelerationVectors() {\r\n        const forces: Map<number, Vector2D> = this.calculateForces();\r\n\r\n        this.objectStates.forEach((objectState, index) => {\r\n            const totalForceOnBody = forces.get(index);\r\n            let newAcceleration = (totalForceOnBody !== undefined) ? (totalForceOnBody) : (new Vector2D(0, 0));\r\n            newAcceleration = Vector2D.scale(newAcceleration, 1 / objectState.body.mass);\r\n            objectState.acceleration = newAcceleration;\r\n        });\r\n    }\r\n    private calculateForces() {\r\n        const forces: Map<number, Vector2D> = new Map();\r\n        \r\n        for (let i = 0; i < this.objectStates.length; i++) {\r\n            for (let j = i+1; j < this.objectStates.length; j++) {\r\n                const forceOnI = this.calculateForceBetweenBodies(i, j);\r\n                const forceOnJ = Vector2D.scale(forceOnI, -1);\r\n\r\n                forces.set(i, Vector2D.add(forces.get(i) || new Vector2D(0, 0), forceOnI));\r\n                forces.set(j, Vector2D.add(forces.get(j) || new Vector2D(0, 0), forceOnJ));\r\n            }\r\n        }\r\n        return forces;\r\n    }\r\n    /**\r\n     * Calculates the next **position** and **velocity** of the object in state, and updates state accordingly.\r\n     * @param state *ObjectState* containing the body\r\n     */\r\n    private updateVelocityAndPosition(objectState: ObjectState) {\r\n        const dt = this.tickLength / 1000;\r\n        if (!objectState.body.movable) { return; }\r\n        // update velocity based on acceleration: v = v + a * dt\r\n        objectState.velocity = Vector2D.add(objectState.velocity, Vector2D.scale(objectState.acceleration, dt));\r\n\r\n        // update position based on velocity: x = x + v * dt\r\n        objectState.position = Vector2D.add( objectState.position, Vector2D.scale(objectState.velocity, dt));\r\n    }\r\n    /**\r\n     * Calculates the force-vector between the bodies in objectStates at index [i] and [j]\r\n     * @returns a vector representing the force applied ***to*** body at ***objectStates[i]***\r\n     */\r\n    private calculateForceBetweenBodies(i: number, j: number): Vector2D {\r\n        const objectStateI = this.objectStates[i];\r\n        const objectStateJ = this.objectStates[j];\r\n\r\n        const distance = Vector2D.distance(objectStateI.position, objectStateJ.position);\r\n        if (distance < this.gravityLowerBounds || distance === 0) // if the bodies are too close, skip the calculation\r\n            { return new Vector2D(0, 0); } \r\n        const netForceBetweenBodies: number = this.g * ((objectStateI.body.mass * objectStateJ.body.mass)/(distance * distance));\r\n        const unitVectorIToJ = Vector2D.normalize(Vector2D.subtract(objectStateJ.position, objectStateI.position));\r\n        return Vector2D.scale(unitVectorIToJ, netForceBetweenBodies);\r\n    }\r\n    private handleCollisions() {\r\n        for (let i = 0; i < this.objectStates.length; i++) {\r\n            const objectStateI = this.objectStates[i];\r\n            // undefined, if objectStateI has been merged in a previous collision\r\n            if (objectStateI === undefined) {\r\n                continue;\r\n            }\r\n            for (let j = i+1; j < this.objectStates.length; j++) {\r\n                const objectStateJ = this.objectStates[j];\r\n                const distanceIJ = Vector2D.distance(objectStateI.position, objectStateJ.position);\r\n                const collision = distanceIJ <= objectStateI.body.radius + objectStateJ.body.radius;\r\n                if (collision) {\r\n                    if (distanceIJ <= objectStateI.body.radius || distanceIJ <= objectStateJ.body.radius) { \r\n                        this.mergeBodies(i, j);\r\n                    } else {\r\n                        if (this.elasticCollisions) {\r\n                            this.elasticCollision(objectStateI, objectStateJ);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * merges the two bodies into one (the one at index1), removes the body at index2 from objectStates\r\n     */\r\n    private mergeBodies(index1: number, index2: number) {\r\n        const state1: ObjectState = this.objectStates[index1];\r\n        const state2: ObjectState = this.objectStates[index2];\r\n        const totalMomentum = Vector2D.add(Vector2D.scale(state1.velocity, state1.body.mass), Vector2D.scale(state2.velocity, state2.body.mass));\r\n        const totalMass = state1.body.mass + state2.body.mass;\r\n        const resultingVelocity = Vector2D.scale(totalMomentum, 1 / totalMass);\r\n        let changeObject: ObjectState;\r\n        let removeIndex: number;\r\n\r\n        if (state2.body.mass > state1.body.mass) {\r\n            changeObject = state2;\r\n            removeIndex = index1;\r\n        } else {\r\n            changeObject = state1;\r\n            removeIndex = index2;\r\n        }\r\n\r\n        changeObject.velocity = resultingVelocity;\r\n        changeObject.body.mass = totalMass;\r\n        changeObject.body.radius = changeObject.body.defaultRadius();\r\n        changeObject.body.movable = (state1.body.movable && state2.body.movable);\r\n        if (!changeObject.body.movable) {\r\n            changeObject.velocity = {x: 0, y: 0};\r\n        }\r\n        this.removeFromObjectStates(removeIndex);\r\n    \r\n    }\r\n    /**\r\n    * @param restitution number between 0 (perfectly inelastic) and 1 (perfectly elastic)\r\n    */\r\n    private elasticCollision(body1: ObjectState, body2: ObjectState, restitution: number = 1) {\r\n        const lowerBounds = 1; // lower bounds for the distance between bodies\r\n        \r\n        // normal vector between the bodies\r\n        const displacement = Vector2D.displacementVector(body1.position, body2.position);\r\n        const distance = Vector2D.magnitude(displacement); \r\n        if (distance <= lowerBounds || distance === 0) { \r\n            return; \r\n        }\r\n        const normalizedDisplacement = Vector2D.scale(displacement, 1 / distance);\r\n\r\n        // relative velocity along the normalDisplacement\r\n        const relativeVelocity = Vector2D.subtract(body2.velocity, body1.velocity);\r\n        const velocityAlongDisplacement = Vector2D.dotProduct(relativeVelocity, normalizedDisplacement);\r\n\r\n        // if the bodies are moving apart, do nothing\r\n        if (velocityAlongDisplacement > 0) { return; }\r\n\r\n        // impulseScalar = change in momentum as scalar\r\n        const impulseScalar = -(1 + restitution) * velocityAlongDisplacement / (body1.body.mass + body2.body.mass);\r\n\r\n        // update velocities based on the impulse scalar\r\n        const deltaV1 = Vector2D.scale(normalizedDisplacement, impulseScalar * body2.body.mass);\r\n        const deltaV2 = Vector2D.scale(normalizedDisplacement, impulseScalar * body1.body.mass);\r\n\r\n        body1.velocity = Vector2D.subtract(body1.velocity, deltaV1);\r\n        body2.velocity = Vector2D.add(body2.velocity, deltaV2);\r\n    }\r\n    public run() {\r\n        if (this.running) {\r\n            return;\r\n        }\r\n        this.running = true;\r\n\r\n        const runSimulationStep = () => {\r\n            if (this.running) {\r\n                setTimeout(runSimulationStep, this.tickLength);\r\n                this.nextState();\r\n            }\r\n        };\r\n        runSimulationStep();\r\n    }\r\n}\r\n","\r\n    /*\r\n    Just Some functions\r\n    (hopefully moderately helpful)\r\n    */\r\n    \r\n    //#region math stuff\r\n    /**\r\n     * empty string is NOT considered numeric\r\n     * @param s the string to be examined\r\n     * @returns true if s is a valid number, returns false otherwise\r\n     */\r\n    export function isNumeric(s: string): boolean {\r\n        s = s.trim();\r\n        return (!isNaN(+s)) && s.length !== 0;\r\n    }\r\n    /**\r\n     * @returns \"\", if d is a non-numeric string\r\n     */\r\n    export function decimalToHex(d: string | number): string {\r\n        if (typeof(d) === \"string\")  {\r\n            if (isNumeric(d)) {\r\n                d = parseFloat(d);\r\n            } else {\r\n                return \"\";\r\n            }\r\n        }\r\n        return d.toString(16);\r\n    }\r\n    /**\r\n     * converts a hexadecimal-number-string to a decimal number and returns it\r\n     * @returns 0 if hex is not a valid hexadecimal number\r\n     */\r\n    export function hexToDecimal(hex: string): number {\r\n        const prefix = \"0x\"\r\n        if (!(hex.startsWith(prefix))) {\r\n            hex = prefix + hex;\r\n        }\r\n        const num: number = Number(hex);\r\n        const valid = !isNaN(num);\r\n        return valid ? num : 0;\r\n    }\r\n    /**\r\n     * ensures min <= n <= max (Inclusive!)\r\n     * @param n number to test against upper and lower bounds\r\n     * @param min the lowest allowed value for n\r\n     * @param max the highest allowed value for n\r\n     * @returns n if n satisfies min <= n <= max, otherwise min or max are returned\r\n     */\r\n    export function ensureNumberInRange(n: number, min: number, max: number): number {\r\n        return Math.max(min, Math.min(n, max))\r\n    }\r\n    //#endregion\r\n    \r\n    //#region string stuff\r\n    /**\r\n     * Removes all occurrences of charToRemove from the beginning of str\r\n     * @param str the string to be modified\r\n     * @param charToRemove ***optional*** If no value is provided the first character of str is used.\r\n     */\r\n    export function removeLeadingChar(str: string, charToRemove?: string): string {\r\n        if (str.length < 1) { return \"\"; }\r\n        if (charToRemove === undefined) {\r\n            charToRemove = str[0];\r\n        }\r\n\r\n        while (str.startsWith(charToRemove)) {\r\n            str = str.slice(charToRemove.length);\r\n        }\r\n        return str;\r\n    }\r\n    //#endregion\r\n\r\n    //#region input stuff\r\n    export function getInputValue(inputElement: HTMLInputElement): string \r\n    export function getInputValue(inputId: string): string \r\n    export function getInputValue(input: string | HTMLInputElement): string {\r\n        let inputElement: HTMLInputElement;\r\n        if (typeof input === \"string\") {\r\n            inputElement = <HTMLInputElement>document.getElementById(input);\r\n        } else {\r\n            inputElement = input;\r\n        }\r\n        return inputElement.value.trim();\r\n    }\r\n    /**\r\n     * @param input an HTMLInputElement, or the id for the Element\r\n     * @returns element's value attribute; 0 if value is not numeric\r\n     */\r\n    export function getInputNumber(input: string | HTMLInputElement): number {\r\n        let inputValue: string\r\n        if (typeof input === \"string\") {\r\n            inputValue = getInputValue(input);\r\n        } else {\r\n            inputValue = getInputValue(input);\r\n        }\r\n        return isNumeric(inputValue) ? +inputValue : 0;\r\n    }\r\n    /**\r\n     * @param inputId id for a checkable input (radioButton, checkbox)\r\n     * @returns true if checked, false otherwise\r\n     */\r\n    export function isChecked(inputElement: HTMLInputElement): boolean\r\n    export function isChecked(inputId: string): boolean\r\n    export function isChecked(input: string | HTMLInputElement): boolean {\r\n        let checkbox: HTMLInputElement;\r\n        if (typeof input === \"string\") {\r\n            checkbox = document.getElementById(input) as HTMLInputElement;\r\n        } else {\r\n            checkbox = input;\r\n        }\r\n        return checkbox ? checkbox.checked : false;\r\n    }\r\n    //#endregion","import { InferCustomEventPayload } from \"vite\";\r\nimport { Body2d, Simulation } from \"./gravity\";\r\nimport { Vector2D } from \"tcellib-vectors\";\r\nimport * as tsEssentials from \"./essentials\";\r\n\r\ninterface CanvasSpace { \r\n    // use this to transform simulationSpace to canvasSpace and back\r\n    origin: Vector2D, // the canvas' origin in simulation space\r\n    zoomFactor: number, // simulationUnits (meter) per canvasUnit\r\n    orientationY: number; // in practice this is -1, as the y-axis of the canvas is in the opposite direction of the simulation\r\n}\r\nenum CanvasClickAction {\r\n    None = 0,\r\n    AddBody = 1,\r\n    ScrollCanvas = 2,\r\n}\r\nenum MouseBtnState {\r\n    Up = 0,\r\n    Down = 1,\r\n}\r\n\r\n// let offscreenCanvas: OffscreenCanvas; // use this in a worker thread to render or draw on, then transfer content to the visible html-canvas\r\nlet visibleCanvas: HTMLCanvasElement;\r\n// let offscreenCanvasCtx: OffscreenCanvasRenderingContext2D;\r\nlet visibleCanvasContext: CanvasRenderingContext2D;\r\nlet statusBar: { fields: HTMLElement[] } = { fields: [] };\r\nlet simulation: Simulation;\r\nlet canvasSpace: CanvasSpace;\r\nlet frameLength = 25; // ms\r\nlet animationRunning = false; // set to true while the sim is running\r\nlet zoomStep = 1; // simUnits that get added to or subtracted from one canvasUnit in a zoom steps\r\n\r\n// when scrolling, canvas is moved by this percentage of its height/width in the corresponding direction\r\nlet defaultScrollRate = 0.1;\r\n\r\nlet selectedMassInput: number;\r\nlet tracePaths = false;\r\nlet displayVectors: boolean;\r\nlet canvasLMouseState: MouseBtnState = MouseBtnState.Up;\r\nlet mainMouseBtnLastCanvasPosition: Vector2D = new Vector2D (0, 0); // the position on the canvas, where the mouse's main button's last down-event happened\r\nlet selectedCanvasClickAction: string;\r\n// #region page stuff\r\ndocument.addEventListener(\"DOMContentLoaded\", initialize);\r\nfunction initialize() {\r\n    initStatusBar();\r\n    registerEvents();\r\n    initCanvas(1280, 720);\r\n    canvasSpace = {origin: {x: 0, y: 0}, zoomFactor: 1, orientationY: -1};\r\n    simulation = new Simulation();\r\n    displayVectors = tsEssentials.isChecked(\"cbxDisplayVectors\");\r\n    selectedMassInput = tsEssentials.getInputNumber(\"massInput\");\r\n    (<HTMLInputElement>document.getElementById(\"massInput\")!).step = calculateMassInputStep();\r\n    selectedCanvasClickAction = (document.querySelector('input[name=\"cvsRadioBtnMouseAction\"]:checked') as HTMLInputElement).value;\r\n    simulation.collisionDetection = tsEssentials.isChecked(\"cbxCollisions\");\r\n    simulation.elasticCollisions = tsEssentials.isChecked(\"cbxElasticCollisions\");\r\n    (<HTMLInputElement>document.getElementById(\"cbxElasticCollisions\")).disabled = !simulation.collisionDetection;\r\n    document.removeEventListener(\"DOMContentLoaded\", initialize);\r\n}\r\nfunction registerEvents() {\r\n    document.getElementById(\"cvsBtnToggleSim\")?.addEventListener(\"click\", toggleSimulation);\r\n    document.getElementById(\"cvsBtnNextStep\")?.addEventListener(\"click\", advanceSimulationState);\r\n    document.getElementById(\"cvsBtnResetSim\")?.addEventListener(\"click\", resetSimulation);\r\n    document.getElementById(\"cvsBtnZoomOut\")?.addEventListener(\"click\", zoomOut);\r\n    document.getElementById(\"cvsBtnZoomIn\")?.addEventListener(\"click\", zoomIn);\r\n    document.getElementById(\"cvsBtnScrollLeft\")?.addEventListener(\"click\", scrollLeft);\r\n    document.getElementById(\"cvsBtnScrollRight\")?.addEventListener(\"click\", scrollRight);\r\n    document.getElementById(\"cvsBtnScrollUp\")?.addEventListener(\"click\", scrollUp);\r\n    document.getElementById(\"cvsBtnScrollDown\")?.addEventListener(\"click\", scrollDown);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"mousedown\", cvsMouseDownHandler);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"mouseup\", cvsMouseUpHandler);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"mouseout\", cvsMouseOutHandler);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"mousemove\", cvsMouseMoveHandler);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"touchstart\", cvsTouchStartHandler);\r\n    document.getElementById(\"theCanvas\")?.addEventListener(\"touchend\", cvsTouchEndHandler);\r\n    document.getElementById(\"massInput\")?.addEventListener(\"change\", massInputChangeHandler);\r\n    document.getElementById(\"cbxDisplayVectors\")?.addEventListener(\"change\", cbxDisplayVectorsChangeHandler);\r\n    document.getElementById(\"cbxCollisions\")?.addEventListener(\"change\", cbxCollisionsChangeHandler);\r\n    document.getElementById(\"cbxElasticCollisions\")?.addEventListener(\"change\", cbxElasticCollisionsChangeHandler);\r\n    document.querySelectorAll('input[name=\"cvsRadioBtnMouseAction\"]').forEach((radioButton) => {\r\n        radioButton.addEventListener('change', radioBtnMouseActionChangeHandler);\r\n      });\r\n}\r\nfunction massInputChangeHandler(this: HTMLElement) {\r\n    const element = this as HTMLInputElement;\r\n    const inputValue = element.value;\r\n    selectedMassInput = tsEssentials.isNumeric(inputValue) ? +inputValue : 0;\r\n    element.step = calculateMassInputStep(); // step = 10% of input value, round down to nearest power of 10\r\n}\r\nfunction cbxCollisionsChangeHandler(event: Event) {\r\n    const checked = tsEssentials.isChecked(event.target as HTMLInputElement);\r\n    const cbxElastic: HTMLInputElement = <HTMLInputElement>document.getElementById(\"cbxElasticCollisions\");\r\n    const elasticChecked = tsEssentials.isChecked(cbxElastic);\r\n    simulation.collisionDetection = checked;\r\n    simulation.elasticCollisions = elasticChecked;\r\n\r\n    cbxElastic.disabled = !checked;\r\n}\r\nfunction cbxElasticCollisionsChangeHandler(event: Event) {\r\n    const checked = tsEssentials.isChecked(event.target as HTMLInputElement);\r\n    simulation.elasticCollisions = checked;\r\n}\r\nfunction cbxDisplayVectorsChangeHandler(event: Event) {\r\n    const checkbox = event.target as HTMLInputElement;\r\n    displayVectors = checkbox ? checkbox.checked : false;\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\nfunction radioBtnMouseActionChangeHandler(event: Event): void {\r\n    const target = event.target as HTMLInputElement;\r\n    if (target && target.type === 'radio') {\r\n      selectedCanvasClickAction = target.value;\r\n    }\r\n}\r\nfunction cvsTouchStartHandler(this: HTMLElement, ev: TouchEvent) {\r\n    canvasLMouseState = MouseBtnState.Down;\r\n    const touchPosition = getCanvasTouchPosition(ev);\r\n\r\n    switch (CanvasClickAction[selectedCanvasClickAction as keyof typeof CanvasClickAction]) {\r\n        case CanvasClickAction.None:\r\n            console.log(touchPosition.toString());\r\n            break;\r\n        case CanvasClickAction.AddBody:\r\n            ev.preventDefault();\r\n            mainMouseBtnLastCanvasPosition = touchPosition;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\nfunction cvsTouchEndHandler(this: HTMLElement, ev: TouchEvent) {\r\n    canvasLMouseState = MouseBtnState.Up;\r\n    const touchPosition = getCanvasTouchEndPosition(ev);\r\n\r\n    switch (CanvasClickAction[selectedCanvasClickAction as keyof typeof CanvasClickAction]) {\r\n        case CanvasClickAction.None:\r\n            break;\r\n        case CanvasClickAction.AddBody:\r\n            const body: Body2d = body2dFromInputs();\r\n            if (body.mass <= 0) { break; }\r\n            const vel: Vector2D = calculateVelocityBetweenPoints(pointInCanvasSpaceToSimulationSpace(mainMouseBtnLastCanvasPosition), pointInCanvasSpaceToSimulationSpace(touchPosition));\r\n            addBodyToSimulation(body, pointInCanvasSpaceToSimulationSpace(touchPosition), vel);\r\n            setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\nfunction cvsMouseDownHandler(this: HTMLElement, ev: MouseEvent) {\r\n    if (ev.button !== 0) {\r\n        return; // do nothing if a button other than the main mouse button is clicked\r\n    }\r\n    canvasLMouseState = MouseBtnState.Down;\r\n    const mousePosition: Vector2D = getCanvasMousePosition(ev);\r\n    log(\"canvasMouseDownHandler:\" + MouseBtnState[canvasLMouseState] + \" - at Position: \" + mousePosition.toString());\r\n\r\n    switch (CanvasClickAction[selectedCanvasClickAction as keyof typeof CanvasClickAction]) {\r\n        case CanvasClickAction.None:  \r\n            break;\r\n        case CanvasClickAction.AddBody:\r\n            mainMouseBtnLastCanvasPosition = mousePosition;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n}\r\nfunction cvsMouseUpHandler(this: HTMLElement, ev: MouseEvent) {\r\n    if (ev.button !== 0 || canvasLMouseState === MouseBtnState.Up) {\r\n        return; // only the main mouse button matters, and only if the click was initiated inside the canvas\r\n    }\r\n    canvasLMouseState = MouseBtnState.Up;\r\n    const mousePosition: Vector2D = getCanvasMousePosition(ev);\r\n    log(\"canvasMouseUpHandler:\" + MouseBtnState[canvasLMouseState] + \" - at Position: \" + mousePosition.toString());\r\n\r\n    switch (CanvasClickAction[selectedCanvasClickAction as keyof typeof CanvasClickAction]) {\r\n        case CanvasClickAction.None:\r\n            break;\r\n        case CanvasClickAction.AddBody:\r\n            const body: Body2d = body2dFromInputs();\r\n            if (body.mass <= 0) { break; }\r\n            const vel: Vector2D = calculateVelocityBetweenPoints(pointInCanvasSpaceToSimulationSpace(mainMouseBtnLastCanvasPosition), pointInCanvasSpaceToSimulationSpace(mousePosition));\r\n            addBodyToSimulation(body, pointInCanvasSpaceToSimulationSpace(mousePosition), vel);\r\n            setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\nfunction cvsMouseMoveHandler(this: HTMLElement, ev: MouseEvent) {\r\n    const mousePosition: Vector2D = getCanvasMousePosition(ev);\r\n    log(\"canvasMouseMoveHandler:\" + MouseBtnState[canvasLMouseState] + \" - at Position: \" + mousePosition.toString());\r\n    if (canvasLMouseState === MouseBtnState.Up) {\r\n        return;\r\n    }\r\n    // goal: display vector for a body that is currently being added\r\n    // or add body to simSpace as immovable, with the velocity from moving, then redraw everything\r\n}\r\nfunction cvsMouseOutHandler(this: HTMLElement, ev: MouseEvent) {\r\n    canvasLMouseState = MouseBtnState.Up;\r\n    // cancel an ongoing addBodyToSimulation\r\n    // ...\r\n    // redraw simState to get rid of the adding's velocity-vector\r\n}\r\nfunction getCanvasMousePosition(event: MouseEvent): Vector2D {\r\n    const rect = visibleCanvas.getBoundingClientRect();\r\n    const x = event.clientX - rect.left;\r\n    const y = event.clientY - rect.top;\r\n    return new Vector2D(x, y);\r\n}\r\nfunction getCanvasTouchPosition(event: TouchEvent): Vector2D {\r\n    const rect = visibleCanvas.getBoundingClientRect();\r\n    const touch = event.touches[0];\r\n    return new Vector2D(touch.clientX - rect.left, touch.clientY - rect.top)\r\n}\r\nfunction getCanvasTouchEndPosition(event: TouchEvent): Vector2D {\r\n    const rect = visibleCanvas.getBoundingClientRect();\r\n    const touch = event.changedTouches[0];\r\n    return new Vector2D(touch.clientX - rect.left, touch.clientY - rect.top)\r\n}\r\n/**\r\n * The step is equal to 10% of the input value, rounded down to the nearest power of 10.\r\n * @returns Step as a string. Step is always at least 1 or larger.\r\n */\r\nfunction calculateMassInputStep(): string {\r\n    let step = (10 ** (Math.floor(Math.log10(selectedMassInput)) - 1));\r\n    return step < 1 ? \"1\" : step.toString();\r\n}\r\nfunction initStatusBar() {\r\n    statusBar.fields;\r\n    const idBeginsWith = \"statusText\";\r\n    let i = 1;\r\n    let statusBarField = document.getElementById(idBeginsWith + i);\r\n    while (statusBarField !== null) {\r\n        statusBar.fields.push(statusBarField)\r\n        i++;\r\n        statusBarField = document.getElementById(idBeginsWith + i);\r\n    }\r\n}\r\nfunction body2dFromInputs(): Body2d {\r\n    const movable = tsEssentials.isChecked(\"cvsCbxBodyMovable\");\r\n    return new Body2d(selectedMassInput, movable);\r\n}\r\n/**\r\n * @param fieldIndexOrId number of field, starting at one. OR id of the field\r\n */\r\nfunction setStatusMessage(newMessage: string, fieldIndexOrId?: number | string, append: boolean = false) {\r\n    let element: HTMLElement;\r\n    if (typeof fieldIndexOrId === \"number\") {\r\n        element = statusBar.fields[fieldIndexOrId - 1];\r\n    } else if (typeof fieldIndexOrId === \"string\") {\r\n        element = document.getElementById(fieldIndexOrId)!;\r\n    } else {\r\n        element = statusBar.fields[0];\r\n    }\r\n    \r\n    if (append) {\r\n        element!.innerHTML += newMessage;\r\n    } else {\r\n        element!.innerHTML = newMessage;\r\n    }\r\n}\r\nfunction initCanvas(width: number, height: number) {\r\n    visibleCanvas = (document.getElementById(\"theCanvas\")) as HTMLCanvasElement;\r\n    visibleCanvas.width = width;\r\n    visibleCanvas.height = height;\r\n    visibleCanvasContext = visibleCanvas.getContext(\"2d\")!;\r\n    setStatusMessage(`Canvas dimension: ${width} * ${height}`, 5);\r\n    // offscreenCanvas = new OffscreenCanvas(visibleCanvas.clientWidth, visibleCanvas.clientHeight);\r\n    // offscreenCanvasCtx = offscreenCanvas.getContext(\"2d\")!;\r\n}\r\nfunction log(message: string) {\r\n    const timestamp = new Date();\r\n    const hours = timestamp.getHours().toString().padStart(2, '0');\r\n    const minutes = timestamp.getMinutes().toString().padStart(2, '0');\r\n    const seconds = timestamp.getSeconds().toString().padStart(2, '0');\r\n    const milliseconds = timestamp.getMilliseconds().toString().padStart(3, '0');\r\n\r\n    const formattedTimestamp = `${hours}:${minutes}:${seconds}.${milliseconds}`;\r\n    console.log(`[${formattedTimestamp}] ${message}`);\r\n}\r\n// #endregion\r\n// #region canvas and drawing stuff\r\n/**\r\n * @param position in canvas space\r\n * @param direction in canvas space\r\n */\r\nfunction drawVector(position: Vector2D, direction: Vector2D, color?: string) {\r\n    // optionally normalize the direction and scale later\r\n    if (color === undefined) { color = \"white\" }\r\n    let endPosition: Vector2D = Vector2D.add(position, direction);\r\n    visibleCanvasContext.beginPath();\r\n    visibleCanvasContext.lineWidth = 3;\r\n    visibleCanvasContext.strokeStyle = color;\r\n    visibleCanvasContext.moveTo(position.x, position.y);\r\n    visibleCanvasContext.lineTo(endPosition.x, endPosition.y);\r\n    visibleCanvasContext.stroke();\r\n}\r\n/**\r\n * draws a circular body at specified position, in specified color\r\n * @param body \r\n * @param position \r\n * @param color default white\r\n */\r\nfunction drawBody(body: Body2d, position: Vector2D) {\r\n    let visibleRadius = Math.max(body.radius / canvasSpace.zoomFactor, 1); // Minimum Radius of displayed body is one\r\n    visibleCanvasContext.beginPath();\r\n    visibleCanvasContext.arc(position.x, position.y, visibleRadius, 0, Math.PI * 2); // zF = m/cu; r...m -> r/zF -> (m)/\r\n    visibleCanvasContext.closePath();\r\n    visibleCanvasContext.fillStyle = body.color;\r\n    visibleCanvasContext.fill();\r\n}\r\nfunction drawBodies() {\r\n    const objects = simulation.objectStates;\r\n    objects.forEach(object => {\r\n        if (object !== null) {\r\n            drawBody(object.body, pointInSimulationSpaceToCanvasSpace(object.position));\r\n        }\r\n    });\r\n}\r\nfunction redrawSimulationState() {\r\n    visibleCanvasContext.clearRect(0, 0, visibleCanvas.width, visibleCanvas.height);\r\n    drawBodies();\r\n    if (displayVectors) {\r\n        drawVectors();\r\n    }\r\n}\r\nfunction drawVectors() {\r\n    simulation.objectStates.forEach(objectState => {\r\n        drawVector(pointInSimulationSpaceToCanvasSpace(objectState.position), directionInSimulationSpaceToCanvasSpace(objectState.acceleration), \"green\");\r\n        drawVector(pointInSimulationSpaceToCanvasSpace(objectState.position), directionInSimulationSpaceToCanvasSpace(objectState.velocity), \"red\");\r\n    });\r\n}\r\nfunction pointInSimulationSpaceToCanvasSpace(simVector: Vector2D): Vector2D {\r\n    // transformation:\r\n    // 1. shift (point in SimSpace - Origin of C in SimSpace)\r\n    // 2. flip (y axis point in opposite directions)\r\n    // 3. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const shifted: Vector2D = Vector2D.subtract(simVector, canvasSpace.origin);\r\n    const flipped: Vector2D = {x: shifted.x, y: shifted.y * -1}\r\n    const scaled: Vector2D = Vector2D.scale(flipped, 1/canvasSpace.zoomFactor);\r\n    return scaled;\r\n}\r\nfunction directionInSimulationSpaceToCanvasSpace(simVector: Vector2D): Vector2D {\r\n    // transformation:\r\n    // 1. flip (y axis are in opposite directions)\r\n    // 2. scale (result from 2 divided by Zoom in simulationUnits/canvasUnit)\r\n    const flipped: Vector2D = {x: simVector.x, y: simVector.y * -1}\r\n    const scaled: Vector2D = Vector2D.scale(flipped, 1/canvasSpace.zoomFactor);\r\n    return scaled;\r\n}\r\nfunction pointInCanvasSpaceToSimulationSpace(canvasVector: Vector2D): Vector2D {\r\n    // transformation:\r\n    // 1. scale (canvasVector * zoom in simulationUnits/canvasUnit)\r\n    // 2. flip (y axis are in opposite directions)\r\n    // 3. shift (scaledAndFlippedPoint + Origin of C in SimSpace)\r\n    let simulationVector: Vector2D;\r\n    simulationVector = Vector2D.add(Vector2D.hadamardProduct(Vector2D.scale(canvasVector, canvasSpace.zoomFactor), {x: 1, y: canvasSpace.orientationY}), canvasSpace.origin)\r\n    return simulationVector;\r\n}\r\n/**\r\n * Origin {x:0,y:0} is at the top-left\r\n */\r\nfunction setCanvasOrigin(newOrigin: Vector2D) {\r\n    canvasSpace.origin = newOrigin;\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\nfunction scrollRight() {\r\n    let scrollDistance = calculateScrollDistance(\"horizontal\"); // in simulationUnits\r\n    setCanvasOrigin({x: canvasSpace.origin.x + scrollDistance, y: canvasSpace.origin.y });\r\n}\r\nfunction scrollLeft() {\r\n    let scrollDistance = calculateScrollDistance(\"horizontal\"); // in simulationUnits\r\n    setCanvasOrigin({x: canvasSpace.origin.x - scrollDistance, y: canvasSpace.origin.y });\r\n}\r\nfunction scrollUp() {\r\n    let scrollDistance = calculateScrollDistance(\"vertical\"); // in simulationUnits\r\n    setCanvasOrigin({x: canvasSpace.origin.x, y: canvasSpace.origin.y + scrollDistance });\r\n}\r\nfunction scrollDown() {\r\n    let scrollDistance = calculateScrollDistance(\"vertical\"); // in simulationUnits\r\n    setCanvasOrigin({x: canvasSpace.origin.x, y: canvasSpace.origin.y - scrollDistance });\r\n}\r\n/**\r\n * \r\n * @param orientation \"horizontal\" | \"vertical\"\r\n * @param rate a number *0<rate<1* - the relative distance of the screen dimension (h/v) that one scroll step will move (ie. 0.1 will scroll 10% of the width/height in a horizontal/vertical direction)\r\n * @returns \r\n */\r\nfunction calculateScrollDistance(orientation: \"horizontal\" | \"vertical\", rate?: number): number {\r\n    if (rate === undefined) { rate = defaultScrollRate; }\r\n    switch (orientation) {\r\n        case \"horizontal\":\r\n            return visibleCanvas.width * rate * canvasSpace.zoomFactor;\r\n        case \"vertical\":\r\n            return visibleCanvas.height * rate * canvasSpace.zoomFactor;\r\n    }\r\n}\r\nfunction zoomOut() {\r\n    const zoomCenter: Vector2D = {x: visibleCanvas.width/2, y: visibleCanvas.height/2};\r\n    const newZoom = canvasSpace.zoomFactor + zoomStep;\r\n\r\n    let shiftOrigin: Vector2D = Vector2D.scale(zoomCenter, zoomStep); // zoom step here is really the difference in zoom change (zoomFactor now - zoomFactor before)\r\n\r\n    canvasSpace.origin = {x: canvasSpace.origin.x - shiftOrigin.x, y: canvasSpace.origin.y + shiftOrigin.y};\r\n    canvasSpace.zoomFactor = newZoom;\r\n\r\n    setStatusMessage(`Zoom: ${newZoom} (m per pixel)`, 4);\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\nfunction zoomIn() {\r\n    if (canvasSpace.zoomFactor <= 1) { return; }\r\n    let zoomCenter: Vector2D = {x: visibleCanvas.width/2, y: visibleCanvas.height/2};\r\n    let newZoom = canvasSpace.zoomFactor - zoomStep;\r\n\r\n    let shiftOrigin: Vector2D = Vector2D.scale(zoomCenter, zoomStep); // zoom step here is really the difference in zoom change (zoomFactor now - zoomFactor before)\r\n\r\n    canvasSpace.origin = {x: canvasSpace.origin.x + shiftOrigin.x, y: canvasSpace.origin.y - shiftOrigin.y};\r\n    canvasSpace.zoomFactor = newZoom;\r\n    \r\n    setStatusMessage(`Zoom: ${newZoom} (m per pixel)`, 4);\r\n    if (!animationRunning) {\r\n        redrawSimulationState();\r\n    }\r\n}\r\n// #endregion\r\n// #region simulation\r\n/**\r\n * Calculates and returns the velocity vector needed to get from *fromCoordinate* to *toCoordinate* in *timeFrameInSeconds* seconds\r\n * @param toCoordinate value in simulation space\r\n * @param fromCoordinate value in simulation space\r\n * @param timeFrameInSeconds *optional* defaults to one\r\n */\r\nfunction calculateVelocityBetweenPoints(toCoordinate: Vector2D, fromCoordinate: Vector2D, timeFrameInSeconds: number = 1): Vector2D {\r\n    if (timeFrameInSeconds <= 0) { timeFrameInSeconds = 1; }\r\n    let distance: Vector2D = Vector2D.subtract(toCoordinate, fromCoordinate);\r\n    return Vector2D.scale(distance, 1 / timeFrameInSeconds);\r\n}\r\nfunction toggleSimulation(this: HTMLElement, ev: MouseEvent) {\r\n    if (simulation.running) {\r\n        pauseSimulation();\r\n    } else {\r\n        resumeSimulation();\r\n    }\r\n}\r\nfunction advanceSimulationState() {\r\n    if (animationRunning) {\r\n        return;\r\n    }\r\n    simulation.nextState();\r\n    redrawSimulationState();\r\n    setStatusMessage(`Simulation Tick: ${simulation.tickCount}`, 2);\r\n    setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n}\r\nfunction resetSimulation() {\r\n    if (simulation.running) {\r\n        pauseSimulation();\r\n    }\r\n    simulation.clearObjects();\r\n    simulation.tickCount = 0;\r\n    redrawSimulationState();\r\n    setStatusMessage(`Simulation Tick: ${simulation.tickCount}`, 2);\r\n    setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n}\r\n/**\r\n * @param body \r\n * @param position in **SIMULATION SPACE**\r\n * @param velocity in **SIMULATION SPACE**\r\n * @param movable \r\n */\r\nfunction addBodyToSimulation(body?: Body2d, position?: Vector2D, velocity?: Vector2D, movable?: boolean) {\r\n    if (body === undefined) {\r\n        body = newBody();\r\n    }\r\n    if (position === undefined) {\r\n        position = {x: 0, y: 0};\r\n    }\r\n    if (velocity === undefined) {\r\n        velocity = {x: 0, y: 0};\r\n    }\r\n    if (movable !== undefined) {\r\n        body.movable = movable;\r\n    }\r\n    const objectState = {body: body, position: position, velocity: velocity, acceleration: {x: 0, y: 0}};\r\n\r\n    simulation.addObject(objectState);\r\n}\r\nfunction resumeSimulation() {\r\n    if (!simulation.running) {\r\n        simulation.run();\r\n        drawRunningSimulation();\r\n        setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n        document.getElementById(\"cvsBtnToggleSim\")!.innerHTML = \"Pause\";\r\n    }\r\n}\r\nfunction pauseSimulation() {\r\n    if (simulation.running) {\r\n        animationRunning = false;\r\n        simulation.pause();\r\n        document.getElementById(\"cvsBtnToggleSim\")!.innerHTML = \"Play\";\r\n    }\r\n}\r\nfunction drawRunningSimulation() {\r\n    if (animationRunning) {\r\n        return;\r\n    }\r\n    animationRunning = true;\r\n    const runDrawLoop = () => {\r\n        if (animationRunning) {\r\n            setTimeout(runDrawLoop, frameLength);\r\n            redrawSimulationState();\r\n            setStatusMessage(`Simulation Tick: ${simulation.tickCount}`, 2);\r\n            setStatusMessage(`Number of Bodies: ${simulation.objectStates.length}`, 1);\r\n            // log(\"Draw simulation step\");\r\n        }\r\n    };\r\n    runDrawLoop();\r\n}\r\nfunction newBody(): Body2d \r\nfunction newBody(mass: number, radius: number): Body2d \r\nfunction newBody(mass: number, radius?: number): Body2d \r\nfunction newBody(mass?: number, radius?: number): Body2d {\r\n    let body1: Body2d;\r\n    if (mass === undefined) {\r\n        body1 = new Body2d(rng(20, 200));    \r\n    } else if (radius === undefined) {\r\n        body1 = new Body2d(mass);\r\n    } else {\r\n        body1 = new Body2d(mass, true, \"white\", radius);\r\n    }\r\n    return body1;\r\n}\r\n// #endregion\r\n// #region other stuff\r\n/**\r\n * min and max included\r\n * @returns random number\r\n */\r\nfunction rng(min: number, max: number) {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n}\r\n\r\n// #endregion\r\n"],"names":["Vector2D","x","y","vectors","previous","current","v1","v2","v","scalar","mag","_Body2d","mass","movable","color","radius","__publicField","newMass","newRadius","affected","c","Body2d","Simulation","objectState","running","tickCount","collisionDetection","elasticCollisions","g","i","forces","index","totalForceOnBody","newAcceleration","j","forceOnI","forceOnJ","dt","objectStateI","objectStateJ","distance","netForceBetweenBodies","unitVectorIToJ","distanceIJ","index1","index2","state1","state2","totalMomentum","totalMass","resultingVelocity","changeObject","removeIndex","body1","body2","restitution","displacement","normalizedDisplacement","relativeVelocity","velocityAlongDisplacement","impulseScalar","deltaV1","deltaV2","runSimulationStep","isNumeric","s","getInputValue","input","inputElement","getInputNumber","inputValue","isChecked","checkbox","CanvasClickAction","MouseBtnState","visibleCanvas","visibleCanvasContext","statusBar","simulation","canvasSpace","frameLength","animationRunning","zoomStep","defaultScrollRate","selectedMassInput","displayVectors","canvasLMouseState","mainMouseBtnLastCanvasPosition","selectedCanvasClickAction","initialize","initStatusBar","registerEvents","initCanvas","tsEssentials.isChecked","tsEssentials.getInputNumber","calculateMassInputStep","_a","toggleSimulation","_b","advanceSimulationState","_c","resetSimulation","_d","zoomOut","_e","zoomIn","_f","scrollLeft","_g","scrollRight","_h","scrollUp","_i","scrollDown","_j","cvsMouseDownHandler","_k","cvsMouseUpHandler","_l","cvsMouseOutHandler","_m","cvsMouseMoveHandler","_n","cvsTouchStartHandler","_o","cvsTouchEndHandler","_p","massInputChangeHandler","_q","cbxDisplayVectorsChangeHandler","_r","cbxCollisionsChangeHandler","_s","cbxElasticCollisionsChangeHandler","radioButton","radioBtnMouseActionChangeHandler","element","tsEssentials.isNumeric","event","checked","cbxElastic","elasticChecked","redrawSimulationState","target","ev","touchPosition","getCanvasTouchPosition","getCanvasTouchEndPosition","body","body2dFromInputs","vel","calculateVelocityBetweenPoints","pointInCanvasSpaceToSimulationSpace","addBodyToSimulation","setStatusMessage","mousePosition","getCanvasMousePosition","log","rect","touch","step","idBeginsWith","statusBarField","newMessage","fieldIndexOrId","append","width","height","message","timestamp","hours","minutes","seconds","milliseconds","formattedTimestamp","drawVector","position","direction","endPosition","drawBody","visibleRadius","drawBodies","object","pointInSimulationSpaceToCanvasSpace","drawVectors","directionInSimulationSpaceToCanvasSpace","simVector","shifted","flipped","canvasVector","simulationVector","setCanvasOrigin","newOrigin","scrollDistance","calculateScrollDistance","orientation","rate","zoomCenter","newZoom","shiftOrigin","toCoordinate","fromCoordinate","timeFrameInSeconds","pauseSimulation","resumeSimulation","velocity","newBody","drawRunningSimulation","runDrawLoop","rng","min","max"],"mappings":"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"}