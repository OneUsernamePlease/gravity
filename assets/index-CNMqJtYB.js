var Y=Object.defineProperty;var W=(n,t,i)=>t in n?Y(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i;var c=(n,t,i)=>W(n,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();class a{constructor(t,i){c(this,"x");c(this,"y");typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t??0,this.y=i??0)}toString(){return`x: ${this.x}, y: ${this.y}`}add(...t){const i=t.reduce((e,s)=>({x:e.x+s.x,y:e.y+s.y}),{x:this.x,y:this.y});return new a(i.x,i.y)}subtract(t){return new a(this.x-t.x,this.y-t.y)}scale(t){return new a(this.x*t,this.y*t)}dotProduct(t){return this.x*t.x+this.y*t.y}magnitude(){return Math.hypot(this.x,this.y)}normalize(){const t=this.magnitude();return t===0?new a(0,0):this.scale(1/t)}distance(t){return Math.hypot(t.x-this.x,t.y-this.y)}displacementVector(t){return new a(t.x,t.y).subtract(this)}hadamardProduct(t){return new a(this.x*t.x,this.y*t.y)}normalVectors(){const t=[],i=this.normalize();return t.push(new a(-i.y,i.x)),t.push(new a(i.y,-i.x)),t}midpoint(t){return new a((this.x+t.x)/2,(this.y+t.y)/2)}reflect(t){t=t.normalize();const i=t.normalVectors()[0],e=this.dotProduct(i),s=i.scale(e).scale(2);return this.subtract(s)}static linesIntersecting(t,i,e=!1){const[s,o]=t,[r,u]=i,l=o.subtract(s),h=u.subtract(r),p=l.x*h.y-l.y*h.x,d=r.subtract(s),m=d.x*l.y-d.y*l.x;if(p===0){if(m===0){if(e){const B=r.subtract(s).dotProduct(l)/l.dotProduct(l),E=u.subtract(s).dotProduct(l)/l.dotProduct(l),y=Math.max(0,Math.min(B,E)),w=Math.min(1,Math.max(B,E));if(y<=w){const b=s.add(l.scale(y)),I=s.add(l.scale(w));return y===w?b:[b,I]}else return null}return[s,o]}return null}const x=(d.x*h.y-d.y*h.x)/p,S=(d.x*l.y-d.y*l.x)/p;return e&&(x<0||x>1||S<0||S>1)?null:s.add(l.scale(x))}static midpoint(t,i){return new a((t.x+i.x)/2,(t.y+i.y)/2)}static simpleLineIntersection(t,i){throw new Error("Method not implemented.")}static linesIntersectingButBetter(t,i,e=!1,s=1e-9){const[o,r]=t,[u,l]=i,h=r.subtract(o),p=l.subtract(u),d=h.x*p.y-h.y*p.x,m=u.subtract(o),x=m.x*h.y-m.y*h.x,S=y=>Math.abs(y)<s;if(S(d)){if(S(x)){if(e){const y=u.subtract(o).dotProduct(h)/h.dotProduct(h),w=l.subtract(o).dotProduct(h)/h.dotProduct(h),b=Math.max(0,Math.min(y,w)),I=Math.min(1,Math.max(y,w));if(b<=I){const U=o.add(h.scale(b)),q=o.add(h.scale(I));return S(b-I)?U:[U,q]}else return null}return[o,r]}return null}const M=(m.x*p.y-m.y*p.x)/d,B=(m.x*h.y-m.y*h.x)/d;return e&&(M<-s||M>1+s||B<-s||B>1+s)?null:o.add(h.scale(M))}}function H(n){return n=n.trim(),!isNaN(+n)&&n.length!==0}function X(n,t,i){return Math.max(t,Math.min(n,i))}function k(n,t,i){return n>=t&&n<=i}function J(n){let t;return typeof n=="string"?t=document.getElementById(n):t=n,t.value.trim()}function Z(n){const t=J(n);return H(t)?+t:0}function L(n){return{x:n.clientX,y:n.clientY}}function K(n,t,i=1){return i<=0&&(i=1),(n instanceof a?n:new a(n)).subtract(t).scale(1/i)}function P(n){return n.toString(16).padStart(2,"0")}const Q=50,j=-10,tt=100,V=.05,A=100,F=.075,it=.1,et=1,st=.75,nt="#222222ff",_=new Map().set("acceleration",{hex:"#20ff20ff",name:"Green"}).set("velocity",{hex:"#ffd700ff",name:"Yellow"});class ot{constructor(t){c(this,"statusBar");c(this,"resetButton");c(this,"playPauseButton");c(this,"stepButton");c(this,"repositoryLink");c(this,"zoomInButton");c(this,"zoomOutButton");c(this,"scrollUpButton");c(this,"scrollDownButton");c(this,"scrollLeftButton");c(this,"scrollRightButton");c(this,"displayVectorsCheckbox");c(this,"collisionDetectionCheckbox");c(this,"elasticCollisionsCheckbox");c(this,"gravitationalConstantInput");c(this,"gravitationalConstantRangeInput");c(this,"clickAction");c(this,"massInput");c(this,"movableCheckbox");this.app=t,this.resetButton=document.getElementById("btnResetSim"),this.playPauseButton=document.getElementById("btnToggleSim"),this.stepButton=document.getElementById("btnNextStep"),this.repositoryLink=document.getElementById("repoLink"),this.zoomInButton=document.getElementById("btnZoomIn"),this.zoomOutButton=document.getElementById("btnZoomOut"),this.scrollUpButton=document.getElementById("btnScrollUp"),this.scrollDownButton=document.getElementById("btnScrollDown"),this.scrollLeftButton=document.getElementById("btnScrollLeft"),this.scrollRightButton=document.getElementById("btnScrollRight"),this.displayVectorsCheckbox=document.getElementById("cbxDisplayVectors"),this.collisionDetectionCheckbox=document.getElementById("cbxCollisions"),this.elasticCollisionsCheckbox=document.getElementById("cbxElasticCollisions"),this.gravitationalConstantInput=document.getElementById("numberG"),this.gravitationalConstantRangeInput=document.getElementById("rangeG"),this.massInput=document.getElementById("massInput"),this.movableCheckbox=document.getElementById("cbxBodyMovable"),this.clickAction={name:"radioBtnMouseAction",buttons:Array.from(document.querySelectorAll('input[name="radioBtnMouseAction"]'))},this.statusBar=(()=>{const i=document.getElementById("statusBar");return{bar:i,fields:Array.from(i.querySelectorAll(".statusBarItem"))}})(),this.registerEvents()}get collisionDetection(){return this.collisionDetectionCheckbox.checked}get elasticCollisions(){return this.elasticCollisionsCheckbox.checked}get gravitationalConstant(){return Z(this.gravitationalConstantInput)}get displayVectors(){return this.displayVectorsCheckbox.checked}get mass(){return Z(this.massInput)}get movable(){return this.movableCheckbox.checked}get selectedClickAction(){return this.getSelectedValue(this.clickAction)??this.clickAction.buttons[0].value}get animationSettings(){return{displayVectors:this.displayVectors}}get simulationSettings(){return{collisionDetection:this.collisionDetection,elasticCollisions:this.elasticCollisions,gravitationalConstant:this.gravitationalConstant}}get bodyInformation(){return{mass:this.mass,movable:this.movable}}registerEvents(){this.resetButton.addEventListener("click",()=>this.resetButtonClicked()),this.playPauseButton.addEventListener("click",()=>this.playPauseClicked()),this.stepButton.addEventListener("click",()=>this.stepButtonClicked()),this.zoomInButton.addEventListener("click",()=>this.zoomInClicked()),this.zoomOutButton.addEventListener("click",()=>this.zoomOutClicked()),this.scrollUpButton.addEventListener("click",()=>this.scrollUpClicked()),this.scrollDownButton.addEventListener("click",()=>this.scrollDownClicked()),this.scrollLeftButton.addEventListener("click",()=>this.scrollLeftClicked()),this.scrollRightButton.addEventListener("click",()=>this.scrollRightClicked()),this.displayVectorsCheckbox.addEventListener("change",()=>this.cbxDisplayVectorsChanged()),this.collisionDetectionCheckbox.addEventListener("change",()=>this.cbxCollisionsChanged()),this.elasticCollisionsCheckbox.addEventListener("change",()=>this.cbxCollisionsChanged()),this.gravitationalConstantInput.addEventListener("change",()=>this.numberInputGChanged()),this.gravitationalConstantRangeInput.addEventListener("input",()=>this.rangeInputGChanged()),this.massInput.addEventListener("change",()=>this.updateSelectedMass())}initialize(t,i){this.elasticCollisionsCheckbox.disabled=!this.collisionDetectionCheckbox.checked,this.massInput.step=this.calculateMassInputStep(),this.setStatusBarVectors(),this.updateStatusBarCanvasDimensions(t,i),this.app.applySimulationSettings({gravitationalConstant:Number(this.gravitationalConstantRangeInput.value)})}resetButtonClicked(){this.app.resetSimulation(),this.updateStatusBarSimulationInfo()}playPauseClicked(){this.app.simulationRunning?this.app.stop():this.app.run()}stepButtonClicked(){this.app.advanceOneTick(),this.updateStatusBarSimulationInfo()}zoomInClicked(){this.app.zoomIn(),this.updateStatusBarAnimationInfo()}zoomOutClicked(){this.app.zoomOut(),this.updateStatusBarAnimationInfo()}scrollUpClicked(){this.app.scrollUp()}scrollDownClicked(){this.app.scrollDown()}scrollLeftClicked(){this.app.scrollLeft()}scrollRightClicked(){this.app.scrollRight()}cbxDisplayVectorsChanged(){this.app.setDisplayVectors(this.displayVectors),this.setStatusBarVectors()}cbxCollisionsChanged(){const t=this.collisionDetectionCheckbox.checked,i=this.elasticCollisionsCheckbox.checked;this.elasticCollisionsCheckbox.disabled=!t;const e={collisionDetection:t,elasticCollisions:i};this.app.applySimulationSettings(e)}numberInputGChanged(){const t=this.gravitationalConstantInput.value;this.gravitationalConstantRangeInput.value=t,this.app.applySimulationSettings({gravitationalConstant:Number(t)})}rangeInputGChanged(){const t=this.gravitationalConstantRangeInput.value;this.gravitationalConstantInput.value!==t&&(this.gravitationalConstantInput.value=t,this.app.applySimulationSettings({gravitationalConstant:Number(t)}))}simulationStopped(){this.playPauseButton.innerHTML="&#9654;",this.stepButton.disabled=!1}simulationResumed(){this.playPauseButton.innerHTML="&#10074;&#10074;",this.stepButton.disabled=!0,this.updateStatusBarSimulationInfo()}getSelectedValue(t){const i=t.buttons.find(e=>e.checked);return(i==null?void 0:i.value)??null}updateSelectedMass(){this.massInput.step=this.calculateMassInputStep()}calculateMassInputStep(){let t=10**(Math.floor(Math.log10(this.mass))-1);return t<1?"1":t.toString()}setStatusBarVectors(){this.displayVectors?this.setStatusMessage(this.statusBarVectorMessage(),3):this.setStatusMessage("",3)}updateStatusBarSimulationInfo(){this.updateStatusBarTickCount(this.app.tick),this.updateStatusBarBodyCount(this.app.currentSimulationState.length)}updateStatusBarAnimationInfo(){this.updateStatusBarZoom(this.app.currentZoom)}updateStatusBarBodyCount(t,i=1){this.setStatusMessage(`Number of Bodies: ${t}`,i)}updateStatusBarTickCount(t,i=2){this.setStatusMessage(`Simulation Tick: ${t}`,i)}updateStatusBarZoom(t,i=4){this.setStatusMessage(`Zoom: ${t.toFixed(2)} (m per pixel)`,i)}updateStatusBarCanvasDimensions(t,i,e=5){this.setStatusMessage(`Canvas dimension: ${t} * ${i}`,e)}statusBarVectorMessage(){var t,i;return`Acceleration: ${(t=_.get("acceleration"))==null?void 0:t.name} - Velocity: ${(i=_.get("velocity"))==null?void 0:i.name}`}setStatusMessage(t,i,e=!1){let s;typeof i=="number"?s=this.statusBar.fields[i-1]:typeof i=="string"?s=document.getElementById(i):s=this.statusBar.fields[0],e?s.innerHTML+=t:s.innerHTML=t}}class at{constructor(){c(this,"_simulationState");c(this,"_running");c(this,"_tickCount");c(this,"_tickLength");c(this,"_collisionDetection");c(this,"_elasticCollisions");c(this,"_g");c(this,"gravityLowerBounds",1);this._simulationState=[],this._running=!1,this._tickCount=0,this._tickLength=10,this._collisionDetection=!1,this._elasticCollisions=!1,this._g=Q}get simulationState(){return this._simulationState}get tick(){return this._tickCount}get running(){return this._running}get collisionSettings(){return{collisionDetection:this._collisionDetection,elastic:this._elasticCollisions}}get g(){return this._g}set g(t){this._g=X(t,j,tt)}set collisionDetection(t){this._collisionDetection=t}set elasticCollisions(t){this._elasticCollisions=t}applySettings(t){t.collisionDetection!=null&&(this.collisionDetection=t.collisionDetection),t.elasticCollisions!=null&&(this.elasticCollisions=t.elasticCollisions),t.gravitationalConstant!=null&&(this.g=t.gravitationalConstant)}addBody(t,i,e){const s={body:t,position:i,velocity:e,acceleration:new a(0,0)};return t.movable||(s.velocity=new a(0,0)),this.addObject(s)}stop(){this._running=!1}run(){if(this._running)return;this._running=!0;const t=()=>{this._running&&(setTimeout(t,this._tickLength),this.advanceTick())};t()}reset(){this.clearObjects(),this._tickCount=0}advanceTick(){this.updateAccelerationVectors(),this.updateVelocitiesAndPositions(),this._collisionDetection&&this.handleCollisions(),this._tickCount++}addObject(t){return t.body.movable||(t.velocity=new a(0,0)),this.simulationState.push(t)}clearObjects(){this._simulationState=[]}removeFromObjectStates(t){this.simulationState[t]=this.simulationState[this.simulationState.length-1],this.simulationState.pop()}updateAccelerationVectors(){const t=this.calculateForces();this.simulationState.forEach((i,e)=>{const o=(t.get(e)||new a(0,0)).scale(1/i.body.mass);i.acceleration=o})}calculateForces(){const t=new Map;for(let i=0;i<this.simulationState.length;i++)for(let e=i+1;e<this.simulationState.length;e++){const s=this.calculateForceBetweenBodies(i,e),o=s.scale(-1);t.set(i,(t.get(i)||new a(0,0)).add(s)),t.set(e,(t.get(e)||new a(0,0)).add(o))}return t}updateVelocityAndPosition(t){const i=this._tickLength/1e3;t.body.movable&&(t.velocity=t.velocity.add(t.acceleration.scale(i)),t.position=t.position.add(t.velocity.scale(i)))}updateVelocitiesAndPositions(){this.simulationState.forEach(t=>{this.updateVelocityAndPosition(t)})}calculateForceBetweenBodies(t,i){const e=this.simulationState[t],s=this.simulationState[i],o=e.position.distance(s.position);if(o<this.gravityLowerBounds||o===0)return new a(0,0);const r=this._g*(e.body.mass*s.body.mass/(o*o));return s.position.subtract(e.position).normalize().scale(r)}handleCollisions(){for(let t=0;t<this.simulationState.length;t++){const i=this.simulationState[t];for(let e=t+1;e<this.simulationState.length;e++){const s=this.simulationState[e],o=i.position.distance(s.position);o<=i.body.radius+s.body.radius&&(o<=i.body.radius||o<=s.body.radius?this.mergeBodies(t,e):this._elasticCollisions&&this.elasticCollision(i,s))}}}mergeBodies(t,i){const e=this.simulationState[t],s=this.simulationState[i],o=e.velocity.scale(e.body.mass).add(s.velocity.scale(s.body.mass)),r=e.body.mass+s.body.mass,u=o.scale(1/r);let l,h;s.body.mass>e.body.mass?(l=s,h=t):(l=e,h=i),l.velocity=u,l.body.setProperties(r),l.body.movable=e.body.movable&&s.body.movable,l.body.movable||(l.velocity=new a(0,0)),this.removeFromObjectStates(h)}elasticCollision(t,i,e=1){const o=t.position.displacementVector(i.position),r=o.magnitude();if(r<=1||r===0)return;const u=o.scale(1/r),h=i.velocity.subtract(t.velocity).dotProduct(u);if(h>0)return;const p=-(1+e)*h/(t.body.mass+i.body.mass),d=u.scale(p*i.body.mass),m=u.scale(p*t.body.mass);t.velocity=t.velocity.subtract(d),i.velocity=i.velocity.add(m),t.body.movable||(t.velocity=new a(0,0),i.velocity=i.velocity.add(d)),i.body.movable||(i.velocity=new a(0,0),t.velocity=t.velocity.add(m))}placeBodiesTangentially(t,i){const e=t.position.displacementVector(i.position),s=e.normalize(),o=t.body.radius+i.body.radius,r=o-e.magnitude();if(o===0)return;const u=s.scale(r*(t.body.radius/o)),l=s.scale(r*(i.body.radius/o));t.position=t.position.subtract(u),i.position=i.position.add(l)}}function T(n,t){const i=t.getBoundingClientRect(),e=n.x-i.left,s=n.y-i.top;return new a(e,s)}function z(n,t){return n.scale(t.currentZoom).hadamardProduct(new a(1,t.orientationY)).add(t.origin)}function N(n,t){const i=n.subtract(t.origin);return new a(i.x,i.y*-1).scale(1/t.currentZoom)}function G(n,t){return new a(n.x,n.y*-1).scale(1/t.currentZoom)}class ct{constructor(t){this.animation=t}get canvasSpace(){return this.animation.canvasSpace}get currentZoom(){return this.canvasSpace.currentZoom}scroll(t){this.moveOrigin(t)}zoomToFactor(t,i){if(t<=0)return this.currentZoom;const e=this.currentZoom,s=e*t,o=e-s;return this.zoomByStep(i,o)}zoomByStep(t,i){let e=this.canvasSpace.currentZoom-i;e<V?(e=V,i=this.canvasSpace.currentZoom-V):e>A&&(e=A,i=A-this.canvasSpace.currentZoom);const s=t.scale(i);return this.moveOrigin(s.hadamardProduct({x:1,y:-1})),this.canvasSpace.currentZoom=e,e}moveOrigin(t){const e=this.canvasSpace.origin.add(t);this.setOrigin(e)}setOrigin(t){this.canvasSpace.origin=t}}class rt{constructor(t,i){c(this,"_canvasSpace");c(this,"_animationSettings");c(this,"_viewController");c(this,"_running");this._canvas=t,this._app=i,this._animationSettings={frameLength:25,displayVectors:!0,tracePaths:!0},this._canvasSpace={origin:new a(0,0),currentZoom:1,orientationY:-1},this._viewController=new ct(this),this._running=!1}get canvas(){return this._canvas}set canvas(t){this._canvas=t}get viewController(){return this._viewController}get animationSettings(){return this._animationSettings}set animationSettings(t){this._animationSettings=t}get canvasSpace(){return this._canvasSpace}set canvasSpace(t){this._canvasSpace=t}get app(){return this._app}get running(){return this._running}set running(t){this._running=t}get currentZoom(){return this.canvasSpace.currentZoom}get width(){return this.canvas.width}get height(){return this.canvas.height}initialize(t,i,e){this.canvas.visibleCanvas.width=t,this.canvas.visibleCanvas.height=i,this.animationSettings.displayVectors=e.displayVectors}run(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.animationSettings.frameLength),this.redrawSimulationState(this.app.currentSimulationState,this.animationSettings),this._app.updateStatusBarSimulationInfo())};t()}stop(){this.running=!1}drawBodies(t){t.forEach(i=>{this.drawBody(i.body,N(i.position,this.canvasSpace))})}drawBody(t,i){let e=Math.max(t.radius/this.currentZoom,st);this.canvas.drawCircle(i,e,t.color)}redrawSimulationState(t,i){this.canvas.clear(),this.canvas.fillCanvas(nt),this.drawBodies(t),i.displayVectors&&this.drawVectors(t)}drawVectors(t){t.forEach(i=>{var r,u;const e=N(i.position,this.canvasSpace),s=G(i.acceleration,this.canvasSpace),o=G(i.velocity,this.canvasSpace);this.canvas.drawVector(e,s,(r=_.get("acceleration"))==null?void 0:r.hex),this.canvas.drawVector(e,o,(u=_.get("velocity"))==null?void 0:u.hex)})}setDisplayVectors(t){this.animationSettings.displayVectors=t}resizeCanvas(t,i){this.canvas.resize(t,i)}scrollRight(t){t||(t=this.scrollDistance("horizontal")),this.viewController.scroll({x:t,y:0})}scrollLeft(t){t||(t=this.scrollDistance("horizontal")),this.viewController.scroll({x:-t,y:0})}scrollUp(t){t||(t=this.scrollDistance("vertical")),this.viewController.scroll({x:0,y:t})}scrollDown(t){t||(t=this.scrollDistance("vertical")),this.viewController.scroll({x:0,y:-t})}scrollDistance(t,i=it){switch(t){case"horizontal":return this.width*i*this.canvasSpace.currentZoom;case"vertical":return this.height*i*this.canvasSpace.currentZoom}}zoomIn(t=new a(this.width/2,this.height/2),i=F){return this.zoomToFactor(1-i,t)}zoomOut(t=new a(this.width/2,this.height/2),i=F){return this.zoomToFactor(1+i,t)}zoomToFactor(t,i){return i||(i=new a(this.width/2,this.height/2)),this.app.updateStatusBarAnimationInfo(),this.viewController.zoomToFactor(t,i)}scrollInCanvasUnits(t){const i=t.scale(this.currentZoom);this.viewController.scroll({x:-i.x,y:i.y})}}var v=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.ManipulateView=2]="ManipulateView",n))(v||{}),f=(n=>(n[n.None=0]="None",n[n.AddBody=1]="AddBody",n[n.Scroll=2]="Scroll",n[n.Zoom=3]="Zoom",n))(f||{}),g=(n=>(n[n.Up=0]="Up",n[n.Down=1]="Down",n))(g||{}),C=(n=>(n[n.Main=0]="Main",n[n.Wheel=1]="Wheel",n[n.Secondary=2]="Secondary",n))(C||{});class lt{constructor(t,i){c(this,"_touchAction",v.None);c(this,"_activeTouches",new Map);c(this,"_previousTouchesMid",null);c(this,"_previousTouchesDist",null);c(this,"_lastSingleTouchPos",null);c(this,"pointer",{main:{state:g.Up,downCoordinatesInSimSpace:void 0},secondary:{state:g.Up},wheel:{state:g.Up}});this.canvas=t,this.app=i,t.addEventListener("pointerdown",e=>this.canvasPointerDown(e)),t.addEventListener("pointerup",e=>this.canvasPointerUp(e)),t.addEventListener("pointermove",e=>this.canvasPointerMoving(e)),t.addEventListener("pointercancel",e=>this.reset()),t.addEventListener("mousedown",e=>this.canvasMouseDown(e)),t.addEventListener("mouseup",e=>this.canvasMouseUp(e)),t.addEventListener("wheel",e=>this.canvasScrollMouseWheel(e)),t.addEventListener("contextmenu",e=>{e.preventDefault()}),t.addEventListener("touchend",e=>{e.preventDefault()},{passive:!1})}get touchAction(){return this._touchAction}set touchAction(t){this._touchAction=t}get activeTouches(){return this._activeTouches}set activeTouches(t){this._activeTouches=t}get lastSingleTouchPos(){return this._lastSingleTouchPos}set lastSingleTouchPos(t){this._lastSingleTouchPos=t}get previousTouchesMid(){return this._previousTouchesMid}set previousTouchesMid(t){this._previousTouchesMid=t}get previousTouchesDist(){return this._previousTouchesDist}set previousTouchesDist(t){this._previousTouchesDist=t}canvasPointerDown(t){if(t.pointerType!=="mouse")switch(this.canvas.setPointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchStart(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerUp(t){if(t.pointerType!=="mouse")switch(this.canvas.releasePointerCapture(t.pointerId),t.pointerType){case"touch":this.canvasTouchEnd(t);break;case"pen":break;default:console.log("unknown pointerType: "+t.pointerType);break}}canvasPointerMoving(t){const i=new a(t.movementX,t.movementY);switch(t.pointerType){case"mouse":this.pointer.wheel.state===g.Down&&(t.preventDefault(),this.app.scrollInCanvasUnits(i));break;case"touch":const e=this.activeTouches.get(t.pointerId);if(!e)return;switch(e.x=t.clientX,e.y=t.clientY,this.touchAction){case v.AddBody:break;case v.ManipulateView:if(this.activeTouches.size===1){if(this.lastSingleTouchPos){const s=e.x-this.lastSingleTouchPos.x,o=e.y-this.lastSingleTouchPos.y;this.app.scrollInCanvasUnits(new a(s,o))}this.lastSingleTouchPos=new a(e.x,e.y);return}else{const s=this.multiTouch();if(!s)return;const o=s.midpoint,r=s.distance;if(this.previousTouchesMid===null||this.previousTouchesDist===null){this.previousTouchesMid=o,this.previousTouchesDist=r;return}const u=r/this.previousTouchesDist,l=T(o,this.canvas),h=o.subtract(this.previousTouchesMid);this.app.zoomToFactor(u,l),this.app.scrollInCanvasUnits(h),this.previousTouchesMid=o,this.previousTouchesDist=r}break}break;case"pen":break;default:console.log("unknown pointerType");break}}deletePointer(t){this.activeTouches.delete(t.pointerId)}canvasScrollMouseWheel(t){t.preventDefault();const i=new a(L(t)),e=T(i,this.canvas);t.deltaY<0?this.app.zoomIn(e):t.deltaY>0&&this.app.zoomOut(e),this.app.updateStatusBarAnimationInfo()}canvasTouchStart(t){const i=new a(t.clientX,t.clientY);if(this.activeTouches.set(t.pointerId,i),this.activeTouches.size===1){this.touchAction=v.AddBody,this.lastSingleTouchPos=i;const e=new a(t.clientX,t.clientY),s=z(e,this.app.canvasSpace);this.pointer.main.downCoordinatesInSimSpace=s}else this.activeTouches.size===2&&(this.touchAction=v.ManipulateView,this.previousTouchesMid=null,this.previousTouchesDist=null,this.lastSingleTouchPos=null)}canvasTouchEnd(t){if(this.activeTouches.has(t.pointerId))switch(this.activeTouches.delete(t.pointerId),this.touchAction){case v.AddBody:const i=L(t);this.addBodyAtPointer(T(i,this.canvas)),this.touchAction=v.None;break;case v.ManipulateView:if(this.previousTouchesMid=null,this.previousTouchesDist=null,this.activeTouches.size===1){const e=this.activeTouches.values().next().value;this.lastSingleTouchPos=new a(e.x,e.y)}else this.activeTouches.size===0&&(this.touchAction=v.None,this.lastSingleTouchPos=null,this.previousTouchesMid=null,this.previousTouchesDist=null);break}}canvasMouseUp(t){const i=new a(L(t));switch(t.button){case C.Main:this.pointer.main.state=g.Up,this.canvasMainMouseUp(i);break;case C.Wheel:this.pointer.wheel.state=g.Up,t.preventDefault();break;case C.Secondary:this.pointer.secondary.state=g.Up;break}}canvasMouseDown(t){const i=new a(t.clientX,t.clientY);switch(t.button){case C.Main:this.pointer.main.state=g.Down,this.canvasMainMouseDown(i);break;case C.Wheel:this.pointer.wheel.state=g.Down,t.preventDefault();break;case C.Secondary:this.pointer.secondary.state=g.Down;break}}canvasMainMouseDown(t){switch(f[this.app.selectedClickAction]){case f.None:break;case f.AddBody:const i=new a(t.x,t.y),e=z(i,this.app.canvasSpace);this.pointer.main.downCoordinatesInSimSpace=e;break}}canvasMainMouseUp(t){switch(f[this.app.selectedClickAction]){case f.None:break;case f.AddBody:this.addBodyAtPointer(T(t,this.canvas));break}}updateTouchPosition(t,i,e){const s=this.activeTouches.get(t);s&&(s.x=i,s.y=e)}multiTouch(){if(this.activeTouches.size<2)return null;const t=this.activeTouches.values(),i=new a(t.next().value),e=new a(t.next().value),s=a.midpoint(i,e),o=new a(i).distance(e);return Math.hypot(e.x-i.x,e.y-i.y),{first:i,second:e,midpoint:s,distance:o}}reset(){this.touchAction=v.None,this.activeTouches.clear(),this.previousTouchesMid=null,this.previousTouchesDist=null,this.lastSingleTouchPos=null}addBodyAtPointer(t){const i=this.app.body2dFromUi(),e=z(t,this.app.canvasSpace),s=K(this.pointer.main.downCoordinatesInSimSpace,e);this.app.addBody(i,e,s),this.app.updateStatusBarSimulationInfo()}}class ht{constructor(t){c(this,"_visibleCanvasContext");this._visibleCanvas=t,this._visibleCanvasContext=t.getContext("2d",{alpha:!1})}get visibleCanvas(){return this._visibleCanvas}get visibleCanvasContext(){return this._visibleCanvasContext}get width(){return this.visibleCanvas.width}get height(){return this.visibleCanvas.height}resize(t,i){this.visibleCanvas.width=t,this.visibleCanvas.height=i}clear(){this.visibleCanvasContext.clearRect(0,0,this.width,this.height)}fillCanvas(t="#000000"){this.visibleCanvasContext.fillStyle=t,this.visibleCanvasContext.fillRect(0,0,this.width,this.height)}drawVector(t,i,e="white"){let s=t.add(i);this.isLineVisible(t,s)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.lineWidth=et,this.visibleCanvasContext.strokeStyle=e,this.visibleCanvasContext.moveTo(t.x,t.y),this.visibleCanvasContext.lineTo(s.x,s.y),this.visibleCanvasContext.stroke())}drawCircle(t,i,e="white"){this.isCircleVisible(t,i)&&(this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.arc(t.x,t.y,i,0,Math.PI*2),this.visibleCanvasContext.closePath(),this.visibleCanvasContext.fillStyle=e,this.visibleCanvasContext.fill())}isCircleVisible(t,i){const e=t.x+i>=0,s=t.x-i<=this.visibleCanvas.width,o=t.y+i>=0,r=t.y-i<=this.visibleCanvas.height;return e&&s&&o&&r}isLineVisible(t,i){return!!(k(t.x,0,this.visibleCanvas.width)&&k(t.y,0,this.visibleCanvas.height)||k(i.x,0,this.visibleCanvas.width)&&k(i.y,0,this.visibleCanvas.height)||a.linesIntersecting([t,i],[new a(0,0),new a(this.visibleCanvas.width,0)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,0),new a(this.visibleCanvas.width,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(this.visibleCanvas.width,this.visibleCanvas.height),new a(0,this.visibleCanvas.height)],!0)||a.linesIntersecting([t,i],[new a(0,this.visibleCanvas.height),new a(0,0)],!0))}}const D=class D{constructor(t,i,e,s){c(this,"_radius");c(this,"_color");c(this,"_movable");this._mass=t,s===void 0&&(s=this.defaultRadius(t)),this.radius=s,e===void 0&&(e=this.massDependentColor(t)),this.color=e,i===void 0&&(i=!0),this.movable=i}get mass(){return this._mass}set mass(t){this._mass=Math.max(t,1)}get radius(){return this._radius}set radius(t){this._radius=Math.max(t,1)}get movable(){return this._movable}set movable(t){this._movable=t}get color(){return this._color}set color(t){CSS.supports("color",t)||(t="#818181ff"),this._color=t}defaultRadius(t){return t||(t=this.mass),(3*t/(4*Math.PI*D.defaultDensity))**(1/3)}setProperties(t,i,e){e?(this.color=e,this.radius=+i):i?typeof i=="string"?(this.color=i,this.radius=this.defaultRadius(t)):typeof i=="number"&&(this.color=this.massDependentColor(t),this.radius=i):(this.color=this.massDependentColor(t),this.radius=this.defaultRadius(t)),this._mass=t}massDependentColor(t){if(t<=50)return"#ff0000ff";if(t>=1e8)return"#0000ffff";const o=Math.sqrt(50*1e8);let r,u,l;if(t<o){const h=(Math.log(t)-Math.log(50))/(Math.log(o)-Math.log(50));r=255,u=Math.round(255*h),l=Math.round(255*h)}else{const h=(Math.log(t)-Math.log(o))/(Math.log(1e8)-Math.log(o));r=Math.round(255*(1-h)),u=Math.round(255*(1-h)),l=255}return`#${P(r)}${P(u)}${P(l)}ff`}};c(D,"defaultDensity",1);let O=D;class ut{constructor(){c(this,"_gravity");c(this,"_animation");c(this,"_interaction");c(this,"_ui");const t=document.getElementById("theCanvas");if(!t)throw new Error("canvasElement not found");const i=new ht(t);this._gravity=new at,this._animation=new rt(i,this),this._ui=new ot(this),this._interaction=new lt(i.visibleCanvas,this),this.initialize()}get gravity(){return this._gravity}get animation(){return this._animation}get interaction(){return this._interaction}get ui(){return this._ui}get simulationRunning(){return this.gravity.running}get currentSimulationState(){return this.gravity.simulationState}get canvasSpace(){return this.animation.canvasSpace}get selectedClickAction(){return this.ui.selectedClickAction}get tick(){return this.gravity.tick}get currentZoom(){return this.animation.currentZoom}initialize(){const t=window.innerWidth,i=window.innerHeight;this.animation.initialize(t,i,this.ui.animationSettings),this.applySimulationSettings(this.ui.simulationSettings),this.ui.initialize(t,i),this.animation.run()}run(){this.gravity.run(),this.ui.simulationResumed()}stop(){this.gravity.stop(),this.ui.simulationStopped()}advanceOneTick(){this.gravity.advanceTick(),this.ui.updateStatusBarSimulationInfo()}resetSimulation(){this.gravity.reset(),this.ui.updateStatusBarSimulationInfo()}applySimulationSettings(t){this.gravity.applySettings(t)}addBody(t,i,e){return this.gravity.addBody(t,i,e)}zoomToFactor(t,i){this.animation.zoomToFactor(t,i)}zoomIn(t,i){this.animation.zoomIn(t,i)}zoomOut(t,i){this.animation.zoomOut(t,i)}scrollInCanvasUnits(t){this.animation.scrollInCanvasUnits(t)}scrollUp(){this.animation.scrollUp()}scrollDown(){this.animation.scrollDown()}scrollLeft(){this.animation.scrollLeft()}scrollRight(){this.animation.scrollRight()}resizeCanvas(t,i){this.animation.resizeCanvas(t,i),this.ui.updateStatusBarCanvasDimensions(t,i)}setDisplayVectors(t){this.animation.setDisplayVectors(t)}updateStatusBarAnimationInfo(){this.ui.updateStatusBarAnimationInfo()}updateStatusBarSimulationInfo(){this.ui.updateStatusBarSimulationInfo()}body2dFromUi(){const t=this.ui.bodyInformation;return new O(t.mass,t.movable)}}let R;document.addEventListener("DOMContentLoaded",$);function $(){R=new ut,dt(),R.run()}function dt(){document.removeEventListener("DOMContentLoaded",$),window.addEventListener("resize",pt)}function pt(n){let t=this.innerWidth,i=this.innerHeight;R.resizeCanvas(t,i)}
//# sourceMappingURL=index-CNMqJtYB.js.map
