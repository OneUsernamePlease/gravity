var U=Object.defineProperty;var Z=(i,t,e)=>t in i?U(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var u=(i,t,e)=>Z(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(a){if(a.ep)return;a.ep=!0;const c=e(a);fetch(a.href,c)}})();class l{constructor(t,e){u(this,"x");u(this,"y");t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}toString(){return`x: ${this.x}, y: ${this.y}`}add(...t){return t.reduce((n,a)=>new l(n.x+a.x,n.y+a.y),new l(this.x,this.y))}subtract(t){return new l(this.x-t.x,this.y-t.y)}scale(t){return new l(this.x*t,this.y*t)}dotProduct(t){return this.x*t.x+this.y*t.y}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return t===0?new l(0,0):this.scale(1/t)}distance(t){return Math.sqrt((t.x-this.x)**2+(t.y-this.y)**2)}displacementVector(t){return t.subtract(this)}hadamardProduct(t){return new l(this.x*t.x,this.y*t.y)}}const E=class E{constructor(t,e,n,a){u(this,"_mass");u(this,"_radius");u(this,"_color");u(this,"_movable");this._mass=t,a===void 0&&(a=this.defaultRadius(t)),this._radius=a,n===void 0&&(n="white"),this._color=n,e===void 0&&(e=!0),this._movable=e}get mass(){return this._mass}set mass(t){this._mass=t}get radius(){return this._radius}set radius(t){this._radius=t}get movable(){return this._movable}set movable(t){this._movable=t}get color(){return this._color}set color(t){CSS.supports("color",t)||(t="white"),this._color=t}defaultRadius(t){return t===void 0&&(t=this.mass),(3*t/(4*Math.PI*E.defaultDensity))**(1/3)}};u(E,"defaultDensity",1);let B=E;class J{constructor(){u(this,"_simulationState");u(this,"_running");u(this,"_tickCount");u(this,"_tickLength");u(this,"_collisionDetection");u(this,"_elasticCollisions");u(this,"_g");u(this,"gravityLowerBounds",1);this._simulationState=[],this._running=!1,this._tickCount=0,this._tickLength=10,this._collisionDetection=!1,this._elasticCollisions=!1,this._g=50}get simulationState(){return this._simulationState}set simulationState(t){this._simulationState=t}get running(){return this._running}set running(t){this._running=t}get tickCount(){return this._tickCount}set tickCount(t){this._tickCount=t}get tickLength(){return this._tickLength}set tickLength(t){this._tickLength=t}get collisionDetection(){return this._collisionDetection}set collisionDetection(t){this._collisionDetection=t}get elasticCollisions(){return this._elasticCollisions}set elasticCollisions(t){this._elasticCollisions=t}get g(){return this._g}set g(t){this._g=t}addObject(t,e,n){return t instanceof B&&(t={body:t,position:e,velocity:n,acceleration:new l(0,0)}),t.body.movable||(t.velocity=new l(0,0)),this.simulationState.push(t)}clearObjects(){this.simulationState=[]}removeFromObjectStates(t){this.simulationState.splice(t,1)}pause(){this.running=!1}nextState(){this.updateAccelerationVectors(),this.updateVelocitiesAndPositions(),this.collisionDetection&&this.handleCollisions(),this.tickCount++}updateAccelerationVectors(){const t=this.calculateForces();this.simulationState.forEach((e,n)=>{const c=(t.get(n)||new l(0,0)).scale(1/e.body.mass);e.acceleration=c})}calculateForces(){const t=new Map;for(let e=0;e<this.simulationState.length;e++)for(let n=e+1;n<this.simulationState.length;n++){const a=this.calculateForceBetweenBodies(e,n),c=a.scale(-1);t.set(e,(t.get(e)||new l(0,0)).add(a)),t.set(n,(t.get(n)||new l(0,0)).add(c))}return t}updateVelocityAndPosition(t){const e=this.tickLength/1e3;t.body.movable&&(t.velocity=t.velocity.add(t.acceleration.scale(e)),t.position=t.position.add(t.velocity.scale(e)))}updateVelocitiesAndPositions(){this.simulationState.forEach(t=>{this.updateVelocityAndPosition(t)})}calculateForceBetweenBodies(t,e){const n=this.simulationState[t],a=this.simulationState[e],c=n.position.distance(a.position);if(c<this.gravityLowerBounds||c===0)return new l(0,0);const r=this.g*(n.body.mass*a.body.mass/(c*c));return a.position.subtract(n.position).normalize().scale(r)}handleCollisions(){for(let t=0;t<this.simulationState.length;t++){const e=this.simulationState[t];if(e!==void 0)for(let n=t+1;n<this.simulationState.length;n++){const a=this.simulationState[n],c=e.position.distance(a.position);c<=e.body.radius+a.body.radius&&(c<=e.body.radius||c<=a.body.radius?this.mergeBodies(t,n):this.elasticCollisions&&this.elasticCollision(e,a))}}}mergeBodies(t,e){const n=this.simulationState[t],a=this.simulationState[e],c=n.velocity.scale(n.body.mass).add(a.velocity.scale(a.body.mass)),r=n.body.mass+a.body.mass,v=c.scale(1/r);let d,p;a.body.mass>n.body.mass?(d=a,p=t):(d=n,p=e),d.velocity=v,d.body.mass=r,d.body.radius=d.body.defaultRadius(),d.body.movable=n.body.movable&&a.body.movable,d.body.movable||(d.velocity=new l(0,0)),this.removeFromObjectStates(p)}elasticCollision(t,e,n=1){const c=t.position.displacementVector(e.position),r=c.magnitude();if(r<=1||r===0)return;const v=c.scale(1/r),p=e.velocity.subtract(t.velocity).dotProduct(v);if(p>0)return;const C=-(1+n)*p/(t.body.mass+e.body.mass),b=v.scale(C*e.body.mass),w=v.scale(C*t.body.mass);t.velocity=t.velocity.subtract(b),e.velocity=e.velocity.add(w),t.body.movable||(t.velocity=new l(0,0),e.velocity=e.velocity.add(b)),e.body.movable||(e.velocity=new l(0,0),t.velocity=t.velocity.add(w))}placeOverlappingBodiesTangentially(t,e){const n=t.position.displacementVector(e.position),a=n.normalize(),c=t.body.radius+e.body.radius,r=c-n.magnitude(),v=a.scale(r*(t.body.radius/c)),d=a.scale(r*(e.body.radius/c));t.position=t.position.subtract(v),e.position=e.position.add(d)}run(){if(this.running)return;this.running=!0;const t=()=>{this.running&&(setTimeout(t,this.tickLength),this.nextState())};t()}}var m=(i=>(i[i.None=0]="None",i[i.AddBody=1]="AddBody",i[i.ScrollCanvas=2]="ScrollCanvas",i))(m||{}),g=(i=>(i[i.Up=0]="Up",i[i.Down=1]="Down",i))(g||{});class q{constructor(t){u(this,"_visibleCanvas");u(this,"_visibleCanvasContext");u(this,"_canvasSpace");u(this,"_animationSettings");u(this,"_animationRunning");this._visibleCanvas=t,this._visibleCanvasContext=t.getContext("2d"),this._canvasSpace={origin:new l(0,0),zoomFactor:1,orientationY:-1},this._animationSettings={defaultScrollRate:.1,defaultZoomStep:1,frameLength:25,displayVectors:!0,tracePaths:!1},this._animationRunning=!1}get visibleCanvas(){return this._visibleCanvas}set visibleCanvas(t){this._visibleCanvas=t}get visibleCanvasContext(){return this._visibleCanvasContext}set visibleCanvasContext(t){this._visibleCanvasContext=t}get canvasSpace(){return this._canvasSpace}set canvasSpace(t){this._canvasSpace=t}get animationSettings(){return this._animationSettings}set animationSettings(t){this._animationSettings=t}get animationRunning(){return this._animationRunning}set animationRunning(t){this._animationRunning=t}drawVector(t,e,n){n===void 0&&(n="white");let a=t.add(e);this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.lineWidth=3,this.visibleCanvasContext.strokeStyle=n,this.visibleCanvasContext.moveTo(t.x,t.y),this.visibleCanvasContext.lineTo(a.x,a.y),this.visibleCanvasContext.stroke()}drawVectors(t){t.forEach(e=>{this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(e.position),this.directionFromSimulationSpaceToCanvasSpace(e.acceleration),"green"),this.drawVector(this.pointFromSimulationSpaceToCanvasSpace(e.position),this.directionFromSimulationSpaceToCanvasSpace(e.velocity),"red")})}drawBody(t,e){let n=Math.max(t.radius/this.canvasSpace.zoomFactor,1);this.visibleCanvasContext.beginPath(),this.visibleCanvasContext.arc(e.x,e.y,n,0,Math.PI*2),this.visibleCanvasContext.closePath(),this.visibleCanvasContext.fillStyle=t.color,this.visibleCanvasContext.fill()}drawBodies(t){t.forEach(e=>{this.drawBody(e.body,this.pointFromSimulationSpaceToCanvasSpace(e.position))})}redrawSimulationState(t,e){this.visibleCanvasContext.clearRect(0,0,this.visibleCanvas.width,this.visibleCanvas.height),this.drawBodies(t),e&&this.drawVectors(t)}pointFromSimulationSpaceToCanvasSpace(t){const e=t.subtract(this.canvasSpace.origin);return new l(e.x,e.y*-1).scale(1/this.canvasSpace.zoomFactor)}directionFromSimulationSpaceToCanvasSpace(t){return new l(t.x,t.y*-1).scale(1/this.canvasSpace.zoomFactor)}pointFromCanvasSpaceToSimulationSpace(t){let e;return e=t.scale(this.canvasSpace.zoomFactor).hadamardProduct(new l(1,this.canvasSpace.orientationY)).add(this.canvasSpace.origin),e}setCanvasOrigin(t){this.canvasSpace.origin=t}moveCanvasRight(t){const e=this.calculateScrollDistance("horizontal",t);this.setCanvasOrigin(new l(this.canvasSpace.origin.x+e,this.canvasSpace.origin.y))}moveCanvasLeft(t){const e=this.calculateScrollDistance("horizontal",t);this.setCanvasOrigin(new l(this.canvasSpace.origin.x-e,this.canvasSpace.origin.y))}moveCanvasUp(t){const e=this.calculateScrollDistance("vertical",t);this.setCanvasOrigin(new l(this.canvasSpace.origin.x,this.canvasSpace.origin.y+e))}moveCanvasDown(t){const e=this.calculateScrollDistance("vertical",t);this.setCanvasOrigin(new l(this.canvasSpace.origin.x,this.canvasSpace.origin.y-e))}calculateScrollDistance(t,e){switch(e===void 0&&(e=this.animationSettings.defaultScrollRate),t){case"horizontal":return this.visibleCanvas.width*e*this.canvasSpace.zoomFactor;case"vertical":return this.visibleCanvas.height*e*this.canvasSpace.zoomFactor}}zoomOut(t){const e=this.canvasSpace.zoomFactor+this.animationSettings.defaultZoomStep;let n=t.scale(this.animationSettings.defaultZoomStep);this.canvasSpace.origin=new l(this.canvasSpace.origin.x-n.x,this.canvasSpace.origin.y+n.y),this.canvasSpace.zoomFactor=e}zoomIn(t){if(this.canvasSpace.zoomFactor<=1)return;let e=this.canvasSpace.zoomFactor-this.animationSettings.defaultZoomStep,n=t.scale(this.animationSettings.defaultZoomStep);this.canvasSpace.origin=new l(this.canvasSpace.origin.x+n.x,this.canvasSpace.origin.y-n.y),this.canvasSpace.zoomFactor=e}getCanvasMousePosition(t){const e=this.visibleCanvas.getBoundingClientRect(),n=t.clientX-e.left,a=t.clientY-e.top;return new l(n,a)}getCanvasTouchPosition(t){const e=this.visibleCanvas.getBoundingClientRect(),n=t.touches[0];return new l(n.clientX-e.left,n.clientY-e.top)}getCanvasTouchEndPosition(t){const e=this.visibleCanvas.getBoundingClientRect(),n=t.changedTouches[0];return new l(n.clientX-e.left,n.clientY-e.top)}}function H(i){const t=new Date,e=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),a=t.getSeconds().toString().padStart(2,"0"),c=t.getMilliseconds().toString().padStart(3,"0"),r=`${e}:${n}:${a}.${c}`;console.log(`[${r}] ${i}`)}function M(i){return i=i.trim(),!isNaN(+i)&&i.length!==0}function Y(i){let t;return t=document.getElementById(i),t.value.trim()}function X(i){let t;return t=Y(i),M(t)?+t:0}function f(i){let t;return typeof i=="string"?t=document.getElementById(i):t=i,t?t.checked:!1}let s,o,k={fields:[]},x,S=g.Up,_=new l(0,0),y;document.addEventListener("DOMContentLoaded",R);function R(){ft(),W(),yt(1280,720),St(),x=X("massInput"),document.getElementById("massInput").step=z(),y=document.querySelector('input[name="radioBtnMouseAction"]:checked').value,document.getElementById("cbxElasticCollisions").disabled=!o.collisionDetection,document.removeEventListener("DOMContentLoaded",R)}function W(){var i,t,e,n,a,c,r,v,d,p,C,b,w,L,I,T,F,V,P,D;(i=document.getElementById("btnToggleSim"))==null||i.addEventListener("click",ct),(t=document.getElementById("btnNextStep"))==null||t.addEventListener("click",lt),(e=document.getElementById("btnResetSim"))==null||e.addEventListener("click",rt),(n=document.getElementById("btnZoomOut"))==null||n.addEventListener("click",K),(a=document.getElementById("btnZoomIn"))==null||a.addEventListener("click",G),(c=document.getElementById("btnScrollLeft"))==null||c.addEventListener("click",Q),(r=document.getElementById("btnScrollRight"))==null||r.addEventListener("click",j),(v=document.getElementById("btnScrollUp"))==null||v.addEventListener("click",tt),(d=document.getElementById("btnScrollDown"))==null||d.addEventListener("click",et),(p=document.getElementById("theCanvas"))==null||p.addEventListener("mousedown",ut),(C=document.getElementById("theCanvas"))==null||C.addEventListener("mouseup",mt),(b=document.getElementById("theCanvas"))==null||b.addEventListener("mouseout",ht),(w=document.getElementById("theCanvas"))==null||w.addEventListener("mousemove",dt),(L=document.getElementById("theCanvas"))==null||L.addEventListener("touchstart",vt),(I=document.getElementById("theCanvas"))==null||I.addEventListener("touchend",pt),(T=document.getElementById("theCanvas"))==null||T.addEventListener("touchmove",gt),(F=document.getElementById("massInput"))==null||F.addEventListener("change",it),(V=document.getElementById("cbxDisplayVectors"))==null||V.addEventListener("change",at),(P=document.getElementById("cbxCollisions"))==null||P.addEventListener("change",nt),(D=document.getElementById("cbxElasticCollisions"))==null||D.addEventListener("change",st),document.querySelectorAll('input[name="radioBtnMouseAction"]').forEach(A=>{A.addEventListener("change",ot)})}function K(i){s.zoomOut(new l(s.visibleCanvas.width/2,s.visibleCanvas.height/2)),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors),h(`Zoom: ${s.canvasSpace.zoomFactor} (m per pixel)`,4)}function G(i){s.zoomIn(new l(s.visibleCanvas.width/2,s.visibleCanvas.height/2)),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors),h(`Zoom: ${s.canvasSpace.zoomFactor} (m per pixel)`,4)}function Q(i){s.moveCanvasLeft(),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function j(i){s.moveCanvasRight(),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function tt(i){s.moveCanvasUp(),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function et(i){s.moveCanvasDown(),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function it(){const i=this,t=i.value;x=M(t)?+t:0,i.step=z()}function nt(i){const t=f(i.target),e=document.getElementById("cbxElasticCollisions"),n=f(e);o.collisionDetection=t,o.elasticCollisions=n,e.disabled=!t}function st(i){const t=f(i.target);o.elasticCollisions=t}function at(i){const t=i.target;s.animationSettings.displayVectors=t?t.checked:!1,s.animationRunning||s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function ot(i){const t=i.target;t&&t.type==="radio"&&(y=t.value)}function ct(i){o.running?N():Ct()}function lt(){s.animationRunning||(o.nextState(),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors),h(`Simulation Tick: ${o.tickCount}`,2),h(`Number of Bodies: ${o.simulationState.length}`,1))}function rt(){o.running&&N(),o.clearObjects(),o.tickCount=0,s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors),h(`Simulation Tick: ${o.tickCount}`,2),h(`Number of Bodies: ${o.simulationState.length}`,1)}function ut(i){if(i.button!==0)return;S=g.Down;const t=s.getCanvasMousePosition(i);switch(m[y]){case m.None:break;case m.AddBody:_=t;break}}function dt(i){g.Up}function mt(i){if(i.button!==0||S===g.Up)return;S=g.Up;const t=s.getCanvasMousePosition(i);switch(m[y]){case m.None:break;case m.AddBody:const e=O();if(e.mass<=0)break;const n=$(s.pointFromCanvasSpaceToSimulationSpace(_),s.pointFromCanvasSpaceToSimulationSpace(t));o.addObject(e,s.pointFromCanvasSpaceToSimulationSpace(t),n),h(`Number of Bodies: ${o.simulationState.length}`,1);break}s.animationRunning||s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function ht(i){S=g.Up}function vt(i){S=g.Down;const t=s.getCanvasTouchPosition(i);switch(m[y]){case m.None:break;case m.AddBody:i.preventDefault(),_=t;break}}function gt(i){const t=s.getCanvasTouchEndPosition(i);H(t.toString()),(t.x>s.visibleCanvas.width||t.y>s.visibleCanvas.height)&&(S=g.Up)}function pt(i){if(S===g.Up)return;S=g.Up;const t=s.getCanvasTouchEndPosition(i);switch(m[y]){case m.None:break;case m.AddBody:const e=O();if(e.mass<=0)break;const n=$(s.pointFromCanvasSpaceToSimulationSpace(_),s.pointFromCanvasSpaceToSimulationSpace(t));o.addObject(e,s.pointFromCanvasSpaceToSimulationSpace(t),n),h(`Number of Bodies: ${o.simulationState.length}`,1);break}s.animationRunning||s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors)}function St(){o=new J,o.collisionDetection=f("cbxCollisions"),o.elasticCollisions=f("cbxElasticCollisions")}function ft(){const i="statusText";let t=1,e=document.getElementById(i+t);for(;e!==null;)k.fields.push(e),t++,e=document.getElementById(i+t)}function z(){let i=10**(Math.floor(Math.log10(x))-1);return i<1?"1":i.toString()}function O(){const i=f("cvsCbxBodyMovable");return new B(x,i)}function h(i,t,e=!1){let n;typeof t=="number"?n=k.fields[t-1]:typeof t=="string"?n=document.getElementById(t):n=k.fields[0],e?n.innerHTML+=i:n.innerHTML=i}function yt(i,t){const e=document.getElementById("theCanvas");s=new q(e),s.visibleCanvas.width=i,s.visibleCanvas.height=t,s.animationSettings.displayVectors=f("cbxDisplayVectors"),h(`Canvas dimension: ${i} * ${t}`,5)}function $(i,t,e=1){return e<=0&&(e=1),i.subtract(t).scale(1/e)}function Ct(){o.running||(o.run(),bt(),h(`Number of Bodies: ${o.simulationState.length}`,1),document.getElementById("btnToggleSim").innerHTML="Pause")}function N(){o.running&&(s.animationRunning=!1,o.pause(),document.getElementById("btnToggleSim").innerHTML="Play")}function bt(){if(s.animationRunning)return;s.animationRunning=!0;const i=()=>{s.animationRunning&&(setTimeout(i,s.animationSettings.frameLength),s.redrawSimulationState(o.simulationState,s.animationSettings.displayVectors),h(`Simulation Tick: ${o.tickCount}`,2),h(`Number of Bodies: ${o.simulationState.length}`,1))};i()}
//# sourceMappingURL=index-Dttp6zJv.js.map
